/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery.min.map
*/

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

(function(){function setTimeout(e){e()}var _setTimeoutBackup=window.setTimeout,requirejs,require,define;(function(e){function t(e,t){return g.call(e,t)}function n(e,t){var n,r,i,s,o,u,a,f,l,c,h=t&&t.split("/"),p=v.map,d=p&&p["*"]||{};if(e&&e.charAt(0)===".")if(t){h=h.slice(0,h.length-1),e=h.concat(e.split("/"));for(f=0;f<e.length;f+=1){c=e[f];if(c===".")e.splice(f,1),f-=1;else if(c===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((h||d)&&p){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(h)for(l=h.length;l>0;l-=1){i=p[h.slice(0,l).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&d&&d[r]&&(u=d[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function r(t,n){return function(){return l.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function s(e){return function(t){p[e]=t}}function o(n){if(t(d,n)){var r=d[n];delete d[n],m[n]=!0,f.apply(e,r)}if(!t(p,n)&&!t(m,n))throw new Error("No "+n);return p[n]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e){return function(){return v&&v.config&&v.config[e]||{}}}var f,l,c,h,p={},d={},v={},m={},g=Object.prototype.hasOwnProperty,y=[].slice;c=function(e,t){var r,s=u(e),a=s[0];return e=s[1],a&&(a=n(a,t),r=o(a)),a?r&&r.normalize?e=r.normalize(e,i(t)):e=n(e,t):(e=n(e,t),s=u(e),a=s[0],e=s[1],a&&(r=o(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:r}},h={require:function(e){return r(e)},exports:function(e){var t=p[e];return typeof t!="undefined"?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:a(e)}}},f=function(n,i,u,a){var f,l,v,g,y,b=[],w;a=a||n;if(typeof u=="function"){i=!i.length&&u.length?["require","exports","module"]:i;for(y=0;y<i.length;y+=1){g=c(i[y],a),l=g.f;if(l==="require")b[y]=h.require(n);else if(l==="exports")b[y]=h.exports(n),w=!0;else if(l==="module")f=b[y]=h.module(n);else if(t(p,l)||t(d,l)||t(m,l))b[y]=o(l);else{if(!g.p)throw new Error(n+" missing "+l);g.p.load(g.n,r(a,!0),s(l),{}),b[y]=p[l]}}v=u.apply(p[n],b);if(n)if(f&&f.exports!==e&&f.exports!==p[n])p[n]=f.exports;else if(v!==e||!w)p[n]=v}else n&&(p[n]=u)},requirejs=require=l=function(t,n,r,i,s){return typeof t=="string"?h[t]?h[t](n):o(c(t,n).f):(t.splice||(v=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=i,i=s),i?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},4),l)},l.config=function(e){return v=e,v.deps&&l(v.deps,v.callback),l},requirejs._defined=p,define=function(e,n,r){n.splice||(r=n,n=[]),!t(p,e)&&!t(d,e)&&(d[e]=[e,n,r])},define.amd={jQuery:!0}})(),define("../../build/almond",function(){}),function(e,t){function H(e){var t=e.length,n=w.type(e);return w.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function j(e){var t=B[e]={};return w.each(e.match(S)||[],function(e,n){t[n]=!0}),t}function q(e,n,r,i){if(w.acceptData(e)){var s,o,u=w.expando,a=e.nodeType,f=a?w.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||r!==t||"string"!=typeof n)return l||(l=a?e[u]=c.pop()||w.guid++:u),f[l]||(f[l]=a?{}:{toJSON:w.noop}),("object"==typeof n||"function"==typeof n)&&(i?f[l]=w.extend(f[l],n):f[l].data=w.extend(f[l].data,n)),o=f[l],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[w.camelCase(n)]=r),"string"==typeof n?(s=o[n],null==s&&(s=o[w.camelCase(n)])):s=o,s}}function R(e,t,n){if(w.acceptData(e)){var r,i,s=e.nodeType,o=s?w.cache:e,u=s?e[w.expando]:w.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){w.isArray(t)?t=t.concat(w.map(t,w.camelCase)):t in r?t=[t]:(t=w.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!z(r):!w.isEmptyObject(r))return}(n||(delete o[u].data,z(o[u])))&&(s?w.cleanData([e],!0):w.support.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function U(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(I,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:F.test(r)?w.parseJSON(r):r}catch(s){}w.data(e,n,r)}else r=t}return r}function z(e){var t;for(t in e)if(("data"!==t||!w.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function st(){return!1}function ot(){try{return o.activeElement}catch(e){}}function ct(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ht(e,t,n){if(w.isFunction(t))return w.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return w.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(ut.test(t))return w.filter(t,e,n);t=w.filter(t,e)}return w.grep(e,function(e){return w.inArray(e,t)>=0!==n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return w.nodeName(e,"table")&&w.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function _t(e){return e.type=(null!==w.find.attr(e,"type"))+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)w._data(n,"globalEval",!t||w._data(t[r],"globalEval"))}function Ht(e,t){if(1===t.nodeType&&w.hasData(e)){var n,r,i,s=w._data(e),o=w._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)w.event.add(t,n,u[n][r])}o.data&&(o.data=w.extend({},o.data))}}function Bt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!w.support.noCloneEvent&&t[w.expando]){i=w._data(t);for(r in i.events)w.removeEvent(t,r,i.handle);t.removeAttribute(w.expando)}"script"===n&&t.text!==e.text?(_t(t).text=e.text,Dt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),w.support.html5Clone&&e.innerHTML&&!w.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&xt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;null!=(s=r[o]);o++)!n||w.nodeName(s,n)?u.push(s):w.merge(u,jt(s,n));return n===t||n&&w.nodeName(e,n)?w.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===w.css(e,"display")||!w.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;u>o;o++)r=e[o],r.style&&(s[o]=w._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(s[o]=w._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&"none"!==n||!i)&&w._data(r,"olddisplay",i?n:w.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;for(;4>s;s+=2)"margin"===n&&(o+=w.css(e,n+Zt[s],!0,i)),r?("content"===n&&(o-=w.css(e,"padding"+Zt[s],!0,i)),"margin"!==n&&(o-=w.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=w.css(e,"padding"+Zt[s],!0,i),"padding"!==n&&(o+=w.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=qt(e),o=w.support.boxSizing&&"border-box"===w.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Rt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Jt.test(i))return i;r=o&&(w.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=o,n=Qt[e];return n||(n=fn(e,t),"none"!==n&&n||(It=(It||w("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach()),Qt[e]=n),n}function fn(e,t){var n=w(t.createElement(e)).appendTo(t.body),r=w.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(w.isArray(t))w.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==w.type(t))r(e,t);else for(i in t)vn(e+"["+i+"]",t[i],n,r)}function _n(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(S)||[];if(w.isFunction(n))while(r=s[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,n,r,i){function u(a){var f;return s[a]=!0,w.each(e[a]||[],function(e,a){var l=a(n,r,i);return"string"!=typeof l||o||s[l]?o?!(f=l):t:(n.dataTypes.unshift(l),u(l),!1)}),f}var s={},o=e===An;return u(n.dataTypes[0])||!s["*"]&&u("*")}function Pn(e,n){var r,i,s=w.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&w.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes;while("*"===f[0])f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}return o?(o!==f[0]&&f.unshift(o),r[o]):t}function Bn(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=w.now()}function Zn(e,t,n){var r,i=(Gn[t]||[]).concat(Gn["*"]),s=0,o=i.length;for(;o>s;s++)if(r=i[s].call(n,t,e))return r}function er(e,t,n){var r,i,s=0,o=Qn.length,u=w.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(tr(l,f.opts.specialEasing);o>s;s++)if(r=Qn[s].call(f,e,l,f.opts))return r;return w.map(l,Zn,f),w.isFunction(f.opts.start)&&f.opts.start.call(e,f),w.fx.timer(w.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(n in e)if(r=w.camelCase(n),i=t[r],s=e[n],w.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=w.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function nr(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&nn(e),p=w._data(e,"fxshow");n.queue||(u=w._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,w.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],"inline"===w.css(e,"display")&&"none"===w.css(e,"float")&&(w.support.inlineBlockNeedsLayout&&"inline"!==an(e.nodeName)?c.zoom=1:c.display="inline-block")),n.overflow&&(c.overflow="hidden",w.support.shrinkWrapBlocks||f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],$n.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(h?"hide":"show"))continue;l[r]=p&&p[r]||w.style(e,r)}if(!w.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=w._data(e,"fxshow",{}),s&&(p.hidden=!h),h?w(e).show():f.done(function(){w(e).hide()}),f.done(function(){var t;w._removeData(e,"fxshow");for(t in l)w.style(e,t,l[t])});for(r in l)o=Zn(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return w.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.location,o=e.document,u=o.documentElement,a=e.jQuery,f=e.$,l={},c=[],h="1.10.2",p=c.concat,d=c.push,v=c.slice,m=c.indexOf,g=l.toString,y=l.hasOwnProperty,b=h.trim,w=function(e,t){return new w.fn.init(e,t,r)},E=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,S=/\S+/g,x=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,T=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,N=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,C=/^[\],:{}\s]*$/,k=/(?:^|:|,)(?:\s*\[)+/g,L=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,O=/^-ms-/,M=/-([\da-z])/gi,_=function(e,t){return t.toUpperCase()},D=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(P(),w.ready())},P=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",D,!1),e.removeEventListener("load",D,!1)):(o.detachEvent("onreadystatechange",D),e.detachEvent("onload",D))};w.fn=w.prototype={jquery:h,constructor:w,init:function(e,n,r){var i,s;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:T.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof w?n[0]:n,w.merge(this,w.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),N.test(i[1])&&w.isPlainObject(n))for(i in n)w.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(s=o.getElementById(i[2]),s&&s.parentNode){if(s.id!==i[2])return r.find(e);this.length=1,this[0]=s}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):w.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),w.makeArray(e,this))},selector:"",length:0,toArray:function(){return v.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return w.each(this,e,t)},ready:function(e){return w.ready.promise().done(e),this},slice:function(){return this.pushStack(v.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},w.fn.init.prototype=w.fn,w.extend=w.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),"object"==typeof u||w.isFunction(u)||(u={}),f===a&&(u=this,--a);f>a;a++)if(null!=(s=arguments[a]))for(i in s)e=u[i],r=s[i],u!==r&&(l&&r&&(w.isPlainObject(r)||(n=w.isArray(r)))?(n?(n=!1,o=e&&w.isArray(e)?e:[]):o=e&&w.isPlainObject(e)?e:{},u[i]=w.extend(l,o,r)):r!==t&&(u[i]=r));return u},w.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===w&&(e.$=f),t&&e.jQuery===w&&(e.jQuery=a),w},isReady:!1,readyWait:1,holdReady:function(e){e?w.readyWait++:w.ready(!0)},ready:function(e){if(e===!0?!--w.readyWait:!w.isReady){if(!o.body)return setTimeout(w.ready);w.isReady=!0,e!==!0&&--w.readyWait>0||(n.resolveWith(o,[w]),w.fn.trigger&&w(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===w.type(e)},isArray:Array.isArray||function(e){return"array"===w.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[g.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==w.type(e)||e.nodeType||w.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(w.support.ownLast)for(n in e)return y.call(e,n);for(n in e);return n===t||y.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=N.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=w.buildFragment([e],t,i),i&&w(i).remove(),w.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=w.trim(n),n&&C.test(n.replace(L,"@").replace(A,"]").replace(k,"")))?Function("return "+n)():(w.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&w.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(O,"ms-").replace(M,_)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=H(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:b&&!b.call("﻿ ")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(x,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(H(Object(e))?w.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m)return m.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof r)for(;r>s;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;for(n=!!n;o>s;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=H(e),u=[];if(o)for(;s>i;i++)r=t(e[i],i,n),null!=r&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(u[u.length]=r);return p.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return"string"==typeof n&&(s=e[n],n=e,e=s),w.isFunction(e)?(r=v.call(arguments,2),i=function(){return e.apply(n||this,r.concat(v.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===w.type(r)){s=!0;for(a in r)w.access(e,n,a,r[a],!0,o,u)}else if(i!==t&&(s=!0,w.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(w(e),n)})),n))for(;f>a;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)));return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),w.ready.promise=function(t){if(!n)if(n=w.Deferred(),"complete"===o.readyState)setTimeout(w.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",D,!1),e.addEventListener("load",D,!1);else{o.attachEvent("onreadystatechange",D),e.attachEvent("onload",D);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function s(){if(!w.isReady){try{r.doScroll("left")}catch(e){return setTimeout(s,50)}P(),w.ready()}}()}return n.promise(t)},w.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()}),r=w(o),function(e,t){function ot(e,t,n,i){var s,o,u,a,f,l,p,m,g,w;if((t?t.ownerDocument||t:E)!==h&&c(t),t=t||h,n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=t.nodeType)&&9!==a)return[];if(d&&!i){if(s=Z.exec(e))if(u=s[1]){if(9===a){if(o=t.getElementById(u),!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return H.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return H.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){if(m=p=b,g=t,w=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){l=mt(e),(p=t.getAttribute("id"))?m=p.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+gt(l[f]);g=$.test(e)&&t.parentNode||t,w=l.join(",")}if(w)try{return H.apply(n,g.querySelectorAll(w)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return Nt(e.replace(W,"$1"),t,n,i)}function ut(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function at(e){return e[b]=!0,e}function ft(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),r=e.length;while(r--)s.attrHandle[n[r]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||O)-(~e.sourceIndex||O);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function dt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(){}function mt(e,t){var n,r,i,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){(!n||(r=X.exec(u)))&&(r&&(u=u.slice(r[0].length)||u),a.push(i=[])),n=!1,(r=V.exec(u))&&(n=r.shift(),i.push({value:n,type:r[0].replace(W," ")}),u=u.slice(n.length));for(o in s.filter)!(r=G[o].exec(u))||f[o]&&!(r=f[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ot.error(e):N(e,a).slice(0)}function gt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var r=t.dir,s=n&&"parentNode"===r,o=x++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=S+" "+o;if(u){while(t=t[r])if((1===t.nodeType||s)&&e(t,n,u))return!0}else while(t=t[r])if(1===t.nodeType||s)if(l=t[b]||(t[b]={}),(f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else if(f=l[r]=[c],f[1]=e(t,n,u)||i,f[1]===!0)return!0}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=null!=t;for(;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function Et(e,t,n,r,i,s){return r&&!r[b]&&(r=Et(r)),i&&!i[b]&&(i=Et(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Tt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?j.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):H.apply(o,g)})}function St(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return j.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;i>a;a++)if(n=s.relative[e[a].type])h=[yt(bt(h),n)];else{if(n=s.filter[e[a].type].apply(null,e[a].matches),n[b]){for(r=++a;i>r;r++)if(s.relative[e[r].type])break;return Et(a>1&&bt(h),a>1&&gt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(W,"$1"),n,r>a&&St(e.slice(a,r)),i>r&&St(e=e.slice(r)),i>r&&gt(e))}h.push(n)}return bt(h)}function xt(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=null!=p,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=S+=null==x?1:Math.random()||.1;for(E&&(f=a!==h&&a,i=n);null!=(d=T[b]);b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}E&&(S=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}if(y+=b,r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)w[b]||g[b]||(g[b]=D.call(c));g=wt(g)}H.apply(c,g),E&&!u&&g.length>0&&y+t.length>1&&ot.uniqueSort(c)}return E&&(S=N,f=x),w};return r?at(u):u}function Tt(e,t,n){var r=0,i=t.length;for(;i>r;r++)ot(e,t[r],n);return n}function Nt(e,t,n,i){var o,u,f,l,c,h=mt(e);if(!i&&1===h.length){if(u=h[0]=h[0].slice(0),u.length>2&&"ID"===(f=u[0]).type&&r.getById&&9===t.nodeType&&d&&s.relative[u[1].type]){if(t=(s.find.ID(f.matches[0].replace(rt,it),t)||[])[0],!t)return n;e=e.slice(u.shift().value.length)}o=G.needsContext.test(e)?0:u.length;while(o--){if(f=u[o],s.relative[l=f.type])break;if((c=s.find[l])&&(i=c(f.matches[0].replace(rt,it),$.test(u[0].type)&&t.parentNode||t))){if(u.splice(o,1),e=i.length&&gt(u),!e)return H.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,$.test(e)),n}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ut(),N=ut(),C=ut(),k=!1,L=function(e,t){return e===t?(k=!0,0):0},A=typeof t,O=1<<31,M={}.hasOwnProperty,_=[],D=_.pop,P=_.push,H=_.push,B=_.slice,j=_.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",I="[\\x20\\t\\r\\n\\f]",q="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",R=q.replace("w","w#"),U="\\["+I+"*("+q+")"+I+"*(?:([*^$|!~]?=)"+I+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+R+")|)|)"+I+"*\\]",z=":("+q+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+U.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+I+"+|((?:^|[^\\\\])(?:\\\\.)*)"+I+"+$","g"),X=RegExp("^"+I+"*,"+I+"*"),V=RegExp("^"+I+"*([>+~]|"+I+")"+I+"*"),$=RegExp(I+"*[+~]"),J=RegExp("="+I+"*([^\\]'\"]*)"+I+"*\\]","g"),K=RegExp(z),Q=RegExp("^"+R+"$"),G={ID:RegExp("^#("+q+")"),CLASS:RegExp("^\\.("+q+")"),TAG:RegExp("^("+q.replace("w","w*")+")"),ATTR:RegExp("^"+U),PSEUDO:RegExp("^"+z),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+I+"*(even|odd|(([+-]|)(\\d*)n|)"+I+"*(?:([+-]|)"+I+"*(\\d+)|))"+I+"*\\)|)","i"),bool:RegExp("^(?:"+F+")$","i"),needsContext:RegExp("^"+I+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+I+"*((?:-\\d)?\\d*)"+I+"*\\)|)(?=[^-]|$)","i")},Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+I+"?|("+I+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{H.apply(_=B.call(E.childNodes),E.childNodes),_[E.childNodes.length].nodeType}catch(st){H={apply:_.length?function(e,t){P.apply(e,B.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=ot.support={},c=ot.setDocument=function(e){var n=e?e.ownerDocument||e:E,i=n.defaultView;return n!==h&&9===n.nodeType&&n.documentElement?(h=n,p=n.documentElement,d=!u(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){c()}),r.attributes=ft(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ft(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ft(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ft(function(e){return p.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==A&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==A&&d?n.getElementsByClassName(e):t},m=[],v=[],(r.qsa=Y.test(n.querySelectorAll))&&(ft(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+I+"*(?:value|"+F+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),ft(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+I+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(r.matchesSelector=Y.test(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ft(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",z)}),v=v.length&&RegExp(v.join("|")),m=m.length&&RegExp(m.join("|")),y=Y.test(p.contains)||p.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},L=p.compareDocumentPosition?function(e,t){if(e===t)return k=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||y(E,e)?-1:t===n||y(E,t)?1:l?j.call(l,e)-j.call(l,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(e===t)return k=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:l?j.call(l,e)-j.call(l,t):0;if(s===o)return ct(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?ct(u[i],a[i]):u[i]===E?-1:a[i]===E?1:0},n):h},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==h&&c(e),t=t.replace(J,"='$1']"),!(!r.matchesSelector||!d||m&&m.test(t)||v&&v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return ot(t,h,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},ot.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&M.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},ot.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,n=[],i=0,s=0;if(k=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(L),k){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=ot.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},s=ot.selectors={cacheLength:50,createPseudo:at,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return G.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&K.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=RegExp("(^|"+I+")"+e+"("+I+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[b]||(c[b]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||0===h%r&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=j.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(W,"$1"));return r[b]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return Q.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[0>n?n+t:n]}),even:dt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:dt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},s.pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ht(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=pt(n);vt.prototype=s.filters=s.pseudos,s.setFilters=new vt,a=ot.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=mt(e)),n=t.length;while(n--)s=St(t[n]),s[b]?r.push(s):i.push(s);s=C(e,xt(i,r))}return s},r.sortStable=b.split("").sort(L).join("")===b,r.detectDuplicates=k,c(),r.sortDetached=ft(function(e){return 1&e.compareDocumentPosition(h.createElement("div"))}),ft(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ft(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||lt("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ft(function(e){return null==e.getAttribute("disabled")})||lt(F,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),w.find=ot,w.expr=ot.selectors,w.expr[":"]=w.expr.pseudos,w.unique=ot.uniqueSort,w.text=ot.getText,w.isXMLDoc=ot.isXML,w.contains=ot.contains}(e);var B={};w.Callbacks=function(e){e="string"==typeof e?B[e]||j(e):w.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){for(r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;a&&s>o;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){w.each(t,function(t,n){var r=w.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&w.each(arguments,function(e,t){var r;while((r=w.inArray(t,a,r))>-1)a.splice(r,1),n&&(s>=r&&s--,o>=r&&o--)}),this},has:function(e){return e?w.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],s=0,this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||i&&!f||(t=t||[],t=[e,t.slice?t.slice():t],n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},w.extend({Deferred:function(e){var t=[["resolve","done",w.Callbacks("once memory"),"resolved"],["reject","fail",w.Callbacks("once memory"),"rejected"],["notify","progress",w.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return w.Deferred(function(n){w.each(t,function(t,s){var o=s[0],u=w.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&w.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?w.extend(e,r):r}},i={};return r.pipe=r.then,w.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=v.call(arguments),r=n.length,i=1!==r||e&&w.isFunction(e.promise)?r:0,s=1===i?e:w.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?v.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1)for(u=Array(r),a=Array(r),f=Array(r);r>t;t++)n[t]&&w.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i;return i||s.resolveWith(f,n),s.promise()}}),w.support=function(t){var n,r,s,u,a,f,l,c,h,p=o.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*")||[],r=p.getElementsByTagName("a")[0],!r||!r.style||!n.length)return t;u=o.createElement("select"),f=u.appendChild(o.createElement("option")),s=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==p.className,t.leadingWhitespace=3===p.firstChild.nodeType,t.tbody=!p.getElementsByTagName("tbody").length,t.htmlSerialize=!!p.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!s.value,t.optSelected=f.selected,t.enctype=!!o.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,s.checked=!0,t.noCloneChecked=s.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}s=o.createElement("input"),s.setAttribute("value",""),t.input=""===s.getAttribute("value"),s.value="t",s.setAttribute("type","radio"),t.radioValue="t"===s.value,s.setAttribute("checked","t"),s.setAttribute("name","t"),a=o.createDocumentFragment(),a.appendChild(s),t.appendChecked=s.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1;p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===p.style.backgroundClip;for(h in w(t))break;return t.ownLast="0"!==h,w(function(){var n,r,s,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=o.getElementsByTagName("body")[0];a&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=p.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===s[0].offsetHeight,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&0===s[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",w.swap(a,null!=a.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===p.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,r=p.appendChild(o.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===p.offsetWidth,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==p.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=s=r=null)}),n=u=a=f=r=s=null,t}({});var F=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;w.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?w.cache[e[w.expando]]:e[w.expando],!!e&&!z(e)},data:function(e,t,n){return q(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return q(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&w.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),w.fn.extend({data:function(e,n){var r,i,s=null,o=0,u=this[0];if(e===t){if(this.length&&(s=w.data(u),1===u.nodeType&&!w._data(u,"parsedAttrs"))){for(r=u.attributes;r.length>o;o++)i=r[o].name,0===i.indexOf("data-")&&(i=w.camelCase(i.slice(5)),U(u,i,s[i]));w._data(u,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){w.data(this,e)}):arguments.length>1?this.each(function(){w.data(this,e,n)}):u?U(u,e,w.data(u,e)):null},removeData:function(e){return this.each(function(){w.removeData(this,e)})}}),w.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=w._data(e,n),r&&(!i||w.isArray(r)?i=w._data(e,n,w.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),s=w._queueHooks(e,t),o=function(){w.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return w._data(e,n)||w._data(e,n,{empty:w.Callbacks("once memory").add(function(){w._removeData(e,t+"queue"),w._removeData(e,n)})})}}),w.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?w.queue(this[0],e):n===t?this:this.each(function(){var t=w.queue(this,e,n);w._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},delay:function(e,t){return e=w.fx?w.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=w.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(u--)r=w._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var W,X,V=/[\t\r\n\f]/g,$=/\r/g,J=/^(?:input|select|textarea|button|object)$/i,K=/^(?:a|area)$/i,Q=/^(?:checked|selected)$/i,G=w.support.getSetAttribute,Y=w.support.input;w.fn.extend({attr:function(e,t){return w.access(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})},prop:function(e,t){return w.access(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return e=w.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a="string"==typeof e&&e;if(w.isFunction(e))return this.each(function(t){w(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(S)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(V," "):" ")){s=0;while(i=t[s++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=w.trim(r)}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=0===arguments.length||"string"==typeof e&&e;if(w.isFunction(e))return this.each(function(t){w(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(S)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(V," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?w.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):w.isFunction(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,r=0,s=w(this),o=e.match(S)||[];while(t=o[r++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(n===i||"boolean"===n)&&(this.className&&w._data(this,"__className__",this.className),this.className=this.className||e===!1?"":w._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(V," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(arguments.length)return i=w.isFunction(e),this.each(function(n){var s;1===this.nodeType&&(s=i?e.call(this,n,w(this).val()):e,null==s?s="":"number"==typeof s?s+="":w.isArray(s)&&(s=w.map(s,function(e){return null==e?"":e+""})),r=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,s,"value")!==t||(this.value=s))});if(s)return r=w.valHooks[s.type]||w.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace($,""):null==n?"":n)}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;for(;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(w.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&w.nodeName(n.parentNode,"optgroup"))){if(t=w(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=w.makeArray(t),o=i.length;while(o--)r=i[o],(r.selected=w.inArray(w(r).val(),s)>=0)&&(n=!0);return n||(e.selectedIndex=-1),s}}},attr:function(e,n,r){var s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?w.prop(e,n,r):(1===u&&w.isXMLDoc(e)||(n=n.toLowerCase(),s=w.attrHooks[n]||(w.expr.match.bool.test(n)?X:W)),r===t?s&&"get"in s&&null!==(o=s.get(e,n))?o:(o=w.find.attr(e,n),null==o?t:o):null!==r?s&&"set"in s&&(o=s.set(e,r,n))!==t?o:(e.setAttribute(n,r+""),r):(w.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(S);if(s&&1===e.nodeType)while(n=s[i++])r=w.propFix[n]||n,w.expr.match.bool.test(n)?Y&&G||!Q.test(n)?e[r]=!1:e[w.camelCase("default-"+n)]=e[r]=!1:w.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!w.support.radioValue&&"radio"===t&&w.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!w.isXMLDoc(e),o&&(n=w.propFix[n]||n,s=w.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&null!==(i=s.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):J.test(e.nodeName)||K.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?w.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&w.propFix[n]||n,n):e[w.camelCase("default-"+n)]=e[n]=!0,n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,n){var r=w.expr.attrHandle[n]||w.find.attr;w.expr.attrHandle[n]=Y&&G||!Q.test(n)?function(e,n,i){var s=w.expr.attrHandle[n],o=i?t:(w.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return w.expr.attrHandle[n]=s,o}:function(e,n,r){return r?t:e[w.camelCase("default-"+n)]?n.toLowerCase():null}}),Y&&G||(w.attrHooks.value={set:function(e,n,r){return w.nodeName(e,"input")?(e.defaultValue=n,t):W&&W.set(e,n,r)}}),G||(W={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},w.expr.attrHandle.id=w.expr.attrHandle.name=w.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null},w.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:W.set},w.attrHooks.contenteditable={set:function(e,t,n){W.set(e,""===t?!1:t,n)}},w.each(["width","height"],function(e,n){w.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),w.support.hrefNormalized||w.each(["href","src"],function(e,t){w.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),w.support.style||(w.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),w.support.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.support.enctype||(w.propFix.enctype="encoding"),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,n){return w.isArray(n)?e.checked=w.inArray(w(e).val(),n)>=0:t}},w.support.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;w.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=w._data(e);if(y){r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=w.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof w===i||e&&w.event.triggered===e.type?t:w.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(S)||[""],f=n.length;while(f--)u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),v&&(c=w.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=w.event.special[v]||{},p=w.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&w.expr.match.needsContext.test(o),namespace:m.join(".")},l),(d=a[v])||(d=a[v]=[],d.delegateCount=0,c.setup&&c.setup.call(e,s,m,h)!==!1||(e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h))),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),w.event.global[v]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=w.hasData(e)&&w._data(e);if(m&&(l=m.events)){t=(t||"").match(S)||[""],f=t.length;while(f--)if(u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort(),p){c=w.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&v!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,d,m.handle)!==!1||w.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)w.event.remove(e,p+t[f],n,r,!0);w.isEmptyObject(l)&&(delete m.handle,w._removeData(e,"events"))}},trigger:function(n,r,i,s){var u,a,f,l,c,h,p,d=[i||o],v=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(f=h=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(v+w.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=0>v.indexOf(":")&&"on"+v,n=n[w.expando]?n:new w.Event(v,"object"==typeof n&&n),n.isTrigger=s?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:w.makeArray(r,[n]),c=w.event.special[v]||{},s||!c.trigger||c.trigger.apply(i,r)!==!1)){if(!s&&!c.noBubble&&!w.isWindow(i)){for(l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||o)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(w._data(f,"events")||{})[n.type]&&w._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&w.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();if(n.type=v,!s&&!n.isDefaultPrevented()&&(!c._default||c._default.apply(d.pop(),r)===!1)&&w.acceptData(i)&&a&&i[v]&&!w.isWindow(i)){h=i[a],h&&(i[a]=null),w.event.triggered=v;try{i[v]()}catch(g){}w.event.triggered=t,h&&(i[a]=h)}return n.result}},dispatch:function(e){e=w.event.fix(e);var n,r,i,s,o,u=[],a=v.call(arguments),f=(w._data(this,"events")||{})[e.type]||[],l=w.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=w.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((w.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!=this;f=f.parentNode||this)if(1===f.nodeType&&(f.disabled!==!0||"click"!==e.type)){for(s=[],o=0;a>o;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?w(r,this).index(f)>=0:w.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return n.length>a&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[w.expando])return e;var t,n,r,i=e.type,s=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new w.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,s,u=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,s=i.documentElement,r=i.body,e.pageX=n.clientX+(s&&s.scrollLeft||r&&r.scrollLeft||0)-(s&&s.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||r&&r.scrollTop||0)-(s&&s.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||u===t||(e.which=1&u?1:2&u?3:4&u?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ot()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===ot()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return w.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t},_default:function(e){return w.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=w.extend(new w.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?w.event.trigger(i,null,t):w.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},w.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},w.Event=function(e,n){return this instanceof w.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,n&&w.extend(this,n),this.timeStamp=e&&e.timeStamp||w.now(),this[w.expando]=!0,t):new w.Event(e,n)},w.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},w.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!w.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),w.support.submitBubbles||(w.event.special.submit={setup:function(){return w.nodeName(this,"form")?!1:(w.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=w.nodeName(n,"input")||w.nodeName(n,"button")?n.form:t;r&&!w._data(r,"submitBubbles")&&(w.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),w._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&w.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return w.nodeName(this,"form")?!1:(w.event.remove(this,"._submit"),t)}}),w.support.changeBubbles||(w.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(w.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),w.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),w.event.simulate("change",this,e,!0)})),!1):(w.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!w._data(t,"changeBubbles")&&(w.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||w.event.simulate("change",this.parentNode,e,!0)}),w._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return w.event.remove(this,"._change"),!Z.test(this.nodeName)}}),w.support.focusinBubbles||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){w.event.simulate(t,e.target,w.event.fix(e),!0)};w.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),w.fn.extend({on:function(e,n,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=st;else if(!i)return this;return 1===s&&(u=i,i=function(e){return w().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=w.guid++)),this.each(function(){w.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,w(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=st),this.each(function(){w.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?w.event.trigger(e,n,r,!0):t}});var ut=/^.[^:#\[\.,]*$/,at=/^(?:parents|prev(?:Until|All))/,ft=w.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};w.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;i>t;t++)if(w.contains(r[t],this))return!0}));for(t=0;i>t;t++)w.find(e,r[t],n);return n=this.pushStack(i>1?w.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=w(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(w.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e||[],!0))},filter:function(e){return this.pushStack(ht(this,e||[],!1))},is:function(e){return!!ht(this,"string"==typeof e&&ft.test(e)?w(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||"string"!=typeof e?w(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?w.unique(s):s)},index:function(e){return e?"string"==typeof e?w.inArray(this[0],w(e)):w.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?w(e,t):w.makeArray(e&&e.nodeType?[e]:e),r=w.merge(this.get(),n);return this.pushStack(w.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return w.dir(e,"parentNode")},parentsUntil:function(e,t,n){return w.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return w.dir(e,"nextSibling")},prevAll:function(e){return w.dir(e,"previousSibling")},nextUntil:function(e,t,n){return w.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return w.dir(e,"previousSibling",n)},siblings:function(e){return w.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return w.sibling(e.firstChild)},contents:function(e){return w.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:w.merge([],e.childNodes)}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(lt[e]||(i=w.unique(i)),at.test(e)&&(i=i.reverse())),this.pushStack(i)}}),w.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){var i=[],s=e[n];while(s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!w(s).is(r)))1===s.nodeType&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:w.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(o),Ot=At.appendChild(o.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,w.fn.extend({text:function(e){return w.access(this,function(e){return e===t?w.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Mt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Mt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?w.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||w.cleanData(jt(n)),n.parentNode&&(t&&w.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&w.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&w.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return w.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(vt,""):t;if(!("string"!=typeof e||St.test(e)||!w.support.htmlSerialize&&mt.test(e)||!w.support.leadingWhitespace&&gt.test(e)||Lt[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(yt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(w.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=w.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),w(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=p.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,d=e[0],v=w.isFunction(d);if(v||!(1>=l||"string"!=typeof d||w.support.checkClone)&&Tt.test(d))return this.each(function(r){var i=c.eq(r);v&&(e[0]=d.call(this,r,i.html())),i.domManip(e,t,n)});if(l&&(a=w.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=a.firstChild,1===a.childNodes.length&&(a=r),r)){for(o=w.map(jt(a,"script"),_t),s=o.length;l>f;f++)i=a,f!==h&&(i=w.clone(i,!0,!0),s&&w.merge(o,jt(i,"script"))),t.call(this[f],i,f);if(s)for(u=o[o.length-1].ownerDocument,w.map(o,Dt),f=0;s>f;f++)i=o[f],Nt.test(i.type||"")&&!w._data(i,"globalEval")&&w.contains(u,i)&&(i.src?w._evalUrl(i.src):w.globalEval((i.text||i.textContent||i.innerHTML||"").replace(kt,"")));a=r=null}return this}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){var n,r=0,i=[],s=w(e),o=s.length-1;for(;o>=r;r++)n=r===o?this:this.clone(!0),w(s[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}}),w.extend({clone:function(e,t,n){var r,i,s,o,u,a=w.contains(e.ownerDocument,e);if(w.support.html5Clone||w.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild)),!(w.support.noCloneEvent&&w.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(r=jt(s),u=jt(e),o=0;null!=(i=u[o]);++o)r[o]&&Bt(i,r[o]);if(t)if(n)for(u=u||jt(e),r=r||jt(s),o=0;null!=(i=u[o]);o++)Ht(i,r[o]);else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;c>d;d++)if(s=e[d],s||0===s)if("object"===w.type(s))w.merge(p,s.nodeType?[s]:s);else if(Et.test(s)){u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!w.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0])),!w.support.tbody){s="table"!==a||wt.test(s)?"<table>"!==l[1]||wt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)w.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}w.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}else p.push(t.createTextNode(s));u&&h.removeChild(u),w.support.appendChecked||w.grep(jt(p,"input"),Ft),d=0;while(s=p[d++])if((!r||-1===w.inArray(s,r))&&(o=w.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u),n)){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=w.expando,f=w.cache,l=w.support.deleteExpando,h=w.event.special;for(;null!=(n=e[u]);u++)if((t||w.acceptData(n))&&(s=n[a],o=s&&f[s])){if(o.events)for(r in o.events)h[r]?w.event.remove(n,r):w.removeEvent(n,r,o.handle);f[s]&&(delete f[s],l?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,c.push(s))}},_evalUrl:function(e){return w.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),w.fn.extend({wrapAll:function(e){if(w.isFunction(e))return this.each(function(t){w(this).wrapAll(e.call(this,t))});if(this[0]){var t=w(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return w.isFunction(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=w.isFunction(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){w.nodeName(this,"body")||w(this).replaceWith(this.childNodes)}).end()}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=RegExp("^("+E+")(.*)$","i"),Jt=RegExp("^("+E+")(?!px)[a-z%]+$","i"),Kt=RegExp("^([+-])=("+E+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];w.fn.extend({css:function(e,n){return w.access(this,function(e,n,r){var i,s,o={},u=0;if(w.isArray(n)){for(s=qt(e),i=n.length;i>u;u++)o[n[u]]=w.css(e,n[u],!1,s);return o}return r!==t?w.style(e,n,r):w.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){nn(this)?w(this).show():w(this).hide()})}}),w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":w.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=w.camelCase(n),f=e.style;if(n=w.cssProps[a]||(w.cssProps[a]=tn(f,a)),u=w.cssHooks[n]||w.cssHooks[a],r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];if(o=typeof r,"string"===o&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(w.css(e,n)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||w.cssNumber[a]||(r+="px"),w.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(f[n]="inherit"),u&&"set"in u&&(r=u.set(e,r,i))===t)))try{f[n]=r}catch(l){}}},css:function(e,n,r,i){var s,o,u,a=w.camelCase(n);return n=w.cssProps[a]||(w.cssProps[a]=tn(e.style,a)),u=w.cssHooks[n]||w.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),"normal"===o&&n in Yt&&(o=Yt[n]),""===r||r?(s=parseFloat(o),r===!0||w.isNumeric(s)?s||0:o):o}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(""!==a||w.contains(e.ownerDocument,e)||(a=w.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):o.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return null==a&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left="fontSize"===n?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),""===a?"auto":a}),w.each(["height","width"],function(e,n){w.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(w.css(e,"display"))?w.swap(e,Gt,function(){return un(e,n,i)}):un(e,n,i):t},set:function(e,t,r){var i=r&&qt(e);return sn(e,t,r?on(e,n,r,w.support.boxSizing&&"border-box"===w.css(e,"boxSizing",!1,i),i):0)}}}),w.support.opacity||(w.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=w.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===w.trim(s.replace(Ut,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i)}}),w(function(){w.support.reliableMarginRight||(w.cssHooks.marginRight={get:function(e,n){return n?w.swap(e,{display:"inline-block"},Rt,[e,"marginRight"]):t}}),!w.support.pixelPosition&&w.fn.position&&w.each(["top","left"],function(e,n){w.cssHooks[n]={get:function(e,r){return r?(r=Rt(e,n),Jt.test(r)?w(e).position()[n]+"px":r):t}}})}),w.expr&&w.expr.filters&&(w.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!w.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||w.css(e,"display"))},w.expr.filters.visible=function(e){return!w.expr.filters.hidden(e)}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){var r=0,i={},s="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(w.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:w.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),w.param=function(e,n){var r,i=[],s=function(e,t){t=w.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=w.ajaxSettings&&w.ajaxSettings.traditional),w.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")},w.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,gn,yn=w.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=w.fn.load,Ln={},An={},On="*/".concat("*");try{gn=s.href}catch(Mn){gn=o.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],w.fn.load=function(e,n,r){if("string"!=typeof e&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),w.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),u.length>0&&w.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?w("<div>").append(w.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":w.parseJSON,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,w.ajaxSettings),t):Pn(w.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;2!==b&&(b=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,l=e>=200&&300>e||304===e,r&&(E=Hn(c,x,r)),E=Bn(c,E,x,l),l?(c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(w.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(w.etag[s]=S)),204===e||"HEAD"===c.type?T="nocontent":304===e?T="notmodified":(T=E.state,g=E.data,y=E.error,l=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--w.active||w.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=w.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?w(h):w.event,d=w.Deferred(),v=w.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,E="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||E;return f&&f.abort(t),N(0,t),this}};if(d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=w.trim(c.dataType||"*").toLowerCase().match(S)||[""],null==c.crossDomain&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=w.param(c.data,c.traditional)),Dn(Ln,c,n,x),2===b)return x;a=c.global,a&&0===w.active++&&w.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(w.lastModified[s]&&x.setRequestHeader("If-Modified-Since",w.lastModified[s]),w.etag[s]&&x.setRequestHeader("If-None-Match",w.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader(i,c.headers[i]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&2!==b){E="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);if(f=Dn(An,c,n,x)){x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{b=1,f.send(g,N)}catch(T){if(!(2>b))throw T;N(-1,T)}}else N(-1,"No Transport");return x}return x.abort()},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,n){return w.get(e,t,n,"script")}}),w.each(["get","post"],function(e,n){w[n]=function(e,r,i,s){return w.isFunction(r)&&(s=s||i,i=r,r=t),w.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),w.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||w("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||w.expando+"_"+yn++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");return a||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=w.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||w.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&w.isFunction(o)&&o(u[0]),u=o=t}),"script"):t});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};w.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=w.ajaxSettings.xhr(),w.support.cors=!!qn&&"withCredentials"in qn,qn=w.support.ajax=!!qn,qn&&w.ajaxTransport(function(n){if(!n.crossDomain||w.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();if(n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async),n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||4===a.readyState))if(r=t,o&&(a.onreadystatechange=w.noop,Un&&delete In[o]),i)4!==a.readyState&&a.abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}u||!n.isLocal||n.crossDomain?1223===u&&(u=204):u=c.text?200:404}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?4===a.readyState?setTimeout(r):(o=++Rn,Un&&(In||(In={},w(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=RegExp("^(?:([+-])=|)("+E+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Jn.exec(t),s=i&&i[3]||(w.cssNumber[e]?"":"px"),o=(w.cssNumber[e]||"px"!==s&&+r)&&Jn.exec(w.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,w.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};w.Animation=w.extend(er,{tweener:function(e,t){w.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),w.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(w.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=w.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[w.cssProps[e.prop]]||w.cssHooks[e.prop])?w.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),s=w.speed(t,n,r),o=function(){var t=er(this,w.extend({},e),s);(i||w._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=w.timers,o=w._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&w.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=w._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||w.isFunction(e)&&e,duration:e,easing:n&&t||t&&!w.isFunction(t)&&t};return r.duration=w.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in w.fx.speeds?w.fx.speeds[r.duration]:w.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){w.isFunction(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},w.timers=[],w.fx=rr.prototype.init,w.fx.tick=function(){var e,n=w.timers,r=0;for(Xn=w.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||w.fx.stop(),Xn=t},w.fx.timer=function(e){e()&&w.timers.push(e)&&w.fx.start()},w.fx.interval=13,w.fx.start=function(){Vn||(Vn=setInterval(w.fx.tick,w.fx.interval))},w.fx.stop=function(){clearInterval(Vn),Vn=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fx.step={},w.expr&&w.expr.filters&&(w.expr.filters.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length}),w.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){w.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(u)return n=u.documentElement,w.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},w.offset={setOffset:function(e,t,n){var r=w.css(e,"position");"static"===r&&(e.style.position="relative");var i=w(e),s=i.offset(),o=w.css(e,"top"),u=w.css(e,"left"),a=("absolute"===r||"fixed"===r)&&w.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),w.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+c),null!=t.left&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},w.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===w.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),w.nodeName(e[0],"html")||(n=e.offset()),n.top+=w.css(e[0],"borderTopWidth",!0),n.left+=w.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-w.css(r,"marginTop",!0),left:t.left-n.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u;while(e&&!w.nodeName(e,"html")&&"static"===w.css(e,"position"))e=e.offsetParent;return e||u})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);w.fn[e]=function(i){return w.access(this,function(e,i,s){var o=sr(e);return s===t?o?n in o?o[n]:o.document.documentElement[i]:e[i]:(o?o.scrollTo(r?w(o).scrollLeft():s,r?s:w(o).scrollTop()):e[i]=s,t)},e,i,arguments.length,null)}}),w.each({Height:"height",Width:"width"},function(e,n){w.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){w.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return w.access(this,function(n,r,i){var s;return w.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?w.css(n,r,u):w.style(n,r,i,u)},n,o?i:t,o,null)}})}),w.fn.size=function(){return this.length},w.fn.andSelf=w.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=w:(e.jQuery=e.$=w,"function"==typeof define&&define.amd&&define("jquery",[],function(){return w}))}(window),define("mout/lang/toString",[],function(){function e(e){return e==null?"":e.toString()}return e}),define("mout/string/WHITE_SPACES",[],function(){return[" ","\n","\r","	","\f",""," "," ","᠎"," "," "," "," "," "," "," "," "," "," "," ","\u2028","\u2029"," "," ","　"]}),define("mout/string/rtrim",["../lang/toString","./WHITE_SPACES"],function(e,t){function n(n,r){n=e(n),r=r||t;var i=n.length-1,s=r.length,o=!0,u,a;while(o&&i>=0){o=!1,u=-1,a=n.charAt(i);while(++u<s)if(a===r[u]){o=!0,i--;break}}return i>=0?n.substring(0,i+1):""}return n}),define("config",["exports","jquery","mout/string/rtrim"],function(e,t,n){var r;e.appContainer=t(".app"),e.LANG=LANG,e.ENV_ID=ENV_ID,e.IS_DEV=IS_DEV,e.LANG_LONG={fr:"French",en:"English"}[e.LANG],e.POST_ID_OFFSET=1248,e.BASE_URL=n(t("base").attr("href"),["/"]),e.SITE_URL=e.BASE_URL+(LANG=="fr"?"":"/"+LANG),e.settings=SETTINGS,e.ERROR_MESSAGES=ERROR_MESSAGES,e.SKIP_PRELOADER=IS_DEV,e.SKIP_ADJUSTMENT_TUTORIALS=IS_DEV,e.DISABLE_SOUND_ON_START=IS_DEV,e.USES_STATS=!1,e.UPLOADS_FOLDER=e.BASE_URL+"/uploads/",e.POST_SEARCH_RESULT_MAX=200,e.POST_DISPLAY_AMOUNT_MAX=20,e.POST_CANVAS_SIZE=512,e.POST_IMAGE_PADDING=60,e.SCENE_3D_FOV=100,e.SCENE_3D_FOV_MAX=100,e.SCENE_3D_FOV_MIN=25,e.SCENE_CAMERA_HORIZONTAL_DISTANCE=750,e.SCENE_CAMERA_VERTICAL_BASE_DISTANCE=110,e.SCENE_CAMERA_VERTICAL_UP_DISTANCE=200,e.SCENE_CAMERA_VERTICAL_DOWN_DISTANCE=60,e.PARTICLE_TEXTURE_SIZE=128,e.PARTICLE_FIELD_SEGMENT_SIZE=200,e.PARTICLE_FIELD_GRID_SEG=3,e.PARTICLE_FIELD_GRID_SIZE=2e3,e.NAV_SEARCH_SIZE_MIN=50,e.NAV_SEARCH_SIZE_MAX=100,e.NAV_SEARCH_ZOOM_THRESHOLD=.7,e.NAV_SEARCH_ITEMS_MAX=200,e.POST_SEARCH_WITH_TAG_RESULT_MAX=200,e.PARTICLE_THUMB_SIZE=128,e.STEP_CIRCLE_PARTICLE_AMOUNT_PER_DEGREE=100,e.DEFAULT_NOISE_RATIO=.05,e.transitionStyle=Modernizr.prefixed("transition"),e.transformStyle=Modernizr.prefixed("transform"),e.transform3DStyle=Modernizr.csstransforms3d?e.transformStyle:!1,e.transformPerspectiveStyle=Modernizr.prefixed("perspective"),e.transformOriginStyle=Modernizr.prefixed("transformOrigin"),e.isRetina=window.devicePixelRatio&&window.devicePixelRatio>=1.5,e.webkitFilter=document.body.style.webkitFilter===r?!1:"webkitFilter",e.uiAssetPath=e.isRetina?"img/ui_x2.png":"img/ui.png",e.colorMapPath="img/colorMap.png"}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,typeof define=="function"&&define.amd?define("signals",[],function(){return i}):typeof module!="undefined"&&module.exports?module.exports=i:e.signals=i}(this),define("mout/array/forEach",[],function(){function e(e,t,n){if(e==null)return;var r=-1,i=e.length;while(++r<i)if(t.call(n,e[r],r,e)===!1)break}return e}),define("mout/function/identity",[],function(){function e(e){return e}return e}),define("mout/function/prop",[],function(){function e(e){return function(t){return t[e]}}return e}),define("mout/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),define("mout/object/forIn",[],function(){function n(){t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=!0;for(var n in{toString:null})e=!1}function r(r,s,o){var u,a=0;e==null&&n();for(u in r)if(i(s,r,u,o)===!1)break;if(e)while(u=t[a++])if(r[u]!==Object.prototype[u]&&i(s,r,u,o)===!1)break}function i(e,t,n,r){return e.call(r,t[n],n,t)}var e,t;return r}),define("mout/object/forOwn",["./hasOwn","./forIn"],function(e,t){function n(n,r,i){t(n,function(t,s){if(e(n,s))return r.call(i,n[s],s,n)})}return n}),define("mout/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),define("mout/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),define("mout/lang/isArray",["./isKind"],function(e){var t=Array.isArray||function(t){return e(t,"Array")};return t}),define("mout/object/deepMatches",["./forOwn","../lang/isArray"],function(e,t){function n(e,t){var n=-1,r=e.length;while(++n<r)if(s(e[n],t))return!0;return!1}function r(e,t){var r=-1,i=t.length;while(++r<i)if(!n(e,t[r]))return!1;return!0}function i(t,n){var r=!0;return e(n,function(e,n){if(!s(t[n],e))return r=!1}),r}function s(e,n){return e&&typeof e=="object"?t(e)&&t(n)?r(e,n):i(e,n):e===n}return s}),define("mout/function/makeIterator_",["./identity","./prop","../object/deepMatches"],function(e,t,n){function r(r,i){if(r==null)return e;switch(typeof r){case"function":return typeof i!="undefined"?function(e,t,n){return r.call(i,e,t,n)}:r;case"object":return function(e){return n(e,r)};case"string":case"number":return t(r)}}return r}),define("mout/array/every",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=!0;if(t==null)return i;var s=-1,o=t.length;while(++s<o)if(!n(t[s],s,t)){i=!1;break}return i}return t}),define("mout/array/indexOf",[],function(){function e(e,t,n){n=n||0;if(e==null)return-1;var r=e.length,i=n<0?r+n:n;while(i<r){if(e[i]===t)return i;i++}return-1}return e}),define("mout/array/contains",["./indexOf"],function(e){function t(t,n){return e(t,n)!==-1}return t}),define("inputController",["config","signals","mout/array/forEach","mout/array/every","mout/array/contains"],function(e,t,n,r,i){function N(e,t,n){if(e.jquery){e.each(function(){N(this,t,n)});return}if(!e)return;e["__"+t]=n,(t=="over"||t=="out")&&$(e).bind(x[t],n),e.__hasInput=!0,S.push(e)}function C(e,t){if(e.jquery){e.each(function(){C(this,t)});return}if(!e)return;t?((t=="over"||t=="out")&&e["__"+t]&&$(e).unbind(x[t],e["__"+t]),e["__"+t]=s):(e.__over&&$(e).unbind(x.over,e.__over),e.__out&&$(e).unbind(x.out,e.__out),n(T,function(t){e["__"+t]=s}),e.__hasInput=!1);if(r(T,function(t){return!e["__"+t]}))for(var i=0;i<S.length;i++)if(S[i]==e){S.splice(i,1);break}}function k(){u.ondragstart=function(){return!1},l.hasTouch?(u.addEventListener("touchstart",O,!1),u.addEventListener("touchmove",M,!1),u.addEventListener("touchend",_,!1),u.addEventListener("mousedown",O,!1),u.addEventListener("mousemove",M,!1),u.addEventListener("mouseup",_,!1),u.addEventListener("gesturechange",A,!1)):h?(u.addEventListener("mousedown",O,!1),u.addEventListener("mousemove",M,!1),u.addEventListener("mouseup",_,!1),u.addEventListener("mousewheel",L,!1),u.addEventListener("DOMMouseScroll",L,!1)):(u.attachEvent("onmousedown",O),u.attachEvent("onmousemove",M),u.attachEvent("onmouseup",_),u.attachEvent("onmousewheel",L)),l.onDown.add(F),l.onMove.add(I),l.onUp.add(q)}function L(e){e=e||o.event;var t=e.wheelDelta;t?t/=120:t=-e.detail/3;var n,r=l.currentBubbleHistory,i=r.length;while(i--)n=r[i],n.__wheel&&(e.currentTarget=n,n.__wheel.call(n,t))}function A(e){if(l.disablePreventDefault)return;e.preventDefault?e.preventDefault():e.returnValue=!1}function O(e){return j.call(this,e,function(e){var t=e.target.nodeName.toLowerCase();if(u.activeElement&&!i(["input","select","label","option","textarea"],t)&&e.target.contentEditable!=="true"){var n=u.activeElement;i(["body"],n.nodeName.toLowerCase())||u.activeElement.blur()}l.onDown.dispatch(e)})}function M(e){return j.call(this,e,function(e){l.onMove.dispatch(e)})}function _(e){return j.call(this,e,function(e){l.onUp.dispatch(e)})}function D(e){return function(){A.call(this,e)}}function P(e,t){if(e.__skipPreventDefault)return!0;var n=e.nodeName.toLowerCase();return i(["source","object","iframe"],n)?!0:t?!1:e.contentEditable==="true"||i(["input","select","label","textarea","option"],n)}function H(e,t,n){var r=e;while(e){if(e.__isPointerEventsNone)return E.push(e),e.style.visibility="hidden",H(u.elementFromPoint(t,n),t,n);e=e.parentNode}return r}function B(){for(var e=0,t=E.length;e<t;e++)E[e].style.display,E[e].style.visibility="visible";E=[]}function j(e,t){e=e||o.event;var n={originalEvent:e,button:e.button,preventDefault:D(e)},r,i,u,a,c,E,S,x=e.type,T=n.currentTime=(new Date).getTime(),N=x.indexOf("start")>-1||x.indexOf("down")>-1,C=x.indexOf("end")>-1||x.indexOf("up")>-1,k=x.indexOf("move")>-1,L=n.isTouch=x.indexOf("touch")>-1,A=!1;l.isFirstTouch===s&&(l.isFirstTouch=L);if(L){c=e.touches.length?e.touches[0]:e.changedTouches[0],n.x=u=c.pageX,n.y=a=c.pageY,n.target=S=c.target,E=l.currentBubbleHistory=n.bubbleHistory=[];while(S)E.unshift(S),!A&&P(S,k)&&(A=n.isSkipPreventDefault=!0),S=S.parentNode}else{n.x=u=h?e.pageX:e.clientX+p.scrollLeft,n.y=a=h?e.pageY:e.clientY+p.scrollTop,n.target=S=e.target?e.target:e.srcElement,E=l.currentBubbleHistory=n.bubbleHistory=[];while(S)E.unshift(S),!A&&P(S,k)&&(A=n.isSkipPreventDefault=!0),S=S.parentNode}if(N){d=!0,v=y=T,m=b=u,g=w=a,l.downBubbleHistory=E,r=E.length;while(r--)i=E[r],L&&i.__over&&(n.currentTarget=i,i.__over.call(i,n)),i.__down&&(n.currentTarget=i,i.__down.call(i,n));f=A}f||n.preventDefault(),d&&(n.distanceTime=T-v,n.distanceX=u-m,n.distanceY=a-g,n.distance=Math.sqrt((u-m)*(u-m)+(a-g)*(a-g))),n.deltaTime=T-y,n.deltaX=u-b,n.deltaY=a-w,y=T,b=u,w=a;if(x.indexOf("end")>-1||x.indexOf("up")>-1)d=!1;t(n)}function F(e){l.isDown=!0;var t=e.bubbleHistory.length,n;while(t--)n=e.bubbleHistory[t],n.__tap&&(e.currentTarget=n,n.__tap.call(n,e))}function I(e){l.currentBubbleHistory=e.bubbleHistory,l.deltaX=e.deltaX,l.deltaY=e.deltaY,l.deltaTime=e.deltaTime,l.distanceX=e.distanceX,l.distanceY=e.distanceY,l.distanceTime=e.distanceTime,!l.isScrollH&&!l.isScrollV&&e.distance>80&&(Math.abs(e.distanceX)>Math.abs(e.distanceY)?(l.isScrollH=!0,l.onSwipeH.dispatch(e)):(l.isScrollV=!0,l.onSwipeV.dispatch(e)));var t=e.bubbleHistory.length,n;while(t--)n=e.bubbleHistory[t],n.__move&&(e.currentTarget=n,n.__move.call(n,e))}function q(e){l.isDown=!1,l.distanceTime=e.distanceTime;var t=e.bubbleHistory.length,n=l.downBubbleHistory,r,i,s=e.isClick=e.distanceTime!==null&&e.distanceTime<l.clickTime&&e.distance<l.clickDistance;e.isDoubleClick=e.currentTime-l.lastUpTime<400;while(t--){r=e.bubbleHistory[t],e.isTouch&&r.__out&&(e.currentTarget=r,r.__out.call(r,e)),r.__up&&(e.currentTarget=r,r.__up.call(r,e));if(s&&r.__click){i=n.length;while(i--)if(n[i]===r){e.currentTarget=r,r.__click.call(r,e);break}}}l.isScrollH=!1,l.isScrollV=!1,l.lastUpTime=e.currentTime}var s,o=window,u=document,a=u.documentElement,f=!1,l={hasTouch:"ontouchstart"in o,onDown:new t.Signal,onMove:new t.Signal,onUp:new t.Signal,onSwipeH:new t.Signal,onSwipeV:new t.Signal,isDown:!1,isScrollH:!1,isScrollV:!1,isFirstTouch:s,deltaX:0,deltaY:0,deltaTime:0,downBubbleHistory:[],currentBubbleHistory:[],lastUpTime:0,isOnSwipePane:!1,elems:[],disablePreventDefault:!1,clickTime:500,clickDistance:40},c=l.hasTouch,h="addEventListener"in o,p=u.documentElement,d=!1,v=0,m=0,g=0,y=0,b=0,w=0,E=[],S=l.elems,x=c?{over:"touchstart mouseenter",out:"touchend mouseleave"}:{over:"mouseenter",out:"mouseleave"},T=["over","out","tap","click","down","move","up","wheel"];return l.add=N,l.remove=C,k(),l}),define("mout/object/mixIn",["./forOwn"],function(e){function t(t,r){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o!=null&&e(o,n,t);return t}function n(e,t){this[t]=e}return t}),define("mout/math/clamp",[],function(){function e(e,t,n){return e<t?t:e>n?n:e}return e}),define("mout/math/norm",[],function(){function e(e,t,n){return(e-t)/(n-t)}return e}),define("mout/math/lerp",[],function(){function e(e,t,n){return t+(n-t)*e}return e}),define("mout/array/slice",[],function(){function t(t,n,r){return e.call(t,n,r)}var e=Array.prototype.slice;return t}),define("mout/function/bind",["../array/slice"],function(e){function t(t,n,r){var i=e(arguments,2);return function(){return t.apply(n,i.concat(e(arguments)))}}return t}),define("EKTweener",[],function(){function e(e,t,n,r,i,o){this._target=e,this._appliedTarget=t,this._isStyle=e!==t,this._data=i,this._pauseTime=0,this._isPaused=!1,this._isStarted=!1,this._currentTime=(new Date).getTime(),this._startTime=r*1e3+this._currentTime,this._durationTime=(n||0)*1e3,this._hasFrom=o,this.isFinished=!1,this.ease=s.defaultFunc,this.tweens=null,this.onStart=null,this.onStartParams=null,this.onUpdate=null,this.onUpdateParams=null,this.onComplete=null,this.onCompleteParams=null,this.properties={},this.prefix={},this.suffix={},this.yoyo={},this.plugin={},this.init()}function t(){var e=[0,0,0,0,0,0,0,0,0,0,0,0],t=[0,0,0,0,0,0,0,0,0,0,0,0],n=180/Math.PI,r=!1,s=!1,o=!1;this.setFrom=function(t){u(e,t)},this.setTo=function(e){u(t,e)},this.setOutput=function(n){return"matrix3d("+(e[0]+(t[0]-e[0])*n)+","+(e[1]+(t[1]-e[1])*n)+","+(e[2]+(t[2]-e[2])*n)+","+"0,"+(e[3]+(t[3]-e[3])*n)+","+(e[4]+(t[4]-e[4])*n)+","+(e[5]+(t[5]-e[5])*n)+","+"0,"+(e[6]+(t[6]-e[6])*n)+","+(e[7]+(t[7]-e[7])*n)+","+(e[8]+(t[8]-e[8])*n)+","+"0,"+(e[9]+(t[9]-e[9])*n)+","+(e[10]+(t[10]-e[10])*n)+","+(e[11]+(t[11]-e[11])*n)+","+"1)"};var u=function(e,t){var n=i.getStyle("transform",t);if(n.indexOf("matrix3d")>-1){var r=n.substring(9,n.length-1).split(",");for(var s=0,o=0;s<15;s++)s!=3&&s!=7&&s!=11&&(e[o]=parseFloat(r[s]),o++)}else if(n.indexOf("matrix")>-1){var r=n.substring(7,n.length-1).split(",");e[0]=parseFloat(r[0]),e[1]=parseFloat(r[1]),e[2]=0,e[3]=parseFloat(r[2]),e[4]=parseFloat(r[3]),e[5]=0,e[6]=0,e[7]=0,e[8]=1,e[9]=parseFloat(r[4]),e[10]=parseFloat(r[5]),e[11]=0}else e[0]=e[4]=e[8]=e[11]=1,e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=e[9]=e[10]=0}}function n(){var e=[0,0,0],t=[0,0,0];this.setFrom=function(t){r(e,t)},this.setTo=function(e){r(t,e)},this.setOutput=function(r){return"#"+n(e[0],t[0],r)+n(e[1],t[1],r)+n(e[2],t[2],r)};var n=function(e,t,n){var r=(e+(t-e)*n>>0).toString(16);return r.length==0&&(r="00"),r.length==1&&(r="0"+r),r},r=function(e,t){if(t.substr(0,1)=="#")t.length==4?(e[0]=parseInt(t.substr(1,1),16)*17,e[1]=parseInt(t.substr(2,1),16)*17,e[2]=parseInt(t.substr(3,1),16)*17):t.length==7&&(e[0]=parseInt(t.substr(1,2),16),e[1]=parseInt(t.substr(3,2),16),e[2]=parseInt(t.substr(5,2),16));else{var n=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t);e[0]=parseInt(n[2]),e[1]=parseInt(n[3]),e[2]=parseInt(n[4])}}}function r(){var e,t;this.setFrom=function(t){if(!t){e=1;return}if(typeof t=="number"){e=parseFloat(t);return}var n=t.indexOf("alpha");n>-1?e=parseFloat(t.slice(t.indexOf("=",n)+1))/100:e=1},this.setTo=function(e){t=e},this.setOutput=function(n){var r=e+(t-e)*n;return"alpha(opacity="+(r===1?"none":r*100)+")"}}(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),window.getComputedStyle||(window.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t=="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this});var i=function(t,n){function r(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:typeof e=="object"&&e.nodeType===1&&typeof e.nodeName=="string"}function i(e){return typeof CSSStyleDeclaration=="object"?e instanceof CSSStyleDeclaration:typeof e=="object"&&typeof e.cssText=="string"}function s(){var e=t.createElement("div"),n="Webkit Moz O ms".split(" "),r=n.length;while(r--)if(n[r]+"Transform"in e.style){y=n[r];break}}function o(e){x[e]&&(e=x[e]);for(var t=0;t<S.length;t++)if(S[t]===e)return y+e.charAt(0).toUpperCase()+e.slice(1);return e}function u(e){for(var t in e){var n=t;x[t]&&(n=x[t]);for(var r=0;r<S.length;r++)if(S[r]===n){n=y+n.charAt(0).toUpperCase()+n.slice(1);break}t!==n&&(e[n]=e[t],delete e[t])}}function a(e){u(e),u(e.plugin)}function f(e,t){t.plugin||(t.plugin={}),t.suffix||(t.suffix={});for(property in t)E[property]&&!t.plugin[property]&&(t.plugin[property]=E[property]),T[property]&&!t.suffix[property]&&(t.suffix[property]=T[property]);a(t)}function l(t,n,i,s){if(t.jquery){var o=[];return t.each(function(){o[o.length]=l(this,n,i,s)}),o.length>1?o:o[0]}var u;r(t)&&i.skipHTMLParsing!=1?(u=t.style,f(t,i)):(u=t,i.appliedTarget=t),typeof t.tweenId=="undefined"&&(t.tweenId=N.length,N[t.tweenId]=[]);var a=i.delay==m?0:i.delay;delete i.delay;var c=new e(t,u,n,a,i,s||!1);return N[t.tweenId].push(c),s||c.onLoop(),c}function c(e,t,n,i){if(e.jquery){var s=[];return e.each(function(){s[s.length]=c(this,t,n,i)}),s.length>1?s:s[0]}var o=l(e,t,i,!0);r(e)&&i.skipHTMLParsing!=1&&a(n);for(var u in n)o.changeFrom(u,n[u]);return o.onLoop(),o}function h(e){if(e.jquery){e.each(function(){h(this)});return}var t=N[e.tweenId];if(t){while(t[0])t[0].removeProperties(),t[0].kill(),delete t[0];t.splice(0,t.length)}}function p(e){return N[e.tweenId]}function d(e,t){x[t]&&(t=x[t]);var n=p(e);if(!n)return null;var r=n.length;while(r--)if(n[r].properties[t])return n[r];return null}function v(e,r){propertyName=o(e);var i=propertyName,s=/[A-Z]/g;propertyName.search(s)>-1&&(i=propertyName.replace(s,function(){return"-"+arguments[0].toLowerCase()}),i.indexOf("ms")==0&&(i="-"+i));if(t.body)return b||(b=t.createElement("div"),w=b.style,w.position="absolute",w.top=w.left="-9000px",document.body.appendChild(b)),w[propertyName]=r,n.getComputedStyle(b,"null").getPropertyValue(i);var u=t.createElement("body"),a=t.createElement("div");t.documentElement.appendChild(u),u.appendChild(a),w[propertyName]=r;var f=n.getComputedStyle(a,"null").getPropertyValue(i);return t.documentElement.removeChild(u),u=null,a=null,f}var m,g={},y="",b,w,E={},S=[],x={},T={width:"px",height:"px",top:"px",left:"px",bottom:"px",right:"px",marginTop:"px",marginLeft:"px",marginBottom:"px",marginRight:"px",paddingTop:"px",paddingLeft:"px",paddingBottom:"px",paddingRight:"px",fontSize:"px",size:"px"},N=[];return s(),g.HTMLPlugins=E,g.HTMLSuffix=T,g.HTMLPrefixedStyle=S,g.HTMLStyleAlias=x,g.getPropertyName=o,g.getStyle=v,g.to=l,g.fromTo=c,g.killTweensOf=h,g.getTweens=p,g.getTween=d,g}(document,window);e.prototype={init:function(){function e(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}}for(var t in this._data.plugin)this.plugin[t]=new this._data.plugin[t];for(t in this._data)switch(t){case"ease":this.ease=s[this._data[t]];break;case"prefix":case"suffix":case"yoyo":case"onStart":case"onStartParams":case"onUpdate":case"onUpdateParams":case"onComplete":case"onCompleteParams":this[t]=this._data[t];break;case"plugin":break;default:this.properties[t]=[this.plugin[t]?1:this._data[t],0],this.plugin[t]&&this.plugin[t].setTo(this._data[t],this._appliedTarget)}if(this.yoyo&&this._isStyle)for(var t=0;t<this.yoyo.length;t++)this.yoyo[t]=i.getPropertyName(this.yoyo[t]);if(this.prefix&&this._isStyle){var n={};for(var t in this.prefix)n[i.getPropertyName(t)]=this.prefix[t];this.prefix=n}if(this.suffix&&this._isStyle){var r={};for(var t in this.suffix)r[i.getPropertyName(t)]=this.suffix[t];this.suffix=r}this.tweens=i.getTweens(this._target);if(this.tweens&&this.tweens.length>0){t=this.tweens.length;while(t--)this.tweens[t].removeProperties(this.properties)==0&&(this.tweens[t].kill(),this.tweens.splice(t,1))}delete this._data,this.onLoop=e(this.onLoop,this)},update:function(){this.onUpdate&&(this.onUpdateParams?this.onUpdate.apply(this,this.onUpdateParams):this.onUpdate())},onLoop:function(){if(this.isFinished)return;requestAnimationFrame(this.onLoop),this._currentTime=(new Date).getTime(),this._isPaused||this.render()},render:function(){if(this._currentTime>=this._startTime){if(!this._isStarted){if(!this._hasFrom)for(var e in this.properties)this.setProperty(e,this.properties[e]);this.onStart&&(this.onStartParams?this.onStart.apply(this,this.onStartParams):this.onStart()),this._isStarted=!0}if(this._currentTime>=this._durationTime+this._startTime){for(var e in this.properties)this.setValue(this.properties[e][4]?this.properties[e][1]:this.properties[e][0],e,this.properties[e]);this.update(),this.onComplete&&(this.onCompleteParams?this.onComplete.apply(this,this.onCompleteParams):this.onComplete()),this.kill(),e=this.tweens.length;while(e--)this.tweens[e]&&this.tweens[e].isFinished&&this.tweens.splice(e,1);return}for(var e in this.properties)this.setEaseValue(e,this.properties[e]);this.update()}},setProperty:function(e,t){var n;this.prefix&&this.prefix[e]&&(t[2]=this.prefix[e]),this.suffix&&this.suffix[e]&&(t[3]=this.suffix[e]);if(this.yoyo)for(var n=0;n<this.yoyo.length;n++)if(this.yoyo[n]===e){t[4]=!0;break}if(this._isStyle){var r=this.getCurrentPropertyValue(e);this.plugin[e]?(this.plugin[e].setFrom(r),t[1]=0):t[1]=parseFloat(r)}else t[1]=parseFloat(this._appliedTarget[e]);isNaN(t[1])&&(t[1]=0)},setEaseValue:function(e,t){if(t[4]){var n=this._durationTime,r=(this._currentTime-this._startTime)*2/n;this.setValue(this.ease(r>1?2-r:r,t[1],t[0]-t[1],1),e,t)}else this.setValue(this.ease(this._currentTime-this._startTime<0?0:this._currentTime-this._startTime,t[1],t[0]-t[1],this._durationTime),e,t)},setValue:function(e,t,n){if(isNaN(e))return;var r=this.plugin[t]?this.plugin[t].setOutput(e):e;n.length>2?this._appliedTarget[t]=(n[2]?n[2]:"")+r+(n[3]?n[3]:""):this._appliedTarget[t]=r},kill:function(){cancelAnimationFrame(this.onLoop),this.isFinished=!0},pause:function(){this._pauseTime==0&&(this._pauseTime=(new Date).getTime()),this._isPaused=!0},resume:function(){if(this._pauseTime>0){var e=(new Date).getTime()-this._pauseTime;this._currentTime+=e,this._startTime+=e,_pauseTime=(new Date).getTime(),this._pauseTime=0}this._isPaused&&(this._isPaused=!1)},removeProperties:function(e){var t;if(e){var n=0;for(propertyName in this.properties)propertyName in e?delete this.properties[propertyName]:n++;return n}for(propertyName in this.properties)delete this.properties[propertyName];return 0},changeFrom:function(e,t){this._isHTML&&(e=getPropertyName(e)),this.setProperty(e,this.properties[e]),this.properties[e]&&(this.plugin[e]?this.plugin[e].setFrom(t):this.properties[e][1]=t)},changeTo:function(e,t){this._isHTML&&(e=getPropertyName(e)),this.properties[e]&&(this.plugin[e]?this.plugin[e].setTo(t):this.properties[e][0]=t)},getCurrentPropertyValue:function(e){var t=/[A-Z]/g;return e.search(t)>-1&&(e=e.replace(t,function(){return"-"+arguments[0].toLowerCase()}),e.indexOf("ms")==0&&(e="-"+e)),window.getComputedStyle(this._target,"null").getPropertyValue(e)}};var s={linear:function(e,t,n,r){return n*e/r+t},easeInQuad:function(e,t,n,r){return n*(e/=r)*e+t},easeOutQuad:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOutQuad:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,r){return n*(e/=r)*e*e+t},easeOutCubic:function(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},easeOutInCubic:function(e,t,n,r){return e<r/2?s.easeOutCubic(e*2,t,n/2,r):s.easeInCubic(e*2-r,t+n/2,n/2,r)},easeInQuart:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOutQuart:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},easeOutInQuart:function(e,t,n,r){return e<r/2?s.easeOutQuart(e*2,t,n/2,r):s.easeInQuart(e*2-r,t+n/2,n/2,r)},easeInQuint:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},easeOutQuint:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},easeOutInQuint:function(e,t,n,r){return e<r/2?s.easeOutQuint(e*2,t,n/2,r):s.easeInQuint(e*2-r,t+n/2,n/2,r)},easeInSine:function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},easeOutSine:function(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t},easeInOutSine:function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},easeOutInSine:function(e,t,n,r){return e<r/2?s.easeOutSine(e*2,t,n/2,r):s.easeInSine(e*2-r,t+n/2,n/2,r)},easeInExpo:function(e,t,n,r){return e==0?t:n*Math.pow(2,10*(e/r-1))+t-n*.001},easeOutExpo:function(e,t,n,r){return e==r?t+n:n*1.001*(-Math.pow(2,-10*e/r)+1)+t},easeInOutExpo:function(e,t,n,r){return e==0?t:e==r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t-n*5e-4:n/2*1.0005*(-Math.pow(2,-10*--e)+2)+t},easeOutInExpo:function(e,t,n,r){return e<r/2?s.easeOutExpo(e*2,t,n/2,r):s.easeInExpo(e*2-r,t+n/2,n/2,r)},easeInCirc:function(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t},easeOutCirc:function(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t},easeInOutCirc:function(e,t,n,r){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeOutInCirc:function(e,t,n,r){return e<r/2?s.easeOutCirc(e*2,t,n/2,r):s.easeInCirc(e*2-r,t+n/2,n/2,r)},easeInElastic:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},easeOutElastic:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},easeInOutElastic:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r/2)==2?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)},easeOutInElastic:function(e,t,n,r,i,o){return e<r/2?s.easeOutElastic(e*2,t,n/2,r,i,o):s.easeInElastic(e*2-r,t+n/2,n/2,r,i,o)},easeInBack:function(e,t,n,r,i){return i==undefined&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t},easeOutBack:function(e,t,n,r,i){return i==undefined&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},easeInOutBack:function(e,t,n,r,i){return i==undefined&&(i=1.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},easeOutInBack:function(e,t,n,r,i){return e<r/2?s.easeOutBack(e*2,t,n/2,r,i):s.easeInBack(e*2-r,t+n/2,n/2,r,i)},easeInBounce:function(e,t,n,r){return n-s.easeOutBounce(r-e,0,n,r)+t},easeOutBounce:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,n,r){return e<r/2?s.easeInBounce(e*2,0,n,r)*.5+t:s.easeOutBounce(e*2-r,0,n,r)*.5+n*.5+t},easeOutInBounce:function(e,t,n,r){return e<r/2?s.easeOutBounce(e*2,t,n/2,r):s.easeInBounce(e*2-r,t+n/2,n/2,r)}};return s.defaultFunc=s.easeOutCirc,i&&(i.HTMLStyleAlias.transform3d="transform",i.HTMLPrefixedStyle.push("transform"),i.HTMLPlugins.transform3d=t),i&&(i.HTMLPlugins.backgroundColor=i.HTMLPlugins.color=n),r.hasOpacity=function(){var e=document.createElement("div");return"opacity"in e.style}(),i&&(r.hasOpacity||(i.HTMLStyleAlias.opacity="filter",i.HTMLPlugins.opacity=r)),i}),define("ui/com/CircleBtn",["config","jquery","signals","inputController","mout/object/mixIn","mout/math/clamp","mout/math/norm","mout/math/lerp","mout/function/bind","EKTweener"],function(e,t,n,r,i,s,o,u,a,f){function l(e){i(this,{target:null},e),this._init()}function p(){var e=this.target;e[0].circleBtn=this,this.size=e.data("size")||44,this.strokeWidth=e.data("strokeWidth")||2,this.strokeWidthOffset=e.data("strokeWidthOffset")||1,this.innerSize=this.size-(this.strokeWidth+this.strokeWidthOffset)*2,this.iconWrapper=e.find(".circle-btn-icon-wrapper"),this.iconWrapper.css({width:this.innerSize,height:this.innerSize}),this.outline=t('<canvas class="circle-btn-outline"></canvas>')[0],t(this.outline).css({left:-this.strokeWidth-this.strokeWidthOffset,top:-this.strokeWidth-this.strokeWidthOffset}),this.outline.width=this.outline.height=this.size,this.outlineCtx=this.outline.getContext("2d"),this.iconWrapper.prepend(this.outline),this.iconStyle=this.iconWrapper.find(".circle-btn-icon")[0].style,this.isDimmed=e.hasClass("circle-btn-style-dim"),this.isDisable=e.hasClass("circle-btn-state-disable"),this.isActive=!0,this.hoverAnimation=0,this.onOvered=new n.Signal,this.onOuted=new n.Signal,this.onClicked=new n.Signal,this.boundRender=a(E,this),r.add(e,"over",a(d,this)),r.add(e,"out",a(v,this)),r.add(e,"click",a(m,this)),this.render()}function d(){!this.isDisable&&this.isActive&&(this.target.addClass("hover"),this.isHover=!0,this.isDimmed||f.to(this,.3,{hoverAnimation:1,onUpdate:this.boundRender,ease:"linear"}),this.onOvered.dispatch(this))}function v(){this.target.removeClass("hover"),this.isHover=!1,this.isDimmed||f.to(this,.3,{hoverAnimation:0,onUpdate:this.boundRender,ease:"linear"}),this.onOuted.dispatch(this)}function m(){!this.isDisable&&this.isActive&&this.onClicked.dispatch(this)}function g(e,t,n){return s(o(e,t,n),0,1)}function y(e,t,n,r){return(e-=1)*e*e+1}function b(){this.isDisable=!1,this.target.removeClass("circle-btn-state-disable")}function w(){this.isDisable=!0,this.target.addClass("circle-btn-state-disable"),this._onOut()}function E(){var e,t,n,r=this.outlineCtx,i=this.hoverAnimation,s,o=this.size/2;s=g(i,0,.5),e=u(s,.2,1),s=y(g(i,0,.4)),t=u(s,o-this.strokeWidth,o),s=y(g(i,.15,.5)),n=u(s,o-this.strokeWidth-this.strokeWidthOffset,o-this.strokeWidth),r.clearRect(0,0,this.size,this.size),r.save(),r.beginPath(),r.fillStyle="rgba(255,255,255,"+e+")",r.arc(o,o,t,0,2*Math.PI,!1),r.arc(o,o,n,0,2*Math.PI,!0),r.fill(),r.restore(),s=this.isHover?1-(1-Math.abs((g(i,0,.7)-.5)*2))*.5:1,this.iconStyle[h]="scale3d("+s+","+s+",1)"}var c=l.prototype,h=e.transform3DStyle;return c._init=p,c.render=E,c._onOver=d,c._onOut=v,c.enable=b,c.disable=w,l}),define("edankwan/loader/types/Abstract",["../quickLoader"],function(e){function t(t){if(!t)return;this.url=t,e._added[t]=this}function r(e){this.callback=e}function i(){this.isLoaded=!0,e._loaded[this.url]=this,this.callback&&this.callback(this)}t.extensions=[],t.test=function(e){return!1};var n=t.prototype;return n.load=r,n.onLoad=i,t}),window.getComputedStyle||(window.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t=="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this}),define("edankwan/polyfill/getComputedStyle",function(){}),define("edankwan/browser/getStyle",["../polyfill/getComputedStyle"],function(){function e(e){return window.getComputedStyle(e,"null")}return e}),define("edankwan/loader/types/ImageItem",["./Abstract","../../browser/getStyle"],function(e,t){function r(e){u.constructor.apply(this,arguments)}function s(e){return e.indexOf("data:")!==0}function o(e,t){i.push(t)}function f(e){u.load.apply(this,arguments);var t=this,n=t.content=new Image;n.src=this.url,n.width?t.onLoad():n.onload=function(){t.onLoad()}}function l(){this.width=this.content.width,this.height=this.content.height,u.onLoad.call(this)}var n;r.type="image",r.extensions=["jpg","gif","png"];var i;r.retrieve=function(e){return e.nodeType&&e.style?(i=[],e.nodeName.toLowerCase()=="img"&&e.src.indexOf(";")<0&&i.push(e.src),t(e).getPropertyValue("background-image").replace(/s?url\(\s*?[\'\"]?([^;]*?)[\'\"]?\s*?\)/g,o),i.length>0?i:(i=n,!1)):typeof e=="string"?[e]:!1};var u=e.prototype,a=r.prototype=new e;return a.constructor=r,a.load=f,a.onLoad=l,r}),define("edankwan/loader/types/JSONPItem",["./Abstract"],function(e){function n(){return"_jsonp"+(new Date).getTime()+~~(Math.random()*1e8)}function r(e){i.constructor.apply(this,arguments)}function o(e){i.load.apply(this,arguments);var t=this,r=this.url.lastIndexOf("=")+1,s=this.url.substr(0,r),o=this.url.substr(r);o.length===0?(o=n(),this.jsonpCallback=e):this.jsonpCallback=window[o],window[o]=function(e){t.content=e,t.onLoad(e)};var u=document.createElement("script");u.type="text/javascript",u.src=s+o,document.getElementsByTagName("head")[0].appendChild(u)}function u(e){this.jsonpCallback&&this.jsonpCallback(e),i.onLoad.call(this)}var t;r.type="jsonp",r.extensions=[],r.retrieve=function(e){return typeof e=="string"&&e.indexOf("=")>-1?[e]:!1};var i=e.prototype,s=r.prototype=new e;return s.constructor=r,s.load=o,s.onLoad=u,r}),define("edankwan/loader/types/AudioItem",["./Abstract"],function(e){function n(e){r.constructor.apply(this,arguments)}function s(e){r.load.apply(this,arguments);var t=this,n;try{n=t.content=new Audio}catch(i){n=t.content=document.createElement("audio")}n.canplaythrough=n.load=function(){t.onLoad()},n.src=this.url,n.load()}function o(e){if(this.isLoaded)return;r.onLoad.call(this)}var t;n.type="audio",n.extensions=["mp3","ogg"],n.retrieve=function(e){return[e]};var r=e.prototype,i=n.prototype=new e;return i.constructor=n,i.load=s,i.onLoad=o,n}),define("edankwan/loader/quickLoader",["exports","./types/ImageItem","./types/JSONPItem","./types/AudioItem"],function(e,t,n,r){function c(){for(var e=0,t=f;e<t;e++)l[a[e].type]=a[e]}function h(e,t){var n,r,i,s,o,u=p(e,t);for(n=0,i=u.length;n<i;n++){o=u[n];for(r=0,s=o.items.length;r<s;r++)m(o.items[r],o.type)}return u}function p(e,t){var n,r,i=e.length,s=[];if(i&&typeof e!="string"){var n=-1;while(++n<i)r=v(e[n],t),r&&(s=s.concat(r))}else r=v(e,t),r&&(s=s.concat(r));return s}function d(e,t){if(!e)return;var n=t.extensions,r=n.length,i=e.length;while(r--)if(e.lastIndexOf("."+n[r])===i-n[r].length-1)return!0;return!1}function v(e,t){var n,r,s,o;if(t)o=l[t],s=o.retrieve(e);else for(n=0,r=f;n<r;n++){o=a[n],t=o.type,s=o.retrieve(e);if(s&&s.length&&typeof s[0]=="string"&&d(s[0],o))break;s=i}if(s)return{type:t,items:s};return}function m(t,n){return s[t]||(y(t,n),u.push(new l[n](t)),e._weight++),s[t]}function g(e,t,n){if(!o[e]){if(!n){var r=v(e,n);n=r.type}y(e,n),s[e].load(t)}else t.call(this,o[e])}function y(e,t){s[e]=new l[t](e)}function b(t){var n,r;e._onLoading=t,e.isLoading=!0;var i=u.splice(0,u.length);while(i[0])i.shift().load(w)}function w(t){e._sum++;var n=e._sum/e._weight;n==1&&(e.isLoading=!1,e._sum=0,e._weight=0),e._onLoading&&e._onLoading(n,t.url)}var i;e.VERSION="1.0.0",e.isLoading=!1,e._added={},e._loaded={},e._sum=0,e._weight=0,e._onLoading=null;var s=e._added,o=e._loaded,u=[],a=[t,n,r],f=a.length,l={};c(),e.add=h,e.addSingle=m,e.retrieveAll=p,e.loadSingle=g,e.start=b}),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("edankwan/polyfill/rAF",function(){}),define("stageReference",["signals","exports","edankwan/polyfill/rAF"],function(e,t){function s(){"addEventListener"in window?(window.addEventListener("resize",function(){t.resizeActive&&n.dispatch("resize")},!1),window.addEventListener("orientationchange",function(){t.orientationchangeActive&&n.dispatch("orientationchange")},!1)):window.detachEvent("onresize",n.dispatch),n.add(o),o()}function o(){"innerWidth"in window?(t.windowWidth=window.innerWidth,t.windowHeight=window.innerHeight):document.documentElement?(t.windowWidth=document.documentElement.clientWidth,t.windowHeight=document.documentElement.clientHeight):(t.windowWidth=document.body.clientWidth,t.windowHeight=document.body.clientHeight),t.stageWidth=t.windowWidth<t.minWidth?t.minWidth:t.windowWidth,t.stageHeight=t.windowHeight<t.minHeight?t.minHeight:t.windowHeight}function u(){i&&(window.requestAnimationFrame(u),r.dispatch())}function a(){i=t.isRendering=!0,u()}function f(){i=t.isRendering=!1}function l(){r.dispatch()}t.windowWidth=0,t.windowHeight=0,t.stageWidth=0,t.stageHeight=0,t.resizeActive=!0,t.orientationchangeActive=!0;var n=new e.Signal,r=new e.Signal,i=t.isRendering=!1;return t.init=s,t.onResize=n,t.onRender=r,t.startRender=a,t.stopRender=f,t.renderOnce=l,t}),define("preloaderController",["exports","config","signals","mout/function/bind","edankwan/loader/quickLoader","stageReference","EKTweener"],function(e,t,n,r,i,s,o){function m(){p.add(x)}function g(e,t,n,r){function i(i){e.dispatch(i),i===1&&(r===0&&t.dispatch(),n.dispatch())}u&&(r=0);if(r===0)return i;var s={percent:0};return function(e){o.to(s,r,{percent:e,onUpdate:function(){i(s.percent)}}),e===1&&t.dispatch()}}function y(){i.start(g(a,f,l,d))}function b(e,t){return e.jquery&&(e=e.add(e.find("*"))),i.add(e,t)}function w(e,t,n){i.loadSingle(e,t,n)}function E(e){return{width:i._imageWidths[e],height:i._imageHeights[e]}}function S(){i.start(g(c,h,p,v))}function x(){e.preloaded=!0}function T(e){return i._loaded[e]}var u=e.SKIP_ANIMATION=!0,a=e.onReadyLoading=new n.Signal,f=e.onReadyLoaded=new n.Signal,l=e.onReadyComplete=new n.Signal,c=e.onLoading=new n.Signal,h=e.onLoaded=new n.Signal,p=e.onLoadComplete=new n.Signal;e.preloaded=!1;var d=0,v=1;return e.preStart=y,e.add=b,e.loadSingle=w,e.getImageSize=E,e.start=S,e.getLoadedItemByURL=T,e}),define("trackingController",["exports","config","jquery"],function(e,t,n){function u(e){}function a(e){var t=e.trackPage;s?o&&(console.log("### TRACK PAGE ###"),console.log("track page: "+t),console.log("###")):_gaq.push(["_trackPageview",t])}function f(e){var t=[e.trackCat];t.push("click - "+e.trackCat),e.trackLabel&&t.push(e.trackLabel),s?o&&(console.log("### TRACK EVENT ###"),console.log("track event: "+t.join("-")),console.log("###")):(t.unshift("_trackEvent"),_gaq.push(t))}function l(e){c(n(e).data())}function c(e){e.trackPage?a(e):e.tracAction?f(e):o&&console.log("## ERROR missing tracking parameters")}var r,i=window.s||{t:function(){}},s=t.IS_DEV&&t.ENV_ID=="edanlocal",o=!1;return e.trackPage=a,e.trackEvent=f,e.trackDom=l,e.track=c,e}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!shaders/stepCircle/vertex.glsl",[],function(){return"varying float pAlpha;\nuniform float time;\nuniform float extraTime;\nuniform vec4 stepTimes;\nuniform vec4 stepExtraTimes;\nuniform float animationRatio;\nuniform float focusRatio;\nuniform float amountPerDegree;\nuniform float opacity;\nuniform float fading;\nuniform float dpi;\n\nfloat PI = 3.14159265358979323846264;\n\n/*EVAL THREE.ShaderChunk['snoise2d'];*/\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nfloat easeOutBack(float t) {\n    return ((t=t-1.)*t*((2.70158)*t + 1.70158) + 1.);\n}\n\nvoid main() {\n\n    vec3 pos = position;\n    float baseAngle = atan(pos.y, pos.x);\n    float baseRadius = sqrt(pos.x * pos.x + pos.y * pos.y) - 1.0;\n\n    // 9 groups\n    float group = mod(floor(baseRadius * amountPerDegree), 9.0);\n\n    float angle = baseAngle;\n    float radius = baseRadius * 30.0 + 155.0;\n    float angleFinalOffset = (time + extraTime) * .1;\n    float tmpRatio;\n    float tmp;\n    pAlpha = 1.0;\n\n    // tmpRatio = clampNorm(animationRatio, 0., 1.);\n\n    tmpRatio = 1.;//easeOutBack(clamp(1. - abs(animationRatio - 2.), 0., 1.));\n    float stepTime = time;// stepTimes.x + stepExtraTimes.x;\n\n    if(group > 2.) {\n        if(angle > PI / 2.0) {\n            tmp = PI;\n        } else if(angle < -PI / 2.0) {\n            tmp = -PI;\n        } else {\n            tmp = 0.;\n        }\n        angle = mix(angle, mix(angle, tmp, .85), (tmpRatio + snoise(position.xy * 30. + time * (.1 + group * .03))) * tmpRatio / 2.);\n        radius += ((snoise(position.xy * 15.) * 2. - 1.) * (sin(radius * group * 3.0) + 1.) * 10. + 18.)* tmpRatio;\n        angleFinalOffset += (mod(group, 3.) * .01 * mod(group, 2.) ) * (tmpRatio  + stepTime);\n    } else {\n        angleFinalOffset += (group * .02) * (tmpRatio  + stepTime);\n        // angle += time * tmpRatio * .2;\n        radius += (30. + snoise(position.xy * 400.) * 20. * group  + (baseRadius - .5) * (50. + group * 20. + abs(cos(baseAngle)) * snoise(position.xy * 200.) *30.)) * tmpRatio;\n    }\n\n    tmpRatio = clampNorm(animationRatio, 2., 3.);\n    radius = mix(radius, 150. + baseRadius * (255. + group * 10.), easeOutBack(pow(tmpRatio, 1. + group * .2 + snoise(position.xy * 312.))));\n    radius += clampNorm(baseRadius, .75, 1.) * 100. * snoise(position.xy * 230. + 15.) * tmpRatio;\n\n    tmpRatio = clampNorm(animationRatio, 3., 4.);\n    radius *= 1.0 + tmpRatio * abs(snoise(position.xy * 35. + 41.));\n\n    // focus\n    angle -= focusRatio * PI * (.1 + group * .03);\n    radius = mix(radius, 160., (easeOutBack(focusRatio) * .8 + snoise(position.xy * 200.0) * .3) * pow(abs(easeOutBack(focusRatio)), 1.0 + group));\n\n    pos.x = sin(angle) * radius;\n    pos.y = cos(angle) * radius;\n\n\n    tmpRatio = 1.;//clampNorm(animationRatio, 1., 2.);\n    pos.x += (snoise(position.xy *90. + time * .3) * 10.) * (tmpRatio - (focusRatio));\n    pos.y += (snoise(position.xy *90. + time * .3 + 2.)  * 10.) * (tmpRatio - (focusRatio));\n    angleFinalOffset += .1 * (tmpRatio  + stepTime);\n\n    pos.x += snoise(position.xy * 100.0) * 3.0;\n    pos.y += snoise(position.xy * 100.0 + 3.0) * 3.0;\n\n    tmpRatio = clampNorm(animationRatio, 3., 4.);\n    pos.x += tmpRatio * (abs(snoise(position.xy * 26. + 31.)) - .5) * 20.;\n    pos.y += tmpRatio * (abs(snoise(position.xy * 41. + 26.)) - .5) * 20.;\n\n    angle = atan(pos.y, pos.x) + angleFinalOffset;\n    radius = sqrt(pos.x * pos.x + pos.y * pos.y);\n\n    pos.x = sin(angle) * radius;\n    pos.y = cos(angle) * radius;\n\n    tmpRatio = 1.;//clampNorm(animationRatio, 1., 2.);\n    if(group > 1.) {\n        pAlpha = tmpRatio;\n    }\n    tmpRatio = 1.;//clamp(1. - abs(animationRatio - 2.), 0., 1.);\n    if(mod(group, 3.) > 0.) {\n        pAlpha -= sin((radius + snoise(position.xy * 12.) * 10.0) * mix(.2, .25, tmpRatio)) / pow(1.0 + baseRadius, 3.0) * tmpRatio;\n    }\n\n    tmpRatio = clampNorm(animationRatio, 2., 3.);\n    pAlpha *= 1. - tmpRatio * .4;\n\n    tmpRatio = clampNorm(animationRatio, 3.75, 4.);\n    pAlpha *= 1. - tmpRatio;\n\n    tmpRatio = clampNorm(animationRatio, 0., 1.);\n    angle = mod(angle + PI * 2., PI * 2.);\n    float maskCenterAngle = mod(time * 2. + PI, PI * 2.);\n    float deltaAngle = mod(angle - maskCenterAngle + PI * 2., PI * 2.);\n    float maskStart = tmpRatio * PI / 2.;\n    float maskEnd = PI / 3. + tmpRatio * PI;\n    float alpha = 1. - clampNorm( step(0., deltaAngle) * deltaAngle + (1. - step(0., deltaAngle)) * (deltaAngle + PI * 2.), maskStart, maskEnd);\n\n    maskStart = PI * 2. - tmpRatio * PI / 2.;\n    maskEnd = PI * 2. - PI / 3. - tmpRatio * PI;\n    alpha += 1. - clampNorm( step(0., deltaAngle) * deltaAngle + (1. - step(0., deltaAngle)) * (deltaAngle + PI * 2.), maskStart, maskEnd);\n\n    pAlpha *= pow(clamp(alpha, 0., 1.), 1. + group * .2);\n\n    // pAlpha *= mix((step(0., deltaAngle) * deltaAngle + (1. - step(0., deltaAngle)) * (deltaAngle + PI * 2.)) / maskLen * PI;\n    // if(deltaAngle > PI) {\n    //     pAlpha *= 1.;\n    // } else {\n    //     pAlpha *= 0.;\n    // }\n\n    // float alpha = (cos(baseAngle + time * 2.0 + PI * .75) + 1.0) / 2.0 * tmpRatio;\n    // pAlpha += pow(abs(alpha), 3.0) * .75;\n\n    //crop center\n    tmpRatio = step(.2, animationRatio) * clamp(1. - abs(animationRatio + 2. - 2.), 0., 1.);\n    if(tmpRatio > .0 && radius < tmpRatio * 155.) {\n        pAlpha = .0;\n    }\n\n\n    pAlpha = clamp(pAlpha, .0, 1.0) * .2 * opacity * fading;\n\n\n    vec4 modelViewPos = modelViewMatrix * vec4( pos, 1.0 );\n    float distanceToCamera = sqrt(modelViewPos.x * modelViewPos.x + modelViewPos.y * modelViewPos.y + modelViewPos.z * modelViewPos.z);\n\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );\n    gl_PointSize = 1. * dpi;\n    // colorRatio = snoise(refPos.xz * 0.0005 + 200.0);\n\n}\n"}),define("text!shaders/stepCircle/fragment.glsl",[],function(){return"varying float pAlpha;\n\nvoid main() {\n\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    gl_FragColor.a *= pAlpha;\n\n\n}\n"}),define("libs/threejs/Three",[],function(){var e={REVISION:"66"};return self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!self.requestAnimationFrame;++n)self.requestAnimationFrame=self[t[n]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[n]+"CancelAnimationFrame"]||self[t[n]+"CancelRequestAnimationFrame"];self.requestAnimationFrame===undefined&&self.setTimeout!==undefined&&(self.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=self.setTimeout(function(){t(n+r)},r);return e=n+r,i}),self.cancelAnimationFrame===undefined&&self.clearTimeout!==undefined&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=function(){},e.CubeReflectionMapping=function(){},e.CubeRefractionMapping=function(){},e.SphericalReflectionMapping=function(){},e.SphericalRefractionMapping=function(){},e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e}),define("text!shaders/noises/snoise2d.glsl",[],function(){return"vec3 mod289(vec3 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec2 mod289(vec2 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec3 permute(vec3 x) {return mod289(((x*34.0)+1.0)*x);}\nfloat snoise(vec2 v){\nconst vec4 C = vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);\nvec2 i  = floor(v + dot(v, C.yy) );\nvec2 x0 = v -   i + dot(i, C.xx);\nvec2 i1;\ni1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\nvec4 x12 = x0.xyxy + C.xxzz;\nx12.xy -= i1;\ni = mod289(i);\nvec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))+ i.x + vec3(0.0, i1.x, 1.0 ));\nvec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\nm = m*m ;\nm = m*m ;\nvec3 x = 2.0 * fract(p * C.www) - 1.0;\nvec3 h = abs(x) - 0.5;\nvec3 ox = floor(x + 0.5);\nvec3 a0 = x - ox;\nm *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\nvec3 g;\ng.x  = a0.x  * x0.x  + h.x  * x0.y;\ng.yz = a0.yz * x12.xz + h.yz * x12.yw;\nreturn 130.0 * dot(m, g);\n}\n"}),define("libs/threejs/renderers/shaders/ShaderChunk",["../../Three"],function(e){return e.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},e.ShaderChunk}),define("libs/threejs/math/Quaternion",["../Three"],function(e){return e.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=r!==undefined?r:1},e.Quaternion.prototype={constructor:e.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:undefined,_updateEuler:function(e){this._euler!==undefined&&this._euler.setFromQuaternion(this,undefined,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(t,n){if(t instanceof e.Euler==0)throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var r=Math.cos(t._x/2),i=Math.cos(t._y/2),s=Math.cos(t._z/2),o=Math.sin(t._x/2),u=Math.sin(t._y/2),a=Math.sin(t._z/2);return t.order==="XYZ"?(this._x=o*i*s+r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s-o*u*a):t.order==="YXZ"?(this._x=o*i*s+r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s+o*u*a):t.order==="ZXY"?(this._x=o*i*s-r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s-o*u*a):t.order==="ZYX"?(this._x=o*i*s-r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s+o*u*a):t.order==="YZX"?(this._x=o*i*s+r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s-o*u*a):t.order==="XZY"&&(this._x=o*i*s-r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s+o*u*a),n!==!1&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._updateEuler(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;return c>0?(h=.5/Math.sqrt(c+1),this._w=.25/h,this._x=(f-u)*h,this._y=(i-a)*h,this._z=(s-r)*h):n>o&&n>l?(h=2*Math.sqrt(1+n-o-l),this._w=(f-u)/h,this._x=.25*h,this._y=(r+s)/h,this._z=(i+a)/h):o>l?(h=2*Math.sqrt(1+o-n-l),this._w=(i-a)/h,this._x=(r+s)/h,this._y=.25*h,this._z=(u+f)/h):(h=2*Math.sqrt(1+l-n-o),this._w=(s-r)/h,this._x=(i+a)/h,this._y=(u+f)/h,this._z=.25*h),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;return this._w=s*f+this._w*l,this._x=n*f+this._x*l,this._y=r*f+this._y*l,this._z=i*f+this._z*l,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new e.Quaternion(this._x,this._y,this._z,this._w)}},e.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},e.Quaternion}),define("libs/threejs/math/Math",["../Three"],function(e){return e.Math={PI2:Math.PI*2,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),n=0,r;return function(){for(var i=0;i<36;i++)i==8||i==13||i==18||i==23?t[i]="-":i==14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i==19?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}},e.Math}),define("libs/threejs/math/Euler",["../Three","./Quaternion"],function(e,t){return e.Euler=function(t,n,r,i){this._x=t||0,this._y=n||0,this._z=r||0,this._order=i||e.Euler.DefaultOrder},e.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.Euler.DefaultOrder="XYZ",e.Euler.prototype={constructor:e.Euler,_x:0,_y:0,_z:0,_order:e.Euler.DefaultOrder,_quaternion:undefined,_updateQuaternion:function(){this._quaternion!==undefined&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],h=r[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(n(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-f,h),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,a),this._z=0)):t==="YXZ"?(this._x=Math.asin(-n(f)),Math.abs(f)<.99999?(this._y=Math.atan2(o,h),this._z=Math.atan2(u,a)):(this._y=Math.atan2(-l,i),this._z=0)):t==="ZXY"?(this._x=Math.asin(n(c)),Math.abs(c)<.99999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-s,a)):(this._y=0,this._z=Math.atan2(u,i))):t==="ZYX"?(this._y=Math.asin(-n(l)),Math.abs(l)<.99999?(this._x=Math.atan2(c,h),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-s,a))):t==="YZX"?(this._z=Math.asin(n(u)),Math.abs(u)<.99999?(this._x=Math.atan2(-f,a),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,h))):t==="XZY"?(this._z=Math.asin(-n(s)),Math.abs(s)<.99999?(this._x=Math.atan2(c,a),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-f,h),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,u=e.w*e.w;return t=t||this._order,t==="XYZ"?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)):t==="YXZ"?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)):t==="ZXY"?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)):t==="ZYX"?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)):t==="YZX"?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):t==="XZY"?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,n!==!1&&this._updateQuaternion(),this},reorder:function(){var t=new e.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==undefined&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new e.Euler(this._x,this._y,this._z,this._order)}},e.Euler}),define("libs/threejs/math/Vector3",["../Three","./Math","./Quaternion","./Euler"],function(e,t,n,r){return e.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var t;return function(n){return n instanceof e.Euler==0&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),t===undefined&&(t=new e.Quaternion),this.applyQuaternion(t.setFromEuler(n)),this}}(),applyAxisAngle:function(){var t;return function(n,r){return t===undefined&&(t=new e.Quaternion),this.applyQuaternion(t.setFromAxisAngle(n,r)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,u=e.w,a=u*t+s*r-o*n,f=u*n+o*t-i*r,l=u*r+i*n-s*t,c=-i*t-s*n-o*r;return this.x=a*u+c*-i+f*-o-l*-s,this.y=f*u+c*-s+l*-i-a*-o,this.z=l*u+c*-o+a*-s-f*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var t,n;return function(r,i){return t===undefined&&(t=new e.Vector3,n=new e.Vector3),t.set(r,r,r),n.set(i,i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(t!==undefined)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var t,n;return function(r){return t===undefined&&(t=new e.Vector3),t.copy(r).normalize(),n=this.dot(t),this.copy(t).multiplyScalar(n)}}(),projectOnPlane:function(){var t;return function(n){return t===undefined&&(t=new e.Vector3),t.copy(this).projectOnVector(n),this.sub(t)}}(),reflect:function(){var t;return function(n){return t===undefined&&(t=new e.Vector3),this.sub(t.copy(n).multiplyScalar(2*this.dot(n)))}}(),angleTo:function(t){var n=this.dot(t)/(this.length()*t.length());return Math.acos(e.Math.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){var n=e*4,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.Vector3}),define("libs/threejs/math/Matrix4",["../Three","./Vector3","./Math","./Euler"],function(e,t,n,r){return e.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.elements=new Float32Array(16);var m=this.elements;m[0]=e!==undefined?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=s!==undefined?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=l!==undefined?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=v!==undefined?v:1},e.Matrix4.prototype={constructor:e.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractRotation:function(){var t=new e.Vector3;return function(e){var n=this.elements,r=e.elements,i=1/t.set(r[0],r[1],r[2]).length(),s=1/t.set(r[4],r[5],r[6]).length(),o=1/t.set(r[8],r[9],r[10]).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,this}}(),makeRotationFromEuler:function(t){t instanceof e.Euler==0&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var n=this.elements,r=t.x,i=t.y,s=t.z,o=Math.cos(r),u=Math.sin(r),a=Math.cos(i),f=Math.sin(i),l=Math.cos(s),c=Math.sin(s);if(t.order==="XYZ"){var h=o*l,p=o*c,d=u*l,v=u*c;n[0]=a*l,n[4]=-a*c,n[8]=f,n[1]=p+d*f,n[5]=h-v*f,n[9]=-u*a,n[2]=v-h*f,n[6]=d+p*f,n[10]=o*a}else if(t.order==="YXZ"){var m=a*l,g=a*c,y=f*l,b=f*c;n[0]=m+b*u,n[4]=y*u-g,n[8]=o*f,n[1]=o*c,n[5]=o*l,n[9]=-u,n[2]=g*u-y,n[6]=b+m*u,n[10]=o*a}else if(t.order==="ZXY"){var m=a*l,g=a*c,y=f*l,b=f*c;n[0]=m-b*u,n[4]=-o*c,n[8]=y+g*u,n[1]=g+y*u,n[5]=o*l,n[9]=b-m*u,n[2]=-o*f,n[6]=u,n[10]=o*a}else if(t.order==="ZYX"){var h=o*l,p=o*c,d=u*l,v=u*c;n[0]=a*l,n[4]=d*f-p,n[8]=h*f+v,n[1]=a*c,n[5]=v*f+h,n[9]=p*f-d,n[2]=-f,n[6]=u*a,n[10]=o*a}else if(t.order==="YZX"){var w=o*a,E=o*f,S=u*a,x=u*f;n[0]=a*l,n[4]=x-w*c,n[8]=S*c+E,n[1]=c,n[5]=o*l,n[9]=-u*l,n[2]=-f*l,n[6]=E*c+S,n[10]=w-x*c}else if(t.order==="XZY"){var w=o*a,E=o*f,S=u*a,x=u*f;n[0]=a*l,n[4]=-c,n[8]=f*l,n[1]=w*c+x,n[5]=o*l,n[9]=E*c-S,n[2]=S*c-E,n[6]=u*l,n[10]=x*c+w}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(e,i,s){var o=this.elements;return r.subVectors(e,i).normalize(),r.length()===0&&(r.z=1),t.crossVectors(s,r).normalize(),t.length()===0&&(r.x+=1e-4,t.crossVectors(s,r).normalize()),n.crossVectors(r,t),o[0]=t.x,o[4]=n.x,o[8]=r.x,o[1]=t.y,o[5]=n.y,o[9]=r.y,o[2]=t.z,o[6]=n.z,o[10]=r.z,this}}(),multiply:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],E=r[0],S=r[4],x=r[8],T=r[12],N=r[1],C=r[5],k=r[9],L=r[13],A=r[2],O=r[6],M=r[10],_=r[14],D=r[3],P=r[7],H=r[11],B=r[15];return i[0]=s*E+o*N+u*A+a*D,i[4]=s*S+o*C+u*O+a*P,i[8]=s*x+o*k+u*M+a*H,i[12]=s*T+o*L+u*_+a*B,i[1]=f*E+l*N+c*A+h*D,i[5]=f*S+l*C+c*O+h*P,i[9]=f*x+l*k+c*M+h*H,i[13]=f*T+l*L+c*_+h*B,i[2]=p*E+d*N+v*A+m*D,i[6]=p*S+d*C+v*O+m*P,i[10]=p*x+d*k+v*M+m*H,i[14]=p*T+d*L+v*_+m*B,i[3]=g*E+y*N+b*A+w*D,i[7]=g*S+y*C+b*O+w*P,i[11]=g*x+y*k+b*M+w*H,i[15]=g*T+y*L+b*_+w*B,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyProjection(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var t=new e.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(w==0){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/w),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var t=new e.Vector3,n=new e.Matrix4;return function(e,r,i){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),u=t.set(s[4],s[5],s[6]).length(),a=t.set(s[8],s[9],s[10]).length(),f=this.determinant();f<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],n.elements.set(this.elements);var l=1/o,c=1/u,h=1/a;return n.elements[0]*=l,n.elements[1]*=l,n.elements[2]*=l,n.elements[4]*=c,n.elements[5]*=c,n.elements[6]*=c,n.elements[8]*=h,n.elements[9]*=h,n.elements[10]*=h,r.setFromRotationMatrix(n),i.x=o,i.y=u,i.z=a,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements,u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return o[0]=u,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=a,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,n,r,i){var s=r*Math.tan(e.Math.degToRad(t*.5)),o=-s,u=o*n,a=s*n;return this.makeFrustum(u,a,o,s,r,i)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i,l=(t+e)/u,c=(n+r)/a,h=(s+i)/f;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2/a,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var t=this.elements;return new e.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},e.Matrix4}),define("libs/threejs/core/EventDispatcher",["../Three"],function(e){return e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=e.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){this._listeners===undefined&&(this._listeners={});var n=this._listeners;n[e]===undefined&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===undefined)return!1;var n=this._listeners;return n[e]!==undefined&&n[e].indexOf(t)!==-1?!0:!1},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners,r=n[e];if(r!==undefined){var i=r.indexOf(t);i!==-1&&r.splice(i,1)}},dispatchEvent:function(){var e=[];return function(t){if(this._listeners===undefined)return;var n=this._listeners,r=n[t.type];if(r!==undefined){t.target=this;var i=r.length;for(var s=0;s<i;s++)e[s]=r[s];for(var s=0;s<i;s++)e[s].call(this,t)}}}()},e.EventDispatcher}),define("libs/threejs/core/Object3D",["../Three","../math/Quaternion","../math/Vector3","../math/Matrix4","./EventDispatcher","../math/Euler","../math/Math"],function(e,t,n,r,i,s,o){return e.Object3D=function(){this.id=e.Object3DIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.parent=undefined,this.children=[],this.up=new e.Vector3(0,1,0),this.position=new e.Vector3,this._rotation=new e.Euler,this._quaternion=new e.Quaternion,this.scale=new e.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},e.Object3D.prototype={constructor:e.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var t=new e.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new e.Vector3;return function(e,n){return t.copy(e),t.applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new e.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new e.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(t===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(t instanceof e.Object3D){t.parent!==undefined&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t);var n=this;while(n.parent!==undefined)n=n.parent;n!==undefined&&n instanceof e.Scene&&n.__addObject(t)}},remove:function(t){var n=this.children.indexOf(t);if(n!==-1){t.parent=undefined,t.dispatchEvent({type:"removed"}),this.children.splice(n,1);var r=this;while(r.parent!==undefined)r=r.parent;r!==undefined&&r instanceof e.Scene&&r.__removeObject(t)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e)return i;if(t===!0){i=i.getObjectById(e,t);if(i!==undefined)return i}}return undefined},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e)return i;if(t===!0){i=i.getObjectByName(e,t);if(i!==undefined)return i}}return undefined},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){e===undefined&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||e===!0)this.parent===undefined?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(t,n){t===undefined&&(t=new e.Object3D),n===undefined&&(n=!0),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData));if(n===!0)for(var r=0;r<this.children.length;r++){var i=this.children[r];t.add(i.clone())}return t}},e.EventDispatcher.prototype.apply(e.Object3D.prototype),e.Object3DIdCount=0,e.Object3D}),define("libs/threejs/cameras/Camera",["../Three","../core/Object3D","../math/Matrix4"],function(e,t,n){return e.Camera=function(){e.Object3D.call(this),this.matrixWorldInverse=new e.Matrix4,this.projectionMatrix=new e.Matrix4},e.Camera.prototype=Object.create(e.Object3D.prototype),e.Camera.prototype.lookAt=function(){var t=new e.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),e.Camera.prototype.clone=function(t){return t===undefined&&(t=new e.Camera),e.Object3D.prototype.clone.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t},e.Camera}),define("libs/threejs/cameras/OrthographicCamera",["../Three","./Camera"],function(e,t){return e.OrthographicCamera=function(t,n,r,i,s,o){e.Camera.call(this),this.left=t,this.right=n,this.top=r,this.bottom=i,this.near=s!==undefined?s:.1,this.far=o!==undefined?o:2e3,this.updateProjectionMatrix()},e.OrthographicCamera.prototype=Object.create(e.Camera.prototype),e.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},e.OrthographicCamera.prototype.clone=function(){var t=new e.OrthographicCamera;return e.Camera.prototype.clone.call(this,t),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t},e.OrthographicCamera}),define("libs/threejs/math/Color",["../Three"],function(e){return e.Color=function(e){return arguments.length===3?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},e.Color.prototype={constructor:e.Color,r:1,g:1,b:1,set:function(t){return t instanceof e.Color?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(t===0)this.r=this.g=this.b=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*6*(2/3-n):e},i=n<=.5?n*(1+t):n+t-n*t,s=2*n-i;this.r=r(s,i,e+1/3),this.g=r(s,i,e),this.b=r(s,i,e-1/3)}return this},setStyle:function(t){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var n=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){var n=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(t)){var n=/^\#([0-9a-f]{6})$/i.exec(t);return this.setHex(parseInt(n[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return this.setHex(parseInt(n[1]+n[1]+n[2]+n[2]+n[3]+n[3],16)),this}if(/^(\w+)$/i.test(t))return this.setHex(e.ColorKeywords[t]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0},n=this.r,r=this.g,i=this.b,s=Math.max(n,r,i),o=Math.min(n,r,i),u,a,f=(o+s)/2;if(o===s)u=0,a=0;else{var l=s-o;a=f<=.5?l/(s+o):l/(2-s-o);switch(s){case n:u=(r-i)/l+(r<i?6:0);break;case r:u=(i-n)/l+2;break;case i:u=(n-r)/l+4}u/=6}return t.h=u,t.s=a,t.l=f,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new e.Color).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e.Color}),define("libs/threejs/materials/Material",["../Three","../core/EventDispatcher","../math/Vector3","../math/Color","../math/Math"],function(e,t,n,r,i){return e.Material=function(){this.id=e.MaterialIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},e.Material.prototype={constructor:e.Material,setValues:function(t){if(t===undefined)return;for(var n in t){var r=t[n];if(r===undefined){console.warn("THREE.Material: '"+n+"' parameter is undefined.");continue}if(n in this){var i=this[n];i instanceof e.Color?i.set(r):i instanceof e.Vector3&&r instanceof e.Vector3?i.copy(r):n=="overdraw"?this[n]=Number(r):this[n]=r}}},clone:function(t){return t===undefined&&(t=new e.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Material.prototype),e.MaterialIdCount=0,e.Material}),define("libs/threejs/materials/MeshBasicMaterial",["../Three","./Material","../math/Color"],function(e,t,n){return e.MeshBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},e.MeshBasicMaterial.prototype=Object.create(e.Material.prototype),e.MeshBasicMaterial.prototype.clone=function(){var t=new e.MeshBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},e.MeshBasicMaterial}),define("libs/threejs/math/Vector2",["../Three"],function(e){return e.Vector2=function(e,t){this.x=e||0,this.y=t||0},e.Vector2.prototype={constructor:e.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var t,n;return function(r,i){return t===undefined&&(t=new e.Vector2,n=new e.Vector2),t.set(r,r),n.set(i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector2}),define("libs/threejs/math/Box3",["../Three","./Vector3"],function(e,t){return e.Box3=function(t,n){this.min=t!==undefined?t:new e.Vector3(Infinity,Infinity,Infinity),this.max=n!==undefined?n:new e.Vector3(-Infinity,-Infinity,-Infinity)},e.Box3.prototype={constructor:e.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)this.addPoint(e[n])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t=new e.Vector3;return function(e){var n=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){if(e.geometry!==undefined&&e.geometry.vertices!==undefined){var r=e.geometry.vertices;for(var i=0,s=r.length;i<s;i++)t.copy(r[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){var n=t||new e.Vector3;return n.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var n=t||new e.Vector3;return n.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(t,n){var r=n||new e.Vector3;return r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(t,n){var r=n||new e.Vector3;return r.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var n=t.copy(e).clamp(this.min,this.max);return n.sub(e).length()}}(),getBoundingSphere:function(){var t=new e.Vector3;return function(n){var r=n||new e.Sphere;return r.center=this.center(),r.radius=this.size(t).length()*.5,r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box3).copy(this)}},e.Box3}),define("libs/threejs/math/Sphere",["../Three","./Box3","./Vector3"],function(e,t,n){return e.Sphere=function(t,n){this.center=t!==undefined?t:new e.Vector3,this.radius=n!==undefined?n:0},e.Sphere.prototype={constructor:e.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var t=new e.Box3;return function(e,n){var r=this.center;n!==undefined?r.copy(n):t.setFromPoints(e).center(r);var i=0;for(var s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(t,n){var r=this.center.distanceToSquared(t),i=n||new e.Vector3;return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){var n=t||new e.Box3;return n.set(this.center,this.center),n.expandByScalar(this.radius),n},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new e.Sphere).copy(this)}},e.Sphere}),define("libs/threejs/math/Vector4",["../Three"],function(e){return e.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==undefined?r:1},e.Vector4.prototype={constructor:e.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==undefined?e.w:1,this},add:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return t!==undefined?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(a+1)/2,y=(h+1)/2,b=(m+1)/2,w=(f+c)/4,E=(l+d)/4,S=(p+v)/4;return g>y&&g>b?g<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(g),r=w/n,i=E/n):y>b?y<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=w/r,i=S/r):b<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(b),n=E/i,r=S/i),this.set(n,r,i,t),this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));return Math.abs(x)<.001&&(x=1),this.x=(v-p)/x,this.y=(l-d)/x,this.z=(c-f)/x,this.w=Math.acos((a+h+m-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var t,n;return function(r,i){return t===undefined&&(t=new e.Vector4,n=new e.Vector4),t.set(r,r,r,r),n.set(i,i,i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Vector4(this.x,this.y,this.z,this.w)}},e.Vector4}),define("libs/threejs/math/Matrix3",["../Three","./Vector3","./Matrix4"],function(e,t,n){return e.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9),this.set(e!==undefined?e:1,t||0,n||0,r||0,i!==undefined?i:1,s||0,o||0,u||0,a!==undefined?a:1)},e.Matrix3.prototype={constructor:e.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix3(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var t=this.elements;return new e.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},e.Matrix3}),define("libs/threejs/core/Geometry",["../Three","./EventDispatcher","../math/Vector2","../math/Sphere","../math/Box3","../math/Vector4","../math/Vector3","../math/Matrix3","../math/Math"],function(e,t,n,r,i,s,o,u,a){return e.Geometry=function(){this.id=e.GeometryIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},e.Geometry.prototype={constructor:e.Geometry,applyMatrix:function(t){var n=(new e.Matrix3).getNormalMatrix(t);for(var r=0,i=this.vertices.length;r<i;r++){var s=this.vertices[r];s.applyMatrix4(t)}for(var r=0,i=this.faces.length;r<i;r++){var o=this.faces[r];o.normal.applyMatrix3(n).normalize();for(var u=0,a=o.vertexNormals.length;u<a;u++)o.vertexNormals[u].applyMatrix3(n).normalize();o.centroid.applyMatrix4(t)}this.boundingBox instanceof e.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof e.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)},computeFaceNormals:function(){var t=new e.Vector3,n=new e.Vector3;for(var r=0,i=this.faces.length;r<i;r++){var s=this.faces[r],o=this.vertices[s.a],u=this.vertices[s.b],a=this.vertices[s.c];t.subVectors(a,u),n.subVectors(o,u),t.cross(n),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t){var n,r,i,s,o,u;u=new Array(this.vertices.length);for(n=0,r=this.vertices.length;n<r;n++)u[n]=new e.Vector3;if(t){var a,f,l,c,h=new e.Vector3,p=new e.Vector3,d=new e.Vector3,v=new e.Vector3,m=new e.Vector3;for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],a=this.vertices[o.a],f=this.vertices[o.b],l=this.vertices[o.c],h.subVectors(l,f),p.subVectors(a,f),h.cross(p),u[o.a].add(h),u[o.b].add(h),u[o.c].add(h)}else for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],u[o.a].add(o.normal),u[o.b].add(o.normal),u[o.c].add(o.normal);for(n=0,r=this.vertices.length;n<r;n++)u[n].normalize();for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],o.vertexNormals[0]=u[o.a].clone(),o.vertexNormals[1]=u[o.b].clone(),o.vertexNormals[2]=u[o.c].clone()},computeMorphNormals:function(){var t,n,r,i,s;for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r],s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]);for(t=0,n=s.vertexNormals.length;t<n;t++)s.__originalVertexNormals[t]?s.__originalVertexNormals[t].copy(s.vertexNormals[t]):s.__originalVertexNormals[t]=s.vertexNormals[t].clone()}var o=new e.Geometry;o.faces=this.faces;for(t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var u=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals,f,l;for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],f=new e.Vector3,l={a:new e.Vector3,b:new e.Vector3,c:new e.Vector3},u.push(f),a.push(l)}var c=this.morphNormals[t];o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals();var f,l;for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],f=c.faceNormals[r],l=c.vertexNormals[r],f.copy(s.normal),l.a.copy(s.vertexNormals[0]),l.b.copy(s.vertexNormals[1]),l.c.copy(s.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeTangents:function(){function j(e,t,n,r,i,s,o){l=e.vertices[t],c=e.vertices[n],h=e.vertices[r],p=f[i],d=f[s],v=f[o],m=c.x-l.x,g=h.x-l.x,y=c.y-l.y,b=h.y-l.y,w=c.z-l.z,E=h.z-l.z,S=d.x-p.x,x=v.x-p.x,T=d.y-p.y,N=v.y-p.y,C=1/(S*N-x*T),M.set((N*m-T*g)*C,(N*y-T*b)*C,(N*w-T*E)*C),_.set((S*g-x*m)*C,(S*b-x*y)*C,(S*E-x*w)*C),A[t].add(M),A[n].add(M),A[r].add(M),O[t].add(_),O[n].add(_),O[r].add(_)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=[],O=[],M=new e.Vector3,_=new e.Vector3,D=new e.Vector3,P=new e.Vector3,H=new e.Vector3,B;for(r=0,i=this.vertices.length;r<i;r++)A[r]=new e.Vector3,O[r]=new e.Vector3;for(t=0,n=this.faces.length;t<n;t++)a=this.faces[t],f=this.faceVertexUvs[0][t],j(this,a.a,a.b,a.c,0,1,2);var F=["a","b","c","d"];for(t=0,n=this.faces.length;t<n;t++){a=this.faces[t];for(s=0;s<Math.min(a.vertexNormals.length,3);s++)H.copy(a.vertexNormals[s]),u=a[F[s]],k=A[u],D.copy(k),D.sub(H.multiplyScalar(H.dot(k))).normalize(),P.crossVectors(a.vertexNormals[s],k),L=P.dot(O[u]),B=L<0?-1:1,a.vertexTangents[s]=new e.Vector4(D.x,D.y,D.z,B)}this.hasTangents=!0},computeLineDistances:function(){var e=0,t=this.vertices;for(var n=0,r=t.length;n<r;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new e.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new e.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e={},t=[],n=[],r,i,s=4,o=Math.pow(10,s),u,a,f,l,c,h,p,d;for(u=0,a=this.vertices.length;u<a;u++)r=this.vertices[u],i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o),e[i]===undefined?(e[i]=u,t.push(this.vertices[u]),n[u]=t.length-1):n[u]=n[e[i]];var v=[];for(u=0,a=this.faces.length;u<a;u++){f=this.faces[u],f.a=n[f.a],f.b=n[f.b],f.c=n[f.c],l=[f.a,f.b,f.c];var m=-1;for(var g=0;g<3;g++)if(l[g]==l[(g+1)%3]){m=g,v.push(u);break}}for(u=v.length-1;u>=0;u--){var y=v[u];this.faces.splice(y,1);for(h=0,p=this.faceVertexUvs.length;h<p;h++)this.faceVertexUvs[h].splice(y,1)}var b=this.vertices.length-t.length;return this.vertices=t,b},makeGroups:function(){var e=0;return function(t){var n,r,i,s,o,u={},a=this.morphTargets.length,f=this.morphNormals.length;this.geometryGroups={};for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],s=t?i.materialIndex:0,s in u||(u[s]={hash:s,counter:0}),o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:a,numMorphNormals:f}),this.geometryGroups[o].vertices+3>65535&&(u[s].counter+=1,o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:a,numMorphNormals:f})),this.geometryGroups[o].faces3.push(n),this.geometryGroups[o].vertices+=3;this.geometryGroupsList=[];for(var l in this.geometryGroups)this.geometryGroups[l].id=e++,this.geometryGroupsList.push(this.geometryGroups[l])}}(),clone:function(){var t=new e.Geometry,n=this.vertices;for(var r=0,i=n.length;r<i;r++)t.vertices.push(n[r].clone());var s=this.faces;for(var r=0,i=s.length;r<i;r++)t.faces.push(s[r].clone());var o=this.faceVertexUvs[0];for(var r=0,i=o.length;r<i;r++){var u=o[r],a=[];for(var f=0,l=u.length;f<l;f++)a.push(new e.Vector2(u[f].x,u[f].y));t.faceVertexUvs[0].push(a)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Geometry.prototype),e.GeometryIdCount=0,e.Geometry}),define("libs/threejs/objects/Mesh",["../Three","../core/Object3D","../materials/MeshBasicMaterial","../core/Geometry"],function(e,t,n,r){return e.Mesh=function(t,n){e.Object3D.call(this),this.geometry=t!==undefined?t:new e.Geometry,this.material=n!==undefined?n:new e.MeshBasicMaterial({color:Math.random()*16777215}),this.updateMorphTargets()},e.Mesh.prototype=Object.create(e.Object3D.prototype),e.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},e.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==undefined?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},e.Mesh.prototype.clone=function(t){return t===undefined&&(t=new e.Mesh(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Mesh}),define("libs/threejs/extras/shaders/ShaderFlares",["../../Three"],function(e){return e.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},e.ShaderFlares}),define("libs/threejs/extras/renderers/plugins/LensFlarePlugin",["../../../Three","../../../math/Vector2","../../../math/Vector3","../../shaders/ShaderFlares"],function(e,t,n,r){return e.LensFlarePlugin=function(){function s(e,n){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),s=t.createShader(t.VERTEX_SHADER),o="precision "+n+" float;\n";return t.shaderSource(i,o+e.fragmentShader),t.shaderSource(s,o+e.vertexShader),t.compileShader(i),t.compileShader(s),t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),r}var t,n,r,i={};this.init=function(o){t=o.context,n=o,r=o.getPrecision(),i.vertices=new Float32Array(16),i.faces=new Uint16Array(6);var u=0;i.vertices[u++]=-1,i.vertices[u++]=-1,i.vertices[u++]=0,i.vertices[u++]=0,i.vertices[u++]=1,i.vertices[u++]=-1,i.vertices[u++]=1,i.vertices[u++]=0,i.vertices[u++]=1,i.vertices[u++]=1,i.vertices[u++]=1,i.vertices[u++]=1,i.vertices[u++]=-1,i.vertices[u++]=1,i.vertices[u++]=0,i.vertices[u++]=1,u=0,i.faces[u++]=0,i.faces[u++]=1,i.faces[u++]=2,i.faces[u++]=0,i.faces[u++]=2,i.faces[u++]=3,i.vertexBuffer=t.createBuffer(),i.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,i.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i.faces,t.STATIC_DRAW),i.tempTexture=t.createTexture(),i.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,i.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(i.hasVertexTexture=!1,i.program=s(e.ShaderFlares.lensFlare,r)):(i.hasVertexTexture=!0,i.program=s(e.ShaderFlares.lensFlareVertexTexture,r)),i.attributes={},i.uniforms={},i.attributes.vertex=t.getAttribLocation(i.program,"position"),i.attributes.uv=t.getAttribLocation(i.program,"uv"),i.uniforms.renderType=t.getUniformLocation(i.program,"renderType"),i.uniforms.map=t.getUniformLocation(i.program,"map"),i.uniforms.occlusionMap=t.getUniformLocation(i.program,"occlusionMap"),i.uniforms.opacity=t.getUniformLocation(i.program,"opacity"),i.uniforms.color=t.getUniformLocation(i.program,"color"),i.uniforms.scale=t.getUniformLocation(i.program,"scale"),i.uniforms.rotation=t.getUniformLocation(i.program,"rotation"),i.uniforms.screenPosition=t.getUniformLocation(i.program,"screenPosition")},this.render=function(r,s,o,u){var a=r.__webglFlares,f=a.length;if(!f)return;var l=new e.Vector3,c=u/o,h=o*.5,p=u*.5,d=16/u,v=new e.Vector2(d*c,d),m=new e.Vector3(1,1,0),g=new e.Vector2(1,1),y=i.uniforms,b=i.attributes;t.useProgram(i.program),t.enableVertexAttribArray(i.attributes.vertex),t.enableVertexAttribArray(i.attributes.uv),t.uniform1i(y.occlusionMap,0),t.uniform1i(y.map,1),t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.vertexAttribPointer(b.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(b.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var w,E,S,x,T;for(w=0;w<f;w++){d=16/u,v.set(d*c,d),x=a[w],l.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),l.applyMatrix4(s.matrixWorldInverse),l.applyProjection(s.projectionMatrix),m.copy(l),g.x=m.x*h+h,g.y=m.y*p+p;if(i.hasVertexTexture||g.x>0&&g.x<o&&g.y>0&&g.y<u){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,g.x-8,g.y-8,16,16,0),t.uniform1i(y.renderType,0),t.uniform2f(y.scale,v.x,v.y),t.uniform3f(y.screenPosition,m.x,m.y,m.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,g.x-8,g.y-8,16,16,0),t.uniform1i(y.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),x.positionScreen.copy(m),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),t.uniform1i(y.renderType,2),t.enable(t.BLEND);for(E=0,S=x.lensFlares.length;E<S;E++)T=x.lensFlares[E],T.opacity>.001&&T.scale>.001&&(m.x=T.x,m.y=T.y,m.z=T.z,d=T.size*T.scale/u,v.x=d*c,v.y=d,t.uniform3f(y.screenPosition,m.x,m.y,m.z),t.uniform2f(y.scale,v.x,v.y),t.uniform1f(y.rotation,T.rotation),t.uniform1f(y.opacity,T.opacity),t.uniform3f(y.color,T.color.r,T.color.g,T.color.b),n.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),n.setTexture(T.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}},e.LensFlarePlugin}),define("libs/threejs/scenes/FogExp2",["../Three","../math/Color"],function(e,t){return e.FogExp2=function(t,n){this.name="",this.color=new e.Color(t),this.density=n!==undefined?n:25e-5},e.FogExp2.prototype.clone=function(){return new e.FogExp2(this.color.getHex(),this.density)},e.FogExp2}),define("libs/threejs/scenes/Fog",["../Three","../math/Color"],function(e,t){return e.Fog=function(t,n,r){this.name="",this.color=new e.Color(t),this.near=n!==undefined?n:1,this.far=r!==undefined?r:1e3},e.Fog.prototype.clone=function(){return new e.Fog(this.color.getHex(),this.near,this.far)},e.Fog}),define("libs/threejs/textures/Texture",["../Three","../core/EventDispatcher","../math/Vector2","../math/Math"],function(e,t,n,r){return e.Texture=function(t,n,r,i,s,o,u,a,f){this.id=e.TextureIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=n!==undefined?n:new e.UVMapping,this.wrapS=r!==undefined?r:e.ClampToEdgeWrapping,this.wrapT=i!==undefined?i:e.ClampToEdgeWrapping,this.magFilter=s!==undefined?s:e.LinearFilter,this.minFilter=o!==undefined?o:e.LinearMipMapLinearFilter,this.anisotropy=f!==undefined?f:1,this.format=u!==undefined?u:e.RGBAFormat,this.type=a!==undefined?a:e.UnsignedByteType,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},e.Texture.prototype={constructor:e.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(t){return t===undefined&&(t=new e.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Texture.prototype),e.TextureIdCount=0,e.Texture}),define("libs/threejs/extras/renderers/plugins/SpritePlugin",["../../../Three","../../../scenes/FogExp2","../../../scenes/Fog","../../../textures/Texture"],function(e,t,n,r){return e.SpritePlugin=function(){function c(){var e=t.createProgram(),r=t.createShader(t.VERTEX_SHADER),i=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(r,["precision "+n.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),t.shaderSource(i,["precision "+n.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),t.compileShader(r),t.compileShader(i),t.attachShader(e,r),t.attachShader(e,i),t.linkProgram(e),e}function h(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var t,n,r,i,s,o,u,a,f,l;this.init=function(h){t=h.context,n=h,i=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),s=new Uint16Array([0,1,2,0,2,3]),o=t.createBuffer(),u=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW),a=c(),f={position:t.getAttribLocation(a,"position"),uv:t.getAttribLocation(a,"uv")},l={uvOffset:t.getUniformLocation(a,"uvOffset"),uvScale:t.getUniformLocation(a,"uvScale"),rotation:t.getUniformLocation(a,"rotation"),scale:t.getUniformLocation(a,"scale"),color:t.getUniformLocation(a,"color"),map:t.getUniformLocation(a,"map"),opacity:t.getUniformLocation(a,"opacity"),modelViewMatrix:t.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(a,"projectionMatrix"),fogType:t.getUniformLocation(a,"fogType"),fogDensity:t.getUniformLocation(a,"fogDensity"),fogNear:t.getUniformLocation(a,"fogNear"),fogFar:t.getUniformLocation(a,"fogFar"),fogColor:t.getUniformLocation(a,"fogColor"),alphaTest:t.getUniformLocation(a,"alphaTest")};var p=document.createElement("canvas");p.width=8,p.height=8;var d=p.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,p.width,p.height),r=new e.Texture(p),r.needsUpdate=!0},this.render=function(i,s,c,p){var d=i.__webglSprites,v=d.length;if(!v)return;t.useProgram(a),t.enableVertexAttribArray(f.position),t.enableVertexAttribArray(f.uv),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(f.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(f.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.uniformMatrix4fv(l.projectionMatrix,!1,s.projectionMatrix.elements),t.activeTexture(t.TEXTURE0),t.uniform1i(l.map,0);var m=0,g=0,y=i.fog;y?(t.uniform3f(l.fogColor,y.color.r,y.color.g,y.color.b),y instanceof e.Fog?(t.uniform1f(l.fogNear,y.near),t.uniform1f(l.fogFar,y.far),t.uniform1i(l.fogType,1),m=1,g=1):y instanceof e.FogExp2&&(t.uniform1f(l.fogDensity,y.density),t.uniform1i(l.fogType,2),m=2,g=2)):(t.uniform1i(l.fogType,0),m=0,g=0);var b,w,E,S,x=[];for(b=0;b<v;b++){w=d[b],E=w.material;if(w.visible===!1)continue;w._modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}d.sort(h);for(b=0;b<v;b++){w=d[b];if(w.visible===!1)continue;E=w.material,t.uniform1f(l.alphaTest,E.alphaTest),t.uniformMatrix4fv(l.modelViewMatrix,!1,w._modelViewMatrix.elements),x[0]=w.scale.x,x[1]=w.scale.y,i.fog&&E.fog?S=g:S=0,m!==S&&(t.uniform1i(l.fogType,S),m=S),E.map!==null?(t.uniform2f(l.uvOffset,E.map.offset.x,E.map.offset.y),t.uniform2f(l.uvScale,E.map.repeat.x,E.map.repeat.y)):(t.uniform2f(l.uvOffset,0,0),t.uniform2f(l.uvScale,1,1)),t.uniform1f(l.opacity,E.opacity),t.uniform3f(l.color,E.color.r,E.color.g,E.color.b),t.uniform1f(l.rotation,E.rotation),t.uniform2fv(l.scale,x),n.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),n.setDepthTest(E.depthTest),n.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?n.setTexture(E.map,0):n.setTexture(r,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}t.enable(t.CULL_FACE)}},e.SpritePlugin}),define("libs/threejs/renderers/renderables/RenderableSprite",["../../Three","../../math/Vector2"],function(e,t){return e.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new e.Vector2,this.material=null},e.RenderableSprite}),define("libs/threejs/renderers/renderables/RenderableVertex",["../../Three","../../math/Vector4","../../math/Vector3"],function(e,t,n){return e.RenderableVertex=function(){this.position=new e.Vector3,this.positionWorld=new e.Vector3,this.positionScreen=new e.Vector4,this.visible=!0},e.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},e.RenderableVertex}),define("libs/threejs/renderers/renderables/RenderableLine",["../../Three","../../math/Color","./RenderableVertex"],function(e,t,n){return e.RenderableLine=function(){this.id=0,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.vertexColors=[new e.Color,new e.Color],this.material=null,this.z=0},e.RenderableLine}),define("libs/threejs/renderers/renderables/RenderableFace",["../../Three","../../math/Vector3","./RenderableVertex"],function(e,t,n){return e.RenderableFace=function(){this.id=0,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=0},e.RenderableFace}),define("libs/threejs/renderers/renderables/RenderableObject",["../../Three"],function(e){return e.RenderableObject=function(){this.id=0,this.object=null,this.z=0},e.RenderableObject}),define("libs/threejs/core/BufferGeometry",["../Three","../math/Box3","../math/Vector3","./EventDispatcher","../math/Sphere","../math/Matrix3","../math/Math","./Geometry"],function(e,t,n,r,i,s,o,u){return e.BufferGeometry=function(){this.id=e.GeometryIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.attributes={},this.offsets=[],this.boundingBox=null,this.boundingSphere=null},e.BufferGeometry.prototype={constructor:e.BufferGeometry,addAttribute:function(e,t,n,r){return this.attributes[e]={array:new t(n*r),itemSize:r},this.attributes[e]},applyMatrix:function(t){var n=this.attributes.position;n!==undefined&&(t.multiplyVector3Array(n.array),n.needsUpdate=!0);var r=this.attributes.normal;if(r!==undefined){var i=(new e.Matrix3).getNormalMatrix(t);i.multiplyVector3Array(r.array),r.needsUpdate=!0}},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new e.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;t.length>=3&&(n.min.x=n.max.x=t[0],n.min.y=n.max.y=t[1],n.min.z=n.max.z=t[2]);for(var r=3,i=t.length;r<i;r+=3){var s=t[r],o=t[r+1],u=t[r+2];s<n.min.x?n.min.x=s:s>n.max.x&&(n.max.x=s),o<n.min.y?n.min.y=o:o>n.max.y&&(n.max.y=o),u<n.min.z?n.min.z=u:u>n.max.z&&(n.max.z=u)}}if(t===undefined||t.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var t=new e.Box3,n=new e.Vector3;return function(){this.boundingSphere===null&&(this.boundingSphere=new e.Sphere);var r=this.attributes.position.array;if(r){t.makeEmpty();var i=this.boundingSphere.center;for(var s=0,o=r.length;s<o;s+=3)n.set(r[s],r[s+1],r[s+2]),t.addPoint(n);t.center(i);var u=0;for(var s=0,o=r.length;s<o;s+=3)n.set(r[s],r[s+1],r[s+2]),u=Math.max(u,i.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(u)}}}(),computeVertexNormals:function(){if(this.attributes.position){var t,n,r,i,s=this.attributes.position.array.length;if(this.attributes.normal===undefined)this.attributes.normal={itemSize:3,array:new Float32Array(s)};else for(t=0,n=this.attributes.normal.array.length;t<n;t++)this.attributes.normal.array[t]=0;var o=this.attributes.position.array,u=this.attributes.normal.array,a,f,l,c,h,p,d=new e.Vector3,v=new e.Vector3,m=new e.Vector3,g=new e.Vector3,y=new e.Vector3;if(this.attributes.index){var b=this.attributes.index.array,w=this.offsets;for(r=0,i=w.length;r<i;++r){var E=w[r].start,S=w[r].count,x=w[r].index;for(t=E,n=E+S;t<n;t+=3)a=x+b[t],f=x+b[t+1],l=x+b[t+2],c=o[a*3],h=o[a*3+1],p=o[a*3+2],d.set(c,h,p),c=o[f*3],h=o[f*3+1],p=o[f*3+2],v.set(c,h,p),c=o[l*3],h=o[l*3+1],p=o[l*3+2],m.set(c,h,p),g.subVectors(m,v),y.subVectors(d,v),g.cross(y),u[a*3]+=g.x,u[a*3+1]+=g.y,u[a*3+2]+=g.z,u[f*3]+=g.x,u[f*3+1]+=g.y,u[f*3+2]+=g.z,u[l*3]+=g.x,u[l*3+1]+=g.y,u[l*3+2]+=g.z}}else for(t=0,n=o.length;t<n;t+=9)c=o[t],h=o[t+1],p=o[t+2],d.set(c,h,p),c=o[t+3],h=o[t+4],p=o[t+5],v.set(c,h,p),c=o[t+6],h=o[t+7],p=o[t+8],m.set(c,h,p),g.subVectors(m,v),y.subVectors(d,v),g.cross(y),u[t]=g.x,u[t+1]=g.y,u[t+2]=g.z,u[t+3]=g.x,u[t+4]=g.y,u[t+5]=g.z,u[t+6]=g.x,u[t+7]=g.y,u[t+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){var e=this.attributes.normal.array,t,n,r,i;for(var s=0,o=e.length;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i=1/Math.sqrt(t*t+n*n+r*r),e[s]*=i,e[s+1]*=i,e[s+2]*=i},computeTangents:function(){function I(e,t,r){c=n[e*3],h=n[e*3+1],p=n[e*3+2],d=n[t*3],v=n[t*3+1],m=n[t*3+2],g=n[r*3],y=n[r*3+1],b=n[r*3+2],w=i[e*2],E=i[e*2+1],S=i[t*2],x=i[t*2+1],T=i[r*2],N=i[r*2+1],C=d-c,k=g-c,L=v-h,A=y-h,O=m-p,M=b-p,_=S-w,D=T-w,P=x-E,H=N-E,B=1/(_*H-D*P),j.set((H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B),F.set((_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B),a[e].add(j),a[t].add(j),a[r].add(j),f[e].add(F),f[t].add(F),f[r].add(F)}function it(e){Z.x=r[e*3],Z.y=r[e*3+1],Z.z=r[e*3+2],et.copy(Z),nt=a[e],G.copy(nt),G.sub(Z.multiplyScalar(Z.dot(nt))).normalize(),Y.crossVectors(et,nt),rt=Y.dot(f[e]),tt=rt<0?-1:1,u[e*4]=G.x,u[e*4+1]=G.y,u[e*4+2]=G.z,u[e*4+3]=tt}if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var t=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,i=this.attributes.uv.array,s=n.length/3;if(this.attributes.tangent===undefined){var o=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(o)}}var u=this.attributes.tangent.array,a=[],f=[];for(var l=0;l<s;l++)a[l]=new e.Vector3,f[l]=new e.Vector3;var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=new e.Vector3,F=new e.Vector3,q,R,U,z,W,X,V,$=this.offsets;for(U=0,z=$.length;U<z;++U){var J=$[U].start,K=$[U].count,Q=$[U].index;for(q=J,R=J+K;q<R;q+=3)W=Q+t[q],X=Q+t[q+1],V=Q+t[q+2],I(W,X,V)}var G=new e.Vector3,Y=new e.Vector3,Z=new e.Vector3,et=new e.Vector3,tt,nt,rt;for(U=0,z=$.length;U<z;++U){var J=$[U].start,K=$[U].count,Q=$[U].index;for(q=J,R=J+K;q<R;q+=3)W=Q+t[q],X=Q+t[q+1],V=Q+t[q+2],it(W),it(X),it(V)}},computeOffsets:function(e){var t=e;e===undefined&&(t=65535);var n=Date.now(),r=this.attributes.index.array,i=this.attributes.position.array,s=i.length/3,o=r.length/3,u=new Uint16Array(r.length),a=0,f=0,l=[{start:0,count:0,index:0}],c=l[0],h=0,p=0,d=new Int32Array(6),v=new Int32Array(i.length),m=new Int32Array(i.length);for(var g=0;g<i.length;g++)v[g]=-1,m[g]=-1;for(var y=0;y<o;y++){p=0;for(var b=0;b<3;b++){var w=r[y*3+b];v[w]==-1?(d[b*2]=w,d[b*2+1]=-1,p++):v[w]<c.index?(d[b*2]=w,d[b*2+1]=-1,h++):(d[b*2]=w,d[b*2+1]=v[w])}var E=f+p;if(E>c.index+t){var S={start:a,count:0,index:f};l.push(S),c=S;for(var x=0;x<6;x+=2){var T=d[x+1];T>-1&&T<c.index&&(d[x+1]=-1)}}for(var x=0;x<6;x+=2){var w=d[x],T=d[x+1];T===-1&&(T=f++),v[w]=T,m[T]=w,u[a++]=T-c.index,c.count++}}return this.reorderBuffers(u,m,f),this.offsets=l,l},reorderBuffers:function(e,t,n){var r={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var s in this.attributes){if(s=="index")continue;var o=this.attributes[s].array;for(var u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}}for(var l=0;l<n;l++){var c=t[l];for(var s in this.attributes){if(s=="index")continue;var h=this.attributes[s].array,p=this.attributes[s].itemSize,d=r[s];for(var v=0;v<p;v++)d[l*p+v]=h[c*p+v]}}this.attributes.index.array=e;for(var s in this.attributes){if(s=="index")continue;this.attributes[s].array=r[s],this.attributes[s].numItems=this.attributes[s].itemSize*n}},clone:function(){var t=new e.BufferGeometry,n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){var i=this.attributes[r],s=i.array,o={itemSize:i.itemSize,array:null};for(var u=0,a=n.length;u<a;u++){var f=n[u];if(s instanceof f){o.array=new f(s);break}}t.attributes[r]=o}for(var u=0,a=this.offsets.length;u<a;u++){var l=this.offsets[u];t.offsets.push({start:l.start,index:l.index,count:l.count})}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.BufferGeometry.prototype),e.BufferGeometry}),define("libs/threejs/core/Geometry2",["../Three","./BufferGeometry"],function(e,t){return e.Geometry2=function(t){e.BufferGeometry.call(this),this.vertices=this.addAttribute("position",Float32Array,t,3).array,this.normals=this.addAttribute("normal",Float32Array,t,3).array,this.uvs=this.addAttribute("uv",Float32Array,t,2).array,this.boundingBox=null,this.boundingSphere=null},e.Geometry2.prototype=Object.create(e.BufferGeometry.prototype),e.Geometry2}),define("libs/threejs/materials/SpriteMaterial",["../Three","./Material","../math/Color"],function(e,t,n){return e.SpriteMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(t)},e.SpriteMaterial.prototype=Object.create(e.Material.prototype),e.SpriteMaterial.prototype.clone=function(){var t=new e.SpriteMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.fog=this.fog,t},e.SpriteMaterial}),define("libs/threejs/objects/Sprite",["../Three","../core/Geometry2","../core/Object3D","../materials/SpriteMaterial"],function(e,t,n,r){return e.Sprite=function(){var t=new e.Geometry2(3);return t.vertices.set([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0]),function(n){e.Object3D.call(this),this.geometry=t,this.material=n!==undefined?n:new e.SpriteMaterial}}(),e.Sprite.prototype=Object.create(e.Object3D.prototype),e.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.Sprite.prototype.clone=function(t){return t===undefined&&(t=new e.Sprite(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Particle=e.Sprite,e.Sprite}),define("libs/threejs/materials/LineBasicMaterial",["../Three","./Material","../math/Color"],function(e,t,n){return e.LineBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineBasicMaterial.prototype=Object.create(e.Material.prototype),e.LineBasicMaterial.prototype.clone=function(){var t=new e.LineBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineBasicMaterial}),define("libs/threejs/objects/Line",["../Three","../core/Object3D","../materials/LineBasicMaterial","../core/Geometry"],function(e,t,n,r){return e.Line=function(t,n,r){e.Object3D.call(this),this.geometry=t!==undefined?t:new e.Geometry,this.material=n!==undefined?n:new e.LineBasicMaterial({color:Math.random()*16777215}),this.type=r!==undefined?r:e.LineStrip},e.LineStrip=0,e.LinePieces=1,e.Line.prototype=Object.create(e.Object3D.prototype),e.Line.prototype.clone=function(t){return t===undefined&&(t=new e.Line(this.geometry,this.material,this.type)),e.Object3D.prototype.clone.call(this,t),t},e.Line}),define("libs/threejs/materials/MeshFaceMaterial",["../Three"],function(e){return e.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},e.MeshFaceMaterial.prototype.clone=function(){var t=new e.MeshFaceMaterial;for(var n=0;n<this.materials.length;n++)t.materials.push(this.materials[n].clone());return t},e.MeshFaceMaterial}),define("libs/threejs/lights/Light",["../Three","../core/Object3D","../math/Color"],function(e,t,n){return e.Light=function(t){e.Object3D.call(this),this.color=new e.Color(t)},e.Light.prototype=Object.create(e.Object3D.prototype),e.Light.prototype.clone=function(t){return t===undefined&&(t=new e.Light),e.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},e.Light}),define("libs/threejs/math/Ray",["../Three","./Vector3"],function(e,t){return e.Ray=function(t,n){this.origin=t!==undefined?t:new e.Vector3,this.direction=n!==undefined?n:new e.Vector3},e.Ray.prototype={constructor:e.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(t,n){var r=n||new e.Vector3;return r.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new e.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,n){var r=n||new e.Vector3;r.subVectors(t,this.origin);var i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e))}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=e.distanceTo(t)*.5,u=this.origin.clone().sub(i),a=-this.direction.dot(s),f=u.dot(this.direction),l=-u.dot(s),c=u.lengthSq(),h=Math.abs(1-a*a),p,d,v,m;if(h>=0){p=a*l-f,d=a*f-l,m=o*h;if(p>=0)if(d>=-m)if(d<=m){var g=1/h;p*=g,d*=g,v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else d=o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d=-o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d<=-m?(p=Math.max(0,-(-a*o+f)),d=p>0?-o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c):d<=m?(p=0,d=Math.min(Math.max(-o,-l),o),v=d*(d+2*l)+c):(p=Math.max(0,-(a*o+f)),d=p>0?o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c)}else d=a>0?-o:o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;return n&&n.copy(this.direction.clone().multiplyScalar(p).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(d).add(i)),v},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var n=e.normal.dot(this.direction);return n*t<0?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0)return e.distanceToPoint(this.origin)==0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},isIntersectionBox:function(){var t=new e.Vector3;return function(e){return this.intersectBox(e,t)!==null}}(),intersectBox:function(e,t){var n,r,i,s,o,u,a=1/this.direction.x,f=1/this.direction.y,l=1/this.direction.z,c=this.origin;a>=0?(n=(e.min.x-c.x)*a,r=(e.max.x-c.x)*a):(n=(e.max.x-c.x)*a,r=(e.min.x-c.x)*a),f>=0?(i=(e.min.y-c.y)*f,s=(e.max.y-c.y)*f):(i=(e.max.y-c.y)*f,s=(e.min.y-c.y)*f);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;l>=0?(o=(e.min.z-c.z)*l,u=(e.max.z-c.z)*l):(o=(e.max.z-c.z)*l,u=(e.min.z-c.z)*l);if(n>u||o>r)return null;if(o>n||n!==n)n=o;if(u<r||r!==r)r=u;return r<0?null:this.at(n>=0?n:r,t)},intersectTriangle:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3,i=new e.Vector3;return function(e,s,o,u,a){n.subVectors(s,e),r.subVectors(o,e),i.crossVectors(n,r);var f=this.direction.dot(i),l;if(f>0){if(u)return null;l=1}else{if(!(f<0))return null;l=-1,f=-f}t.subVectors(this.origin,e);var c=l*this.direction.dot(r.crossVectors(t,r));if(c<0)return null;var h=l*this.direction.dot(n.cross(t));if(h<0)return null;if(c+h>f)return null;var p=-l*t.dot(i);return p<0?null:this.at(p/f,a)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new e.Ray).copy(this)}},e.Ray}),define("libs/threejs/math/Plane",["../Three","./Vector3","./Matrix3"],function(e,t,n){return e.Plane=function(t,n){this.normal=t!==undefined?t:new e.Vector3(1,0,0),this.constant=n!==undefined?n:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new e.Vector3,n=new e.Vector3;return function(e,r,i){var s=t.subVectors(i,r).cross(n.subVectors(e,r)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,n){var r=this.distanceToPoint(t),i=n||new e.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var t=new e.Vector3;return function(n,r){var i=r||new e.Vector3,s=n.delta(t),o=this.normal.dot(s);if(o==0)return this.distanceToPoint(n.start)==0?i.copy(n.start):undefined;var u=-(n.start.dot(this.normal)+this.constant)/o;return u<0||u>1?undefined:i.copy(s).multiplyScalar(u).add(n.start)}}(),coplanarPoint:function(t){var n=t||new e.Vector3;return n.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Matrix3;return function(e,i){var s=i||r.getNormalMatrix(e),o=t.copy(this.normal).applyMatrix3(s),u=this.coplanarPoint(n);return u.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(o,u),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e.Plane}),define("libs/threejs/objects/LOD",["../Three","../core/Object3D","../math/Vector3"],function(e,t,n){return e.LOD=function(){e.Object3D.call(this),this.objects=[]},e.LOD.prototype=Object.create(e.Object3D.prototype),e.LOD.prototype.addLevel=function(e,t){t===undefined&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length;n++)if(t<this.objects[n].distance)break;this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},e.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n;t++)if(e<this.objects[t].distance)break;return this.objects[t-1].object},e.LOD.prototype.update=function(){var t=new e.Vector3,n=new e.Vector3;return function(e){if(this.objects.length>1){t.setFromMatrixPosition(e.matrixWorld),n.setFromMatrixPosition(this.matrixWorld);var r=t.distanceTo(n);this.objects[0].object.visible=!0;for(var i=1,s=this.objects.length;i<s;i++){if(!(r>=this.objects[i].distance))break;this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0}for(;i<s;i++)this.objects[i].object.visible=!1}}}(),e.LOD.prototype.clone=function(t){t===undefined&&(t=new e.LOD),e.Object3D.prototype.clone.call(this,t);for(var n=0,r=this.objects.length;n<r;n++){var i=this.objects[n].object.clone();i.visible=n===0,t.addLevel(i,this.objects[n].distance)}return t},e.LOD}),define("libs/threejs/core/Raycaster",["../Three","../math/Sphere","../math/Ray","../math/Plane","../math/Matrix4","../math/Vector3","../objects/Line","./Geometry","../materials/MeshFaceMaterial","./BufferGeometry","../objects/Mesh","../objects/LOD","../objects/Sprite"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray,r=new e.Plane,i=new e.Vector3,s=new e.Vector3,o=new e.Matrix4,u=function(e,t){return e.distance-t.distance},a=new e.Vector3,f=new e.Vector3,l=new e.Vector3,c=function(r,i,u){if(r instanceof e.Sprite){s.setFromMatrixPosition(r.matrixWorld);var h=i.ray.distanceToPoint(s);if(h>r.scale.x)return u;u.push({distance:h,point:r.position,face:null,object:r})}else if(r instanceof e.LOD){s.setFromMatrixPosition(r.matrixWorld);var h=i.ray.origin.distanceTo(s);c(r.getObjectForDistance(h),i,u)}else if(r instanceof e.Mesh){var p=r.geometry;p.boundingSphere===null&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(r.matrixWorld);if(i.ray.isIntersectionSphere(t)===!1)return u;o.getInverse(r.matrixWorld),n.copy(i.ray).applyMatrix4(o);if(p.boundingBox!==null&&n.isIntersectionBox(p.boundingBox)===!1)return u;if(p instanceof e.BufferGeometry){var d=r.material;if(d===undefined)return u;var v=p.attributes,m,g,y,b=i.precision;if(v.index!==undefined){var w=p.offsets,E=v.index.array,S=v.position.array;for(var x=0,T=w.length;x<T;++x){var N=w[x].start,C=w[x].count,k=w[x].index;for(var L=N,A=N+C;L<A;L+=3){m=k+E[L],g=k+E[L+1],y=k+E[L+2],a.set(S[m*3],S[m*3+1],S[m*3+2]),f.set(S[g*3],S[g*3+1],S[g*3+2]),l.set(S[y*3],S[y*3+1],S[y*3+2]);if(d.side===e.BackSide)var O=n.intersectTriangle(l,f,a,!0);else var O=n.intersectTriangle(a,f,l,d.side!==e.DoubleSide);if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,indices:[m,g,y],face:null,faceIndex:null,object:r})}}}else{var w=p.offsets,S=v.position.array;for(var L=0,A=v.position.array.length;L<A;L+=3){m=L,g=L+1,y=L+2,a.set(S[m*3],S[m*3+1],S[m*3+2]),f.set(S[g*3],S[g*3+1],S[g*3+2]),l.set(S[y*3],S[y*3+1],S[y*3+2]);if(d.side===e.BackSide)var O=n.intersectTriangle(l,f,a,!0);else var O=n.intersectTriangle(a,f,l,d.side!==e.DoubleSide);if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,indices:[m,g,y],face:null,faceIndex:null,object:r})}}}else if(p instanceof e.Geometry){var M=r.material instanceof e.MeshFaceMaterial,_=M===!0?r.material.materials:null,m,g,y,D,b=i.precision,P=p.vertices;for(var H=0,B=p.faces.length;H<B;H++){var j=p.faces[H],d=M===!0?_[j.materialIndex]:r.material;if(d===undefined)continue;m=P[j.a],g=P[j.b],y=P[j.c];if(d.morphTargets===!0){var F=p.morphTargets,I=r.morphTargetInfluences;a.set(0,0,0),f.set(0,0,0),l.set(0,0,0);for(var q=0,R=F.length;q<R;q++){var U=I[q];if(U===0)continue;var z=F[q].vertices;a.x+=(z[j.a].x-m.x)*U,a.y+=(z[j.a].y-m.y)*U,a.z+=(z[j.a].z-m.z)*U,f.x+=(z[j.b].x-g.x)*U,f.y+=(z[j.b].y-g.y)*U,f.z+=(z[j.b].z-g.z)*U,l.x+=(z[j.c].x-y.x)*U,l.y+=(z[j.c].y-y.y)*U,l.z+=(z[j.c].z-y.z)*U}a.add(m),f.add(g),l.add(y),m=a,g=f,y=l}if(d.side===e.BackSide)var O=n.intersectTriangle(y,g,m,!0);else var O=n.intersectTriangle(m,g,y,d.side!==e.DoubleSide);if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,face:j,faceIndex:H,object:r})}}}else if(r instanceof e.Line){var b=i.linePrecision,W=b*b,p=r.geometry;p.boundingSphere===null&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(r.matrixWorld);if(i.ray.isIntersectionSphere(t)===!1)return u;o.getInverse(r.matrixWorld),n.copy(i.ray).applyMatrix4(o);if(p instanceof e.Geometry){var P=p.vertices,X=P.length,V=new e.Vector3,$=new e.Vector3,J=r.type===e.LineStrip?1:2;for(var L=0;L<X-1;L+=J){var K=n.distanceSqToSegment(P[L],P[L+1],$,V);if(K>W)continue;var h=n.origin.distanceTo($);if(h<i.near||h>i.far)continue;u.push({distance:h,point:V.clone().applyMatrix4(r.matrixWorld),face:null,faceIndex:null,object:r})}}}},h=function(e,t,n){var r=e.getDescendants();for(var i=0,s=r.length;i<s;i++)c(r[i],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return t===!0&&h(e,this,n),c(e,this,n),n.sort(u),n},e.Raycaster.prototype.intersectObjects=function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)c(e[r],this,n),t===!0&&h(e[r],this,n);return n.sort(u),n}}(e),e.Raycaster}),define("libs/threejs/math/Frustum",["../Three","./Sphere","./Vector3","./Plane"],function(e,t,n,r){return e.Frustum=function(t,n,r,i,s,o){this.planes=[t!==undefined?t:new e.Plane,n!==undefined?n:new e.Plane,r!==undefined?r:new e.Plane,i!==undefined?i:new e.Plane,s!==undefined?s:new e.Plane,o!==undefined?o:new e.Plane]},e.Frustum.prototype={constructor:e.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){var t=this.planes;for(var n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=n[9],p=n[10],d=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-u,d-c,y-v).normalize(),t[1].setComponents(o+r,l+u,d+c,y+v).normalize(),t[2].setComponents(o+i,l+a,d+h,y+m).normalize(),t[3].setComponents(o-i,l-a,d-h,y-m).normalize(),t[4].setComponents(o-s,l-f,d-p,y-g).normalize(),t[5].setComponents(o+s,l+f,d+p,y+g).normalize(),this},intersectsObject:function(){var t=new e.Sphere;return function(e){var n=e.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),t.copy(n.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center,r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r)return!1}return!0},intersectsBox:function(){var t=new e.Vector3,n=new e.Vector3;return function(e){var r=this.planes;for(var i=0;i<6;i++){var s=r[i];t.x=s.normal.x>0?e.min.x:e.max.x,n.x=s.normal.x>0?e.max.x:e.min.x,t.y=s.normal.y>0?e.min.y:e.max.y,n.y=s.normal.y>0?e.max.y:e.min.y,t.z=s.normal.z>0?e.min.z:e.max.z,n.z=s.normal.z>0?e.max.z:e.min.z;var o=s.distanceToPoint(t),u=s.distanceToPoint(n);if(o<0&&u<0)return!1}return!0}}(),containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new e.Frustum).copy(this)}},e.Frustum}),define("libs/threejs/core/Projector",["../Three","../renderers/renderables/RenderableSprite","../renderers/renderables/RenderableLine","../renderers/renderables/RenderableFace","../renderers/renderables/RenderableVertex","../renderers/renderables/RenderableObject","../objects/Sprite","../objects/Line","./Geometry","./BufferGeometry","../materials/MeshFaceMaterial","../objects/Mesh","../math/Matrix3","../lights/Light","./Raycaster","../math/Vector3","../math/Matrix4","../math/Vector4","../math/Frustum","../math/Box3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){return e.Projector=function(){function z(){if(n===i){var t=new e.RenderableObject;return r.push(t),i++,n++,t}return r[n++]}function W(){if(o===a){var t=new e.RenderableVertex;return u.push(t),a++,o++,t}return u[o++]}function X(){if(l===h){var t=new e.RenderableFace;return c.push(t),h++,l++,t}return c[l++]}function V(){if(d===m){var t=new e.RenderableLine;return v.push(t),m++,d++,t}return v[d++]}function $(){if(y===w){var t=new e.RenderableSprite;return b.push(t),w++,y++,t}return b[y++]}function J(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function K(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var t,n,r=[],i=0,s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y,b=[],w=0,E={objects:[],lights:[],elements:[]},S=new e.Vector3,x=new e.Vector3,T=new e.Vector3,N=new e.Vector3,C=new e.Vector4,k=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1)),L=new e.Box3,A=new Array(3),O=new Array(4),M=new e.Matrix4,_=new e.Matrix4,D,P=new e.Matrix4,H=new e.Matrix3,B=new e.Frustum,j=new e.Vector4,F=new e.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(_)},this.unprojectVector=function(){var t=new e.Matrix4;return function(e,n){return t.getInverse(n.projectionMatrix),_.multiplyMatrices(n.matrixWorld,t),e.applyProjection(_)}}(),this.pickingRay=function(t,n){t.z=-1;var r=new e.Vector3(t.x,t.y,1);return this.unprojectVector(t,n),this.unprojectVector(r,n),r.sub(t).normalize(),new e.Raycaster(t,r)};var I=function(n){if(n.visible===!1)return;if(n instanceof e.Light)E.lights.push(n);else if(n instanceof e.Mesh||n instanceof e.Line||n instanceof e.Sprite)if(n.frustumCulled===!1||B.intersectsObject(n)===!0)t=z(),t.id=n.id,t.object=n,n.renderDepth!==null?t.z=n.renderDepth:(N.setFromMatrixPosition(n.matrixWorld),N.applyProjection(_),t.z=N.z),E.objects.push(t);for(var r=0,i=n.children.length;r<i;r++)I(n.children[r])},q=function(e,t){n=0,E.objects.length=0,E.lights.length=0,I(e),t===!0&&E.objects.sort(J)},R=function(){var t=[],n=null,r=new e.Matrix3,i=function(e){n=e,r.getNormalMatrix(n.matrixWorld),t.length=0},o=function(e){var t=e.position,n=e.positionWorld,r=e.positionScreen;n.copy(t).applyMatrix4(D),r.copy(n).applyMatrix4(_);var i=1/r.w;r.x*=i,r.y*=i,r.z*=i,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1},a=function(e,t,n){s=W(),s.position.set(e,t,n),o(s)},l=function(e,n,r){t.push(e,n,r)},c=function(e,t,n){return A[0]=e.positionScreen,A[1]=t.positionScreen,A[2]=n.positionScreen,e.visible===!0||t.visible===!0||n.visible===!0||k.isIntersectionBox(L.setFromPoints(A))?(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0:!1},h=function(e,t){var r=u[e],i=u[t];p=V(),p.id=n.id,p.v1.copy(r),p.v2.copy(i),p.z=(r.positionScreen.z+i.positionScreen.z)/2,p.material=n.material,E.elements.push(p)},d=function(e,i,s){var o=u[e],a=u[i],l=u[s];if(c(o,a,l)===!0){f=X(),f.id=n.id,f.v1.copy(o),f.v2.copy(a),f.v3.copy(l),f.z=(o.positionScreen.z+a.positionScreen.z+l.positionScreen.z)/3;for(var h=0;h<3;h++){var p=arguments[h]*3,d=f.vertexNormalsModel[h];d.set(t[p+0],t[p+1],t[p+2]),d.applyMatrix3(r).normalize()}f.vertexNormalsLength=3,f.material=n.material,E.elements.push(f)}};return{setObject:i,projectVertex:o,checkTriangleVisibility:c,pushVertex:a,pushNormal:l,pushLine:h,pushTriangle:d}},U=new R;this.projectScene=function(t,n,r,i){var s,a,c,h,v,m,b,w,N,k;l=0,d=0,y=0,E.elements.length=0,t.autoUpdate===!0&&t.updateMatrixWorld(),n.parent===undefined&&n.updateMatrixWorld(),M.copy(n.matrixWorldInverse.getInverse(n.matrixWorld)),_.multiplyMatrices(n.projectionMatrix,M),B.setFromMatrix(_),q(t,r);for(var L=0,A=E.objects.length;L<A;L++){s=E.objects[L].object,a=s.geometry,U.setObject(s),D=s.matrixWorld,o=0;if(s instanceof e.Mesh){if(a instanceof e.BufferGeometry){var O=a.attributes,I=a.offsets;if(O.position===undefined)continue;var R=O.position.array;for(var z=0,Q=R.length;z<Q;z+=3)U.pushVertex(R[z],R[z+1],R[z+2]);var G=O.normal.array;for(var z=0,Q=G.length;z<Q;z+=3)U.pushNormal(G[z],G[z+1],G[z+2]);if(O.index!==undefined){var Y=O.index.array;if(I.length>0)for(var L=0;L<I.length;L++){var Z=I[L],et=Z.index;for(var z=Z.start,Q=Z.start+Z.count;z<Q;z+=3)U.pushTriangle(Y[z]+et,Y[z+1]+et,Y[z+2]+et)}else for(var z=0,Q=Y.length;z<Q;z+=3)U.pushTriangle(Y[z],Y[z+1],Y[z+2])}else for(var z=0,Q=R.length/3;z<Q;z+=3)U.pushTriangle(z,z+1,z+2)}else if(a instanceof e.Geometry){c=a.vertices,h=a.faces,b=a.faceVertexUvs,H.getNormalMatrix(D),N=s.material instanceof e.MeshFaceMaterial,k=N===!0?s.material:null;for(var tt=0,nt=c.length;tt<nt;tt++){var rt=c[tt];U.pushVertex(rt.x,rt.y,rt.z)}for(var it=0,st=h.length;it<st;it++){v=h[it];var ot=N===!0?k.materials[v.materialIndex]:s.material;if(ot===undefined)continue;var ut=ot.side,at=u[v.a],ft=u[v.b],lt=u[v.c];if(ot.morphTargets===!0){var ct=a.morphTargets,ht=s.morphTargetInfluences,pt=at.position,dt=ft.position,vt=lt.position;S.set(0,0,0),x.set(0,0,0),T.set(0,0,0);for(var mt=0,gt=ct.length;mt<gt;mt++){var yt=ht[mt];if(yt===0)continue;var bt=ct[mt].vertices;S.x+=(bt[v.a].x-pt.x)*yt,S.y+=(bt[v.a].y-pt.y)*yt,S.z+=(bt[v.a].z-pt.z)*yt,x.x+=(bt[v.b].x-dt.x)*yt,x.y+=(bt[v.b].y-dt.y)*yt,x.z+=(bt[v.b].z-dt.z)*yt,T.x+=(bt[v.c].x-vt.x)*yt,T.y+=(bt[v.c].y-vt.y)*yt,T.z+=(bt[v.c].z-vt.z)*yt}at.position.add(S),ft.position.add(x),lt.position.add(T),U.projectVertex(at),U.projectVertex(ft),U.projectVertex(lt)}var wt=U.checkTriangleVisibility(at,ft,lt);if(wt===!1&&ut===e.FrontSide||wt===!0&&ut===e.BackSide)continue;f=X(),f.id=s.id,f.v1.copy(at),f.v2.copy(ft),f.v3.copy(lt),f.normalModel.copy(v.normal),wt===!1&&(ut===e.BackSide||ut===e.DoubleSide)&&f.normalModel.negate(),f.normalModel.applyMatrix3(H).normalize(),f.centroidModel.copy(v.centroid).applyMatrix4(D),m=v.vertexNormals;for(var Et=0,St=Math.min(m.length,3);Et<St;Et++){var xt=f.vertexNormalsModel[Et];xt.copy(m[Et]),wt===!1&&(ut===e.BackSide||ut===e.DoubleSide)&&xt.negate(),xt.applyMatrix3(H).normalize()}f.vertexNormalsLength=m.length;for(var Tt=0,Nt=Math.min(b.length,3);Tt<Nt;Tt++){w=b[Tt][it];if(w===undefined)continue;for(var Ct=0,kt=w.length;Ct<kt;Ct++)f.uvs[Tt][Ct]=w[Ct]}f.color=v.color,f.material=ot,f.z=(at.positionScreen.z+ft.positionScreen.z+lt.positionScreen.z)/3,E.elements.push(f)}}}else if(s instanceof e.Line){if(a instanceof e.BufferGeometry){var O=a.attributes;if(O.position!==undefined){var R=O.position.array;for(var z=0,Q=R.length;z<Q;z+=3)U.pushVertex(R[z],R[z+1],R[z+2]);if(O.index!==undefined){var Y=O.index.array;for(var z=0,Q=Y.length;z<Q;z+=2)U.pushLine(Y[z],Y[z+1])}else for(var z=0,Q=R.length/3-1;z<Q;z++)U.pushLine(z,z+1)}}else if(a instanceof e.Geometry){P.multiplyMatrices(_,D),c=s.geometry.vertices;if(c.length===0)continue;at=W(),at.positionScreen.copy(c[0]).applyMatrix4(P);var Lt=s.type===e.LinePieces?2:1;for(var tt=1,nt=c.length;tt<nt;tt++){at=W(),at.positionScreen.copy(c[tt]).applyMatrix4(P);if((tt+1)%Lt>0)continue;ft=u[o-2],j.copy(at.positionScreen),F.copy(ft.positionScreen),K(j,F)===!0&&(j.multiplyScalar(1/j.w),F.multiplyScalar(1/F.w),p=V(),p.id=s.id,p.v1.positionScreen.copy(j),p.v2.positionScreen.copy(F),p.z=Math.max(j.z,F.z),p.material=s.material,s.material.vertexColors===e.VertexColors&&(p.vertexColors[0].copy(s.geometry.colors[tt]),p.vertexColors[1].copy(s.geometry.colors[tt-1])),E.elements.push(p))}}}else if(s instanceof e.Sprite){C.set(D.elements[12],D.elements[13],D.elements[14],1),C.applyMatrix4(_);var At=1/C.w;C.z*=At,C.z>=-1&&C.z<=1&&(g=$(),g.id=s.id,g.x=C.x*At,g.y=C.y*At,g.z=C.z,g.object=s,g.rotation=s.rotation,g.scale.x=s.scale.x*Math.abs(g.x-(C.x+n.projectionMatrix.elements[0])/(C.w+n.projectionMatrix.elements[12])),g.scale.y=s.scale.y*Math.abs(g.y-(C.y+n.projectionMatrix.elements[5])/(C.w+n.projectionMatrix.elements[13])),g.material=s.material,E.elements.push(g))}}return i===!0&&E.elements.sort(J),E}},e.Projector}),define("libs/threejs/lights/DirectionalLight",["../Three","./Light","../math/Vector3","../core/Object3D"],function(e,t,n,r){return e.DirectionalLight=function(t,n){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=n!==undefined?n:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new e.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},e.DirectionalLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight.prototype.clone=function(){var t=new e.DirectionalLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.DirectionalLight}),define("libs/threejs/objects/Bone",["../Three","../core/Object3D","../math/Matrix4"],function(e,t,n){return e.Bone=function(t){e.Object3D.call(this),this.skin=t,this.skinMatrix=new e.Matrix4},e.Bone.prototype=Object.create(e.Object3D.prototype),e.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r,i=this.children.length;for(r=0;r<i;r++)this.children[r].update(this.skinMatrix,t)},e.Bone}),define("libs/threejs/textures/DataTexture",["../Three","./Texture"],function(e,t){return e.DataTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={data:t,width:n,height:r}},e.DataTexture.prototype=Object.create(e.Texture.prototype),e.DataTexture.prototype.clone=function(){var t=new e.DataTexture;return e.Texture.prototype.clone.call(this,t),t},e.DataTexture}),define("libs/threejs/objects/SkinnedMesh",["../Three","./Mesh","../math/Matrix4","../core/BufferGeometry","../core/Geometry","./Bone","../textures/DataTexture"],function(e,t,n,r,i,s,o){return e.SkinnedMesh=function(t,n,r){e.Mesh.call(this,t,n),this.useVertexTexture=r!==undefined?r:!0,this.identityMatrix=new e.Matrix4,this.bones=[],this.boneMatrices=[];var i,s,o,u,a,f;if(this.geometry&&this.geometry.bones!==undefined){for(i=0;i<this.geometry.bones.length;i++)o=this.geometry.bones[i],u=o.pos,a=o.rotq,f=o.scl,s=this.addBone(),s.name=o.name,s.position.set(u[0],u[1],u[2]),s.quaternion.set(a[0],a[1],a[2],a[3]),f!==undefined?s.scale.set(f[0],f[1],f[2]):s.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)o=this.geometry.bones[i],s=this.bones[i],o.parent===-1?this.add(s):this.bones[o.parent].add(s);var l=this.bones.length;if(this.useVertexTexture){var c;l>256?c=64:l>64?c=32:l>16?c=16:c=8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new e.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*l);this.pose()}},e.SkinnedMesh.prototype=Object.create(e.Mesh.prototype),e.SkinnedMesh.prototype.addBone=function(t){return t===undefined&&(t=new e.Bone(this)),this.bones.push(t),t},e.SkinnedMesh.prototype.updateMatrixWorld=function(){var t=new e.Matrix4;return function(n){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||n)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0;for(var r=0,i=this.children.length;r<i;r++){var s=this.children[r];s instanceof e.Bone?s.update(this.identityMatrix,!1):s.updateMatrixWorld(!0)}if(this.boneInverses==undefined){this.boneInverses=[];for(var o=0,u=this.bones.length;o<u;o++){var a=new e.Matrix4;a.getInverse(this.bones[o].skinMatrix),this.boneInverses.push(a)}}for(var o=0,u=this.bones.length;o<u;o++)t.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]),t.flattenToArrayOffset(this.boneMatrices,o*16);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),e.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},e.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof e.Geometry)for(var t=0;t<this.geometry.skinIndices.length;t++){var n=this.geometry.skinWeights[t],r=1/n.lengthManhattan();r!==Infinity?n.multiplyScalar(r):n.set(1)}},e.SkinnedMesh.prototype.clone=function(t){return t===undefined&&(t=new e.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),e.Mesh.prototype.clone.call(this,t),t},e.SkinnedMesh}),define("libs/threejs/materials/ParticleSystemMaterial",["../Three","./Material","../math/Color"],function(e,t,n){return e.ParticleSystemMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.ParticleSystemMaterial.prototype=Object.create(e.Material.prototype),e.ParticleSystemMaterial.prototype.clone=function(){var t=new e.ParticleSystemMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.ParticleBasicMaterial=e.ParticleSystemMaterial,e.ParticleSystemMaterial}),define("libs/threejs/objects/ParticleSystem",["../Three","../core/Object3D","../materials/ParticleSystemMaterial","../core/Geometry"],function(e,t,n,r){return e.ParticleSystem=function(t,n){e.Object3D.call(this),this.geometry=t!==undefined?t:new e.Geometry,this.material=n!==undefined?n:new e.ParticleSystemMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.frustumCulled=!1},e.ParticleSystem.prototype=Object.create(e.Object3D.prototype),e.ParticleSystem.prototype.clone=function(t){return t===undefined&&(t=new e.ParticleSystem(this.geometry,this.material)),t.sortParticles=this.sortParticles,e.Object3D.prototype.clone.call(this,t),t},e.ParticleSystem}),define("libs/threejs/extras/helpers/CameraHelper",["../../Three","../../objects/Line","../../math/Vector3","../../cameras/Camera","../../core/Projector","../../math/Color","../../materials/LineBasicMaterial","../../core/Geometry"],function(e,t,n,r,i,s,o,u){return e.CameraHelper=function(t){function l(e,t,n){c(e,n),c(t,n)}function c(t,r){n.vertices.push(new e.Vector3),n.colors.push(new e.Color(r)),i[t]===undefined&&(i[t]=[]),i[t].push(n.vertices.length-1)}var n=new e.Geometry,r=new e.LineBasicMaterial({color:16777215,vertexColors:e.FaceColors}),i={},s=16755200,o=16711680,u=43775,a=16777215,f=3355443;l("n1","n2",s),l("n2","n4",s),l("n4","n3",s),l("n3","n1",s),l("f1","f2",s),l("f2","f4",s),l("f4","f3",s),l("f3","f1",s),l("n1","f1",s),l("n2","f2",s),l("n3","f3",s),l("n4","f4",s),l("p","n1",o),l("p","n2",o),l("p","n3",o),l("p","n4",o),l("u1","u2",u),l("u2","u3",u),l("u3","u1",u),l("c","t",a),l("p","c",f),l("cn1","cn2",f),l("cn3","cn4",f),l("cf1","cf2",f),l("cf3","cf4",f),e.Line.call(this,n,r,e.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},e.CameraHelper.prototype=Object.create(e.Line.prototype),e.CameraHelper.prototype.update=function(){var t=new e.Vector3,n=new e.Camera,r=new e.Projector;return function(){function o(i,s,o,u){t.set(s,o,u),r.unprojectVector(t,n);var a=e.pointMap[i];if(a!==undefined)for(var f=0,l=a.length;f<l;f++)e.geometry.vertices[a[f]].copy(t)}var e=this,i=1,s=1;n.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-i,-s,-1),o("n2",i,-s,-1),o("n3",-i,s,-1),o("n4",i,s,-1),o("f1",-i,-s,1),o("f2",i,-s,1),o("f3",-i,s,1),o("f4",i,s,1),o("u1",i*.7,s*1.1,-1),o("u2",-i*.7,s*1.1,-1),o("u3",0,s*2,-1),o("cf1",-i,0,1),o("cf2",i,0,1),o("cf3",0,-s,1),o("cf4",0,s,1),o("cn1",-i,0,-1),o("cn2",i,0,-1),o("cn3",0,-s,-1),o("cn4",0,s,-1),this.geometry.verticesNeedUpdate=!0}}(),e.CameraHelper}),define("libs/threejs/cameras/PerspectiveCamera",["../Three","./Camera","../math/Math"],function(e,t,n){return e.PerspectiveCamera=function(t,n,r,i){e.Camera.call(this),this.fov=t!==undefined?t:50,this.aspect=n!==undefined?n:1,this.near=r!==undefined?r:.1,this.far=i!==undefined?i:2e3,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype=Object.create(e.Camera.prototype),e.PerspectiveCamera.prototype.setLens=function(t,n){n===undefined&&(n=24),this.fov=2*e.Math.radToDeg(Math.atan(n/(t*2))),this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(e.Math.degToRad(this.fov*.5))*this.near,r=-n,i=t*r,s=t*n,o=Math.abs(s-i),u=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,n-(this.y+this.height)*u/this.fullHeight,n-this.y*u/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},e.PerspectiveCamera.prototype.clone=function(){var t=new e.PerspectiveCamera;return e.Camera.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t},e.PerspectiveCamera}),define("libs/threejs/lights/SpotLight",["../Three","./Light","../core/Object3D"],function(e,t,n){return e.SpotLight=function(t,n,r,i,s){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=n!==undefined?n:1,this.distance=r!==undefined?r:0,this.angle=i!==undefined?i:Math.PI/3,this.exponent=s!==undefined?s:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},e.SpotLight.prototype=Object.create(e.Light.prototype),e.SpotLight.prototype.clone=function(){var t=new e.SpotLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.SpotLight}),define("libs/threejs/renderers/WebGLRenderTarget",["../Three","../core/EventDispatcher","../math/Vector2"],function(e,t,n){return e.WebGLRenderTarget=function(t,n,r){this.width=t,this.height=n,r=r||{},this.wrapS=r.wrapS!==undefined?r.wrapS:e.ClampToEdgeWrapping,this.wrapT=r.wrapT!==undefined?r.wrapT:e.ClampToEdgeWrapping,this.magFilter=r.magFilter!==undefined?r.magFilter:e.LinearFilter,this.minFilter=r.minFilter!==undefined?r.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=r.anisotropy!==undefined?r.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=r.format!==undefined?r.format:e.RGBAFormat,this.type=r.type!==undefined?r.type:e.UnsignedByteType,this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},e.WebGLRenderTarget.prototype={constructor:e.WebGLRenderTarget,clone:function(){var t=new e.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.WebGLRenderTarget.prototype),e.WebGLRenderTarget}),define("libs/threejs/extras/core/Gyroscope",["../../Three","../../core/Object3D","../../math/Quaternion","../../math/Vector3"],function(e,t,n,r){return e.Gyroscope=function(){e.Object3D.call(this)},e.Gyroscope.prototype=Object.create(e.Object3D.prototype),e.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},e.Gyroscope.prototype.translationWorld=new e.Vector3,e.Gyroscope.prototype.translationObject=new e.Vector3,e.Gyroscope.prototype.quaternionWorld=new e.Quaternion,e.Gyroscope.prototype.quaternionObject=new e.Quaternion,e.Gyroscope.prototype.scaleWorld=new e.Vector3,e.Gyroscope.prototype.scaleObject=new e.Vector3,e.Gyroscope}),define("libs/threejs/renderers/shaders/UniformsUtils",["../../Three","../../textures/Texture","../../math/Matrix4","../../math/Vector4","../../math/Vector3","../../math/Vector2","../../math/Color"],function(e,t,n,r,i,s,o){return e.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(t){var n,r,i,s,o={};for(n in t){o[n]={};for(r in t[n])s=t[n][r],s instanceof e.Color||s instanceof e.Vector2||s instanceof e.Vector3||s instanceof e.Vector4||s instanceof e.Matrix4||s instanceof e.Texture?o[n][r]=s.clone():s instanceof Array?o[n][r]=s.slice():o[n][r]=s}return o}},e.UniformsUtils}),define("libs/threejs/materials/ShaderMaterial",["../Three","./Material","../renderers/shaders/UniformsUtils"],function(e,t,n){return e.ShaderMaterial=function(t){e.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(t)},e.ShaderMaterial.prototype=Object.create(e.Material.prototype),e.ShaderMaterial.prototype.clone=function(){var t=new e.ShaderMaterial;return e.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.ShaderMaterial}),define("libs/threejs/renderers/shaders/UniformsLib",["../../Three","../../math/Vector4","../../math/Vector2","../../math/Color"],function(e,t,n,r){return e.UniformsLib={common:{diffuse:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new e.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new e.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.UniformsLib}),define("libs/threejs/renderers/shaders/ShaderLib",["../../Three","./UniformsUtils","./UniformsLib","../../math/Color","../../math/Vector2","../../math/Vector3","./ShaderChunk"],function(e,t,n,r,i,s,o){return e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},specular:{type:"c",value:new e.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",e.ShaderChunk.map_particle_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",e.ShaderChunk.color_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.color_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new e.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new e.Color(16777215)},specular:{type:"c",value:new e.Color(1118481)},ambient:{type:"c",value:new e.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new e.Vector2(0,0)},uRepeat:{type:"v2",value:new e.Vector2(1,1)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},e.ShaderLib}),define("libs/threejs/extras/renderers/plugins/ShadowMapPlugin",["../../../Three","../../../core/Projector","../../../materials/MeshFaceMaterial","../../../math/Vector3","../../../lights/DirectionalLight","../../../core/BufferGeometry","../../../objects/SkinnedMesh","../../../objects/ParticleSystem","../../../objects/Mesh","../../helpers/CameraHelper","../../../cameras/OrthographicCamera","../../../cameras/PerspectiveCamera","../../../lights/SpotLight","../../../math/Matrix4","../../../math/Vector2","../../../renderers/WebGLRenderTarget","../../core/Gyroscope","../../../materials/ShaderMaterial","../../../renderers/shaders/UniformsUtils","../../../renderers/shaders/ShaderLib","../../../math/Frustum"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){return e.ShadowMapPlugin=function(){function h(t,n){var r=new e.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=t.shadowCameraNear,r.shadowCameraFar=t.shadowCameraFar,r.shadowCameraLeft=t.shadowCameraLeft,r.shadowCameraRight=t.shadowCameraRight,r.shadowCameraBottom=t.shadowCameraBottom,r.shadowCameraTop=t.shadowCameraTop,r.shadowCameraVisible=t.shadowCameraVisible,r.shadowDarkness=t.shadowDarkness,r.shadowBias=t.shadowCascadeBias[n],r.shadowMapWidth=t.shadowCascadeWidth[n],r.shadowMapHeight=t.shadowCascadeHeight[n],r.pointsWorld=[],r.pointsFrustum=[];var i=r.pointsWorld,s=r.pointsFrustum;for(var o=0;o<8;o++)i[o]=new e.Vector3,s[o]=new e.Vector3;var u=t.shadowCascadeNearZ[n],a=t.shadowCascadeFarZ[n];return s[0].set(-1,-1,u),s[1].set(1,-1,u),s[2].set(-1,1,u),s[3].set(1,1,u),s[4].set(-1,-1,a),s[5].set(1,-1,a),s[6].set(-1,1,a),s[7].set(1,1,a),r}function p(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],s=n.pointsFrustum;s[0].z=r,s[1].z=r,s[2].z=r,s[3].z=r,s[4].z=i,s[5].z=i,s[6].z=i,s[7].z=i}function d(t,n){var r=n.shadowCamera,i=n.pointsFrustum,s=n.pointsWorld;f.set(Infinity,Infinity,Infinity),l.set(-Infinity,-Infinity,-Infinity);for(var o=0;o<8;o++){var u=s[o];u.copy(i[o]),e.ShadowMapPlugin.__projector.unprojectVector(u,t),u.applyMatrix4(r.matrixWorldInverse),u.x<f.x&&(f.x=u.x),u.x>l.x&&(l.x=u.x),u.y<f.y&&(f.y=u.y),u.y>l.y&&(l.y=u.y),u.z<f.z&&(f.z=u.z),u.z>l.z&&(l.z=u.z)}r.left=f.x,r.right=l.x,r.top=l.y,r.bottom=f.y,r.updateProjectionMatrix()}function v(t){return t.material instanceof e.MeshFaceMaterial?t.material.materials[0]:t.material}var t,n,r,i,s,o,u=new e.Frustum,a=new e.Matrix4,f=new e.Vector3,l=new e.Vector3,c=new e.Vector3;this.init=function(u){t=u.context,n=u;var a=e.ShaderLib.depthRGBA,f=e.UniformsUtils.clone(a.uniforms);r=new e.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f}),i=new e.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0}),s=new e.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,skinning:!0}),o=new e.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){if(!n.shadowMapEnabled||!n.shadowMapAutoUpdate)return;this.update(e,t)},this.update=function(f,l){var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M=[],_=0,D=null;t.clearColor(1,1,1,1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.frontFace(t.CCW),n.shadowMapCullFace===e.CullFaceFront?t.cullFace(t.FRONT):t.cullFace(t.BACK),n.setDepthTest(!0);for(m=0,g=f.__lights.length;m<g;m++){A=f.__lights[m];if(!A.castShadow)continue;if(A instanceof e.DirectionalLight&&A.shadowCascade)for(w=0;w<A.shadowCascadeCount;w++){var P;if(!A.shadowCascadeArray[w]){P=h(A,w),P.originalCamera=l;var H=new e.Gyroscope;H.position=A.shadowCascadeOffset,H.add(P),H.add(P.target),l.add(H),A.shadowCascadeArray[w]=P,console.log("Created virtualLight",P)}else P=A.shadowCascadeArray[w];p(A,w),M[_]=P,_++}else M[_]=A,_++}for(m=0,g=M.length;m<g;m++){A=M[m];if(!A.shadowMap){var B=e.LinearFilter;n.shadowMapType===e.PCFSoftShadowMap&&(B=e.NearestFilter);var j={minFilter:B,magFilter:B,format:e.RGBAFormat};A.shadowMap=new e.WebGLRenderTarget(A.shadowMapWidth,A.shadowMapHeight,j),A.shadowMapSize=new e.Vector2(A.shadowMapWidth,A.shadowMapHeight),A.shadowMatrix=new e.Matrix4}if(!A.shadowCamera){if(A instanceof e.SpotLight)A.shadowCamera=new e.PerspectiveCamera(A.shadowCameraFov,A.shadowMapWidth/A.shadowMapHeight,A.shadowCameraNear,A.shadowCameraFar);else{if(!(A instanceof e.DirectionalLight)){console.error("Unsupported light type for shadow");continue}A.shadowCamera=new e.OrthographicCamera(A.shadowCameraLeft,A.shadowCameraRight,A.shadowCameraTop,A.shadowCameraBottom,A.shadowCameraNear,A.shadowCameraFar)}f.add(A.shadowCamera),f.autoUpdate===!0&&f.updateMatrixWorld()}A.shadowCameraVisible&&!A.cameraHelper&&(A.cameraHelper=new e.CameraHelper(A.shadowCamera),A.shadowCamera.add(A.cameraHelper)),A.isVirtual&&P.originalCamera==l&&d(l,A),E=A.shadowMap,S=A.shadowMatrix,x=A.shadowCamera,x.position.setFromMatrixPosition(A.matrixWorld),c.setFromMatrixPosition(A.target.matrixWorld),x.lookAt(c),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),A.cameraHelper&&(A.cameraHelper.visible=A.shadowCameraVisible),A.shadowCameraVisible&&A.cameraHelper.update(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(x.projectionMatrix),S.multiply(x.matrixWorldInverse),a.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),u.setFromMatrix(a),n.setRenderTarget(E),n.clear(),O=f.__webglObjects;for(y=0,b=O.length;y<b;y++)k=O[y],L=k.object,k.render=!1,L.visible&&L.castShadow&&(!(L instanceof e.Mesh||L instanceof e.ParticleSystem)||!L.frustumCulled||u.intersectsObject(L))&&(L._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,L.matrixWorld),k.render=!0);var F,I,q;for(y=0,b=O.length;y<b;y++)k=O[y],k.render&&(L=k.object,N=k.buffer,F=v(L),I=L.geometry.morphTargets!==undefined&&L.geometry.morphTargets.length>0&&F.morphTargets,q=L instanceof e.SkinnedMesh&&F.skinning,L.customDepthMaterial?C=L.customDepthMaterial:q?C=I?o:s:I?C=i:C=r,N instanceof e.BufferGeometry?n.renderBufferDirect(x,f.__lights,D,C,N,L):n.renderBuffer(x,f.__lights,D,C,N,L));O=f.__webglObjectsImmediate;for(y=0,b=O.length;y<b;y++)k=O[y],L=k.object,L.visible&&L.castShadow&&(L._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,L.matrixWorld),n.renderImmediateObject(x,f.__lights,D,r,L))}var R=n.getClearColor(),U=n.getClearAlpha();t.clearColor(R.r,R.g,R.b,U),t.enable(t.BLEND),n.shadowMapCullFace===e.CullFaceFront&&t.cullFace(t.BACK)}},e.ShadowMapPlugin.__projector=new e.Projector,e.ShadowMapPlugin}),define("libs/threejs/lights/HemisphereLight",["../Three","./Light","../math/Color"],function(e,t,n){return e.HemisphereLight=function(t,n,r){e.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new e.Color(n),this.intensity=r!==undefined?r:1},e.HemisphereLight.prototype=Object.create(e.Light.prototype),e.HemisphereLight.prototype.clone=function(){var t=new e.HemisphereLight;return e.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},e.HemisphereLight}),define("libs/threejs/lights/PointLight",["../Three","./Light"],function(e,t){return e.PointLight=function(t,n,r){e.Light.call(this,t),this.intensity=n!==undefined?n:1,this.distance=r!==undefined?r:0},e.PointLight.prototype=Object.create(e.Light.prototype),e.PointLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},e.PointLight}),define("libs/threejs/renderers/WebGLRenderTargetCube",["../Three","./WebGLRenderTarget"],function(e,t){return e.WebGLRenderTargetCube=function(t,n,r){e.WebGLRenderTarget.call(this,t,n,r),this.activeCubeFace=0},e.WebGLRenderTargetCube.prototype=Object.create(e.WebGLRenderTarget.prototype),e.WebGLRenderTargetCube}),define("libs/threejs/textures/CompressedTexture",["../Three","./Texture"],function(e,t){return e.CompressedTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={width:n,height:r},this.mipmaps=t,this.generateMipmaps=!1},e.CompressedTexture.prototype=Object.create(e.Texture.prototype),e.CompressedTexture.prototype.clone=function(){var t=new e.CompressedTexture;return e.Texture.prototype.clone.call(this,t),t},e.CompressedTexture}),define("libs/threejs/lights/AmbientLight",["../Three","./Light"],function(e,t){return e.AmbientLight=function(t){e.Light.call(this,t)},e.AmbientLight.prototype=Object.create(e.Light.prototype),e.AmbientLight.prototype.clone=function(){var t=new e.AmbientLight;return e.Light.prototype.clone.call(this,t),t},e.AmbientLight}),define("libs/threejs/materials/MeshLambertMaterial",["../Three","./Material","../math/Vector3","../math/Color"],function(e,t,n,r){return e.MeshLambertMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},e.MeshLambertMaterial.prototype=Object.create(e.Material.prototype),e.MeshLambertMaterial.prototype.clone=function(){var t=new e.MeshLambertMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshLambertMaterial}),define("libs/threejs/materials/MeshPhongMaterial",["../Three","./Material","../math/Vector2","../math/Vector3","../math/Color"],function(e,t,n,r,i){return e.MeshPhongMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.specular=new e.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},e.MeshPhongMaterial.prototype=Object.create(e.Material.prototype),e.MeshPhongMaterial.prototype.clone=function(){var t=new e.MeshPhongMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshPhongMaterial}),define("libs/threejs/materials/MeshNormalMaterial",["../Three","./Material"],function(e,t){return e.MeshNormalMaterial=function(t){e.Material.call(this,t),this.shading=e.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},e.MeshNormalMaterial.prototype=Object.create(e.Material.prototype),e.MeshNormalMaterial.prototype.clone=function(){var t=new e.MeshNormalMaterial;return e.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshNormalMaterial}),define("libs/threejs/materials/MeshDepthMaterial",["../Three","./Material"],function(e,t){return e.MeshDepthMaterial=function(t){e.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},e.MeshDepthMaterial.prototype=Object.create(e.Material.prototype),e.MeshDepthMaterial.prototype.clone=function(){var t=new e.MeshDepthMaterial;return e.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshDepthMaterial}),define("libs/threejs/materials/LineDashedMaterial",["../Three","./Material","../math/Color"],function(e,t,n){return e.LineDashedMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineDashedMaterial.prototype=Object.create(e.Material.prototype),e.LineDashedMaterial.prototype.clone=function(){var t=new e.LineDashedMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineDashedMaterial}),define("libs/threejs/extras/objects/ImmediateRenderObject",["../../Three","../../core/Object3D"],function(e,t){return e.ImmediateRenderObject=function(){e.Object3D.call(this),this.render=function(e){}},e.ImmediateRenderObject.prototype=Object.create(e.Object3D.prototype),e.ImmediateRenderObject}),define("libs/threejs/extras/objects/LensFlare",["../../Three","../../core/Object3D","../../math/Color","../../math/Vector3"],function(e,t,n,r){return e.LensFlare=function(t,n,r,i,s){e.Object3D.call(this),this.lensFlares=[],this.positionScreen=new e.Vector3,this.customUpdateCallback=undefined,t!==undefined&&this.add(t,n,r,i,s)},e.LensFlare.prototype=Object.create(e.Object3D.prototype),e.LensFlare.prototype.add=function(t,n,r,i,s,o){n===undefined&&(n=-1),r===undefined&&(r=0),o===undefined&&(o=1),s===undefined&&(s=new e.Color(16777215)),i===undefined&&(i=e.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:t,size:n,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:s,blending:i})},e.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=-this.positionScreen.x*2,i=-this.positionScreen.y*2;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=(n.wantedRotation-n.rotation)*.25},e.LensFlare}),define("libs/threejs/renderers/WebGLRenderer",["../Three","../extras/renderers/plugins/LensFlarePlugin","../extras/renderers/plugins/SpritePlugin","../extras/renderers/plugins/ShadowMapPlugin","../lights/DirectionalLight","../lights/SpotLight","../lights/HemisphereLight","../lights/PointLight","../objects/SkinnedMesh","./WebGLRenderTargetCube","../math/Math","../textures/CompressedTexture","../textures/DataTexture","../lights/AmbientLight","../textures/Texture","../math/Matrix4","../math/Vector4","../math/Vector3","../math/Vector2","../math/Color","../scenes/FogExp2","../scenes/Fog","../materials/ShaderMaterial","../materials/MeshLambertMaterial","../materials/MeshPhongMaterial","../materials/MeshNormalMaterial","../materials/MeshDepthMaterial","../materials/ParticleSystemMaterial","../materials/LineDashedMaterial","../materials/LineBasicMaterial","../materials/MeshBasicMaterial","./shaders/UniformsUtils","./shaders/ShaderLib","../extras/objects/ImmediateRenderObject","../extras/objects/LensFlare","../objects/Sprite","../objects/Line","../objects/ParticleSystem","../objects/Mesh","../core/BufferGeometry","../core/Geometry","../materials/MeshFaceMaterial","../math/Matrix3","../cameras/Camera","../math/Frustum"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W){return e.WebGLRenderer=function(t){function St(e){e.__webglVertexBuffer=J.createBuffer(),e.__webglColorBuffer=J.createBuffer(),p.info.memory.geometries++}function xt(e){e.__webglVertexBuffer=J.createBuffer(),e.__webglColorBuffer=J.createBuffer(),e.__webglLineDistanceBuffer=J.createBuffer(),p.info.memory.geometries++}function Tt(e){e.__webglVertexBuffer=J.createBuffer(),e.__webglNormalBuffer=J.createBuffer(),e.__webglTangentBuffer=J.createBuffer(),e.__webglColorBuffer=J.createBuffer(),e.__webglUVBuffer=J.createBuffer(),e.__webglUV2Buffer=J.createBuffer(),e.__webglSkinIndicesBuffer=J.createBuffer(),e.__webglSkinWeightsBuffer=J.createBuffer(),e.__webglFaceBuffer=J.createBuffer(),e.__webglLineBuffer=J.createBuffer();var t,n;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,n=e.numMorphTargets;t<n;t++)e.__webglMorphTargetsBuffers.push(J.createBuffer())}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,n=e.numMorphNormals;t<n;t++)e.__webglMorphNormalsBuffers.push(J.createBuffer())}p.info.memory.geometries++}function Pt(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){e.__webglCustomAttributesList===undefined&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;s.type==="v2"?o=2:s.type==="v3"?o=3:s.type==="v4"?o=4:s.type==="c"&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=J.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function Ht(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3),e.__colorArray=new Float32Array(n*3),e.__sortArray=[],e.__webglParticleCount=n,Pt(e,t)}function Bt(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3),e.__colorArray=new Float32Array(n*3),e.__lineDistanceArray=new Float32Array(n*1),e.__webglLineCount=n,Pt(e,t)}function jt(e,t){var n=t.geometry,r=e.faces3,i=r.length*3,s=r.length*1,o=r.length*3,u=Ft(t,e),a=Ut(u),f=qt(u),l=Rt(u);e.__vertexArray=new Float32Array(i*3),f&&(e.__normalArray=new Float32Array(i*3)),n.hasTangents&&(e.__tangentArray=new Float32Array(i*4)),l&&(e.__colorArray=new Float32Array(i*3)),a&&(n.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(i*2)),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(i*2))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(i*4),e.__skinWeightArray=new Float32Array(i*4)),e.__faceArray=new Uint16Array(s*3),e.__lineArray=new Uint16Array(o*2);var c,h;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(c=0,h=e.numMorphTargets;c<h;c++)e.__morphTargetsArrays.push(new Float32Array(i*3))}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(c=0,h=e.numMorphNormals;c<h;c++)e.__morphNormalsArrays.push(new Float32Array(i*3))}e.__webglFaceCount=s*3,e.__webglLineCount=o*2;if(u.attributes){e.__webglCustomAttributesList===undefined&&(e.__webglCustomAttributesList=[]);for(var p in u.attributes){var d=u.attributes[p],v={};for(var m in d)v[m]=d[m];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var g=1;v.type==="v2"?g=2:v.type==="v3"?g=3:v.type==="v4"?g=4:v.type==="c"&&(g=3),v.size=g,v.array=new Float32Array(i*g),v.buffer=J.createBuffer(),v.buffer.belongsToAttribute=p,d.needsUpdate=!0,v.__original=d}e.__webglCustomAttributesList.push(v)}}e.__inittedArrays=!0}function Ft(t,n){return t.material instanceof e.MeshFaceMaterial?t.material.materials[n.materialIndex]:t.material}function It(t){return t&&t.shading!==undefined&&t.shading===e.SmoothShading}function qt(t){return t instanceof e.MeshBasicMaterial&&!t.envMap||t instanceof e.MeshDepthMaterial?!1:It(t)?e.SmoothShading:e.FlatShading}function Rt(e){return e.vertexColors?e.vertexColors:!1}function Ut(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial?!0:!1}function zt(e){var t,n,r;for(t in e.attributes)t==="index"?r=J.ELEMENT_ARRAY_BUFFER:r=J.ARRAY_BUFFER,n=e.attributes[t],n.buffer=J.createBuffer(),J.bindBuffer(r,n.buffer),J.bufferData(r,n.array,J.STATIC_DRAW)}function Wt(e,t,n){var r,i,s,o,u,a,f=e.vertices,l=f.length,c=e.colors,h=c.length,p=e.__vertexArray,d=e.__colorArray,v=e.__sortArray,m=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,b=e.__webglCustomAttributesList,w,E,S,x,T,N,C;if(n.sortParticles){z.copy(U),z.multiply(n.matrixWorld);for(r=0;r<l;r++)s=f[r],W.copy(s),W.applyProjection(z),v[r]=[W.z,r];v.sort(Zt);for(r=0;r<l;r++)s=f[v[r][1]],o=r*3,p[o]=s.x,p[o+1]=s.y,p[o+2]=s.z;for(i=0;i<h;i++)o=i*3,a=c[v[i][1]],d[o]=a.r,d[o+1]=a.g,d[o+2]=a.b;if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.boundTo!==undefined&&C.boundTo!=="vertices")continue;o=0,T=C.value.length;if(C.size===1)for(x=0;x<T;x++)u=v[x][1],C.array[x]=C.value[u];else if(C.size===2)for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,o+=2;else if(C.size===3)if(C.type==="c")for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.r,C.array[o+1]=N.g,C.array[o+2]=N.b,o+=3;else for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,o+=3;else if(C.size===4)for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,C.array[o+3]=N.w,o+=4}}else{if(m)for(r=0;r<l;r++)s=f[r],o=r*3,p[o]=s.x,p[o+1]=s.y,p[o+2]=s.z;if(y)for(i=0;i<h;i++)a=c[i],o=i*3,d[o]=a.r,d[o+1]=a.g,d[o+2]=a.b;if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate&&(C.boundTo===undefined||C.boundTo==="vertices")){T=C.value.length,o=0;if(C.size===1)for(x=0;x<T;x++)C.array[x]=C.value[x];else if(C.size===2)for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,o+=2;else if(C.size===3)if(C.type==="c")for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.r,C.array[o+1]=N.g,C.array[o+2]=N.b,o+=3;else for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,o+=3;else if(C.size===4)for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,C.array[o+3]=N.w,o+=4}}}if(m||n.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,e.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,p,t);if(y||n.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,e.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,d,t);if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate||n.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,C.buffer),J.bufferData(J.ARRAY_BUFFER,C.array,t)}}function Xt(e,t){var n,r,i,s,o,u,a=e.vertices,f=e.colors,l=e.lineDistances,c=a.length,h=f.length,p=l.length,d=e.__vertexArray,v=e.__colorArray,m=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList,E,S,x,T,N,C,k;if(g){for(n=0;n<c;n++)s=a[n],o=n*3,d[o]=s.x,d[o+1]=s.y,d[o+2]=s.z;J.bindBuffer(J.ARRAY_BUFFER,e.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,d,t)}if(y){for(r=0;r<h;r++)u=f[r],o=r*3,v[o]=u.r,v[o+1]=u.g,v[o+2]=u.b;J.bindBuffer(J.ARRAY_BUFFER,e.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,v,t)}if(b){for(i=0;i<p;i++)m[i]=l[i];J.bindBuffer(J.ARRAY_BUFFER,e.__webglLineDistanceBuffer),J.bufferData(J.ARRAY_BUFFER,m,t)}if(w)for(E=0,S=w.length;E<S;E++){k=w[E];if(k.needsUpdate&&(k.boundTo===undefined||k.boundTo==="vertices")){o=0,N=k.value.length;if(k.size===1)for(T=0;T<N;T++)k.array[T]=k.value[T];else if(k.size===2)for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,o+=2;else if(k.size===3)if(k.type==="c")for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.r,k.array[o+1]=C.g,k.array[o+2]=C.b,o+=3;else for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,k.array[o+2]=C.z,o+=3;else if(k.size===4)for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,k.array[o+2]=C.z,k.array[o+3]=C.w,o+=4;J.bindBuffer(J.ARRAY_BUFFER,k.buffer),J.bufferData(J.ARRAY_BUFFER,k.array,t)}}}function Vt(t,n,r,i,s){if(!t.__inittedArrays)return;var o=qt(s),u=Rt(s),a=Ut(s),f=o===e.SmoothShading,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt=0,mt=0,gt=0,yt=0,bt=0,wt=0,Et=0,St=0,xt=0,Tt=0,Nt=0,Ct=0,kt=0,Lt,At=t.__vertexArray,Ot=t.__uvArray,Mt=t.__uv2Array,_t=t.__normalArray,Dt=t.__tangentArray,Pt=t.__colorArray,Ht=t.__skinIndexArray,Bt=t.__skinWeightArray,jt=t.__morphTargetsArrays,Ft=t.__morphNormalsArrays,It=t.__webglCustomAttributesList,zt,Wt=t.__faceArray,Xt=t.__lineArray,Vt=n.geometry,$t=Vt.verticesNeedUpdate,Jt=Vt.elementsNeedUpdate,Kt=Vt.uvsNeedUpdate,Qt=Vt.normalsNeedUpdate,Gt=Vt.tangentsNeedUpdate,Yt=Vt.colorsNeedUpdate,Zt=Vt.morphTargetsNeedUpdate,en=Vt.vertices,tn=t.faces3,nn=Vt.faces,rn=Vt.faceVertexUvs[0],sn=Vt.faceVertexUvs[1],on=Vt.colors,un=Vt.skinIndices,an=Vt.skinWeights,fn=Vt.morphTargets,ln=Vt.morphNormals;if($t){for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],S=en[p.a],x=en[p.b],T=en[p.c],At[mt]=S.x,At[mt+1]=S.y,At[mt+2]=S.z,At[mt+3]=x.x,At[mt+4]=x.y,At[mt+5]=x.z,At[mt+6]=T.x,At[mt+7]=T.y,At[mt+8]=T.z,mt+=9;J.bindBuffer(J.ARRAY_BUFFER,t.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,At,r)}if(Zt)for(at=0,ft=fn.length;at<ft;at++){Nt=0;for(l=0,c=tn.length;l<c;l++)ht=tn[l],p=nn[ht],S=fn[at].vertices[p.a],x=fn[at].vertices[p.b],T=fn[at].vertices[p.c],lt=jt[at],lt[Nt]=S.x,lt[Nt+1]=S.y,lt[Nt+2]=S.z,lt[Nt+3]=x.x,lt[Nt+4]=x.y,lt[Nt+5]=x.z,lt[Nt+6]=T.x,lt[Nt+7]=T.y,lt[Nt+8]=T.z,s.morphNormals&&(f?(pt=ln[at].vertexNormals[ht],O=pt.a,M=pt.b,_=pt.c):(O=ln[at].faceNormals[ht],M=O,_=O),ct=Ft[at],ct[Nt]=O.x,ct[Nt+1]=O.y,ct[Nt+2]=O.z,ct[Nt+3]=M.x,ct[Nt+4]=M.y,ct[Nt+5]=M.z,ct[Nt+6]=_.x,ct[Nt+7]=_.y,ct[Nt+8]=_.z),Nt+=9;J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[at]),J.bufferData(J.ARRAY_BUFFER,jt[at],r),s.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[at]),J.bufferData(J.ARRAY_BUFFER,Ft[at],r))}if(an.length){for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],F=an[p.a],I=an[p.b],q=an[p.c],Bt[Tt]=F.x,Bt[Tt+1]=F.y,Bt[Tt+2]=F.z,Bt[Tt+3]=F.w,Bt[Tt+4]=I.x,Bt[Tt+5]=I.y,Bt[Tt+6]=I.z,Bt[Tt+7]=I.w,Bt[Tt+8]=q.x,Bt[Tt+9]=q.y,Bt[Tt+10]=q.z,Bt[Tt+11]=q.w,U=un[p.a],z=un[p.b],W=un[p.c],Ht[Tt]=U.x,Ht[Tt+1]=U.y,Ht[Tt+2]=U.z,Ht[Tt+3]=U.w,Ht[Tt+4]=z.x,Ht[Tt+5]=z.y,Ht[Tt+6]=z.z,Ht[Tt+7]=z.w,Ht[Tt+8]=W.x,Ht[Tt+9]=W.y,Ht[Tt+10]=W.z,Ht[Tt+11]=W.w,Tt+=12;Tt>0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglSkinIndicesBuffer),J.bufferData(J.ARRAY_BUFFER,Ht,r),J.bindBuffer(J.ARRAY_BUFFER,t.__webglSkinWeightsBuffer),J.bufferData(J.ARRAY_BUFFER,Bt,r))}if(Yt&&u){for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],g=p.vertexColors,y=p.color,g.length===3&&u===e.VertexColors?(P=g[0],H=g[1],B=g[2]):(P=y,H=y,B=y),Pt[xt]=P.r,Pt[xt+1]=P.g,Pt[xt+2]=P.b,Pt[xt+3]=H.r,Pt[xt+4]=H.g,Pt[xt+5]=H.b,Pt[xt+6]=B.r,Pt[xt+7]=B.g,Pt[xt+8]=B.b,xt+=9;xt>0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,Pt,r))}if(Gt&&Vt.hasTangents){for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],b=p.vertexTangents,C=b[0],k=b[1],L=b[2],Dt[Et]=C.x,Dt[Et+1]=C.y,Dt[Et+2]=C.z,Dt[Et+3]=C.w,Dt[Et+4]=k.x,Dt[Et+5]=k.y,Dt[Et+6]=k.z,Dt[Et+7]=k.w,Dt[Et+8]=L.x,Dt[Et+9]=L.y,Dt[Et+10]=L.z,Dt[Et+11]=L.w,Et+=12;J.bindBuffer(J.ARRAY_BUFFER,t.__webglTangentBuffer),J.bufferData(J.ARRAY_BUFFER,Dt,r)}if(Qt&&o){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]],d=p.vertexNormals,v=p.normal;if(d.length===3&&f)for(rt=0;rt<3;rt++)st=d[rt],_t[wt]=st.x,_t[wt+1]=st.y,_t[wt+2]=st.z,wt+=3;else for(rt=0;rt<3;rt++)_t[wt]=v.x,_t[wt+1]=v.y,_t[wt+2]=v.z,wt+=3}J.bindBuffer(J.ARRAY_BUFFER,t.__webglNormalBuffer),J.bufferData(J.ARRAY_BUFFER,_t,r)}if(Kt&&rn&&a){for(l=0,c=tn.length;l<c;l++){h=tn[l],w=rn[h];if(w===undefined)continue;for(rt=0;rt<3;rt++)ot=w[rt],Ot[gt]=ot.x,Ot[gt+1]=ot.y,gt+=2}gt>0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglUVBuffer),J.bufferData(J.ARRAY_BUFFER,Ot,r))}if(Kt&&sn&&a){for(l=0,c=tn.length;l<c;l++){h=tn[l],E=sn[h];if(E===undefined)continue;for(rt=0;rt<3;rt++)ut=E[rt],Mt[yt]=ut.x,Mt[yt+1]=ut.y,yt+=2}yt>0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglUV2Buffer),J.bufferData(J.ARRAY_BUFFER,Mt,r))}if(Jt){for(l=0,c=tn.length;l<c;l++)Wt[bt]=vt,Wt[bt+1]=vt+1,Wt[bt+2]=vt+2,bt+=3,Xt[St]=vt,Xt[St+1]=vt+1,Xt[St+2]=vt,Xt[St+3]=vt+2,Xt[St+4]=vt+1,Xt[St+5]=vt+2,St+=6,vt+=3;J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),J.bufferData(J.ELEMENT_ARRAY_BUFFER,Wt,r),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),J.bufferData(J.ELEMENT_ARRAY_BUFFER,Xt,r)}if(It)for(rt=0,it=It.length;rt<it;rt++){zt=It[rt];if(!zt.__original.needsUpdate)continue;Ct=0,kt=0;if(zt.size===1){if(zt.boundTo===undefined||zt.boundTo==="vertices")for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],zt.array[Ct]=zt.value[p.a],zt.array[Ct+1]=zt.value[p.b],zt.array[Ct+2]=zt.value[p.c],Ct+=3;else if(zt.boundTo==="faces")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],zt.array[Ct]=Lt,zt.array[Ct+1]=Lt,zt.array[Ct+2]=Lt,Ct+=3}else if(zt.size===2){if(zt.boundTo===undefined||zt.boundTo==="vertices")for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],S=zt.value[p.a],x=zt.value[p.b],T=zt.value[p.c],zt.array[Ct]=S.x,zt.array[Ct+1]=S.y,zt.array[Ct+2]=x.x,zt.array[Ct+3]=x.y,zt.array[Ct+4]=T.x,zt.array[Ct+5]=T.y,Ct+=6;else if(zt.boundTo==="faces")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],S=Lt,x=Lt,T=Lt,zt.array[Ct]=S.x,zt.array[Ct+1]=S.y,zt.array[Ct+2]=x.x,zt.array[Ct+3]=x.y,zt.array[Ct+4]=T.x,zt.array[Ct+5]=T.y,Ct+=6}else if(zt.size===3){var cn;zt.type==="c"?cn=["r","g","b"]:cn=["x","y","z"];if(zt.boundTo===undefined||zt.boundTo==="vertices")for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],S=zt.value[p.a],x=zt.value[p.b],T=zt.value[p.c],zt.array[Ct]=S[cn[0]],zt.array[Ct+1]=S[cn[1]],zt.array[Ct+2]=S[cn[2]],zt.array[Ct+3]=x[cn[0]],zt.array[Ct+4]=x[cn[1]],zt.array[Ct+5]=x[cn[2]],zt.array[Ct+6]=T[cn[0]],zt.array[Ct+7]=T[cn[1]],zt.array[Ct+8]=T[cn[2]],Ct+=9;else if(zt.boundTo==="faces")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],S=Lt,x=Lt,T=Lt,zt.array[Ct]=S[cn[0]],zt.array[Ct+1]=S[cn[1]],zt.array[Ct+2]=S[cn[2]],zt.array[Ct+3]=x[cn[0]],zt.array[Ct+4]=x[cn[1]],zt.array[Ct+5]=x[cn[2]],zt.array[Ct+6]=T[cn[0]],zt.array[Ct+7]=T[cn[1]],zt.array[Ct+8]=T[cn[2]],Ct+=9;else if(zt.boundTo==="faceVertices")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],S=Lt[0],x=Lt[1],T=Lt[2],zt.array[Ct]=S[cn[0]],zt.array[Ct+1]=S[cn[1]],zt.array[Ct+2]=S[cn[2]],zt.array[Ct+3]=x[cn[0]],zt.array[Ct+4]=x[cn[1]],zt.array[Ct+5]=x[cn[2]],zt.array[Ct+6]=T[cn[0]],zt.array[Ct+7]=T[cn[1]],zt.array[Ct+8]=T[cn[2]],Ct+=9}else if(zt.size===4)if(zt.boundTo===undefined||zt.boundTo==="vertices")for(l=0,c=tn.length;l<c;l++)p=nn[tn[l]],S=zt.value[p.a],x=zt.value[p.b],T=zt.value[p.c],zt.array[Ct]=S.x,zt.array[Ct+1]=S.y,zt.array[Ct+2]=S.z,zt.array[Ct+3]=S.w,zt.array[Ct+4]=x.x,zt.array[Ct+5]=x.y,zt.array[Ct+6]=x.z,zt.array[Ct+7]=x.w,zt.array[Ct+8]=T.x,zt.array[Ct+9]=T.y,zt.array[Ct+10]=T.z,zt.array[Ct+11]=T.w,Ct+=12;else if(zt.boundTo==="faces")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],S=Lt,x=Lt,T=Lt,zt.array[Ct]=S.x,zt.array[Ct+1]=S.y,zt.array[Ct+2]=S.z,zt.array[Ct+3]=S.w,zt.array[Ct+4]=x.x,zt.array[Ct+5]=x.y,zt.array[Ct+6]=x.z,zt.array[Ct+7]=x.w,zt.array[Ct+8]=T.x,zt.array[Ct+9]=T.y,zt.array[Ct+10]=T.z,zt.array[Ct+11]=T.w,Ct+=12;else if(zt.boundTo==="faceVertices")for(l=0,c=tn.length;l<c;l++)Lt=zt.value[tn[l]],S=Lt[0],x=Lt[1],T=Lt[2],zt.array[Ct]=S.x,zt.array[Ct+1]=S.y,zt.array[Ct+2]=S.z,zt.array[Ct+3]=S.w,zt.array[Ct+4]=x.x,zt.array[Ct+5]=x.y,zt.array[Ct+6]=x.z,zt.array[Ct+7]=x.w,zt.array[Ct+8]=T.x,zt.array[Ct+9]=T.y,zt.array[Ct+10]=T.z,zt.array[Ct+11]=T.w,Ct+=12;J.bindBuffer(J.ARRAY_BUFFER,zt.buffer),J.bufferData(J.ARRAY_BUFFER,zt.array,r)}i&&(delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray)}function $t(e,t,n,r){var i,s,o,u;for(s in t)o=t[s],i=n[s],o>=0&&(i?(u=i.itemSize,J.bindBuffer(J.ARRAY_BUFFER,i.buffer),Kt(o),J.vertexAttribPointer(o,u,J.FLOAT,!1,0,r*u*4)):e.defaultAttributeValues&&(e.defaultAttributeValues[s].length===2?J.vertexAttrib2fv(o,e.defaultAttributeValues[s]):e.defaultAttributeValues[s].length===3&&J.vertexAttrib3fv(o,e.defaultAttributeValues[s])))}function Jt(e,t){var n=e.attributes,r,i;for(r in n)i=n[r],i.needsUpdate&&(r==="index"?(J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,i.buffer),J.bufferData(J.ELEMENT_ARRAY_BUFFER,i.array,t)):(J.bindBuffer(J.ARRAY_BUFFER,i.buffer),J.bufferData(J.ARRAY_BUFFER,i.array,t)),i.needsUpdate=!1)}function Kt(e){q[e]===0&&(J.enableVertexAttribArray(e),q[e]=1)}function Qt(){for(var e in q)q[e]===1&&(J.disableVertexAttribArray(e),q[e]=0)}function Gt(e,t,n){var r=e.program.attributes;n.morphTargetBase!==-1&&r.position>=0?(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),Kt(r.position),J.vertexAttribPointer(r.position,3,J.FLOAT,!1,0,0)):r.position>=0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglVertexBuffer),Kt(r.position),J.vertexAttribPointer(r.position,3,J.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length){var i=0,s=n.morphTargetForcedOrder,o=n.morphTargetInfluences;while(i<e.numSupportedMorphTargets&&i<s.length)r["morphTarget"+i]>=0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[s[i]]),Kt(r["morphTarget"+i]),J.vertexAttribPointer(r["morphTarget"+i],3,J.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&e.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[s[i]]),Kt(r["morphNormal"+i]),J.vertexAttribPointer(r["morphNormal"+i],3,J.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=o[s[i]],i++}else{var u,a=[],o=n.morphTargetInfluences,f,l=o.length;for(f=0;f<l;f++)u=o[f],u>0&&a.push([u,f]);a.length>e.numSupportedMorphTargets?(a.sort(Zt),a.length=e.numSupportedMorphTargets):a.length>e.numSupportedMorphNormals?a.sort(Zt):a.length===0&&a.push([0,0]);var c,i=0;while(i<e.numSupportedMorphTargets)a[i]?(c=a[i][1],r["morphTarget"+i]>=0&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]),Kt(r["morphTarget"+i]),J.vertexAttribPointer(r["morphTarget"+i],3,J.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&e.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]),Kt(r["morphNormal"+i]),J.vertexAttribPointer(r["morphNormal"+i],3,J.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=o[c]):n.__webglMorphTargetInfluences[i]=0,i++}e.program.uniforms.morphTargetInfluences!==null&&J.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}function Yt(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function Zt(e,t){return t[0]-e[0]}function en(e,t,n){if(!e.length)return;for(var r=0,i=e.length;r<i;r++)m=null,w=null,T=-1,L=-1,A=-1,S=-1,x=-1,b=-1,y=-1,V=!0,e[r].render(t,n,F,I),m=null,w=null,T=-1,L=-1,A=-1,S=-1,x=-1,b=-1,y=-1,V=!0}function tn(t,n,r,i,s,o,u,a){var f,l,c,h,d,v,m;n?(d=t.length-1,v=-1,m=-1):(d=0,v=t.length,m=1);for(var g=d;g!==v;g+=m){f=t[g];if(f.render){l=f.object,c=f.buffer;if(a)h=a;else{h=f[r];if(!h)continue;u&&p.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),p.setDepthTest(h.depthTest),p.setDepthWrite(h.depthWrite),Pn(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}p.setMaterialFaces(h),c instanceof e.BufferGeometry?p.renderBufferDirect(i,s,o,h,c,l):p.renderBuffer(i,s,o,h,c,l)}}}function nn(e,t,n,r,i,s,o){var u,a,f,l;for(var c=0,h=e.length;c<h;c++){u=e[c],a=u.object;if(a.visible){if(o)f=o;else{f=u[t];if(!f)continue;s&&p.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),p.setDepthTest(f.depthTest),p.setDepthWrite(f.depthWrite),Pn(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}p.renderImmediateObject(n,r,i,f,a)}}}function rn(e){var t=e.object,n=t.material;n.transparent?(e.transparent=n,e.opaque=null):(e.opaque=n,e.transparent=null)}function sn(t){var n=t.object,r=t.buffer,i=n.geometry,s=n.material;if(s instanceof e.MeshFaceMaterial){var o=i instanceof e.BufferGeometry?0:r.materialIndex;s=s.materials[o],s.transparent?(t.transparent=s,t.opaque=null):(t.opaque=s,t.transparent=null)}else s&&(s.transparent?(t.transparent=s,t.opaque=null):(t.opaque=s,t.transparent=null))}function on(t,n){var r,i,s,o;if(t.__webglInit===undefined){t.__webglInit=!0,t._modelViewMatrix=new e.Matrix4,t._normalMatrix=new e.Matrix3,t.geometry!==undefined&&t.geometry.__webglInit===undefined&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",Nt)),i=t.geometry;if(i!==undefined)if(i instanceof e.BufferGeometry)zt(i);else if(t instanceof e.Mesh){s=t.material,i.geometryGroups===undefined&&i.makeGroups(s instanceof e.MeshFaceMaterial);for(r in i.geometryGroups)o=i.geometryGroups[r],o.__webglVertexBuffer||(Tt(o),jt(o,t),i.verticesNeedUpdate=!0,i.morphTargetsNeedUpdate=!0,i.elementsNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.tangentsNeedUpdate=!0,i.colorsNeedUpdate=!0)}else t instanceof e.Line?i.__webglVertexBuffer||(xt(i),Bt(i,t),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):t instanceof e.ParticleSystem&&(i.__webglVertexBuffer||(St(i),Ht(i,t),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0))}if(t.__webglActive===undefined){if(t instanceof e.Mesh){i=t.geometry;if(i instanceof e.BufferGeometry)un(n.__webglObjects,i,t);else if(i instanceof e.Geometry)for(r in i.geometryGroups)o=i.geometryGroups[r],un(n.__webglObjects,o,t)}else t instanceof e.Line||t instanceof e.ParticleSystem?(i=t.geometry,un(n.__webglObjects,i,t)):t instanceof e.ImmediateRenderObject||t.immediateRenderCallback?an(n.__webglObjectsImmediate,t):t instanceof e.Sprite?n.__webglSprites.push(t):t instanceof e.LensFlare&&n.__webglFlares.push(t);t.__webglActive=!0}}function un(e,t,n){e.push({id:null,buffer:t,object:n,opaque:null,transparent:null,z:0})}function an(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function fn(t){var n=t.geometry,r,i,s;if(n instanceof e.BufferGeometry)Jt(n,J.DYNAMIC_DRAW);else if(t instanceof e.Mesh){for(var o=0,u=n.geometryGroupsList.length;o<u;o++)r=n.geometryGroupsList[o],s=Ft(t,r),n.buffersNeedUpdate&&jt(r,t),i=s.attributes&&ln(s),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||i)&&Vt(r,t,J.DYNAMIC_DRAW,!n.dynamic,s);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,s.attributes&&cn(s)}else t instanceof e.Line?(s=Ft(t,n),i=s.attributes&&ln(s),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||i)&&Xt(n,J.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,s.attributes&&cn(s)):t instanceof e.ParticleSystem&&(s=Ft(t,n),i=s.attributes&&ln(s),(n.verticesNeedUpdate||n.colorsNeedUpdate||t.sortParticles||i)&&Wt(n,J.DYNAMIC_DRAW,t),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,s.attributes&&cn(s))}function ln(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function cn(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function hn(t,n){t instanceof e.Mesh||t instanceof e.ParticleSystem||t instanceof e.Line?pn(n.__webglObjects,t):t instanceof e.Sprite?dn(n.__webglSprites,t):t instanceof e.LensFlare?dn(n.__webglFlares,t):(t instanceof e.ImmediateRenderObject||t.immediateRenderCallback)&&pn(n.__webglObjectsImmediate,t),delete t.__webglActive}function pn(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function dn(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function vn(t,n){t.uniforms=e.UniformsUtils.clone(n.uniforms),t.vertexShader=n.vertexShader,t.fragmentShader=n.fragmentShader}function mn(t,n,r,i,s){E=0,i.needsUpdate&&(i.program&&Dt(i),p.initMaterial(i,n,r,s),i.needsUpdate=!1),i.morphTargets&&(s.__webglMorphTargetInfluences||(s.__webglMorphTargetInfluences=new Float32Array(p.maxMorphTargets)));var o=!1,u=i.program,a=u.uniforms,f=i.uniforms;u!==m&&(J.useProgram(u),m=u,o=!0),i.id!==y&&(y=i.id,o=!0);if(o||t!==w)J.uniformMatrix4fv(a.projectionMatrix,!1,t.projectionMatrix.elements),t!==w&&(w=t);if(i.skinning)if(ot&&s.useVertexTexture){if(a.boneTexture!==null){var l=kn();J.uniform1i(a.boneTexture,l),p.setTexture(s.boneTexture,l)}a.boneTextureWidth!==null&&J.uniform1i(a.boneTextureWidth,s.boneTextureWidth),a.boneTextureHeight!==null&&J.uniform1i(a.boneTextureHeight,s.boneTextureHeight)}else a.boneGlobalMatrices!==null&&J.uniformMatrix4fv(a.boneGlobalMatrices,!1,s.boneMatrices);if(o){r&&i.fog&&En(f,r);if(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i.lights)V&&(_n(u,n),V=!1),Tn(f,$);(i instanceof e.MeshBasicMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.MeshPhongMaterial)&&gn(f,i),i instanceof e.LineBasicMaterial?yn(f,i):i instanceof e.LineDashedMaterial?(yn(f,i),bn(f,i)):i instanceof e.ParticleSystemMaterial?wn(f,i):i instanceof e.MeshPhongMaterial?Sn(f,i):i instanceof e.MeshLambertMaterial?xn(f,i):i instanceof e.MeshDepthMaterial?(f.mNear.value=t.near,f.mFar.value=t.far,f.opacity.value=i.opacity):i instanceof e.MeshNormalMaterial&&(f.opacity.value=i.opacity),s.receiveShadow&&!i._shadowPass&&Nn(f,n),Ln(u,i.uniformsList),(i instanceof e.ShaderMaterial||i instanceof e.MeshPhongMaterial||i.envMap)&&a.cameraPosition!==null&&(W.setFromMatrixPosition(t.matrixWorld),J.uniform3f(a.cameraPosition,W.x,W.y,W.z)),(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.ShaderMaterial||i.skinning)&&a.viewMatrix!==null&&J.uniformMatrix4fv(a.viewMatrix,!1,t.matrixWorldInverse.elements)}return Cn(a,s),a.modelMatrix!==null&&J.uniformMatrix4fv(a.modelMatrix,!1,s.matrixWorld.elements),u}function gn(t,n){t.opacity.value=n.opacity,p.gammaInput?t.diffuse.value.copyGammaToLinear(n.color):t.diffuse.value=n.color,t.map.value=n.map,t.lightMap.value=n.lightMap,t.specularMap.value=n.specularMap,n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale));var r;n.map?r=n.map:n.specularMap?r=n.specularMap:n.normalMap?r=n.normalMap:n.bumpMap&&(r=n.bumpMap);if(r!==undefined){var i=r.offset,s=r.repeat;t.offsetRepeat.value.set(i.x,i.y,s.x,s.y)}t.envMap.value=n.envMap,t.flipEnvMap.value=n.envMap instanceof e.WebGLRenderTargetCube?1:-1,p.gammaInput?t.reflectivity.value=n.reflectivity:t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio,t.combine.value=n.combine,t.useRefract.value=n.envMap&&n.envMap.mapping instanceof e.CubeRefractionMapping}function yn(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function bn(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function wn(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=n.height/2,e.map.value=t.map}function En(t,n){t.fogColor.value=n.color,n instanceof e.Fog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n instanceof e.FogExp2&&(t.fogDensity.value=n.density)}function Sn(e,t){e.shininess.value=t.shininess,p.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function xn(e,t){p.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Tn(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function Nn(t,n){if(t.shadowMatrix){var r=0;for(var i=0,s=n.length;i<s;i++){var o=n[i];if(!o.castShadow)continue;if(o instanceof e.SpotLight||o instanceof e.DirectionalLight&&!o.shadowCascade)t.shadowMap.value[r]=o.shadowMap,t.shadowMapSize.value[r]=o.shadowMapSize,t.shadowMatrix.value[r]=o.shadowMatrix,t.shadowDarkness.value[r]=o.shadowDarkness,t.shadowBias.value[r]=o.shadowBias,r++}}}function Cn(e,t){J.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&J.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function kn(){var e=E;return e>=et&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+et),E+=1,e}function Ln(t,n){var r,i,s,o,u,a,f,l,c,h,d;for(c=0,h=n.length;c<h;c++){o=t.uniforms[n[c][1]];if(!o)continue;r=n[c][0],s=r.type,i=r.value;if(s==="i")J.uniform1i(o,i);else if(s==="f")J.uniform1f(o,i);else if(s==="v2")J.uniform2f(o,i.x,i.y);else if(s==="v3")J.uniform3f(o,i.x,i.y,i.z);else if(s==="v4")J.uniform4f(o,i.x,i.y,i.z,i.w);else if(s==="c")J.uniform3f(o,i.r,i.g,i.b);else if(s==="iv1")J.uniform1iv(o,i);else if(s==="iv")J.uniform3iv(o,i);else if(s==="fv1")J.uniform1fv(o,i);else if(s==="fv")J.uniform3fv(o,i);else if(s==="v2v"){r._array===undefined&&(r._array=new Float32Array(2*i.length));for(f=0,l=i.length;f<l;f++)d=f*2,r._array[d]=i[f].x,r._array[d+1]=i[f].y;J.uniform2fv(o,r._array)}else if(s==="v3v"){r._array===undefined&&(r._array=new Float32Array(3*i.length));for(f=0,l=i.length;f<l;f++)d=f*3,r._array[d]=i[f].x,r._array[d+1]=i[f].y,r._array[d+2]=i[f].z;J.uniform3fv(o,r._array)}else if(s==="v4v"){r._array===undefined&&(r._array=new Float32Array(4*i.length));for(f=0,l=i.length;f<l;f++)d=f*4,r._array[d]=i[f].x,r._array[d+1]=i[f].y,r._array[d+2]=i[f].z,r._array[d+3]=i[f].w;J.uniform4fv(o,r._array)}else if(s==="m4")r._array===undefined&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),J.uniformMatrix4fv(o,!1,r._array);else if(s==="m4v"){r._array===undefined&&(r._array=new Float32Array(16*i.length));for(f=0,l=i.length;f<l;f++)i[f].flattenToArrayOffset(r._array,f*16);J.uniformMatrix4fv(o,!1,r._array)}else if(s==="t"){u=i,a=kn(),J.uniform1i(o,a);if(!u)continue;u.image instanceof Array&&u.image.length===6?zn(u,a):u instanceof e.WebGLRenderTargetCube?Wn(u,a):p.setTexture(u,a)}else if(s==="tv"){r._array===undefined&&(r._array=[]);for(f=0,l=r.value.length;f<l;f++)r._array[f]=kn();J.uniform1iv(o,r._array);for(f=0,l=r.value.length;f<l;f++){u=r.value[f],a=r._array[f];if(!u)continue;p.setTexture(u,a)}}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}function An(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function On(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function Mn(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function _n(t,n){var r,i,s,o,u=0,a=0,f=0,l,c,h,d,v,m,g,y=$,b=y.directional.colors,w=y.directional.positions,E=y.point.colors,S=y.point.positions,x=y.point.distances,T=y.spot.colors,N=y.spot.positions,C=y.spot.distances,k=y.spot.directions,L=y.spot.anglesCos,A=y.spot.exponents,O=y.hemi.skyColors,M=y.hemi.groundColors,_=y.hemi.positions,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=0,R=0,U=0,z=0,V=0;for(r=0,i=n.length;r<i;r++){s=n[r];if(s.onlyShadow)continue;l=s.color,d=s.intensity,g=s.distance;if(s instanceof e.AmbientLight){if(!s.visible)continue;p.gammaInput?(u+=l.r*l.r,a+=l.g*l.g,f+=l.b*l.b):(u+=l.r,a+=l.g,f+=l.b)}else if(s instanceof e.DirectionalLight){j+=1;if(!s.visible)continue;X.setFromMatrixPosition(s.matrixWorld),W.setFromMatrixPosition(s.target.matrixWorld),X.sub(W),X.normalize();if(X.x===0&&X.y===0&&X.z===0)continue;R=D*3,w[R]=X.x,w[R+1]=X.y,w[R+2]=X.z,p.gammaInput?On(b,R,l,d*d):Mn(b,R,l,d),D+=1}else if(s instanceof e.PointLight){F+=1;if(!s.visible)continue;U=P*3,p.gammaInput?On(E,U,l,d*d):Mn(E,U,l,d),W.setFromMatrixPosition(s.matrixWorld),S[U]=W.x,S[U+1]=W.y,S[U+2]=W.z,x[P]=g,P+=1}else if(s instanceof e.SpotLight){I+=1;if(!s.visible)continue;z=H*3,p.gammaInput?On(T,z,l,d*d):Mn(T,z,l,d),W.setFromMatrixPosition(s.matrixWorld),N[z]=W.x,N[z+1]=W.y,N[z+2]=W.z,C[H]=g,X.copy(W),W.setFromMatrixPosition(s.target.matrixWorld),X.sub(W),X.normalize(),k[z]=X.x,k[z+1]=X.y,k[z+2]=X.z,L[H]=Math.cos(s.angle),A[H]=s.exponent,H+=1}else if(s instanceof e.HemisphereLight){q+=1;if(!s.visible)continue;X.setFromMatrixPosition(s.matrixWorld),X.normalize();if(X.x===0&&X.y===0&&X.z===0)continue;V=B*3,_[V]=X.x,_[V+1]=X.y,_[V+2]=X.z,c=s.color,h=s.groundColor,p.gammaInput?(v=d*d,On(O,V,c,v),On(M,V,h,v)):(Mn(O,V,c,d),Mn(M,V,h,d)),B+=1}}for(r=D*3,i=Math.max(b.length,j*3);r<i;r++)b[r]=0;for(r=P*3,i=Math.max(E.length,F*3);r<i;r++)E[r]=0;for(r=H*3,i=Math.max(T.length,I*3);r<i;r++)T[r]=0;for(r=B*3,i=Math.max(O.length,q*3);r<i;r++)O[r]=0;for(r=B*3,i=Math.max(M.length,q*3);r<i;r++)M[r]=0;y.directional.length=D,y.point.length=P,y.spot.length=H,y.hemi.length=B,y.ambient[0]=u,y.ambient[1]=a,y.ambient[2]=f}function Dn(e){e!==D&&(J.lineWidth(e),D=e)}function Pn(e,t,n){O!==e&&(e?J.enable(J.POLYGON_OFFSET_FILL):J.disable(J.POLYGON_OFFSET_FILL),O=e),e&&(M!==t||_!==n)&&(J.polygonOffset(t,n),M=t,_=n)}function Hn(e){var t,n,r=[];for(var i in e){t=e[i];if(t===!1)continue;n="#define "+i+" "+t,r.push(n)}return r.join("\n")}function Bn(t,n,r,s,o,u,a,f){var l,c,h,m,g,y=[];t?y.push(t):(y.push(n),y.push(r));for(h in u)y.push(h),y.push(u[h]);for(l in a)y.push(l),y.push(a[l]);g=y.join();for(l=0,c=d.length;l<c;l++){var b=d[l];if(b.code===g)return b.usedTimes++,b.program}var w="SHADOWMAP_TYPE_BASIC";a.shadowMapType===e.PCFShadowMap?w="SHADOWMAP_TYPE_PCF":a.shadowMapType===e.PCFSoftShadowMap&&(w="SHADOWMAP_TYPE_PCF_SOFT");var E=Hn(u);m=J.createProgram();var S=["precision "+i+" float;","precision "+i+" int;",E,st?"#define VERTEX_TEXTURES":"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),x=["precision "+i+" float;","precision "+i+" int;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",E,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),T=qn("vertex",S+r),N=qn("fragment",x+n);J.attachShader(m,T),J.attachShader(m,N),f!==undefined&&J.bindAttribLocation(m,0,f),J.linkProgram(m),J.getProgramParameter(m,J.LINK_STATUS)===!1&&(console.error("Could not initialise shader"),console.error("gl.VALIDATE_STATUS",J.getProgramParameter(m,J.VALIDATE_STATUS)),console.error("gl.getError()",J.getError())),J.getProgramInfoLog(m)!==""&&console.error("gl.getProgramInfoLog()",J.getProgramInfoLog(m)),J.deleteShader(N),J.deleteShader(T),m.uniforms={},m.attributes={};var C,k,L,A;C=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],a.useVertexTexture?(C.push("boneTexture"),C.push("boneTextureWidth"),C.push("boneTextureHeight")):C.push("boneGlobalMatrices");for(k in s)C.push(k);jn(m,C),C=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(A=0;A<a.maxMorphTargets;A++)C.push("morphTarget"+A);for(A=0;A<a.maxMorphNormals;A++)C.push("morphNormal"+A);for(L in o)C.push(L);return Fn(m,C),m.id=v++,d.push({program:m,code:g,usedTimes:1}),p.info.memory.programs=d.length,m}function jn(e,t){var n,r,i;for(n=0,r=t.length;n<r;n++)i=t[n],e.uniforms[i]=J.getUniformLocation(e,i)}function Fn(e,t){var n,r,i;for(n=0,r=t.length;n<r;n++)i=t[n],e.attributes[i]=J.getAttribLocation(e,i)}function In(e){var t=e.split("\n");for(var n=0,r=t.length;n<r;n++)t[n]=n+1+": "+t[n];return t.join("\n")}function qn(e,t){var n;return e==="fragment"?n=J.createShader(J.FRAGMENT_SHADER):e==="vertex"&&(n=J.createShader(J.VERTEX_SHADER)),J.shaderSource(n,t),J.compileShader(n),J.getShaderParameter(n,J.COMPILE_STATUS)?n:(console.error(J.getShaderInfoLog(n)),console.error(In(t)),null)}function Rn(t,n,r){r?(J.texParameteri(t,J.TEXTURE_WRAP_S,Kn(n.wrapS)),J.texParameteri(t,J.TEXTURE_WRAP_T,Kn(n.wrapT)),J.texParameteri(t,J.TEXTURE_MAG_FILTER,Kn(n.magFilter)),J.texParameteri(t,J.TEXTURE_MIN_FILTER,Kn(n.minFilter))):(J.texParameteri(t,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(t,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(t,J.TEXTURE_MAG_FILTER,Jn(n.magFilter)),J.texParameteri(t,J.TEXTURE_MIN_FILTER,Jn(n.minFilter))),Y&&n.type!==e.FloatType&&(n.anisotropy>1||n.__oldAnisotropy)&&(J.texParameterf(t,Y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,it)),n.__oldAnisotropy=n.anisotropy)}function Un(e,t){if(e.width<=t&&e.height<=t)return e;var n=Math.max(e.width,e.height),r=Math.floor(e.width*t/n),i=Math.floor(e.height*t/n),s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");return o.drawImage(e,0,0,e.width,e.height,0,0,r,i),s}function zn(t,n){if(t.image.length===6)if(t.needsUpdate){t.image.__webglTextureCube||(t.addEventListener("dispose",Ct),t.image.__webglTextureCube=J.createTexture(),p.info.memory.textures++),J.activeTexture(J.TEXTURE0+n),J.bindTexture(J.TEXTURE_CUBE_MAP,t.image.__webglTextureCube),J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,t.flipY);var r=t instanceof e.CompressedTexture,i=[];for(var s=0;s<6;s++)p.autoScaleCubemaps&&!r?i[s]=Un(t.image[s],rt):i[s]=t.image[s];var o=i[0],u=e.Math.isPowerOfTwo(o.width)&&e.Math.isPowerOfTwo(o.height),a=Kn(t.format),f=Kn(t.type);Rn(J.TEXTURE_CUBE_MAP,t,u);for(var s=0;s<6;s++)if(!r)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,a,f,i[s]);else{var l,c=i[s].mipmaps;for(var h=0,d=c.length;h<d;h++)l=c[h],t.format!==e.RGBAFormat?J.compressedTexImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,l.data):J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,a,f,l.data)}t.generateMipmaps&&u&&J.generateMipmap(J.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else J.activeTexture(J.TEXTURE0+n),J.bindTexture(J.TEXTURE_CUBE_MAP,t.image.__webglTextureCube)}function Wn(e,t){J.activeTexture(J.TEXTURE0+t),J.bindTexture(J.TEXTURE_CUBE_MAP,e.__webglTexture)}function Xn(e,t,n){J.bindFramebuffer(J.FRAMEBUFFER,e),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function Vn(e,t){J.bindRenderbuffer(J.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,t.width,t.height),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_STENCIL,t.width,t.height),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,e)):J.renderbufferStorage(J.RENDERBUFFER,J.RGBA4,t.width,t.height)}function $n(t){t instanceof e.WebGLRenderTargetCube?(J.bindTexture(J.TEXTURE_CUBE_MAP,t.__webglTexture),J.generateMipmap(J.TEXTURE_CUBE_MAP),J.bindTexture(J.TEXTURE_CUBE_MAP,null)):(J.bindTexture(J.TEXTURE_2D,t.__webglTexture),J.generateMipmap(J.TEXTURE_2D),J.bindTexture(J.TEXTURE_2D,null))}function Jn(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?J.NEAREST:J.LINEAR}function Kn(t){if(t===e.RepeatWrapping)return J.REPEAT;if(t===e.ClampToEdgeWrapping)return J.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return J.MIRRORED_REPEAT;if(t===e.NearestFilter)return J.NEAREST;if(t===e.NearestMipMapNearestFilter)return J.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return J.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return J.LINEAR;if(t===e.LinearMipMapNearestFilter)return J.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return J.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return J.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return J.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return J.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return J.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return J.BYTE;if(t===e.ShortType)return J.SHORT;if(t===e.UnsignedShortType)return J.UNSIGNED_SHORT;if(t===e.IntType)return J.INT;if(t===e.UnsignedIntType)return J.UNSIGNED_INT;if(t===e.FloatType)return J.FLOAT;if(t===e.AlphaFormat)return J.ALPHA;if(t===e.RGBFormat)return J.RGB;if(t===e.RGBAFormat)return J.RGBA;if(t===e.LuminanceFormat)return J.LUMINANCE;if(t===e.LuminanceAlphaFormat)return J.LUMINANCE_ALPHA;if(t===e.AddEquation)return J.FUNC_ADD;if(t===e.SubtractEquation)return J.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return J.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return J.ZERO;if(t===e.OneFactor)return J.ONE;if(t===e.SrcColorFactor)return J.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return J.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return J.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return J.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return J.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return J.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return J.DST_COLOR;if(t===e.OneMinusDstColorFactor)return J.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return J.SRC_ALPHA_SATURATE;if(Z!==undefined){if(t===e.RGB_S3TC_DXT1_Format)return Z.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return Z.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return Z.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return Z.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Qn(t){if(ot&&t&&t.useVertexTexture)return 1024;var n=J.getParameter(J.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((n-20)/4),i=r;return t!==undefined&&t instanceof e.SkinnedMesh&&(i=Math.min(t.bones.length,i),i<t.bones.length&&console.warn("WebGLRenderer: too many bones - "+t.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function Gn(t){var n=0,r=0,i=0,s=0;for(var o=0,u=t.length;o<u;o++){var a=t[o];if(a.onlyShadow||a.visible===!1)continue;a instanceof e.DirectionalLight&&n++,a instanceof e.PointLight&&r++,a instanceof e.SpotLight&&i++,a instanceof e.HemisphereLight&&s++}return{directional:n,point:r,spot:i,hemi:s}}function Yn(t){var n=0;for(var r=0,i=t.length;r<i;r++){var s=t[r];if(!s.castShadow)continue;s instanceof e.SpotLight&&n++,s instanceof e.DirectionalLight&&!s.shadowCascade&&n++}return n}function Zn(){try{var e={alpha:o,premultipliedAlpha:u,antialias:a,stencil:f,preserveDrawingBuffer:l};J=r||n.getContext("webgl",e)||n.getContext("experimental-webgl",e);if(J===null)throw"Error creating WebGL context."}catch(t){console.error(t)}K=J.getExtension("OES_texture_float"),Q=J.getExtension("OES_texture_float_linear"),G=J.getExtension("OES_standard_derivatives"),Y=J.getExtension("EXT_texture_filter_anisotropic")||J.getExtension("MOZ_EXT_texture_filter_anisotropic")||J.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Z=J.getExtension("WEBGL_compressed_texture_s3tc")||J.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||J.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),K||console.log("THREE.WebGLRenderer: Float textures not supported."),G||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Y||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Z||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),J.getShaderPrecisionFormat===undefined&&(J.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function er(){J.clearColor(0,0,0,1),J.clearDepth(1),J.clearStencil(0),J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL),J.frontFace(J.CCW),J.cullFace(J.BACK),J.enable(J.CULL_FACE),J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),J.viewport(P,H,B,j),J.clearColor(c.r,c.g,c.b,h)}console.log("THREE.WebGLRenderer",e.REVISION),t=t||{};var n=t.canvas!==undefined?t.canvas:document.createElement("canvas"),r=t.context!==undefined?t.context:null,i=t.precision!==undefined?t.precision:"highp",s={},o=t.alpha!==undefined?t.alpha:!1,u=t.premultipliedAlpha!==undefined?t.premultipliedAlpha:!0,a=t.antialias!==undefined?t.antialias:!1,f=t.stencil!==undefined?t.stencil:!0,l=t.preserveDrawingBuffer!==undefined?t.preserveDrawingBuffer:!1,c=new e.Color(0),h=0;this.domElement=n,this.context=null,this.devicePixelRatio=t.devicePixelRatio!==undefined?t.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var p=this,d=[],v=0,m=null,g=null,y=-1,b=null,w=null,E=0,S=-1,x=-1,T=-1,N=-1,C=-1,k=-1,L=-1,A=-1,O=null,M=null,_=null,D=null,P=0,H=0,B=n.width,j=n.height,F=0,I=0,q=new Uint8Array(16),R=new e.Frustum,U=new e.Matrix4,z=new e.Matrix4,W=new e.Vector3,X=new e.Vector3,V=!0,$={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},J,K,Q,G,Y,Z;Zn(),er(),this.context=J;var et=J.getParameter(J.MAX_TEXTURE_IMAGE_UNITS),tt=J.getParameter(J.MAX_VERTEX_TEXTURE_IMAGE_UNITS),nt=J.getParameter(J.MAX_TEXTURE_SIZE),rt=J.getParameter(J.MAX_CUBE_MAP_TEXTURE_SIZE),it=Y?J.getParameter(Y.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,st=tt>0,ot=st&&K,ut=Z?J.getParameter(J.COMPRESSED_TEXTURE_FORMATS):[],at=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.HIGH_FLOAT),ft=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.MEDIUM_FLOAT),lt=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.LOW_FLOAT),ct=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.HIGH_FLOAT),ht=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.MEDIUM_FLOAT),pt=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.LOW_FLOAT),dt=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.HIGH_INT),vt=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.MEDIUM_INT),mt=J.getShaderPrecisionFormat(J.VERTEX_SHADER,J.LOW_INT),gt=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.HIGH_INT),yt=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.MEDIUM_INT),bt=J.getShaderPrecisionFormat(J.FRAGMENT_SHADER,J.LOW_INT),wt=at.precision>0&&ct.precision>0,Et=ft.precision>0&&ht.precision>0;i==="highp"&&!wt&&(Et?(i="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(i="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),i==="mediump"&&!Et&&(i="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return J},this.supportsVertexTextures=function(){return st},this.supportsFloatTextures=function(){return K},this.supportsStandardDerivatives=function(){return G},this.supportsCompressedTextureS3TC=function(){return Z},this.getMaxAnisotropy=function(){return it},this.getPrecision=function(){return i},this.setSize=function(e,t,r){n.width=e*this.devicePixelRatio,n.height=t*this.devicePixelRatio,this.devicePixelRatio!==1&&r!==!1&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){P=e*this.devicePixelRatio,H=t*this.devicePixelRatio,B=n*this.devicePixelRatio,j=r*this.devicePixelRatio,J.viewport(P,H,B,j)},this.setScissor=function(e,t,n,r){J.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(e){e?J.enable(J.SCISSOR_TEST):J.disable(J.SCISSOR_TEST)},this.setClearColor=function(e,t){c.set(e),h=t!==undefined?t:1,J.clearColor(c.r,c.g,c.b,h)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return c},this.getClearAlpha=function(){return h},this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=J.COLOR_BUFFER_BIT;if(t===undefined||t)r|=J.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=J.STENCIL_BUFFER_BIT;J.clear(r)},this.clearColor=function(){J.clear(J.COLOR_BUFFER_BIT)},this.clearDepth=function(){J.clear(J.DEPTH_BUFFER_BIT)},this.clearStencil=function(){J.clear(J.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){m=null,T=-1,L=-1,A=-1,b=-1,y=-1,V=!0,S=-1,x=-1,this.shadowMapPlugin.update(e,t)};var Nt=function(e){var t=e.target;t.removeEventListener("dispose",Nt),Ot(t)},Ct=function(e){var t=e.target;t.removeEventListener("dispose",Ct),Mt(t),p.info.memory.textures--},kt=function(e){var t=e.target;t.removeEventListener("dispose",kt),_t(t),p.info.memory.textures--},Lt=function(e){var t=e.target;t.removeEventListener("dispose",Lt),Dt(t)},At=function(e){e.__webglVertexBuffer!==undefined&&J.deleteBuffer(e.__webglVertexBuffer),e.__webglNormalBuffer!==undefined&&J.deleteBuffer(e.__webglNormalBuffer),e.__webglTangentBuffer!==undefined&&J.deleteBuffer(e.__webglTangentBuffer),e.__webglColorBuffer!==undefined&&J.deleteBuffer(e.__webglColorBuffer),e.__webglUVBuffer!==undefined&&J.deleteBuffer(e.__webglUVBuffer),e.__webglUV2Buffer!==undefined&&J.deleteBuffer(e.__webglUV2Buffer),e.__webglSkinIndicesBuffer!==undefined&&J.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinWeightsBuffer!==undefined&&J.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglFaceBuffer!==undefined&&J.deleteBuffer(e.__webglFaceBuffer),e.__webglLineBuffer!==undefined&&J.deleteBuffer(e.__webglLineBuffer),e.__webglLineDistanceBuffer!==undefined&&J.deleteBuffer(e.__webglLineDistanceBuffer);if(e.__webglCustomAttributesList!==undefined)for(var t in e.__webglCustomAttributesList)J.deleteBuffer(e.__webglCustomAttributesList[t].buffer);p.info.memory.geometries--},Ot=function(t){t.__webglInit=undefined;if(t instanceof e.BufferGeometry){var n=t.attributes;for(var r in n)n[r].buffer!==undefined&&J.deleteBuffer(n[r].buffer);p.info.memory.geometries--}else if(t.geometryGroups!==undefined)for(var i in t.geometryGroups){var s=t.geometryGroups[i];if(s.numMorphTargets!==undefined)for(var o=0,u=s.numMorphTargets;o<u;o++)J.deleteBuffer(s.__webglMorphTargetsBuffers[o]);if(s.numMorphNormals!==undefined)for(var o=0,u=s.numMorphNormals;o<u;o++)J.deleteBuffer(s.__webglMorphNormalsBuffers[o]);At(s)}else At(t)},Mt=function(e){if(e.image&&e.image.__webglTextureCube)J.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,J.deleteTexture(e.__webglTexture)}},_t=function(t){if(!t||!t.__webglTexture)return;J.deleteTexture(t.__webglTexture);if(t instanceof e.WebGLRenderTargetCube)for(var n=0;n<6;n++)J.deleteFramebuffer(t.__webglFramebuffer[n]),J.deleteRenderbuffer(t.__webglRenderbuffer[n]);else J.deleteFramebuffer(t.__webglFramebuffer),J.deleteRenderbuffer(t.__webglRenderbuffer)},Dt=function(e){var t=e.program;if(t===undefined)return;e.program=undefined;var n,r,i,s=!1;for(n=0,r=d.length;n<r;n++){i=d[n];if(i.program===t){i.usedTimes--,i.usedTimes===0&&(s=!0);break}}if(s===!0){var o=[];for(n=0,r=d.length;n<r;n++)i=d[n],i.program!==t&&o.push(i);d=o,J.deleteProgram(t),p.info.memory.programs--}};this.renderBufferImmediate=function(t,n,r){t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=J.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=J.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=J.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=J.createBuffer()),t.hasPositions&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,t.positionArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(n.attributes.position),J.vertexAttribPointer(n.attributes.position,3,J.FLOAT,!1,0,0));if(t.hasNormals){J.bindBuffer(J.ARRAY_BUFFER,t.__webglNormalBuffer);if(r.shading===e.FlatShading){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=t.count*3;for(g=0;g<y;g+=9)m=t.normalArray,u=m[g],l=m[g+1],p=m[g+2],a=m[g+3],c=m[g+4],d=m[g+5],f=m[g+6],h=m[g+7],v=m[g+8],i=(u+a+f)/3,s=(l+c+h)/3,o=(p+d+v)/3,m[g]=i,m[g+1]=s,m[g+2]=o,m[g+3]=i,m[g+4]=s,m[g+5]=o,m[g+6]=i,m[g+7]=s,m[g+8]=o}J.bufferData(J.ARRAY_BUFFER,t.normalArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(n.attributes.normal),J.vertexAttribPointer(n.attributes.normal,3,J.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglUvBuffer),J.bufferData(J.ARRAY_BUFFER,t.uvArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(n.attributes.uv),J.vertexAttribPointer(n.attributes.uv,2,J.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==e.NoColors&&(J.bindBuffer(J.ARRAY_BUFFER,t.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,t.colorArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(n.attributes.color),J.vertexAttribPointer(n.attributes.color,3,J.FLOAT,!1,0,0)),J.drawArrays(J.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,r,i,s,o){if(i.visible===!1)return;var u,a,f,l,c,h,d,v=mn(t,n,r,i,o),m=v.attributes,g=s.attributes,y=!1,w=i.wireframe?1:0,E=s.id*16777215+v.id*2+w;E!==b&&(b=E,y=!0),y&&Qt();if(o instanceof e.Mesh){var S=g.index;if(S){var x=s.offsets;x.length>1&&(y=!0);for(var T=0,N=x.length;T<N;T++){var C=x[T].index;if(y){for(c in m)h=m[c],l=g[c],h>=0&&(l?(d=l.itemSize,J.bindBuffer(J.ARRAY_BUFFER,l.buffer),Kt(h),J.vertexAttribPointer(h,d,J.FLOAT,!1,0,C*d*4)):i.defaultAttributeValues&&(i.defaultAttributeValues[c].length===2?J.vertexAttrib2fv(h,i.defaultAttributeValues[c]):i.defaultAttributeValues[c].length===3&&J.vertexAttrib3fv(h,i.defaultAttributeValues[c])));J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,S.buffer)}J.drawElements(J.TRIANGLES,x[T].count,J.UNSIGNED_SHORT,x[T].start*2),p.info.render.calls++,p.info.render.vertices+=x[T].count,p.info.render.faces+=x[T].count/3}}else{if(y)for(c in m){if(c==="index")continue;h=m[c],l=g[c],h>=0&&(l?(d=l.itemSize,J.bindBuffer(J.ARRAY_BUFFER,l.buffer),Kt(h),J.vertexAttribPointer(h,d,J.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[c]&&(i.defaultAttributeValues[c].length===2?J.vertexAttrib2fv(h,i.defaultAttributeValues[c]):i.defaultAttributeValues[c].length===3&&J.vertexAttrib3fv(h,i.defaultAttributeValues[c])))}var k=s.attributes.position;J.drawArrays(J.TRIANGLES,0,k.array.length/3),p.info.render.calls++,p.info.render.vertices+=k.array.length/3,p.info.render.faces+=k.array.length/3/3}}else if(o instanceof e.ParticleSystem){if(y)for(c in m)h=m[c],l=g[c],h>=0&&(l?(d=l.itemSize,J.bindBuffer(J.ARRAY_BUFFER,l.buffer),Kt(h),J.vertexAttribPointer(h,d,J.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[c]&&(i.defaultAttributeValues[c].length===2?J.vertexAttrib2fv(h,i.defaultAttributeValues[c]):i.defaultAttributeValues[c].length===3&&J.vertexAttrib3fv(h,i.defaultAttributeValues[c])));var k=g.position;J.drawArrays(J.POINTS,0,k.array.length/3),p.info.render.calls++,p.info.render.points+=k.array.length/3}else if(o instanceof e.Line){var L=o.type===e.LineStrip?J.LINE_STRIP:J.LINES;Dn(i.linewidth);var S=g.index;if(S){var x=s.offsets;x.length>1&&(y=!0);for(var T=0,N=x.length;T<N;T++){var C=x[T].index;y&&($t(i,m,g,C),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,S.buffer)),J.drawElements(J.LINES,x[T].count,J.UNSIGNED_SHORT,x[T].start*2),p.info.render.calls++,p.info.render.vertices+=x[T].count}}else{y&&$t(i,m,g,0);var k=g.position;J.drawArrays(L,0,k.array.length/3),p.info.render.calls++,p.info.render.points+=k.array.length}}},this.renderBuffer=function(t,n,r,i,s,o){if(i.visible===!1)return;var u,a,f,l,c,h=mn(t,n,r,i,o),d=h.attributes,v=!1,m=i.wireframe?1:0,g=s.id*16777215+h.id*2+m;g!==b&&(b=g,v=!0),v&&Qt(),!i.morphTargets&&d.position>=0?v&&(J.bindBuffer(J.ARRAY_BUFFER,s.__webglVertexBuffer),Kt(d.position),J.vertexAttribPointer(d.position,3,J.FLOAT,!1,0,0)):o.morphTargetBase&&Gt(i,s,o);if(v){if(s.__webglCustomAttributesList)for(l=0,c=s.__webglCustomAttributesList.length;l<c;l++)f=s.__webglCustomAttributesList[l],d[f.buffer.belongsToAttribute]>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.buffer),Kt(d[f.buffer.belongsToAttribute]),J.vertexAttribPointer(d[f.buffer.belongsToAttribute],f.size,J.FLOAT,!1,0,0));d.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(J.bindBuffer(J.ARRAY_BUFFER,s.__webglColorBuffer),Kt(d.color),J.vertexAttribPointer(d.color,3,J.FLOAT,!1,0,0)):i.defaultAttributeValues&&J.vertexAttrib3fv(d.color,i.defaultAttributeValues.color)),d.normal>=0&&(J.bindBuffer(J.ARRAY_BUFFER,s.__webglNormalBuffer),Kt(d.normal),J.vertexAttribPointer(d.normal,3,J.FLOAT,!1,0,0)),d.tangent>=0&&(J.bindBuffer(J.ARRAY_BUFFER,s.__webglTangentBuffer),Kt(d.tangent),J.vertexAttribPointer(d.tangent,4,J.FLOAT,!1,0,0)),d.uv>=0&&(o.geometry.faceVertexUvs[0]?(J.bindBuffer(J.ARRAY_BUFFER,s.__webglUVBuffer),Kt(d.uv),J.vertexAttribPointer(d.uv,2,J.FLOAT,!1,0,0)):i.defaultAttributeValues&&J.vertexAttrib2fv(d.uv,i.defaultAttributeValues.uv)),d.uv2>=0&&(o.geometry.faceVertexUvs[1]?(J.bindBuffer(J.ARRAY_BUFFER,s.__webglUV2Buffer),Kt(d.uv2),J.vertexAttribPointer(d.uv2,2,J.FLOAT,!1,0,0)):i.defaultAttributeValues&&J.vertexAttrib2fv(d.uv2,i.defaultAttributeValues.uv2)),i.skinning&&d.skinIndex>=0&&d.skinWeight>=0&&(J.bindBuffer(J.ARRAY_BUFFER,s.__webglSkinIndicesBuffer),Kt(d.skinIndex),J.vertexAttribPointer(d.skinIndex,4,J.FLOAT,!1,0,0),J.bindBuffer(J.ARRAY_BUFFER,s.__webglSkinWeightsBuffer),Kt(d.skinWeight),J.vertexAttribPointer(d.skinWeight,4,J.FLOAT,!1,0,0)),d.lineDistance>=0&&(J.bindBuffer(J.ARRAY_BUFFER,s.__webglLineDistanceBuffer),Kt(d.lineDistance),J.vertexAttribPointer(d.lineDistance,1,J.FLOAT,!1,0,0))}if(o instanceof e.Mesh)i.wireframe?(Dn(i.wireframeLinewidth),v&&J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),J.drawElements(J.LINES,s.__webglLineCount,J.UNSIGNED_SHORT,0)):(v&&J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),J.drawElements(J.TRIANGLES,s.__webglFaceCount,J.UNSIGNED_SHORT,0)),p.info.render.calls++,p.info.render.vertices+=s.__webglFaceCount,p.info.render.faces+=s.__webglFaceCount/3;else if(o instanceof e.Line){var y=o.type===e.LineStrip?J.LINE_STRIP:J.LINES;Dn(i.linewidth),J.drawArrays(y,0,s.__webglLineCount),p.info.render.calls++}else o instanceof e.ParticleSystem&&(J.drawArrays(J.POINTS,0,s.__webglParticleCount),p.info.render.calls++,p.info.render.points+=s.__webglParticleCount)},this.render=function(t,n,r,i){if(n instanceof e.Camera==0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var s,o,u,a,f,l=t.__lights,c=t.fog;y=-1,V=!0,t.autoUpdate===!0&&t.updateMatrixWorld(),n.parent===undefined&&n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),U.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),R.setFromMatrix(U),this.autoUpdateObjects&&this.initWebGLObjects(t),en(this.renderPluginsPre,t,n),p.info.render.calls=0,p.info.render.vertices=0,p.info.render.faces=0,p.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),f=t.__webglObjects;for(s=0,o=f.length;s<o;s++)u=f[s],a=u.object,u.id=s,u.render=!1,a.visible&&(!(a instanceof e.Mesh||a instanceof e.ParticleSystem)||!a.frustumCulled||R.intersectsObject(a))&&(An(a,n),sn(u),u.render=!0,this.sortObjects===!0&&(a.renderDepth!==null?u.z=a.renderDepth:(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(U),u.z=W.z)));this.sortObjects&&f.sort(Yt),f=t.__webglObjectsImmediate;for(s=0,o=f.length;s<o;s++)u=f[s],a=u.object,a.visible&&(An(a,n),rn(u));if(t.overrideMaterial){var h=t.overrideMaterial;this.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),this.setDepthTest(h.depthTest),this.setDepthWrite(h.depthWrite),Pn(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits),tn(t.__webglObjects,!1,"",n,l,c,!0,h),nn(t.__webglObjectsImmediate,"",n,l,c,!1,h)}else{var h=null;this.setBlending(e.NoBlending),tn(t.__webglObjects,!0,"opaque",n,l,c,!1,h),nn(t.__webglObjectsImmediate,"opaque",n,l,c,!1,h),tn(t.__webglObjects,!1,"transparent",n,l,c,!0,h),nn(t.__webglObjectsImmediate,"transparent",n,l,c,!0,h)}en(this.renderPluginsPost,t,n),r&&r.generateMipmaps&&r.minFilter!==e.NearestFilter&&r.minFilter!==e.LinearFilter&&$n(r),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,n,r,i){var s=mn(e,t,n,r,i);b=-1,p.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,J,R):i.render(function(e){p.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);while(e.__objectsAdded.length)on(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);while(e.__objectsRemoved.length)hn(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,n=e.__webglObjects.length;t<n;t++){var r=e.__webglObjects[t].object;r.__webglInit===undefined&&(r.__webglActive!==undefined&&hn(r,e),on(r,e)),fn(r)}},this.initMaterial=function(t,n,r,i){t.addEventListener("dispose",Lt);var s,o,u,a,f,l,c,h,p;t instanceof e.MeshDepthMaterial?p="depth":t instanceof e.MeshNormalMaterial?p="normal":t instanceof e.MeshBasicMaterial?p="basic":t instanceof e.MeshLambertMaterial?p="lambert":t instanceof e.MeshPhongMaterial?p="phong":t instanceof e.LineBasicMaterial?p="basic":t instanceof e.LineDashedMaterial?p="dashed":t instanceof e.ParticleSystemMaterial&&(p="particle_basic"),p&&vn(t,e.ShaderLib[p]),l=Gn(n),h=Yn(n),c=Qn(i),f={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,vertexColors:t.vertexColors,fog:r,useFog:t.fog,fogExp:r instanceof e.FogExp2,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,maxBones:c,useVertexTexture:ot&&i&&i.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow&&h>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},t.program=Bn(p,t.fragmentShader,t.vertexShader,t.uniforms,t.attributes,t.defines,f,t.index0AttributeName);var d=t.program.attributes;if(t.morphTargets){t.numSupportedMorphTargets=0;var v,m="morphTarget";for(a=0;a<this.maxMorphTargets;a++)v=m+a,d[v]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;var v,m="morphNormal";for(a=0;a<this.maxMorphNormals;a++)v=m+a,d[v]>=0&&t.numSupportedMorphNormals++}t.uniformsList=[];for(s in t.uniforms)t.uniformsList.push([t.uniforms[s],s])},this.setFaceCulling=function(t,n){t===e.CullFaceNone?J.disable(J.CULL_FACE):(n===e.FrontFaceDirectionCW?J.frontFace(J.CW):J.frontFace(J.CCW),t===e.CullFaceBack?J.cullFace(J.BACK):t===e.CullFaceFront?J.cullFace(J.FRONT):J.cullFace(J.FRONT_AND_BACK),J.enable(J.CULL_FACE))},this.setMaterialFaces=function(t){var n=t.side===e.DoubleSide,r=t.side===e.BackSide;S!==n&&(n?J.disable(J.CULL_FACE):J.enable(J.CULL_FACE),S=n),x!==r&&(r?J.frontFace(J.CW):J.frontFace(J.CCW),x=r)},this.setDepthTest=function(e){L!==e&&(e?J.enable(J.DEPTH_TEST):J.disable(J.DEPTH_TEST),L=e)},this.setDepthWrite=function(e){A!==e&&(J.depthMask(e),A=e)},this.setBlending=function(t,n,r,i){t!==T&&(t===e.NoBlending?J.disable(J.BLEND):t===e.AdditiveBlending?(J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.SRC_ALPHA,J.ONE)):t===e.SubtractiveBlending?(J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.ZERO,J.ONE_MINUS_SRC_COLOR)):t===e.MultiplyBlending?(J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.ZERO,J.SRC_COLOR)):t===e.CustomBlending?J.enable(J.BLEND):(J.enable(J.BLEND),J.blendEquationSeparate(J.FUNC_ADD,J.FUNC_ADD),J.blendFuncSeparate(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA,J.ONE,J.ONE_MINUS_SRC_ALPHA)),T=t);if(t===e.CustomBlending){n!==N&&(J.blendEquation(Kn(n)),N=n);if(r!==C||i!==k)J.blendFunc(Kn(r),Kn(i)),C=r,k=i}else N=null,C=null,k=null},this.setTexture=function(t,n){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",Ct),t.__webglTexture=J.createTexture(),p.info.memory.textures++),J.activeTexture(J.TEXTURE0+n),J.bindTexture(J.TEXTURE_2D,t.__webglTexture),J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,t.flipY),J.pixelStorei(J.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),J.pixelStorei(J.UNPACK_ALIGNMENT,t.unpackAlignment);var r=t.image,i=e.Math.isPowerOfTwo(r.width)&&e.Math.isPowerOfTwo(r.height),s=Kn(t.format),o=Kn(t.type);Rn(J.TEXTURE_2D,t,i);var u,a=t.mipmaps;if(t instanceof e.DataTexture)if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],J.texImage2D(J.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);t.generateMipmaps=!1}else J.texImage2D(J.TEXTURE_2D,0,s,r.width,r.height,0,s,o,r.data);else if(t instanceof e.CompressedTexture)for(var f=0,l=a.length;f<l;f++)u=a[f],t.format!==e.RGBAFormat?J.compressedTexImage2D(J.TEXTURE_2D,f,s,u.width,u.height,0,u.data):J.texImage2D(J.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);else if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],J.texImage2D(J.TEXTURE_2D,f,s,s,o,u);t.generateMipmaps=!1}else J.texImage2D(J.TEXTURE_2D,0,s,s,o,t.image);t.generateMipmaps&&i&&J.generateMipmap(J.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else J.activeTexture(J.TEXTURE0+n),J.bindTexture(J.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var n=t instanceof e.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){t.depthBuffer===undefined&&(t.depthBuffer=!0),t.stencilBuffer===undefined&&(t.stencilBuffer=!0),t.addEventListener("dispose",kt),t.__webglTexture=J.createTexture(),p.info.memory.textures++;var r=e.Math.isPowerOfTwo(t.width)&&e.Math.isPowerOfTwo(t.height),i=Kn(t.format),s=Kn(t.type);if(n){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],J.bindTexture(J.TEXTURE_CUBE_MAP,t.__webglTexture),Rn(J.TEXTURE_CUBE_MAP,t,r);for(var o=0;o<6;o++)t.__webglFramebuffer[o]=J.createFramebuffer(),t.__webglRenderbuffer[o]=J.createRenderbuffer(),J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,t.width,t.height,0,i,s,null),Xn(t.__webglFramebuffer[o],t,J.TEXTURE_CUBE_MAP_POSITIVE_X+o),Vn(t.__webglRenderbuffer[o],t);r&&J.generateMipmap(J.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=J.createFramebuffer(),t.shareDepthFrom?t.__webglRenderbuffer=t.shareDepthFrom.__webglRenderbuffer:t.__webglRenderbuffer=J.createRenderbuffer(),J.bindTexture(J.TEXTURE_2D,t.__webglTexture),Rn(J.TEXTURE_2D,t,r),J.texImage2D(J.TEXTURE_2D,0,i,t.width,t.height,0,i,s,null),Xn(t.__webglFramebuffer,t,J.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,t.__webglRenderbuffer):Vn(t.__webglRenderbuffer,t),r&&J.generateMipmap(J.TEXTURE_2D);n?J.bindTexture(J.TEXTURE_CUBE_MAP,null):J.bindTexture(J.TEXTURE_2D,null),J.bindRenderbuffer(J.RENDERBUFFER,null),J.bindFramebuffer(J.FRAMEBUFFER,null)}var u,a,f,l,c;t?(n?u=t.__webglFramebuffer[t.activeCubeFace]:u=t.__webglFramebuffer,a=t.width,f=t.height,l=0,c=0):(u=null,a=B,f=j,l=P,c=H),u!==g&&(J.bindFramebuffer(J.FRAMEBUFFER,u),J.viewport(l,c,a,f),g=u),F=a,I=f},this.shadowMapPlugin=new e.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new e.SpritePlugin),this.addPostPlugin(new e.LensFlarePlugin)},e.WebGLRenderer}),define("libs/threejs/scenes/Scene",["../Three","../core/Object3D"],function(e,t){return e.Scene=function(){e.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},e.Scene.prototype=Object.create(e.Object3D.prototype),e.Scene.prototype.__addObject=function(t){if(t instanceof e.Light)this.__lights.indexOf(t)===-1&&this.__lights.push(t),t.target&&t.target.parent===undefined&&this.add(t.target);else if(!(t instanceof e.Camera||t instanceof e.Bone)){this.__objectsAdded.push(t);var n=this.__objectsRemoved.indexOf(t);n!==-1&&this.__objectsRemoved.splice(n,1)}this.dispatchEvent({type:"objectAdded",object:t}),t.dispatchEvent({type:"addedToScene",scene:this});for(var r=0;r<t.children.length;r++)this.__addObject(t.children[r])},e.Scene.prototype.__removeObject=function(t){if(t instanceof e.Light){var n=this.__lights.indexOf(t);n!==-1&&this.__lights.splice(n,1);if(t.shadowCascadeArray)for(var r=0;r<t.shadowCascadeArray.length;r++)this.__removeObject(t.shadowCascadeArray[r])}else if(!(t instanceof e.Camera)){this.__objectsRemoved.push(t);var n=this.__objectsAdded.indexOf(t);n!==-1&&this.__objectsAdded.splice(n,1)}this.dispatchEvent({type:"objectRemoved",object:t}),t.dispatchEvent({type:"removedFromScene",scene:this});for(var i=0;i<t.children.length;i++)this.__removeObject(t.children[i])},e.Scene.prototype.clone=function(t){return t===undefined&&(t=new e.Scene),e.Object3D.prototype.clone.call(this,t),this.fog!==null&&(t.fog=this.fog.clone()),this.overrideMaterial!==null&&(t.overrideMaterial=this.overrideMaterial.clone()),t.autoUpdate=this.autoUpdate,t.matrixAutoUpdate=this.matrixAutoUpdate,t},e.Scene}),define("libs/threejs/core/Face3",["../Three","../math/Vector3","../math/Color"],function(e,t,n){return e.Face3=function(t,n,r,i,s,o){this.a=t,this.b=n,this.c=r,this.normal=i instanceof e.Vector3?i:new e.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof e.Color?s:new e.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o!==undefined?o:0,this.centroid=new e.Vector3},e.Face3.prototype={constructor:e.Face3,clone:function(){var t=new e.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var n,r;for(n=0,r=this.vertexNormals.length;n<r;n++)t.vertexNormals[n]=this.vertexNormals[n].clone();for(n=0,r=this.vertexColors.length;n<r;n++)t.vertexColors[n]=this.vertexColors[n].clone();for(n=0,r=this.vertexTangents.length;n<r;n++)t.vertexTangents[n]=this.vertexTangents[n].clone();return t}},e.Face3}),define("libs/threejs/extras/geometries/PlaneGeometry",["../../Three","../../core/Geometry","../../core/Face3","../../math/Vector2","../../math/Vector3"],function(e,t,n,r,i){return e.PlaneGeometry=function(t,n,r,i){e.Geometry.call(this),this.width=t,this.height=n,this.widthSegments=r||1,this.heightSegments=i||1;var s,o,u=t/2,a=n/2,f=this.widthSegments,l=this.heightSegments,c=f+1,h=l+1,p=this.width/f,d=this.height/l,v=new e.Vector3(0,0,1);for(o=0;o<h;o++)for(s=0;s<c;s++){var m=s*p-u,g=o*d-a;this.vertices.push(new e.Vector3(m,-g,0))}for(o=0;o<l;o++)for(s=0;s<f;s++){var y=s+c*o,b=s+c*(o+1),w=s+1+c*(o+1),E=s+1+c*o,S=new e.Vector2(s/f,1-o/l),x=new e.Vector2(s/f,1-(o+1)/l),T=new e.Vector2((s+1)/f,1-(o+1)/l),N=new e.Vector2((s+1)/f,1-o/l),C=new e.Face3(y,b,E);C.normal.copy(v),C.vertexNormals.push(v.clone(),v.clone(),v.clone()),this.faces.push(C),this.faceVertexUvs[0].push([S,x,N]),C=new e.Face3(b,w,E),C.normal.copy(v),C.vertexNormals.push(v.clone(),v.clone(),v.clone()),this.faces.push(C),this.faceVertexUvs[0].push([x.clone(),T,N.clone()])}this.computeCentroids()},e.PlaneGeometry.prototype=Object.create(e.Geometry.prototype),e.PlaneGeometry}),define("libs/threejs/extras/geometries/PolyhedronGeometry",["../../Three","../../core/Geometry","../../math/Vector2","../../core/Face3","../../math/Vector3","../../math/Sphere"],function(e,t,n,r,i,s){return e.PolyhedronGeometry=function(t,n,r,i){function w(t){var n=t.normalize().clone();n.index=s.vertices.push(n)-1;var r=x(t)/2/Math.PI+.5,i=T(t)/Math.PI+.5;return n.uv=new e.Vector2(r,1-i),n}function E(t,n,r){var i=new e.Face3(t.index,n.index,r.index,[t.clone(),n.clone(),r.clone()]);i.centroid.add(t).add(n).add(r).divideScalar(3),s.faces.push(i);var o=x(i.centroid);s.faceVertexUvs[0].push([N(t.uv,t,o),N(n.uv,n,o),N(r.uv,r,o)])}function S(e,t){var n=Math.pow(2,t),r=Math.pow(4,t),i=w(s.vertices[e.a]),o=w(s.vertices[e.b]),u=w(s.vertices[e.c]),a=[];for(var f=0;f<=n;f++){a[f]=[];var l=w(i.clone().lerp(u,f/n)),c=w(o.clone().lerp(u,f/n)),h=n-f;for(var p=0;p<=h;p++)p==0&&f==n?a[f][p]=l:a[f][p]=w(l.clone().lerp(c,p/h))}for(var f=0;f<n;f++)for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);p%2==0?E(a[f][d+1],a[f+1][d],a[f][d]):E(a[f][d+1],a[f+1][d+1],a[f+1][d])}}function x(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function N(t,n,r){return r<0&&t.x===1&&(t=new e.Vector2(t.x-1,t.y)),n.x===0&&n.z===0&&(t=new e.Vector2(r/2/Math.PI+.5,t.y)),t.clone()}e.Geometry.call(this),r=r||1,i=i||0;var s=this;for(var o=0,u=t.length;o<u;o++)w(new e.Vector3(t[o][0],t[o][1],t[o][2]));var a=[],f=this.vertices,l=[];for(var o=0,u=n.length;o<u;o++){var c=f[n[o][0]],h=f[n[o][1]],p=f[n[o][2]];l[o]=new e.Face3(c.index,h.index,p.index,[c.clone(),h.clone(),p.clone()])}for(var o=0,u=l.length;o<u;o++)S(l[o],i);for(var o=0,u=this.faceVertexUvs[0].length;o<u;o++){var d=this.faceVertexUvs[0][o],v=d[0].x,m=d[1].x,g=d[2].x,y=Math.max(v,Math.max(m,g)),b=Math.min(v,Math.min(m,g));y>.9&&b<.1&&(v<.2&&(d[0].x+=1),m<.2&&(d[1].x+=1),g<.2&&(d[2].x+=1))}for(var o=0,u=this.vertices.length;o<u;o++)this.vertices[o].multiplyScalar(r);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,r)},e.PolyhedronGeometry.prototype=Object.create(e.Geometry.prototype),e.PolyhedronGeometry}),define("libs/threejs/extras/geometries/OctahedronGeometry",["../../Three","../../core/Geometry","./PolyhedronGeometry"],function(e,t,n){return e.OctahedronGeometry=function(t,n){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];e.PolyhedronGeometry.call(this,r,i,t,n)},e.OctahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.OctahedronGeometry}),define("THREE",["libs/threejs/Three","text!shaders/noises/snoise2d.glsl","libs/threejs/renderers/shaders/ShaderChunk","libs/threejs/cameras/OrthographicCamera","libs/threejs/objects/Mesh","libs/threejs/renderers/WebGLRenderer","libs/threejs/scenes/Scene","libs/threejs/extras/geometries/PlaneGeometry","libs/threejs/extras/geometries/OctahedronGeometry"],function(THREE,noise2dShader){function _evalReplace(str,scopeVariables){for(var i in scopeVariables)eval("var "+i+'=scopeVariables["'+i+'"]');return str.replace(EVAL_REGEX,function(a,b){return eval(b)})}var EVAL_REGEX=/\/\*EVAL (.+)\*\//g;return THREE.ShaderChunk.snoise2d=noise2dShader,THREE._evalReplace=_evalReplace,THREE||window.THREE}),define("scene3d/stepCircle",["exports","config","text!shaders/stepCircle/vertex.glsl","text!shaders/stepCircle/fragment.glsl","THREE"],function(e,t,n,r,i){function o(){u(),a()}function u(){e.uniforms={amountPerDegree:{type:"f",value:t.STEP_CIRCLE_PARTICLE_AMOUNT_PER_DEGREE},time:{type:"f",value:0},extraTime:{type:"f",value:0},animationRatio:{type:"f",value:0},focusRatio:{type:"f",value:0},opacity:{type:"f",value:1},fading:{type:"f",value:0},dpi:{type:"f",value:window.devicePixelRatio||1},stepTimes:{type:"v4",value:new i.Vector4(0,0,0,0)},stepExtraTimes:{type:"v4",value:new i.Vector4(0,0,0,0)}},e.material=new i.ShaderMaterial({uniforms:e.uniforms,vertexShader:n,fragmentShader:r,blending:i.AdditiveBlending,transparent:!0,depthTest:!1})}function a(){var n=e.geometry=new i.Geometry,r=n.vertices,s=t.STEP_CIRCLE_PARTICLE_AMOUNT_PER_DEGREE,o=s*360,u,a;for(var f=0;f<o;f++)a=f/180*Math.PI,u=1+~~(f/o*s)/s,r.push(new i.Vector3(Math.sin(a)*u,Math.cos(a)*u,0));e.particles=new i.ParticleSystem(n,e.material)}function f(){var t=this.uniforms,n=t.animationRatio.value-2|0,r=t.animationRatio.value-e.currentStep,i=t.time.value+=.01,s=t.stepTimes.value;n==0&&(s.x+=.01),n==1&&(s.y+=.01),n==2&&(s.z+=.01),n==3&&(s.w+=.01),e.currentStep=n}var s;e.offsetLeft=0,e.offsetTop=35,e.currentStep=0,n=i._evalReplace(n,{THREE:i}),r=i._evalReplace(r,{THREE:i}),e.init=o,e.updateStepTimes=f}),define("ui/preloader",["exports","config","jquery","uiController","preloaderController","trackingController","scene3d/stepCircle","EKTweener"],function(e,t,n,r,i,s,o,u){function p(){d(),v(),g()}function d(){f=n(".preloader-text-line")}function v(){i.onLoading.add(m)}function m(e){u.to(o.uniforms.fading,t.SKIP_PRELOADER?0:1,{value:1,ease:"easeInSine"}),u.to(o.uniforms.animationRatio,t.SKIP_PRELOADER?0:10,{value:1,ease:"easeInSine",onComplete:function(){e===1&&(h++,b())}})}function g(){s.trackPage({trackPage:"loader"}),a.show(),u.to(f[0],t.SKIP_PRELOADER?0:2,{opacity:.5,ease:"linear"}),u.to(f[1],t.SKIP_PRELOADER?0:2,{delay:t.SKIP_PRELOADER?0:2,opacity:.5,ease:"linear",onComplete:function(){setTimeout(function(){y()},t.SKIP_PRELOADER?0:2500)}})}function y(){u.to(f[0],t.SKIP_PRELOADER?0:1,{opacity:0,ease:"linear"}),u.to(f[1],t.SKIP_PRELOADER?0:1,{opacity:0,ease:"linear",onComplete:function(){f[0].style.display=f[1].style.display="none",u.to(f[2],t.SKIP_PRELOADER?0:2,{opacity:.5,ease:"linear"}),u.to(f[3],t.SKIP_PRELOADER?0:2,{delay:t.SKIP_PRELOADER?0:2,opacity:.5,ease:"linear",onComplete:function(){setTimeout(function(){h++,b()},t.SKIP_PRELOADER?0:2500)}})}})}function b(){if(h!==2)return;u.to(f[2],t.SKIP_PRELOADER?0:1,{opacity:0,ease:"linear"}),u.to(f[3],t.SKIP_PRELOADER?0:1,{opacity:0,ease:"linear",onComplete:function(){r._appInitFunc(),a.hide()}})}var a=n(".preloader"),f,l,c=.05,h=0;e.init=p}),define("ui/header",["exports","config","jquery","preloaderController","EKTweener"],function(e,t,n,r,i){function g(){a=n(".header-description, .header-fade-container"),r.add(o)}function y(){b(),w(),E()}function b(){n(".header-logo").remove(),f=document.createElement("canvas"),f.className="header-logo";if(v)for(var e in m)m[e]*=2;f.width=m.width,f.height=m.height,l=f.getContext("2d"),h=t.uiAsset,o.find(".header-content").prepend(f),c=n(".header-fade-percent-num"),c.html(100-t.settings.fading|0)}function w(){}function E(){var e=p.fading/100,t=m.width*e;l.clearRect(0,0,m.width,m.height),l.drawImage(h,m.x,m.y,m.width,m.height,0,0,m.width,m.height),l.save(),l.globalCompositeOperation="source-atop",l.fillStyle="#404040",l.fillRect(t,0,m.width-t,m.height),l.restore()}function S(e){i.to(p,e===s?2:e,{fading:d,onUpdate:E})}function x(){i.fromTo(o,.5,{opacity:0},{opacity:1,ease:"linear"}),o.show(),S()}function T(){i.to(u,1.3,{transform3d:"scale3d(1,1,1)"})}function N(){i.to(u,1.3,{transform3d:"scale3d(1,0,1)"})}function C(e){var n=e*100;e*100!==t.settings.fading&&(i.killTweensOf(p),p.fading=n,l&&E())}function k(e){o.height(e)}var s,o=n(".header"),u=n(".header-bg"),a,f,l,c,h,p={fading:100},d=t.settings.fading,v=t.isRetina,m={x:0,y:356,width:266,height:44};e.preInit=g,e.init=y,e.render=E,e.animateFading=S,e.show=x,e.showBg=T,e.hideBg=N,e.updateFading=C,e.changeHeight=k}),define("soundController",["exports","config","signals","jquery","EKTweener"],function(e,t,n,r,i){function a(){o=new Audio("audio/loop."+(Modernizr.audio.mp3?"mp3":"ogg")),u=new Audio("audio/add."+(Modernizr.audio.mp3?"mp3":"ogg")),o.loop=!0,c(0)}function f(){o.play(),o.readyState&&(o.currentTime=.1)}function l(){u.play()}function c(t){e.isMute=!0,e.onMuteToggled.dispatch(!0),i.to(e,t===s?1:t,{globalVolume:0,ease:"linear",onUpdate:d})}function h(t){e.isMute=!1,e.onMuteToggled.dispatch(!1),i.to(e,0,{globalVolume:1,ease:"linear",onUpdate:d}),f()}function p(){e.isMute?h():c()}function d(){o.volume=e.globalVolume,u.volume=e.globalVolume}var s,o,u;return e.globalVolume=0,e.isMute=!0,e.onMuteToggled=new n.Signal,e.init=a,e.playBgm=f,e.playAdd=l,e.mute=c,e.unmute=h,e.toggleMute=p,e}),define("utils/socialUtils",["exports","jquery","config","trackingController"],function(e,t,n,r){function s(e,t){var n=e.replace(/[@]+[A-Za-z0-9-_]+/g,function(e){return'<a target="'+t+'" href="http://twitter.com/#!/'+e.replace("@","")+'">'+e+"</a>"});return n=n.replace(/[#]+[A-Za-z0-9-_]+/g,function(e){return'<a target="'+t+'" href="http://search.twitter.com/search?q='+e.replace("#","")+'"">'+e+"</a>"}),n}function o(e){return e.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(e){return'<a target="_blank" href="'+e+'">'+e+"</a>"})}function u(e){return"https://www.facebook.com/dialog/feed?app_id="+FACEBOOK_ID+"&link="+encodeURIComponent(e)+"&redirect_uri="+encodeURIComponent(n.BASE_URL)+"/close.html"}function a(e){return"https://plus.google.com/share?url="+encodeURIComponent(e)}function f(e,t){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(t)+" "+encodeURIComponent(e)}function l(e,t,n){return"http://pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&media="+n+"&description="+encodeURIComponent(t)}var i,c={facebook:"memory-share-fb",twitter:"memory-share-tw",gplus:"memory-share-g"};window.socialShare=function(i,s,o){var h="",p="",d="",v="";o=o?t("<span>").html(o).text():"",s=s||"",s=n.SITE_URL+s,r.trackEvent({trackCat:c[i]});switch(i){case"facebook":window.open(u(s),"share","width=640,height=480");break;case"twitter":window.open(f(s,o),"share","width=640,height=480");break;case"pinterest":window.open(l(s,p,d),"share","width=640,height=480");break;case"gplus":window.open(a(s),"share","width=640,height=480");break;case"email":window.location.href="mailto:?subject="+encodeURIComponent(h)+"&body="+encodeURIComponent(p)+"["+encodeURIComponent(s)+"]"}},e.parseTweet=s,e.parseLinks=o,e.getFacebookShareLink=u,e.getGplusShareLink=a,e.getTwitterShareLink=f,e.getPinterestShareLink=l,e.socialShare=socialShare}),define("mout/string/ltrim",["../lang/toString","./WHITE_SPACES"],function(e,t){function n(n,r){n=e(n),r=r||t;var i=0,s=n.length,o=r.length,u=!0,a,f;while(u&&i<s){u=!1,a=-1,f=n.charAt(i);while(++a<o)if(f===r[a]){u=!0,i++;break}}return i>=s?"":n.substr(i,s)}return n}),define("mout/queryString/setParam",[],function(){function e(e,t,n){e=e||"";var r=new RegExp("(\\?|&)"+t+"=[^&]*"),i=t+"="+encodeURIComponent(n);return r.test(e)?e.replace(r,"$1"+i):(e.indexOf("?")===-1&&(e+="?"),e.indexOf("=")!==-1&&(e+="&"),e+i)}return e}),define("ui/footer",["exports","config","jquery","inputController","uiController","soundController","trackingController","utils/socialUtils","preloaderController","mout/string/ltrim","mout/queryString/setParam","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c){function E(){a.add(h)}function S(){x(),T(),t.DISABLE_SOUND_ON_START||s.unmute(0)}function x(){p=n(".footer-bg"),d=n(".footer-link-lang-item:not(.selected)"),v=n(".footer-share"),y=n(".footer-sound-btn"),g=n(".footer-link-terms"),m=n(".footer-link-credits")}function T(){r.add(v,"click",O),r.add(d,"click",P),r.add(y,"click",C),r.add(m,"click",k),r.add(g,"click",L),h.find(".track-link").each(function(){r.add(this,"click",A),this._url=n(this).attr("href"),n(this).css("cursor","pointer").removeAttr("href")}),s.onMuteToggled.add(N)}function N(e){y.toggleClass("selected",!e)}function C(){s.toggleMute()}function k(){i.showCredit()}function L(){i.showTerms()}function A(e){e.preventDefault();var t=n(this).data("trackType"),r={};r[t==="trackPage"?"trackPage":"trackCat"]=n(this).data("trackValue"),o[t](r),this._url&&window.open(this._url)}function O(e){var t=n(this),r=t.data("type");u.socialShare(r,"",r==="twitter"?TWITTER_SITE_DESCRIPTION:SITE_DESCRIPTION)}function M(){c.fromTo(h,.5,{opacity:0},{opacity:1,ease:"linear"}),h.show()}function _(){c.to(p,1.3,{transform3d:"scale3d(1,1,1)"})}function D(){c.to(p,1.3,{transform3d:"scale3d(1,0,1)"})}function P(){var e=n(this),r=e.data("id"),i=e.data("urlSuffix"),s=window.location.href.split("?")[1];o.trackEvent({trackCat:"footer-langselector"}),setTimeout(function(){window.location.href=t.BASE_URL+i+l(s||"","ln",r)},500)}function H(e){n("head").append("<style>.footer-fade-item{opacity: "+e*.5+"}</style>")}function B(e){h.height(e)}var h=n(".footer"),p,d,v,m,g,y,b,w;e.preInit=E,e.init=S,e.show=M,e.showBg=_,e.hideBg=D,e.updateFading=H,e.changeHeight=B}),define("ui/terms",["exports","config","jquery","inputController","preloaderController","stageReference","EKTweener"],function(e,t,n,r,i,s,o){function c(){i.add(u)}function h(){p(),d()}function p(){a=n(".terms-wrapper"),f=n(".terms-close-btn")[0].circleBtn}function d(){f.onClicked.add(g),r.add(u,"click",m)}function v(){u[0].scrollpane.onResize()}function m(e){e.target===this&&g()}function g(){b()}function y(){if(l)return;l=!0,u.show(),o.fromTo(a,.5,{transform3d:"translate3d(332px,0,0)"},{transform3d:"translate3d(0,0,0)"}),s.onResize.add(v),v()}function b(){if(!l)return;l=!1,o.to(a,.5,{transform3d:"translate3d(332px,0,0)",onComplete:function(){u.hide()}}),s.onResize.remove(v)}var u=e.container=n(".terms"),a,f,l=!1;e.preInit=c,e.init=h,e.show=y,e.hide=b}),define("text!shaders/map/vertex.glsl",[],function(){return"varying float pAlpha;\nuniform float dLength;\nuniform float visible;\nuniform float zoom;\nuniform float fading;\nuniform vec4 rotation;\nuniform float dpi;\n\nfloat PI = 3.14159265358979323846264;\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n    return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n    {\n    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n        -0.577350269189626,  // -1.0 + 2.0 * C.x\n        0.024390243902439); // 1.0 / 41.0\n// First corner\n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n    vec2 i1;\n    //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n    //i1.y = 1.0 - i1.x;\n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    // x0 = x0 - 0.0 + 0.0 * C.xx ;\n    // x1 = x0 - i1 + 1.0 * C.xx ;\n    // x2 = x0 - 1.0 + 2.0 * C.xx ;\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n\n// Permutations\n    i = mod289(i); // Avoid truncation effects in permutation\n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n        + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n\n// vec2 rotate(vec3 pos) {\n//     float cosRX = cos(rotation.x);\n//     float sinRX = sin(rotation.x);\n//     float cosRY = cos(rotation.y);\n//     float sinRY = sin(rotation.y);\n//     float cosRZ = cos(rotation.z);\n//     float sinRZ = sin(rotation.z);\n\n//     float x0 = pos.x * cosRY - pos.z * sinRY;\n//     float z0 = pos.z * cosRY + pos.x * sinRY;\n//     float y0 = pos.y * cosRX - z0 * sinRX;\n//     z0 = z0 * cosRX + pos.y * sinRX;\n\n//     float x1 = x0 * cosRZ - y0 * sinRZ;\n//     y0 = y0 * cosRZ + x0 * sinRZ;\n\n//     float perspectiveRatio = 1.0 + (z0 / 400.0);\n\n//     return vec2(x1 * perspectiveRatio,  y0 * perspectiveRatio);\n// }\n\n vec3 qtransform( vec4 q, vec3 v ){\n    return v + 2.0*cross(cross(v, q.xyz ) + q.w*v, q.xyz);\n}\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nvoid main() {\n\n    vec3 pos = position;\n\n    if(pos.x > -.1 && pos.x < .1 && pos.x > -.1 && pos.x < .01 && pos.z > 44.99) {\n        pos.x = 0.0;\n        pos.y = 0.0;\n        gl_PointSize = 3.0;\n        pAlpha = 1.0;\n    } else {\n        // float alpha = atan(pos.x, pos.y) + snoise(pos.xy + .1) * 5.0;\n        // float beta = atan(pos.z, pos.x) + snoise(pos.yz + .1) * 5.0;\n        // pos.x = - 45.0 * cos( alpha ) * sin( beta );\n        // pos.y = 45.0 * cos( beta );\n        // pos.z = 45.0 * sin( alpha ) * sin( beta );\n        // pAlpha = .4 + snoise(pos.zx + .4) * .3;\n\n        pAlpha = .2 + .8 * snoise(pos.xy * .3);\n\n        // pos.x += snoise(pos.yz + .1) * 2.0;\n        // pos.y += snoise(pos.zx + .2) * 2.0;\n        pos *= 1.0 + zoom * (2.0 + snoise(pos.xy * 10.0 + 3.0) * 2.0);\n        pos = qtransform( rotation, pos);\n        pos.x += snoise(pos.yz + .1) * 2.0 * (abs(pos.z) / 45.0) * (1.0 - zoom);\n        pos.y += snoise(pos.zx + .2) * 2.0 * (abs(pos.z) / 45.0) * (1.0 - zoom);\n\n        pos *= 1.0 + dLength * .01 * snoise(pos.xy * 10.0) * (abs(pos.z) / 45.0 + .3);\n        gl_PointSize = 1.0 + (abs(pos.z) / 45.0) * .2;\n        pAlpha *= .4 + (pos.z / 45.0) * .25 * dLength / 10.0;\n\n        if(pos.z < -3.0) {\n            pAlpha = 0.0;\n        }\n\n        // at the edge\n        if(pos.z > -3.0 && pos.z < 3.0) {\n            pAlpha = .2;\n        }\n\n        float radius = length(pos.xy);\n        if(radius > 45.0) {\n            pAlpha *= 1.0 - clampNorm(radius, 45.0, 100.0);\n        }\n        pAlpha *= mix(1.0, 2.0, zoom);\n    }\n\n    pAlpha *= visible * fading;\n\n    // pos.xy = rotate(pos);\n    pos.z = 0.0;\n\n    vec4 modelViewPos = modelViewMatrix * vec4( pos, 1.0 );\n    float distanceToCamera = sqrt(modelViewPos.x * modelViewPos.x + modelViewPos.y * modelViewPos.y + modelViewPos.z * modelViewPos.z);\n\n\n    gl_Position = projectionMatrix * modelViewPos;\n    // colorRatio = snoise(refPos.xz * 0.0005 + 200.0);\n    gl_PointSize *= dpi;\n}\n"}),define("text!shaders/map/fragment.glsl",[],function(){return"varying float pAlpha;\nuniform sampler2D tDiffuse;\n\nvoid main() {\n\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, pAlpha);\n\n\n}\n"}),define("scene3d/map",["exports","config","text!shaders/map/vertex.glsl","text!shaders/map/fragment.glsl","THREE"],function(e,t,n,r,i){function o(){u(),a()}function u(){e.uniforms={zoom:{type:"f",value:0},visible:{type:"f",value:0},dLength:{type:"f",value:0},rotation:{type:"v4",value:new i.Vector4},fading:{type:"f",value:0},dpi:{type:"f",value:window.devicePixelRatio||1}},e.material=new i.ShaderMaterial({uniforms:e.uniforms,vertexShader:n,fragmentShader:r,blending:i.AdditiveBlending,transparent:!0,depthTest:!1})}function a(){var t=e.geometry=new i.OctahedronGeometry(45,5);e.particles=new i.ParticleSystem(t,e.material)}var s;e.offsetLeft=72,e.offsetTop=44,n=i._evalReplace(n,{THREE:i}),r=i._evalReplace(r,{THREE:i}),e.init=o}),define("text!shaders/postSubmitCircle/vertex.glsl",[],function(){return"\nuniform float animation;\nvarying vec2 vUv;\nvarying float vAnimation;\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nfloat middleStep(float x, float y, float a) {\n    return step(x, a) * (1. - step(y, a));\n}\n\nfloat middleFadeInOut(float x, float y, float a) {\n    return middleStep(x, y, a) * (1. - abs(clampNorm(a, x, y) -.5) * 2.);\n}\n\n// const float SCALE_RATIO = 40.;\nconst float SCALE_RATIO = 8.;\n\nvoid main() {\n    vUv = uv;\n    vAnimation = animation;\n    vec4 finalPosition;\n\n    float animationRatio = clampNorm(animation, 1.5, 4.);\n\n    animationRatio = clampNorm(animation, 1.5, 4.);\n    float scale = mix(1., SCALE_RATIO, pow(animationRatio, 1.6));\n\n    scale /= (1. + middleFadeInOut(4.0, 5., animation) * 2.);\n\n    finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0,  scale);\n    finalPosition.xy += position.xy;\n\n    gl_Position = projectionMatrix * finalPosition;\n}\n"}),define("text!shaders/postSubmitCircle/fragment.glsl",[],function(){return"precision mediump float;\nuniform float time;\nuniform float fade;\nuniform sampler2D texture;\nvarying float vAnimation;\n\nvarying vec2 vUv;\n\n/*EVAL THREE.ShaderChunk['snoise2d'];*/\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nconst float PI = 3.14159265358979323846264;\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nfloat lightField(float angle, float angleScale, float t1, float t2, float patchSize) {\n    return mix(\n        clamp(snoise(vec2(angle * angleScale + t1, t2)), 0., 1.),\n        clamp(snoise(vec2(-angle * angleScale + t1, t2)), 0., 1.),\n        clampNorm(angle, PI - patchSize, PI)\n    );\n}\n\nvec3 getSepiaColor(vec3 rgb){\n    return vec3(dot(rgb, vec3(0.299, 0.587, 0.114))) * vec3(1.2, 1.0, 0.8);\n}\n\nfloat middleStep(float x, float y, float a) {\n    return step(x, a) * (1. - step(y, a));\n}\n\nfloat middleFadeInOut(float x, float y, float a) {\n    return middleStep(x, y, a) * (1. - abs(clampNorm(a, x, y) -.5) * 2.);\n}\n\nvoid main() {\n\n    float d = length(vUv - .5) * 2.;\n    float ratio;\n    vec4 color;\n    float r;\n\n    float scale = 1. / (1. + clampNorm(vAnimation, 1.0, 3.0) * 8. * (1. + middleFadeInOut(4.0, 5., vAnimation) * 2.));\n\n    float thersh = 280. / 512. * scale;\n\n    float fadeRatio = 1. - ((1. - step(1., vAnimation)) * vAnimation + middleStep(1., 1.5, vAnimation) * (1.0 - clampNorm(vAnimation, 1., 1.5))) * .9;\n    float noiseRatio = clampNorm(vAnimation, 0.0, 0.5) * fadeRatio;\n    float sepiaRatio = clampNorm(vAnimation, 0.0, 0.5);\n    float lightRatio = middleFadeInOut(1.5, 2.5, vAnimation) + middleFadeInOut(4.0, 4.5, vAnimation);\n    float outerGlow = max(lightRatio, clampNorm(vAnimation, 1.0, 2.0) * .2);\n    float brightnessRatio = clampNorm(vAnimation, 1.0, 2.5);\n    float opacity = 1. - clampNorm(vAnimation, 4.5, 5.0);\n    float orangeRatio = clampNorm(vAnimation, 3.0, 4.0);\n\n\n    if(d > thersh) {\n        float alpha = 1.0;\n        float angle = atan(vUv.y - .5, vUv.x - .5);\n\n        ratio = .1 + clampNorm(d, thersh, 1.);\n        alpha *= pow(1. - ratio, 5.); //intensity\n        alpha -= (1. - alpha) * rand(vUv) * .2;\n\n        color = vec4(mix(vec3(1., .65, .75), vec3(1., 1., 1.), clamp(alpha, 0., 1.)), alpha * outerGlow );\n    } else {\n        ratio = clampNorm(d, 0., thersh);\n        color = texture2D(texture, (vUv - .5) / scale + .5);\n\n        color.rgb = mix(color.rgb, getSepiaColor(color.rgb), sepiaRatio *.7);\n\n        color.rgb = mix(vec3(0., 0., 0.), color.rgb, fadeRatio);\n\n        r = rand(vUv.xy + rand(vUv.yx + time));\n        color.rgb = mix(clamp(color.rgb, 0., 1.), vec3(r, r, r), noiseRatio * .1);\n\n        // inner glow\n        color.rgb += clampNorm(ratio, .8, 1.) * lightRatio;\n    }\n\n    color.rgb = mix(color.rgb, getSepiaColor(color.rgb), sepiaRatio * .3);\n\n    r = rand(vUv.xy + rand(vUv.yx + time));\n    color.rgb = mix(clamp(color.rgb, 0., 1.), vec3(r, r, r), noiseRatio * .05);\n\n\n    color.rgb += brightnessRatio;\n\n    color.rgb = mix(color.rgb, vec3(.894, .416, .314), orangeRatio);\n\n    color.a = clamp(color.a, 0., 1.) * (opacity * step(1., vAnimation) + (1. - step(1., vAnimation))) * fade;\n\n    gl_FragColor = color;\n\n}\n"}),define("utils/noiseUtils",[],function(){function e(e,t){var n=.211324865405187,r=-0.577350269189626,i=1.79284291400159,s=1/289,o=(e+t)*.366025403784439,u=Math.floor(e+o),a=Math.floor(t+o);o=(u+a)*n;var f=e-u+o,l=t-a+o,c=f>l?1:0,h=1-c,p=f+n-c,d=l+n-h,v=f+r,m=l+r;u-=Math.floor(u*s)*289,a-=Math.floor(a*s)*289,o=0,n=.024390243902439,r=.85373472095314;var g=.5-p*p-d*d;if(g>0){var y=a+h;y*=y*34+1,y=y-Math.floor(y*s)*289+u+c,y*=y*34+1,y=(y-Math.floor(y*s)*289)*n,y=(y-Math.floor(y))*2-1;var b=Math.abs(y)-.5;y-=Math.floor(y+.5),o+=g*g*g*g*(i-r*(y*y+b*b))*(y*p+b*d)}g=.5-v*v-m*m;if(g>0){var w=a+1;w*=w*34+1,w=w-Math.floor(w*s)*289+u+1,w*=w*34+1,w=(w-Math.floor(w*s)*289)*n,w=(w-Math.floor(w))*2-1;var E=Math.abs(w)-.5;w-=Math.floor(w+.5),o+=g*g*g*g*(i-r*(w*w+E*E))*(w*v+E*m)}g=.5-f*f-l*l;if(g>0){a*=a*34+1,a=a-Math.floor(a*s)*289+u,a*=a*34+1,a=(a-Math.floor(a*s)*289)*n,a=(a-Math.floor(a))*2-1;var S=Math.abs(a)-.5;a-=Math.floor(a+.5),o+=g*g*g*g*(i-r*(a*a+S*S))*(a*f+S*l)}return o*130}return{snoise2D:e}}),define("scene3d/postSubmitCircle",["exports","config","scene3dController","text!shaders/postSubmitCircle/vertex.glsl","text!shaders/postSubmitCircle/fragment.glsl","utils/noiseUtils","mout/math/norm","mout/math/clamp","THREE"],function(e,t,n,r,i,s,o,u,a){function b(e,t,n){return u(o(e,t,n),0,1)}function w(){E(),S()}function E(){l=e.canvas=document.createElement("canvas"),l.width=y,l.height=y,c=e.ctx=l.getContext("2d"),c.fillStyle="#f00",c.fillRect(0,0,y,y),h=e.uniforms={time:{type:"f",value:0},texture:{type:"t",value:new a.Texture(l)},animation:{type:"f",value:0},fade:{type:"f",value:0}},e.material=new a.ShaderMaterial({uniforms:h,vertexShader:r,fragmentShader:i,transparent:!0,depthTest:!1,fog:!1}),h.texture.value.needsUpdate=!0}function S(){var t=e.geometry=new a.PlaneGeometry(y,y);p=e.mesh=new a.Mesh(t,e.material),d=e.mesh.position}function x(e){return(e-=1)*e*e+1}function T(e){return e*e*(2.70158*e-1.70158)}function N(){this.uniforms.time.value+=.01;var e=this.uniforms.animation.value;if(e>1){if(v<=1){m.copy(d),g.copy(d),g.sub(n.cameraPosition).normalize();var t=Math.atan2(g.z,g.x);g.multiplyScalar(400);var r=(Math.random()*2-1)*200,i=s.snoise2D;g.x+=Math.sin(t)*r,g.z+=Math.cos(t)*r;var o=g.x+m.x,u=g.z+m.z,a=i(o*.0021+4,u*.0021+4)*-40+i(o*.0013+32,u*.0013+32)*-90;g.y=a-m.y}C(e)}v=e}function C(e){var t=b(e,1,3);d.x=m.x+x(t)*g.x,d.z=m.z+x(t)*g.z;var t=b(e,1.5,4);d.y=m.y+Math.pow(t,3)*g.y,p.lookAt(n.cameraPosition)}function k(){e.lockCenter=!0,h.animation.value=0}var f,l=e.canvas=null,c=e.ctx=null,h,p,d;e.offsetLeft=0,e.offsetTop=35,e.currentStep=0,e.lockCenter=!1;var v=!1,m=new a.Vector3(0,0,0),g=new a.Vector3(0,0,0),y=e.SIZE=512;r=a._evalReplace(r,{THREE:a}),i=a._evalReplace(i,{THREE:a}),e.init=w,e.update=N}),define("text!shaders/postParticle/vertex.glsl",[],function(){return"varying vec2 vUv;\nvarying float u_pop;\nuniform float pop;\nuniform float popScale;\nuniform float showScale;\n\nvoid main() {\n    vUv = uv;\n    vec4 pos = vec4( position, 1.0 );\n    pos.xyz *= clamp(pow(showScale, 10.), .08, 1.);\n    pos.xyz *= mix(1., popScale, pop);\n    vec4 modelViewPos = modelViewMatrix * pos;\n    gl_Position = projectionMatrix * modelViewPos;\n\n    u_pop = pop;\n}\n"}),define("text!shaders/postParticle/fragment.glsl",[],function(){return"precision mediump float;\n\nuniform sampler2D texture;\nuniform float u_time;\nuniform float fade;\nuniform float alpha;\nvarying float u_pop;\n\nvarying vec2 vUv;\n\n/*EVAL THREE.ShaderChunk['fog_pars_fragment'];*/\n\nconst float PI = 3.14159265358979323846264;\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nvec2 getDisplacement(vec2 uv, float time) {\n\n    time *= 5.0; // speed\n\n    float a = sin(time + uv.x * 10.0);\n    float b = cos(time + uv.y * 10.0);\n\n    return vec2( a + cos(b), b + sin(a) ) * 0.005; // size\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\n\n    vec2 posToCenter = (vUv - vec2(.5, .5)) * 2.0;\n\n    float innerThreshold = .1;\n    float threshold = .8;\n    float direction = 45.0 / 180.0 * PI;\n    float monoNoise = rand(vUv * 10.0 + u_time * .0001);\n\n\n    float angle = atan(posToCenter.y, posToCenter.x);\n    float distanceToCenter = length(posToCenter);\n\n    float angleRatio1 = (cos((angle + direction) * 2.0) + 1.0) / 2.0;\n    float angleRatio2 = (cos(angle + direction) + 1.0) / 2.0;\n    float angleRatio = (angleRatio1 + angleRatio2) / 2.0;\n\n    float fadeOpacity = 1. - smoothstep(threshold, 1., distanceToCenter);\n    float opacity = (1. - step(threshold, distanceToCenter)) + mix(1., monoNoise, 1. - fadeOpacity) * fadeOpacity;\n\n    vec3 bgColor = mix(vec3(255., 255., 255.), vec3(252., 222., 184.), distanceToCenter) / 255.;\n\n    vec2 uv = vUv;\n\n    vec4 imageColor= texture2D(texture, uv);\n\n\n    vec4 color = vec4(mix(bgColor, imageColor.rgb, u_pop), 1.);\n\n    color.a = opacity * alpha * fade;\n    color.r *= .9 + monoNoise * .2;\n    color.g *= .9 + monoNoise * .2;\n    color.b *= .9 + monoNoise * .2;\n\n    gl_FragColor = color;\n\n/*EVAL THREE.ShaderChunk['fog_fragment'];*/\n\n}\n"}),define("utils/stringUtils",["THREE"],function(THREE){function evalReplace(str,scopeVariables,regex){for(var i in scopeVariables)eval("var "+i+'=scopeVariables["'+i+'"]');return str.replace(regex||DEFAULT_EVAL_REPLACE_REGEX,function(a,b){return eval(b)})}function stripHTML(e){return e.replace(/<(?:.|\n)*?>/gm,"")}var DEFAULT_EVAL_REPLACE_REGEX=/\/\*EVAL (.+)\*\//g;return{evalReplace:evalReplace,stripHTML:stripHTML}}),define("scene3d/PostParticle",["config","uiController","text!shaders/postParticle/vertex.glsl","text!shaders/postParticle/fragment.glsl","utils/stringUtils","mout/object/mixIn","THREE","EKTweener"],function(e,t,n,r,i,s,o,u){function a(e){p&&(p(),p=null);var t=this;f.call(this,new o.PlaneGeometry(c,c,1,1),new o.ShaderMaterial({uniforms:{fogColor:{type:"c",value:new o.Color(0)},fogDensity:{type:"f",value:.025},fogFar:{type:"f",value:2e3},fogNear:{type:"f",value:1},texture:{type:"t",value:new o.Texture(h)},u_time:{type:"f",value:Math.random()*100},alpha:{type:"f",value:1},fade:{type:"f",value:0},pop:{type:"f",value:0},popScale:{type:"f",value:1.3},showScale:{type:"f",value:1}},attributes:{},vertexShader:n,fragmentShader:r,depthTest:!1,transparent:!0,fog:!0})),s(this,{uniforms:t.material.uniforms,texture:t.material.uniforms.texture.value,renderDepth:0,canvasStatus:-1,interactive:!0},e)}function p(){n=i.evalReplace(n,{THREE:o}),r=i.evalReplace(r,{THREE:o})}function d(){h=document.createElement("canvas"),h.width=h.height=c;var e=h.getContext("2d");e.fillStyle="#fefcfe",e.fillRect(0,0,c,c)}function v(e){this.post=e,this.canvasStatus=-1}function m(){var e=this.canvasStatus,t=this.post;t?t.isThumbLoaded?e<1&&this._redrawThumb():e<0&&this._redrawBlank():e<0&&this._redrawBlank()}function g(){this._updateCanvas(),this.uniforms.u_time.value+=.01}function y(){this.texture.image=h}function b(){this.texture.image=this.post.thumb,this.canvasStatus=1,this.texture.needsUpdate=!0}function w(){this._renderDepth=this.renderDepth,this.renderDepth=-99999;var e=this.uniforms.pop;u.to(e,(1-e.value)*.3,{value:1})}function E(){this.renderDepth=this._renderDepth;var e=this.uniforms.pop;u.to(e,e.value*.3,{value:0})}function S(){var e=this.post;t.preShowPost2d(e),t.showPost2d(e)}n=o._evalReplace(n,{THREE:o}),r=o._evalReplace(r,{THREE:o});var f=o.Mesh,l=a.prototype=Object.create(o.Mesh.prototype),c=e.POST_CANVAS_SIZE,h;return l.changePost=v,l._updateCanvas=m,l.update=g,l._redrawBlank=y,l._redrawThumb=b,l.onOver=w,l.onOut=E,l.onClick=S,d(),a}),define("text!shaders/particleWave/vertex.glsl",[],function(){return"varying float pAlpha;\nvarying vec2 colorMapPos;\nvarying float alphaIntensity;\nvarying float vZoom;\nuniform float fading;\nuniform float time;\nuniform float zoom;\nuniform vec3 globalPos;\nuniform vec3 posOffset;\nuniform vec3 posFieldOffset;\nuniform vec3 cameraVector;\nuniform float dpi;\n\nconst float PI = 3.14159265358979323846264;\n\n/*EVAL THREE.ShaderChunk['snoise2d'];*/\n\nvoid main() {\n\n    vec3 refPos = position + posFieldOffset;\n    colorMapPos = refPos.xz;\n\n    // noise ratio that fixed depends on the particle reference position\n    float fixedPosNoiseRatio = (snoise(refPos.xz * 0.1) + snoise(refPos.xz * 0.005)) * .5;\n    fixedPosNoiseRatio = 1.0 - (cos(fixedPosNoiseRatio * PI) + 1.0) / 2.0 - snoise(refPos.xz * .1) - snoise(refPos.xz * .03);\n\n    fixedPosNoiseRatio -= snoise(refPos.xz * .003 + 2.1) * 1.5 + snoise(refPos.xz * .3 + 1.1)  + snoise(refPos.xz * .001 + 1.1);\n\n    fixedPosNoiseRatio *= .5;\n\n    vec3 pos = position + posOffset;\n\n    vec4 modelViewPos = modelViewMatrix * vec4( pos + cameraVector, 1.0 );\n    float distanceToCamera = sqrt(modelViewPos.x * modelViewPos.x + modelViewPos.z * modelViewPos.z);\n\n    float offsetY = snoise(refPos.xz * 0.0013 + 4.0) * - 40.00 + snoise(refPos.xz * 0.0006 + 32.0) * - 90.0;\n\n    pos.x += (snoise(refPos.xz * 0.3) - .5) * 8.0;\n    pos.y += offsetY + snoise(refPos.xz * 200. + 12.) * 10.0 + (1. - step(0., fixedPosNoiseRatio)) * 99999. ;\n    pos.z += (snoise(refPos.xz * 0.4) - .5) * 8.0;\n\n    modelViewPos = modelViewMatrix * vec4( pos, 1.0 );\n\n    distanceToCamera = sqrt(modelViewPos.x * modelViewPos.x + modelViewPos.y * modelViewPos.y + modelViewPos.z * modelViewPos.z);\n\n    float blinkRatio = step(.1, snoise(refPos.xz)) * snoise(refPos.xz * 1.0 + 30.0 + time * 0.05);\n\n    pAlpha = clamp(mix(0.5, .6 + .4 * blinkRatio, fixedPosNoiseRatio) * fading * pow(5., clamp(fixedPosNoiseRatio, 0., 1.)), 0., 1.);\n\n    alphaIntensity = 1.0 + abs(snoise(refPos.xz * 400.0) * .8) * (.3 + blinkRatio * .7);\n\n    gl_PointSize = mix(500.0, 5000.0, pow(zoom, 2.1))  / distanceToCamera * 6.0 * mix(0.4, 1.0, fixedPosNoiseRatio) * dpi * (.8 + blinkRatio * .3);\n\n    vZoom = zoom;\n\n    gl_Position = projectionMatrix * modelViewPos;\n}\n"}),define("text!shaders/particleWave/fragment.glsl",[],function(){return"varying vec2 colorMapPos;\nvarying float pAlpha;\nvarying float alphaIntensity;\nvarying float vZoom;\n// uniform sampler2D tDiffuse;\nuniform sampler2D colorMap;\nuniform float colorMapScale;\n\n/*EVAL THREE.ShaderChunk['fog_pars_fragment'];*/\n\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\n\nvoid main() {\n\n    float colorMapScale = 200.0 * colorMapScale;\n\n    gl_FragColor = texture2D( colorMap, mod(colorMapPos, colorMapScale) / colorMapScale);\n\n    float distanceToCenter = length(gl_PointCoord.xy - .5) * 2.;\n\n    gl_FragColor.a = (step(0., distanceToCenter) - step(.25, distanceToCenter)) * 1.;\n    gl_FragColor.a += (step(.25, distanceToCenter) - step(.27, distanceToCenter)) * mix(1., .4, (distanceToCenter - .25) / (.27 - .25));\n    gl_FragColor.a += (step(.27, distanceToCenter) - step(.3, distanceToCenter)) * mix(.4, .15, (distanceToCenter - .27) / (.3 - .27));\n    gl_FragColor.a += (step(.3, distanceToCenter) - step(1., distanceToCenter)) * mix(.15, 0., (distanceToCenter - .3) / (1. - .3));\n\n    gl_FragColor.a = pow(abs(gl_FragColor.a), alphaIntensity) * pAlpha * ( 1. - clampNorm(vZoom, .75, 1.) * .4);\n\n/*EVAL THREE.ShaderChunk['fog_fragment'];*/\n}\n"}),define("scene3d/ParticleField",["config","text!shaders/particleWave/vertex.glsl","text!shaders/particleWave/fragment.glsl","THREE"],function(e,t,n,r){function i(e,t,n){this.amount=e,this.offsetX=t,this.offsetZ=n,this._createMaterial(),this._createGeometry()}function o(){var i=new r.Texture(e.colorMap);i.needsUpdate=!0,i.wrapS=i.wrapT=r.RepeatWrapping,this.uniforms={fogColor:{type:"c",value:new r.Color(0)},fogDensity:{type:"f",value:.025},fogFar:{type:"f",value:2e3},fogNear:{type:"f",value:1},fading:{type:"f",value:0},colorMap:{type:"t",value:i},colorMapScale:{type:"f",value:1},time:{type:"f",value:0},zoom:{type:"f",value:0},globalPos:{type:"v3",value:new r.Vector3(0,0,0)},posOffset:{type:"v3",value:new r.Vector3(this.offsetX,0,this.offsetZ)},posFieldOffset:{type:"v3",value:new r.Vector3(this.offsetX,0,this.offsetZ)},cameraVector:{type:"v3",value:new r.Vector3(0,0,0)},dpi:{type:"f",value:window.devicePixelRatio||1}},this.material=new r.ShaderMaterial({uniforms:this.uniforms,vertexShader:t,fragmentShader:n,blending:r.AdditiveBlending,transparent:!0,depthTest:!1,fog:!0}),this.move(0,0)}function u(){var t=this.geometry=new r.Geometry,n=t.vertices,i,s,o,u=e.PARTICLE_FIELD_SEGMENT_SIZE,a=e.PARTICLE_FIELD_GRID_SIZE,f=a/u;for(i=0;i<u;i++){o=i*f;for(s=0;s<u;s++)n.push(new r.Vector3(o,0,s*f))}this.particles=new r.ParticleSystem(t,this.material)}function a(e,t){this.uniforms.globalPos.value.x=e,this.uniforms.globalPos.value.z=t}t=r._evalReplace(t,{THREE:r}),n=r._evalReplace(n,{THREE:r});var s=i.prototype;return s._createMaterial=o,s._createGeometry=u,s.move=a,i}),define("text!shaders/fakeParticles/vertex.glsl",[],function(){return"varying float pAlpha;\nvarying float alphaIntensity;\nuniform float time;\nuniform vec3 posOffset;\nuniform vec3 cameraVector;\nuniform float dpi;\nuniform float fov;\nuniform float fade;\nuniform float skip;\nuniform float heightPower;\nuniform float amount;\nuniform float floatTime;\nuniform float d;\n\nconst float PI = 3.14159265358979323846264;\n\nconst float D2R = PI / 180.0;\n\n/*EVAL THREE.ShaderChunk['snoise2d'];*/\n\nfloat powInOut(float t, float p) {\n    return (1.-step(.5, t))*pow(t*2.,p)*.5+step(.5,t)*(1.-pow((1.-t)*2.,p)*.5);\n}\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\nfloat cSnoise(vec2 co) {\n    return clamp(snoise(co), 0., 1.);\n}\n\nvoid main() {\n\n    float x = position.x + skip;\n\n    float cameraA = atan(cameraVector.z, cameraVector.x);\n\n    float rr = log2(x);\n    float r = floor(rr);\n    r = pow(r, 1.5) * d + sin(x * .1) * d * 2.;\n    // float a = fract(rr) * 60. * D2R - cameraA - (60. / 2. * D2R) - PI / 2.;\n    float a = (fract(rr) * D2R - (1. / 2. * D2R)) * fov - cameraA - PI / 2.;\n    float centerRatio = 1. - abs(1. - fract(rr) * 2.);\n\n    vec3 refPos = vec3(\n        sin(a) * r,\n        0.,\n        cos(a) * r\n    );\n\n    refPos.x += cameraVector.x * 1.5 + posOffset.x;\n    refPos.z += cameraVector.z * 1.5 + posOffset.z;\n    // refPos.x += posOffset.x;\n    // refPos.z += posOffset.z;\n\n    // refPos = floor(refPos / 100.) * 100.;\n\n    // noise ratio that fixed depends on the particle reference refPosition\n    float fixedPosNoiseRatio = (snoise(refPos.xz * 0.1) + snoise(refPos.xz * 0.005)) * .5;\n    fixedPosNoiseRatio = 1.0 - (cos(fixedPosNoiseRatio * PI) + 1.0) / 2.0 - snoise(refPos.xz * .1) - snoise(refPos.xz * .03);\n    fixedPosNoiseRatio -= snoise(refPos.xz * .003 + 2.1) * 1.5 + snoise(refPos.xz * .3 + 1.1)  + snoise(refPos.xz * .001 + 1.1);\n    fixedPosNoiseRatio *= .5;\n\n    float offsetY = snoise(refPos.xz * 0.0013 + 4.0) * - 40.00 + snoise(refPos.xz * 0.0006 + 32.0) * - 90.0;\n\n    vec3 pos = vec3(\n        (snoise(refPos.xz * 0.3) - .5) * 8.0,\n        offsetY + snoise(refPos.xz * 200. + 12.) * 10.0,\n        (snoise(refPos.xz * 0.4) - .5) * 8.0\n    );\n\n    float t1 = cSnoise(refPos.xz  *213. + 123.) *.2;\n    float t2 = 1.0;//clamp(t1 + .6 + cSnoise(refPos.xz  *213. + 123.)  * (.4 - t1), 0., 1.);\n\n    float animation = clampNorm(time, t1, t2);\n    float moveAnimation = pow(clampNorm(animation, .1, 1.), 1. + cSnoise(refPos.xz  * 23. + 3.) * 1.2);\n\n    pos.x += refPos.x + sin(moveAnimation * 4. + r) * 5.;\n    pos.y += moveAnimation * pow(r, heightPower + sin((a+r) * 30. + cos((a+r) *20. + moveAnimation* a)) *.06) * (.1 + cSnoise(refPos.xz  * 311. + 1.)*r/1000.) * (.2 + cSnoise(refPos.xz  * 3. + 1.) * mix(.2, .8, pow(centerRatio, 15.)));\n    pos.z += refPos.z + cos(moveAnimation * 3. + r - 2.1) * 5.;\n\n    pos.x += r * .01 * sin(floatTime * (.5 + cSnoise(refPos.xz  * 82. + 53.) * .5) * .01 + 12.) * moveAnimation;\n    pos.y += r * .01 * sin(floatTime * (.5 + cSnoise(refPos.xz  * 73. + 184.) * .5) * .01 + 72.) * moveAnimation;\n    pos.z += r * .01 * sin(floatTime * (.5 + cSnoise(refPos.xz  * 92. + 25.) * .5) * .01 + 19.) * moveAnimation;\n\n    vec4 modelViewPos = modelViewMatrix * vec4( pos, 1.0 );\n    float distanceToCamera = sqrt(modelViewPos.x * modelViewPos.x + modelViewPos.y * modelViewPos.y + modelViewPos.z * modelViewPos.z);\n\n\n    // pAlpha = mix(.3, 1., pow(centerRatio, 3.)) * clamp(pow(5., clamp(fixedPosNoiseRatio, 0., 1.)), 0., 1.) * (smoothstep(0.05, .1, animation) - smoothstep(.85, .95 + cSnoise(refPos.xz  * 52. + 1.) * .05, animation)) * fade;\n    pAlpha = mix(.3, 1., pow(centerRatio, 3.)) * clamp(pow(5., clamp(fixedPosNoiseRatio, 0., 1.)), 0., 1.) * smoothstep(.0, .1, animation) * fade;\n\n    pAlpha *= 1. - step(amount, position.x);\n\n    modelViewPos = modelViewMatrix * vec4( pos, 1.0 );\n    gl_Position = projectionMatrix * modelViewPos;\n\n    gl_PointSize = gl_PointSize = 4000.0 / distanceToCamera * mix(1., 3., moveAnimation) * mix(0.4, 1.0, fixedPosNoiseRatio);\n\n\n    alphaIntensity = mix(1., 2., animation + sin(floatTime * (.5 + cSnoise(refPos.xz  * 132. + 25.) * .5) * .01 + 13.) * .6);\n    // alphaIntensity = mix(1., 2., animation);\n}\n"}),define("text!shaders/fakeParticles/fragment.glsl",[],function(){return"varying float pAlpha;\nvarying float alphaIntensity;\n\n/*EVAL THREE.ShaderChunk['fog_pars_fragment'];*/\n\nfloat clampNorm(float val, float min, float max) {\n    return clamp((val - min) / (max - min), 0.0, 1.0);\n}\n\n\nvoid main() {\n\n    float distanceToCenter = length(gl_PointCoord.xy - .5) * 2.;\n\n    float alpha = (step(0., distanceToCenter) - step(.25, distanceToCenter)) * mix(1., .4, distanceToCenter / .25);\n    alpha += (step(.25, distanceToCenter) - step(.3, distanceToCenter)) * mix(.4, .15, (distanceToCenter - .25) / (.3 - .25));\n    alpha += (step(.3, distanceToCenter) - step(1., distanceToCenter)) * mix(.15, 0., (distanceToCenter - .3) / (1. - .3));\n    alpha = pow(abs(alpha), alphaIntensity) * pAlpha;\n\n    gl_FragColor = vec4(mix(vec3(255., 255., 255.), vec3(252., 132., 3.), distanceToCenter) / 255., alpha);\n\n/*EVAL THREE.ShaderChunk['fog_fragment'];*/\n}\n"}),define("scene3d/fakeParticles",["exports","config","scene3dController","text!shaders/fakeParticles/vertex.glsl","text!shaders/fakeParticles/fragment.glsl","THREE"],function(e,t,n,r,i,s){function h(t){a=e.uniforms={fogColor:{type:"c",value:new s.Color(0)},fogDensity:{type:"f",value:.025},fogFar:{type:"f",value:2e3},fogNear:{type:"f",value:1},posOffset:{type:"v3",value:new s.Vector3(0,0,0)},cameraVector:{type:"v3",value:new s.Vector3(0,0,0)},time:{type:"f",value:e.time},dpi:{type:"f",value:window.devicePixelRatio||1},fov:{type:"f",value:50},fade:{type:"f",value:50},skip:{type:"f",value:5},heightPower:{type:"f",value:.9},amount:{type:"f",value:o},floatTime:{type:"f",value:0},d:{type:"f",value:40}};var n=new s.ShaderMaterial({uniforms:a,vertexShader:r,fragmentShader:i,blending:s.AdditiveBlending,transparent:!0,depthTest:!1,fog:!0}),f=new s.Geometry,l=f.vertices;for(var c=0;c<o;c++)l.push(new s.Vector3(c,0,0));u=e.particles=new s.ParticleSystem(f,n),t.add(e.particles)}function p(){a.time.value=e.time,a.floatTime.value+=1,a.fade.value=e.fade}var o=6e4,u,a,f=t.PARTICLE_FIELD_SEGMENT_SIZE,l=t.PARTICLE_FIELD_GRID_SIZE,c=l/f;r=s._evalReplace(r,{THREE:s}),i=s._evalReplace(i,{THREE:s}),e.time=0,e.fade=1,e.init=h,e.update=p}),define("posts/Post",["config","signals","preloaderController","mout/object/mixIn","mout/function/bind"],function(e,t,n,r,i){function s(e){var n;this.isThumbStartLoading=!1,this.isThumbLoaded=!1,this.isLargeStartLoading=!1,this.isLargeLoaded=!1,this.isActive=!1,r(this,{},e),this.onThumbPreloaded=new t.Signal,this.onLargePreloaded=new t.Signal}function u(t){t&&this.onThumbPreloaded.add(t);if(this.isLargeStartLoading)return;this.isThumbStartLoading=!0,n.loadSingle(e.UPLOADS_FOLDER+"posts/"+this.img+"/thumb.jpg",i(f,this))}function a(t){t&&this._onLargePreload.add(t);if(this.isLargeStartLoading)return;this.isLargeStartLoading=!0,n.loadSingle(e.UPLOADS_FOLDER+"posts/"+this.img+"/resized.jpg",i(l,this))}function f(e){this.isThumbLoaded=!0,this.thumb=e.content,this.onThumbPreloaded.dispatch(e)}function l(e){this.isLargeLoaded=!0,this.large=e.content,this.onLargePreloaded.dispatch(e)}var o=s.prototype;return o.preloadThumb=u,o.preloadLarge=a,o._onThumbPreload=f,o._onLargePreload=l,s}),define("widgets/SimpleScrollPane",["config","jquery","inputController","mout/function/bind","mout/math/clamp","stageReference"],function(e,t,n,r,i,s){function f(e,t,n){this.wrapper=e,this.moveContainer=t,this.moveContainerStyle=t[0].style,this.indicator=n,this.indicatorStyle=n[0].style,e[0].scrollpane=this,this._tPos=0,this._tRatio=0,this._pos=0,this._ratio=0,this._easeRatio=1,this._boundEaseRatio=.4,this._momentumEaseRatio=.08,this._isRendering=!1,this.isBound=!1,this.onUpdateCallback=null,this.deltaYLog=[],this.deltaTimeLog=[],this.deltaIndex=0,this._isActive=!0,this._clampWheel=!0}function h(){n.add(this.wrapper,"down",r(p,this)),n.add(this.wrapper,"wheel",r(d,this)),n.onMove.add(v,this),n.onUp.add(m,this)}function p(e){if(!this._isActive||this.movableHeight<1)return;this.isInverted=e.target==this.indicator[0],this.isDown=!0}function d(e){this.moveToPos(this._tPos+e*50,o,this._clampWheel),this.onUpdateCallback&&this.onUpdateCallback(this._pos,this._ratio+e*.1)}function v(e){if(!this._isActive||!this.isDown||!n.isScrollV||this.movableHeight<1)return;this.hasMoved||(this.deltaYLog=[],this.deltaTimeLog=[],this.deltaIndex=0),this.deltaYLog[this.deltaIndex]=e.deltaY*(this.isInverted?-1:1),this.deltaTimeLog[this.deltaIndex++]=e.deltaTime,this.deltaIndex==c-1&&(this.deltaIndex=0),this.hasMoved=!0,this.moveToPos(this._tPos+e.deltaY*(this.isInverted?-this.movableHeight/this.indicatorMovableHeight:1),.5)}function m(e){this.isDown=!1;if(!this._isActive||!this.hasMoved||this.movableHeight<1)return;this.hasMoved=!1;var t=e.deltaY*(this.isInverted?-1:1),n=e.deltaTime,r=Math.max(this.deltaIndex,this.deltaYLog.length);while(r--)t+=this.deltaYLog[r],n+=this.deltaTimeLog[r];var i=this._tPos+t/n*200;this.moveToPos(i,this._momentumEaseRatio)}function g(){this.visibleHeight=this.wrapper.height(),this.height=this.moveContainer.height(),this.movableHeight=Math.max(0,this.height-this.visibleHeight),this.isMovable=this.movableHeight>0,this.indicatorHeight=Math.min(1,this.visibleHeight/this.height)*this.visibleHeight,this.indicatorMovableHeight=this.visibleHeight-this.indicatorHeight,this.indicator.height(this.indicatorHeight),this.indicator.parent()[0]===this.wrapper[0]?this.indicator.toggle(this.isMovable):this.indicator.parent().toggle(this.isMovable),this.moveToRatio(this._tRatio,1)}function y(){this._pos+=(this._tPos-this._pos)*this._easeRatio,this._ratio=this._pos/this.movableHeight,!this.isDown&&(!this.isBound||this._isRendering)&&(this._ratio>0?(this._tRatio-=this._tRatio*this._boundEaseRatio,this._tPos=this._tRatio*this.movableHeight):this._ratio<-1&&(this._tRatio+=(-1-this._tRatio)*this._boundEaseRatio,this._tPos=this._tRatio*this.movableHeight)),this.isBound&&this._bound();var e=this._tPos<-this.movableHeight-1||this._tPos>1;if(!this._isRendering){if(e||Math.abs(this._tPos-this._pos)>1)this._isRendering=!0,s.onRender.add(y,this)}else!e&&~~Math.abs(this._tPos-this._pos)<1&&(this.isDown||this._bound(),this._pos=~~this._tPos,this._isRendering=!1,s.onRender.remove(y,this));this._moveToPos(),this.onUpdateCallback&&this.onUpdateCallback(this._pos,this._ratio)}function b(){this._ratio>0?this._pos=this._tPos=this._ratio=this._tRatio=0:this._ratio<-1&&(this._ratio=this._tRatio=-1,this._pos=this._tPos=this._tRatio*this.movableHeight)}function w(e,t){this.moveToPos(e*this.movableHeight,t)}function E(e,t,n){this._easeRatio=t===o?1:t,this._tPos=e,this._tRatio=this._tPos/(this.movableHeight>0?this.movableHeight:1),n&&(this._tRatio=i(this._tRatio,-1,0),this._tPos=this._tRatio*this.movableHeight),this._isRendering||this.render()}function S(){this._moveElementTo(this.moveContainerStyle,this._pos|0),this._moveElementTo(this.indicatorStyle,this.indicatorMovableHeight*-this._ratio|0)}function T(e){this._isActive=e,this.isDown=!1}var o,u=e.transform3DStyle,a=e.transformStyle,l=f.prototype,c=5,x=u?function(e,t){e[u]="translate3d(0,"+t+"px,0)"}:a?function(e,t){e[a]="translate(0,"+t+"px)"}:function(e,t){e.top=t+"px"};return l.init=h,l._onDown=p,l._onUp=m,l.onResize=g,l._bound=b,l.render=y,l.moveToRatio=w,l.moveToPos=E,l._moveToPos=S,l._moveElementTo=x,l.setActive=T,f}),define("mout/string/trim",["../lang/toString","./WHITE_SPACES","./ltrim","./rtrim"],function(e,t,n,r){function i(i,s){return i=e(i),s=s||t,n(r(i,s),s)}return i}),define("postController",["exports","config","jquery","signals","uiController","inputController","posts/Post","widgets/SimpleScrollPane","mout/string/trim"],function(e,t,n,r,i,s,o,u,a){function w(){N(window.DEFAULT_POSTS);var t=e.DEFAULT_POST;t&&t.success?e.DEFAULT_POST=C(t.data):e.DEFAULT_POST=!1}function E(e){return e=e.toLowerCase(),e=e.replace(/[^\w\s]/gi," "),a(e.replace(/\s+/g," "))}function S(){if(m||h[""])return;m=!0;var e=l[""];v=e.length;var r=e&&v>0?e[v-1].id:-1;n.ajax({type:"GET",dataType:"jsonp",url:"api/search-posts?ln="+t.LANG+"&lastId="+r+"&tagName=&callback=?",success:function(e){m=!1,N(e,!0),d=v},error:function(){m=!1}})}function x(r){var i;r===f?i=r=r="":(r=r,i=E(r));if(i===""||e.parsedTagName===i)return;e.tagName=r,e.parsedTagName=r,g.dispatch({tagName:r,parsedTagName:r});var s=l[r],o=s&&s.length>0?s[s.length-1].id:-1;n.ajax({type:"GET",dataType:"jsonp",url:"api/search-posts"+(r===""?"":"/"+r)+"?ln="+t.LANG+"&tagName="+r+"&callback=?",success:function(e){N(e)},error:T})}function T(e){b.dispatch({tagName:e.input.tagName})}function N(t,n){if(t.success){var r,i=t.data.posts,s=t.input.tagName,o=t.data.tagName;if(i.length===0||i.length<p)h[o]=!0;for(var u=0,a=i.length;u<a;u++)i[u]=C(i[u]);r=l[o]||[];if(!o||r.length==0)r=l[o]=r.concat(i);n||y.dispatch({all:r,posts:i,tagName:s,parsedTagName:o,isLastSearch:e.parsedTagName===o,isRetrievedAll:!!h[o]})}else n||T(t)}function C(e){var t=e.id,n=c[t];return n||(n=c[t]=new o(e),n.preloadThumb()),n}function k(e){var t=C(e),n=e.tags,r;if(n)for(var i in n)l[i]&&(l[i]=[t].concat(r));r=l[""]||[],l[""]=[t].concat(r)}function L(e,r){n.ajax({type:"GET",dataType:"jsonp",url:"api/related-post-count/"+e.id+"?ln="+t.LANG+"&callback=?",success:function(t){t&&t.success&&(e.tags=t.data),r(e)},error:function(){r(e)}})}function A(){var e=l[""],t=e[d];return t||(d=0,t=e[0],S()),d++,t}var f;e.DEFAULT_POST=window.DEFAULT_POST;var l=e.tagNamedPosts={},c=e.posts={},h=e.isTagNamePostsRetrievedAll={},p=t.POST_SEARCH_RESULT_MAX;e.tagName="",e.parsedTagName="";var d=0,v=0,m=!1,g=e.onPostSearchBegan=new r.Signal,y=e.onPostsSearched=new r.Signal,b=e.onPostsSearchErrored=new r.Signal;e.init=w,e.searchPosts=x,e.parseSubmittedPost=k,e.searchRelatedTags=L,e.takePost=A}),define("ui/post2d",["exports","config","jquery","signals","uiController","postController","scene3d/searchPostParticles","inputController","scene3dController","trackingController","preloaderController","utils/socialUtils","mout/function/bind","stageReference","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function H(){m=v[0].style,l.add(v)}function B(){j(),F()}function j(){S=n(".post-2d-img"),g=n(".post-2d-center-wrapper"),y=g[0].style,b=n(".post-2d-content-wrapper"),w=n(".post-2d-share-btn"),x=n(".post-2d-matched-wrapper"),T=n(".post-2d-matched-num"),N=n(".post-2d-matched-singular"),C=n(".post-2d-matched-plural"),k=n(".post-2d-matched-tag"),A=n(".post-2d-message"),L=n(".post-2d-name"),E=n(".post-2d-close-btn")[0].circleBtn}function F(){E.onClicked.add(R),u.add(v,"click",function(e){e.target===this&&R()}),u.add(w,"click",I)}function I(e){var r=n(this),i=r.data("type");c.socialShare(i,"/memory/"+(parseInt(O.id,10)+t.POST_ID_OFFSET),i==="twitter"?TWITTER_POST_DESCRIPTION:POST_DESCRIPTION)}function q(){}function R(){o.visible||a.enableControl(),i.hidePost2d()}function U(e){M=e;var t=new Image;t.src="uploads/posts/"+e.img+"/resized.jpg",S.css("backgroundImage","none"),S.css({backgroundImage:"url(uploads/posts/"+e.img+"/resized.jpg)",width:e.resized_img_width,height:e.resized_img_height}),g.css({width:+e.resized_img_width+P,height:+e.resized_img_height,marginLeft:-e.resized_img_width-P>>1,marginTop:-e.resized_img_height>>1}),L.text(e.name),!e.tags&&!e.isLoadingTags&&(e.isLoadingTags=!0,s.searchRelatedTags(e,W)),e.msgItem||X(e),K(e)}function z(e){f.trackPage({trackPage:"memory-view"}),v.show(),O=e,history.replaceState&&history.replaceState(null,"",t.SITE_URL+"/memory/"+(parseInt(e.id,10)+t.POST_ID_OFFSET)),d.fromTo(g,1,{opacity:0},{opacity:1,ease:"linear"}),d.to(b,0,{width:0}),d.to(b,.6,{delay:.4,width:348}),b[0].scrollpane.onResize()}function W(e){X(e),e===M&&K()}function X(e){var t=n("<div>").text(e.text).html();if(e.tags){var r=e.tags,i=[];for(var s in r)r[s]>1&&i.push(s);if(i.length>0){var o=i.join("|");t=t.replace(new RegExp("(\\b|#)("+o+")\\b","gi"),function(e){return'<span class="post-2d-message-tag" data-tag-name="'+encodeURIComponent(e.toLowerCase())+'" data-tag-posts-count="'+encodeURIComponent(r[e.toLowerCase()])+'">'+e+"</span>"})}}e.msgItem=n("<div>").html(t),e.msgItem.find(".post-2d-message-tag").each(function(){u.add(this,"over",h(V,this)),u.add(this,"out",h($,this)),u.add(this,"click",h(J,this))})}function V(){if(b[0].scrollpane.isDown)return;n(this).addClass("hover");var e=decodeURIComponent(n(this).data("tagName")),t=decodeURIComponent(n(this).data("tagPostsCount"));T.text(t),k.text(e),x.show(),N.css("display",t===1?"inline":"none"),C.css("display",t>1?"inline":"none")}function $(){n(this).removeClass("hover"),x.hide()}function J(){s.searchPosts(n(this).data("tagName")),Q()}function K(){A.find("> *").detach(),A.append(M.msgItem)}function Q(){history.replaceState&&history.replaceState(null,"",t.SITE_URL+"/"),D.dispatch(),d.to(g,.5,{opacity:0,ease:"linear",onComplete:function(){v.hide()}})}function G(){}function Y(e){}var v=n(".post-2d"),m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=t.webkitFilter,D=e.onHidden=new r.Signal,P=348;e.preInit=H,e.init=B,e.preShow=U,e.show=z,e.hide=Q,e.updateFading=Y}),define("scene3d/searchPostParticles",["exports","config","./PostParticle","uiController","scene3d/fakeParticles","scene3dController","ui/post2d","mout/math/lerp","mout/math/clamp","mout/math/norm","THREE","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c){function T(e){var t,r=v;while(r--)t=new n({type:"search",visible:!1}),t.onClick=C,t.floatRadius=(.5+Math.random()*.5)*10,t.floatTime=Math.random()*Math.PI*2,t.floatSpeed=(.3+Math.random()*.7)*.03,y.push(t),e.add(t);o.onHidden.add(k)}function N(t){if(e.visible)m=t,g||O();else{e.visible=!0;var n=s.lookAtTargetPosition,r=s.lookAtHorizontalAngle,o=s.cameraVector.clone();o.y=0,o.normalize(),s.resetCamera({hasControl:!1,lockControl:!0,duration:3,canInteractiveWithPost:!0,cameraOffsetY:100,lookAtOffsetY:230});var f,l,h,d,b,w,E=Math.min(v,t.length),S=(E/(E+1)-.5)*2*Math.PI,x=r+Math.PI/2+(Math.PI-S)/2,T=u(a(E/50,0,1),2,10),N=u(a(E/50,0,1),.25,2),C,k,L,A,M=0;for(f=0;f<E;f++)l=y[f],l.visible=!0,C=t[f],l.changePost(C),w=x+f/E*S,b=500+1e3*Math.random(),A=(Math.random()*2-.5)*300,l.position.x=n.x-Math.sin(w)*b+o.x*A,l.position.z=n.z+Math.cos(w)*b+o.z*A,l.yMax=320+Math.random()*240,k=l.scale.x=l.scale.y=l.scale.z=.05+.08*Math.random(),L=188/Math.min(C.resized_img_width,C.resized_img_height),l.scaleFixScaleRatio=L*4*k*l.uniforms.popScale.value,l.scaleFixScaleOffsetX=-l.scaleFixScaleRatio*C.img_offset_x*(C.resized_img_width-128/L)/2- -174*l.scaleFixScaleRatio,l.scaleFixScaleOffsetY=l.scaleFixScaleRatio*C.img_offset_y*(C.resized_img_height-128/L)/2,h=4+Math.random()*T,d=Math.random()*N,c.killTweensOf(l),c.to(l,h,{fadeValue:1,delay:d,ease:"easeOutCirc"}),c.to(l.uniforms.showScale,0,{value:0}),c.to(l.uniforms.showScale,h,{value:1,delay:d,ease:"easeOutSine"}),h>M&&(M=h);o.y=0,i.uniforms.posOffset.value.x=n.x,i.uniforms.posOffset.value.z=n.z,i.uniforms.cameraVector.value.copy(o.multiplyScalar(p)),c.killTweensOf(i),c.to(i,(M>6?6:M)/6*8,{time:1,ease:"easeOutSine"})}}function C(){var e=this,t=e.post;b=e,e.onOver(),r.preShowPost2d(t),w.copy(s.cameraTargetPosition),E.copy(s.lookAtTargetPosition),S.position.copy(e.position),S.position.y=e.yMax,S.rotation.copy(e.rotation),S.translateX(e.scaleFixScaleOffsetX),S.translateY(e.scaleFixScaleOffsetY),x.position.copy(e.position),x.rotation.copy(e.rotation),x.translateX(e.scaleFixScaleOffsetX),x.translateY(e.scaleFixScaleOffsetY),x.translateZ(s.fixedScalePointLength*e.scaleFixScaleRatio);var n=s.cameraPosOffset;n.tX=(Math.random()>.5?1:-1)*(.5+Math.random()*.5)*90,n.tY=(Math.random()>.5?1:-1)*(.5+Math.random()*.5)*90,n.tZ=(Math.random()>.5?1:-1)*(.5+Math.random()*.5)*90,s.moveTo({hasControl:!1,lockControl:!0,cameraOffsetAnimation:1,duration:2,controller:{blurBlendRatio:0,zoom:0,targetZoom:0,cameraSwingRadius:0},camera:{x:x.position.x,y:x.position.y,z:x.position.z,ease:"easeInOutSine"},lookAt:{x:S.position.x,y:S.position.y,z:S.position.z},cb:function(){r.showPost2d(t)}})}function k(){b&&(b.onOut(),s.moveTo({hasControl:!1,lockControl:!0,canInteractiveWithPost:!0,duration:2,controller:{blurBlendRatio:1,zoom:0,targetZoom:0,cameraSwingRadius:.6},camera:{x:w.x,y:w.y,z:w.z,ease:"easeOutSine"},lookAt:{x:E.x,y:E.y,z:E.z,ease:"easeInSine"},cb:function(){b=null}}))}function L(e,t,n){return a(f(e,t,n),0,1)}function A(){var e=[],t,n,r=s.cameraPosition,i=0,o=s.blurBlendRatio;b&&(i=s.fixedScalePointLength*b.scale.x);for(var u=0,a=y.length;u<a;u++)t=y[u],t.visible?(t.update(),t.position.y=t.fadeValue*t.yMax+t.floatRadius*Math.sin(t.floatTime+=t.floatSpeed)*(1-t.uniforms.pop.value),t.uniforms.fade.value=t.fadeValue,n=t.position.distanceTo(r),t.renderDepth!==-99999&&(t.renderDepth=n),b!==null?b!==t&&(t.uniforms.alpha.value=n<=i?0:Math.pow(L(n,i,i*4),3),t.lookAt(r)):(t.uniforms.alpha.value=1,t.lookAt(r)),e.push(t)):t.renderDepth=99999999;return e.sort(function(e,t){return e.renderDepth-t.renderDepth}),e}function O(){b&&(b.onOut(),b=null),g=!0;var e,t,n,r,s=-1,o=Math.min(v,y.length),f=u(a(o/50,0,1),.5,2),l=u(a(o/50,0,1),.25,1.5);for(e=0;e<o;e++)t=y[e],t.visible&&(n=1+Math.random()*f,r=Math.random()*l,c.killTweensOf(t),c.to(t,n,{fadeValue:0,delay:r,ease:"easeInCirc",onComplete:M}),c.to(t.uniforms.showScale,n,{value:0,delay:r,ease:"easeInSine"}),s=Math.max(n+r,s));c.killTweensOf(i),c.to(i,(s>6?6:s)/6*10,{time:0,ease:"easeInSine",onComplete:function(){_()}})}function M(){var e=this._appliedTarget;e.visible=!1}function _(){g=!1,e.visible=!1;if(m){var t=m;m=null,N(t)}}var h,p=t.SCENE_CAMERA_HORIZONTAL_DISTANCE,d=t.SCENE_CAMERA_VERTICAL_BASE_DISTANCE,v=t.POST_SEARCH_WITH_TAG_RESULT_MAX,m,g=!1;e.visible=!1;var y=e.particvl=[],b=null,w=new l.Vector3,E=new l.Vector3,S=new l.Object3D,x=new l.Object3D;e.init=T,e.update=A,e.show=N,e.hide=O}),define("scene3d/navPostParticles",["exports","config","./PostParticle","postController","scene3dController","utils/noiseUtils","mout/math/lerp","THREE"],function(e,t,n,r,i,s,o,u){function y(e){m=new u.Vector3,g=new u.Vector3;var t,r=h;while(r--)t=new n({type:"nav",visible:!0}),t.scale.x=t.scale.y=t.scale.z=.01,t.position.y=9999,t.uniforms.fade.value=0,t.uniforms.popScale.value=3,v.push(t),e.add(t)}function b(){var e=i.cameraPosition,t=i.lookAtPosition,n=t.x,u=t.z,p=0,y=[],b=0,w=n/a|0,E=u/a|0,S=0,x=i.zoom,T=s.snoise2D,N,C,k,L,A,O,M,_,D,P=a,H=3.141592653589793,B=[],j,F,I=x>f,q=I?1:0;g.x=n-e.x,g.z=u-e.z,g.y=Math.atan2(t.y-e.y,Math.sqrt(g.x*g.x+g.z*g.z));if(I){var R=(o(x,c,l)/2|0)+1,U,z=.5;C=0;for(;;){if(C===0)S++;else{O=(2*S-1)*(2*S-1);if(C===O)E--;else{U=(C-O)*z|0,U===0&&w++,U===1&&E++,U===2&&w--;if(U===3){E--;if((C-O+1)*z===4){S++;if(S>=R)break;z=.5/S}}}}M=w*P,_=E*P,A=T(M*.1,_*.1),N=(A+T(M*.005,_*.005))*.5,N=1-(Math.cos(N*H)+1)/2-A-T(M*.03,_*.03),N-=T(M*.003+2.1,_*.003+2.1)*1.5+T(M*.3+1.1,_*.3+1.1)+T(M*.001+1.1,_*.001+1.1),N*=.5;if(N>.75){B.push(w,E,N,!1),p++;if(p>=h)break}C++}}for(C=0;C<h;C++)D=v[C],D.hasMatch=!1,D.uniforms.fade.value+=(q-D.uniforms.fade.value)*.03;for(C=0;C<p;C++){w=B[C*4],E=B[C*4+1];for(k=0,L=v.length;k<L;k++){D=v[k];if(D.gridX===w&&D.gridY===E){D.hasMatch=!0,B[C*4+3]=D;break}}}var W=0;for(C=0;C<p;C++){w=B[C*4],E=B[C*4+1],N=B[C*4+2],D=B[C*4+3];if(!D){for(k=0,L=v.length;k<L;k++){D=v[k];if(!D.hasMatch){D.gridX=w,D.gridY=E,D.hasMatch=!0,D.changePost(r.takePost()),M=D.sumX=w*P,_=D.sumY=E*P,D.position.x=M+(T(M*.3,_*.3)-.5)*8,D.position.y=T(M*.0013+4,_*.0013+4)*-40+T(M*6e-4+32,_*6e-4+32)*-90+T(M*200+12,_*200+12)*10,D.position.z=_+(T(M*.4,_*.4)-.5)*8,D.uniforms.fade.value=0;break}}W++}m.copy(D.position),m.sub(e),m.x-=i.cameraVector.x*(-0.2+.4*x),m.y-=i.cameraVector.y*(-0.2+.4*x),m.z-=i.cameraVector.z*(-0.2+.4*x),D.scale.x=D.scale.y=D.scale.z=3/m.length()*o(N,.4,1)*(window.devicePixelRatio||1),D.up.copy(g),D.lookAt(e),D.update(),y.push(D);if(W>=d)break}return y.sort(function(e,t){return e-t}),y}var a=t.PARTICLE_FIELD_GRID_SIZE/t.PARTICLE_FIELD_SEGMENT_SIZE,f=t.NAV_SEARCH_ZOOM_THRESHOLD,l=t.NAV_SEARCH_SIZE_MIN,c=t.NAV_SEARCH_SIZE_MAX,h=t.NAV_SEARCH_ITEMS_MAX,p=t.POST_CANVAS_SIZE,d=20;e.visible=!1;var v=e.particles=[],m,g;e.init=y,e.update=b}),define("tutorialController",["exports","config","jquery","mout/math/clamp","mout/math/norm","EKTweener","stageReference"],function(e,t,n,r,i,s,o){function C(){k(),L()}function k(){var e,t,r;for(var i=0,s=p.length;i<s;i++)e=p[i],t=n(".tutoral-page-"+e),r=document.createElement("canvas"),r.width=r.height=E,t.find(".tutorial-page-icon").append(r),v[e]=r.getContext("2d"),l.push(f[e]=t[0]),t[0].__id=e,m[e]=0;if(w){var o;for(var i=0,s=N.length;i<s;i++){o=N[i];for(var u in o)o[u]*=2}}}function L(){}function A(t){var n=f[t];if(n&&!n.__completed){n.__completed=h[t]=!0;var r=e.allCompleted=O();c===n&&(r?q():U(M()))}}function O(){if(e.allCompleted)return!0;var t;for(var n=0,r=l.length;n<r;n++){t=l[n];if(!t.__completed)return!1}return!0}function M(){var e;for(var t=0,n=l.length;t<n;t++){e=l[t];if(!e.__completed)return e}return e}function _(){if(e.allCompleted)return;y=+(new Date),a.show(),s.to(a,.5,{opacity:1,ease:"linear"}),U(M()),o.onRender.add(H)}function D(e,n){w?e.drawImage(t.uiAsset,n.x,n.y,n.width,n.height,-n.width/4,-n.height/4,n.width/2,n.height/2):e.drawImage(t.uiAsset,n.x,n.y,n.width,n.height,-n.width/2,-n.height/2,n.width,n.height)}function P(e,t,n){return r(i(e,t,n),0,1)}function H(){var t=v[d],n=m[d]++,i,s=+(new Date);t.strokeStyle="#fff",t.lineWidth=1,t.fillStyle="#fff";var o=s-y,u=~~(g/1e3/4);g+=o;var a=~~(g/1e3/4);y=s;if(u!==a){a===1?A(p[0]):a===2?A(p[1]):a>=3&&(e.allCompleted=!0,q());return}t.clearRect(0,0,E,E),t.save(),t.translate(S,S),d==="nav"&&(n=r(n,0,200),i=n%100,i*=2.5,t.save(),t.translate(0,-64),B(t,i),t.restore(),t.save(),t.rotate(Math.PI/2),t.translate(0,-64),B(t,i),t.restore(),t.save(),t.rotate(Math.PI),t.translate(0,-64),B(t,i),t.restore(),t.save(),t.rotate(-Math.PI/2),t.translate(0,-64),B(t,i),t.restore(),t.translate(0,50),i=n*.05%10,i=P(i,2,9),t.rotate(-Math.sin(i*Math.PI*2)*10/180*Math.PI),t.translate(0,-50),t.beginPath(),t.arc(0,-20,2.5,0,b,!1),t.fill(),D(t,x),t.restore());if(d==="zoom"){n=r(n,0,200),i=n/2%100,i*=5,t.save(),t.translate(0,-60),B(t,i),t.restore(),i=(n/2+50)%100,i*=5,t.save(),t.rotate(Math.PI),t.translate(0,-12),B(t,i),t.restore(),t.beginPath(),i=n%200*5;var f=P(i,0,100)*Math.PI/2;f+=P(i,400,600)*Math.PI,f+=P(i,900,1e3)*Math.PI/2,t.arc(0,-20-Math.sin(f)*5,2.5,0,b,!1),t.fill(),D(t,x)}if(d==="click"){n=r(n,0,200),t.save(),D(t,T),i=n%100,i=i<20?1:P(i,20,30);var l=Math.abs(Math.sin(i*Math.PI/2));t.scale(1,l),t.globalCompositeOperation="destination-in",t.beginPath(),t.arc(0,-11,25,0,b,!0),t.fill(),t.beginPath(),t.arc(0,11,25,0,b,!1),t.fill(),t.restore(),t.save(),t.scale(1,l),t.beginPath(),t.arc(0,11,25,0,b,!0),t.clip(),t.beginPath(),t.arc(0,-11,25,0,b,!1),t.stroke(),t.beginPath(),t.arc(0,-11,25,0,b,!0),t.clip(),t.beginPath(),t.arc(0,11,25,0,b,!1),t.stroke(),t.restore(),i=P(n%200,20,40),t.save(),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(Math.PI/2),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(Math.PI),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(-Math.PI/2),t.translate(0,-20),I(t,i),t.restore(),i=P(n%200,25,45),t.save(),t.rotate(Math.PI/4),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(Math.PI*3/4),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(Math.PI*5/4),t.translate(0,-20),I(t,i),t.restore(),t.save(),t.rotate(Math.PI*7/4),t.translate(0,-20),I(t,i),t.restore()}t.restore()}function B(e,t){var n;e.save(),e.globalAlpha=1-Math.abs(P(t,0,100)-.5)*2,n=P(t,0,50),e.beginPath(),e.arc(0,18,1.75*n,0,b,!1),e.fill(),e.globalAlpha=1-Math.abs(P(t,25,125)-.5)*2,n=P(t,25,75),e.beginPath(),e.arc(0,13,1.75*n,0,b,!1),e.fill(),e.globalAlpha=1-Math.abs(P(t,50,150)-.5)*2,n=P(t,50,100),e.beginPath(),e.arc(0,8,1.75*n,0,b,!1),e.fill(),e.globalAlpha=1-Math.abs(P(t,75,175)-.5)*2,e.beginPath(),e.moveTo(0,0),e.lineTo(-2.75,2.75),e.lineTo(-1.375,4.125),e.lineTo(0,2.75),e.lineTo(1.375,4.125),e.lineTo(2.75,2.75),e.lineTo(0,0),e.fill(),e.restore()}function j(e){return(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}function F(e){return(e-=1)*e*e+1}function I(e,t){var n=j(t);e.save(),e.globalAlpha=1-Math.abs(t-.5)*2,e.beginPath(),e.moveTo(0,-60*F(t)),e.lineTo(-0.75,-60*n),e.lineTo(.75,-60*n),e.fill(),e.restore()}function q(){o.onRender.remove(H),s.to(a,.5,{opacity:0,ease:"linear",onComplete:function(){a.hide()}})}function R(){e.allCompleted=!0}function U(e){if(e===c)return;c&&z(c),c=e,d=e.__id,m[d]=0,s.to(e,.3,{opacity:1,ease:"linear"})}function z(e){s.to(e,.3,{opacity:0,ease:"linear"})}var u,a=n(".tutorials");e.allCompleted=!1;var f={},l=[],c,h=e.completed={},p=["nav","zoom","click"],d,v={},m={},g=0,y=0,b=Math.PI*2,w=t.isRetina,E=160,S=E/2,x={x:110,y:160,width:39,height:70},T={x:170,y:160,width:44,height:28},N=[x,T];e.init=C,e.complete=A,e.show=_,e.hide=q,e.completeAll=R}),define("steps/addOptionsStep",["exports","config","jquery","scene3d/stepCircle","stepController","EKTweener"],function(e,t,n,r,i,s){function c(){h(),p()}function h(){u=n(".add-steps-add-options-share"),a=n(".add-steps-add-options-look")}function p(){u[0].circleBtn.onOvered.add(d),u[0].circleBtn.onOuted.add(v),u[0].circleBtn.onClicked.add(m),a[0].circleBtn.onClicked.add(g)}function d(){s.to(r.uniforms.focusRatio,.8,{value:1,ease:"easeOutSine"}),s.to(r.uniforms.stepExtraTimes.value,.8,{x:r.uniforms.stepExtraTimes.value.x+5,ease:"easeOutSine"})}function v(){f||s.to(r.uniforms.focusRatio,.8,{value:0})}function m(){f=!0,i.goToStep("upload-methods")}function g(){i.hide()}function y(){f=!1,o.show()}function b(){o.hide()}e.id="add-options",e.animationIndex=2,e.indicatorIndex=0;var o=n(".add-steps-add-options"),u,a,f=!1,l=t.transform3DStyle;e.init=c,e.show=y,e.hide=b}),define("mout/queryString/encode",["../object/forOwn","../lang/isArray","../array/forEach"],function(e,t,n){function r(r){var i=[],s,o;return e(r,function(e,r){t(e)?(s=r+"=",o=new RegExp("&"+r+"+=$"),n(e,function(e){s+=encodeURIComponent(e)+"&"+r+"="}),i.push(s.replace(o,""))):i.push(r+"="+encodeURIComponent(e))}),i.length?"?"+i.join("&"):""}return r}),define("socials/facebook",["exports","config","jquery","signals","mout/queryString/encode","mout/function/bind"],function(e,t,n,r,i,s){function p(){window.fbAsyncInit=function(){FB.init({appId:FACEBOOK_ID,status:!0,xfbml:!0}),c=!0,FB.getLoginStatus(function(t){t.authResponse&&(e.userID=t.authResponse.userID,e.accessToken=t.authResponse.accessToken,h=!0)})},function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t),r.id=n,r.src="//connect.facebook.net/en_US/all.js",i.parentNode.insertBefore(r,i)}(document,"script","facebook-jssdk")}function d(t){if(f||!c)return;f=!0,l=t;if(!h){y();return}var r=t.type;delete t.type,t.access_token=e.accessToken,t.limit=25,r=="albums"?url="https://graph.facebook.com/"+e.userID+"/albums":url="https://graph.facebook.com/"+t.albumId+"/photos",n.ajax({type:"GET",dataType:"jsonp",cache:!1,url:url+i(t),success:function(e){f=!1,e.data?u.dispatch(e):a.dispatch()},error:function(){f=!1,a.dispatch()}})}function v(t,r,i){FB.api("/"+t+"?fields=picture",s(m,i,r)),n.ajax({type:"GET",dataType:"jsonp",cache:!1,url:"https://graph.facebook.com/"+t+"?access_token="+e.accessToken,success:s(m,i,r)})}function m(e,t){var n=t.images;n&&e.call(this,this,g(t))}function g(e){var t=e.images;if(t){var n;for(var r=0,i=t.length;r<i;r++)t[r].width>200&&t[r].width>200&&t[r].width<600&&t[r].width<600&&(n=t[r].source)}return n||e.picture}function y(){FB.login(function(t){t.authResponse?(e.userID=t.authResponse.userID,e.accessToken=t.authResponse.accessToken,f=!1,h=!0,d(l)):(f=!1,h=!1,a.dispatch())},{scope:"user_photos,friends_photos"})}var o;e.hasLoggedIn=!1,e.accessToken=o,e.userID=o;var u=e.onRetrievedSuccess=new r.Signal,a=e.onRetrievedFailed=new r.Signal,f=!1,l=o,c=!1,h=!1;e.retrieveImages=d,e.getImageUrl=v,e.getThumbUrl=g,p()}),define("socials/instagram",["exports","config","jquery","signals","mout/queryString/encode"],function(e,t,n,r,i){function c(){window.open("https://api.instagram.com/oauth/authorize/?client_id="+window.INSTAGRAM_ID+"&redirect_uri="+encodeURIComponent(t.BASE_URL+"/api/instagram-token-callback")+"&response_type=token","_blank","toolbar=no,scrollbars=no,resizable=yes,width=800,height=540")}function h(e){n.ajax({type:"GET",dataType:"jsonp",cache:!1,url:"https://api.instagram.com/v1/users/self"+i(e),success:function(e){a=!1,e&&e.data&&e.data.id?(l=e.data,p(f)):u.dispatch()},error:function(){a=!1,u.dispatch()}})}function p(t){if(a)return;a=!0,f=t||{};if(!e.token){c();return}if(!l){h({access_token:e.token});return}f.access_token=e.token,n.ajax({type:"GET",dataType:"jsonp",cache:!1,url:"https://api.instagram.com/v1/users/"+l.id+"/media/recent"+i(f),success:function(e){a=!1,o.dispatch(e)},error:function(){a=!1,u.dispatch()}})}var s;e.hasLoggedIn=!1,e.token=s;var o=e.onRetrievedSuccess=new r.Signal,u=e.onRetrievedFailed=new r.Signal,a=!1,f=s,l;window.captureInstagramToken=function(t){t?(e.hasLoggedIn=!0,e.token=t):(e.hasLoggedIn=!1,e.token=s),e.hasLoggedIn?(a=!1,p(f)):(a=!1,u.dispatch())},e.retrieveImages=p}),define("mout/object/get",[],function(){function e(e,t){var n=t.split("."),r=n.pop();while(t=n.shift()){e=e[t];if(typeof e!="object"||!e)return}return e[r]}return e}),define("steps/uploadMethodsStep",["exports","config","jquery","scene3d/stepCircle","stepController","uiController","inputController","socials/facebook","socials/instagram","mout/object/get","mout/function/bind","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c){function j(){F(),I()}function F(){w=n(".add-steps-upload-methods-selection-container"),p=n(".add-steps-upload-methods-icons-container .circle-btn"),d=n(".circle-btn-symbol-facebook"),v=n(".circle-btn-symbol-instagram"),m=n(".circle-btn-symbol-local"),b=n(".add-steps-upload-methods-texts-container"),g=n(".add-steps-upload-methods-local-form"),y=n("#local-upload"),E=n(".add-steps-upload-methods-album-container"),S=n(".add-steps-upload-methods-items-scroll-wrapper")[0].scrollpane,S.onUpdateCallback=U,x=n(".add-steps-upload-methods-items-container-inner"),T=n(".add-steps-upload-methods-item").remove(),N=n(".add-steps-upload-methods-album-close-btn"),C=n(".add-steps-upload-methods-album-footer-btn-album-open"),k=n(".add-steps-upload-methods-album-footer-btn-photo-back"),L=n(".add-steps-upload-methods-album-footer-btn-photo-open"),A=n(".add-steps-upload-methods-loading")}function I(){p.each(function(){this.circleBtn.onOvered.add(z),this.circleBtn.onOuted.add(W),this.circleBtn.onClicked.add(X)}),y.change(tt),a.onRetrievedSuccess.add($),a.onRetrievedFailed.add(Z),u.onRetrievedSuccess.add(V),u.onRetrievedFailed.add(et),o.add(N,"click",G),o.add(L,"click",q),o.add(k,"click",R)}function q(){var e=n(".add-steps-upload-methods-item.is-selected");e.length>0&&nt(e.data("img"))}function R(){_=D,x.find("> *").remove(),E.removeClass("has-selected"),x.append(P),E.removeClass("is-facebook is-instagram is-photos is-albums"),E.addClass("is-"+_.type),E.addClass("is-"+_.social),S.onResize()}function U(e,t){!H&&t<-1&&!s.isLocked&&_.loadMore&&(H=!0,setTimeout(function(){H=!1},1e3),_.loadMore())}function z(e){O||at(e.target.data("id"))}function W(e){O||at("default")}function X(e){var t=e.target.data("id");t==="facebook"?(s.lock("facebook-load"),u.retrieveImages({type:"albums"})):t==="instagram"?a.retrieveImages():y.val(null)}function V(e){s.unlock("facebook-load");var t=e.data,n=[],r,i,o;if(t.length>0){var a=t[0].images?"photos":"albums",c=f(e,"paging.cursors.after"),h={type:a,after:c};if(a==="albums")for(i=0,o=t.length;i<o;i++)r=t[i],f(r,"cover_photo")&&n.push({id:f(r,"id"),text:f(r,"name"),thumb:f(r,"cover_photo")});else{for(i=0,o=t.length;i<o;i++)r=t[i],n.push({text:f(r,"name"),thumb:u.getThumbUrl(r),img:f(r,"source")});h.albumId=f(e,"paging.next"),h.albumId?h.albumId=h.albumId.split("/")[3]:h.albumId="0"}K({type:a,social:"facebook",loadMore:c?l(u.retrieveImages,u,h):null,items:n})}}function $(e){var t=f(e,"pagination.next_max_id"),n=e.data,r=[],i;for(var s=0,o=n?n.length:0;s<o;s++)i=n[s],i.type==="image"&&r.push({text:f(i,"caption.text"),thumb:f(i,"images.low_resolution.url"),img:f(i,"images.standard_resolution.url")});K({type:"photos",social:"instagram",loadMore:t?l(a.retrieveImages,a,{max_id:t}):null,items:r})}function J(e,t){e.find(".add-steps-upload-methods-item-image").css("backgroundImage","url("+t+")")}function K(e){var t=_.type!==e.type||_.social!==e.social;c.to(E,.5,{opacity:1,ease:"linear"}),t&&(e.social=="facebook"&&e.type=="photos"?(D=_,P=x.find("> *"),P.detach()):x.find("> *").remove(),E.removeClass("has-selected")),E.removeClass("is-facebook is-instagram is-photos is-albums"),E.addClass("is-"+e.type),E.addClass("is-"+e.social);var n,r,i=e.items;for(var s=0,a=i.length;s<a;s++)r=i[s],n=T.clone(),n.data("img",r.img),n.find(".add-steps-upload-methods-item-name").text(r.text),e.social==="facebook"&&e.type==="albums"?(n.data("id",r.id),u.getImageUrl(r.thumb,J,n)):J(n,r.thumb),o.add(n,"click",Q),x.append(n);var f=t?0:S._tPos;t||e.items.unshift(_.items),_=e,E.show(),S.onResize(),S.moveToPos(f,1)}function Q(){var e=n(this);E.hasClass("is-albums")&&E.hasClass("is-facebook")?u.retrieveImages({type:"photos",albumId:e.data("id")}):(n(".add-steps-upload-methods-item").removeClass("is-selected"),e.addClass("is-selected"),E.addClass("has-selected"))}function G(){Y()}function Y(){_={},E.removeClass("has-selected"),E.hide()}function Z(){}function et(){s.unlock("facebook-load")}function tt(){var e=this.files[0],t=e.size;if(t>5242880)s.showErrorMsgs(B.imageSizeNotValid);else{var n=new FileReader,r=new Image;n.onload=function(e){r.src=e.target.result},r.onload=function(){r.width<512||r.height<512?s.showErrorMsgs(B.imageResolutionNotValid):r.width>5e3||r.height>5e3?s.showErrorMsgs(B.imageResolutionNotValid):nt(e)},r.onerror=function(){s.showErrorMsgs(B.incorrectImageFormat)},n.readAsDataURL(e)}}function nt(e){var r,i={url:"api/upload-image",type:"POST",dataType:"json",success:st,error:ot,cache:!1,contentType:!1,processData:!1};typeof e=="string"?(r=new FormData,r.append("url",e)):(r=new FormData(g[0]),i.mimeType="multipart/form-data"),r.append("ln",t.LANG),i.data=r,rt(),n.ajax(i)}function rt(){s.lock("upload-image"),A.show(),c.to(A,0,{opacity:0}),c.to(A,.5,{delay:.3,opacity:1,ease:"linear"}),c.to(w,.3,{opacity:0,ease:"linear"}),c.to(E,.3,{opacity:0,ease:"linear",onComplete:function(){E.hide()}})}function it(){s.unlock("upload-image"),A.hide(),c.to(A,.5,{opacity:0,ease:"linear"}),c.to(w,.3,{opacity:1,ease:"linear"}),c.to(E,.3,{opacity:1,ease:"linear"})}function st(e){if(e.success){s.unlock("upload-image"),i.data.fileId=e.data.fileId;var t=new Image;t.onload=function(){i.data.image=t,i.goToStep("adjustment")},t.src="uploads/tmp/"+i.data.fileId+"/resized.jpg",t.width&&t.onload()}else ot(e)}function ot(e){s.showError(e),it()}function ut(){i.disableBackBtn(),i.disableValidateBtn(),i.hideBackBtn(),i.hideValidateBtn(),h.show(),at("default"),O=!1,c.to(A,0,{opacity:0}),c.to(w,0,{opacity:1}),c.to(E,0,{opacity:0}),E.hide(),x.find("> *").remove(),c.fromTo(d,.5,{transform3d:"translate3d(60px,0,0)",opacity:0},{transform3d:"translate3d(0,0,0)",opacity:1}),c.fromTo(v,.5,{opacity:0},{opacity:1,ease:"linear"}),c.fromTo(m,.5,{transform3d:"translate3d(-60px,0,0)",opacity:0},{transform3d:"translate3d(0,0,0)",opacity:1}),c.fromTo(b,.2,{opacity:0},{opacity:1,ease:"linear"}),c.to(r.uniforms.focusRatio,.3,{value:1,ease:"easeOutCubic"})}function at(e){h.removeClass("is-default is-facebook is-instagram is-local"),e&&h.addClass("is-"+e)}function ft(){at(),h.hide(),Y(),c.to(r.uniforms.focusRatio,.3,{value:0,ease:"easeInCubic"})}function lt(){_.type?G():i.hide()}e.id="upload-methods",e.animationIndex=2,e.indicatorIndex=0;var h=n(".add-steps-upload-methods"),p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=!1,M=t.transform3DStyle,_={},D={},P,H=!1,B=t.ERROR_MESSAGES;e.init=j,e.show=ut,e.hide=ft,e.onBGClick=lt}),define("steps/adjustmentStep",["exports","config","jquery","stepController","inputController","scene3d/postSubmitCircle","mout/math/clamp","mout/math/norm","mout/math/lerp","EKTweener","stageReference"],function(e,t,n,r,i,s,o,u,a,f,l){function I(){q(),R()}function q(){h=document.createElement("canvas"),h.width=h.height=S,p=h.getContext("2d"),p.lineCap="round",c.append(h),b=t.uiAsset;if(w){var e;for(var n=0,r=F.length;n<r;n++){e=F[n];for(var i in e)e[i]*=2}}}function R(){i.add(h,"down",U),i.onMove.add(z),i.onUp.add(W)}function U(){d=!0}function z(e){d&&(g=o(g+e.deltaX/N,-1,1),y=o(y+e.deltaY/C,-1,1))}function W(e){d&&(d=!1)}function X(){var e=r.data.image;if(e){k=e.width,L=e.height;var t=Math.min(k,L)-T*2;A=S/t,O=k*A,M=L*A,N=(k-t)/2,C=(L-t)/2}}function V(){v=m=g=y=0,_=!1,f.to(c,0,{opacity:1}),X(),h.style.display="block",c.show(),J(),l.onRender.add(tt)}function $(){_=!1,f.to(c,.5,{opacity:0,ease:"linear",onComplete:function(){c.hide(),l.onRender.remove(tt)}})}function J(){f.fromTo(D,P?0:3.5,{animation:0},{animation:1,ease:"linear",onComplete:function(){r.enableBackBtn(),r.enableValidateBtn(),r.showBackBtn(K),r.showValidateBtn(Q),P=!0,_=!0,f.to(D,.5,{animation:2,ease:"linear"})}})}function K(){r.goToStep("upload-methods")}function Q(){r.data.imgOffsetX=-v,r.data.imgOffsetY=-m;var e=s.ctx;e.save(),e.translate(v*N*A,m*C*A),e.drawImage(r.data.image,s.SIZE/2-O/2,s.SIZE/2-M/2,O,M),e.restore(),s.uniforms.texture.value.needsUpdate=!0,f.to(s.uniforms.fade,0,{value:1}),f.fromTo(s.uniforms.animation,.35,{value:0},{value:1,ease:"linear"}),h.style.display="none",r.goToStep("message")}function G(e,t,n){return o(u(e,t,n),0,1)}function Y(e){return(e-=1)*e*e+1}function Z(e){return-(Math.cos(E*e)-1)/2}function et(e){w?p.drawImage(b,e.x,e.y,e.width,e.height,-e.width/4,-e.height/4,e.width/2,e.height/2):p.drawImage(b,e.x,e.y,e.width,e.height,-e.width/2,-e.height/2,e.width,e.height)}function tt(){p.clearRect(0,0,S,S);var e=D.animation,t,n,i;if(e>1){var s=e-1;p.save(),p.globalAlpha=s,p.beginPath(),p.arc(x,x,140,0,2*Math.PI,!1),p.fill(),p.globalCompositeOperation="source-in";var u=r.data.image;u&&(v+=(g-v)*.2,m+=(y-m)*.2,p.translate(v*N*A,m*C*A),p.drawImage(u,x-O/2,x-M/2,O,M)),p.restore()}p.beginPath(),p.strokeStyle="rgba(255,255,255,.5)",p.lineWidth=1,p.setLineDash([3,5]),p.arc(x,x,144.5,0,2*Math.PI,!1),p.stroke();if(e<2){p.save(),p.globalAlpha=1-G(e,1,2);var a=o(e,0,1);p.beginPath(),p.strokeStyle="#fff",p.lineWidth=3,p.setLineDash([]),p.arc(x,x,141.5,-E/2,-E/2+Math.PI*2*a,!1),p.stroke(),p.beginPath(),p.strokeStyle="rgba(255,255,255,.25)",p.lineWidth=1,p.setLineDash([3]),p.arc(x,x,47,0,2*Math.PI,!1),p.stroke(),p.save(),p.translate(x,x),n=0,i=0,a<.5?(t=Z(G(a,.1,.425)),i=t*40):a<.925?(t=Z(G(a,.5,.925)),n=t*10,i=40+t*-50,t=Math.sin(t*E/2)*1-t,n+=t*60):(n=10,i=-10),p.translate(n,i),p.beginPath(),p.strokeStyle="rgba(255,255,255,.25)",p.lineWidth=1,p.setLineDash([2,2]),w?p.rect(-H.width/4,-H.height/4,H.width/2,H.height/2):p.rect(-H.width/2,-H.height/2,H.width,H.height),p.stroke(),p.restore(),p.save(),p.translate(x,x),n=0,i=0,a<.5?(t=Z(G(a,.1,.3)),i=t*40):a<.8?(t=Z(G(a,.5,.8)),n=t*10,i=40+t*-50,t=Math.sin(t*E/2)*1-t,n+=t*60):(n=10,i=-10),p.translate(n,i),et(H),n=0,i=0,a<.1?(t=Z(1-G(a,0,.1)),n=t*12,i=t*-16):a<.5?(t=1-Math.abs(G(a,.35,.5)-.5)*2,n=Math.sin(t*E/2)*-5-t*3,t=1-Math.abs(G(a,.3,.5)-.5)*2,i=Math.sin(t*E/2)*3+t*6):(t=Z(G(a,.8,1)),n=t*8,i=t*-10),p.translate(40+n,0+i),et(B),p.restore(),p.restore()}p.save(),p.translate(x,x),et(j),p.restore()}e.id="adjustment",e.animationIndex=3,e.indicatorIndex=0;var c=n(".add-steps-adjustment"),h,p,d=!1,v=0,m=0,g=0,y=0,b,w=t.isRetina,E=Math.PI,S=290,x=145,T=t.POST_IMAGE_PADDING,N=0,C=0,k=0,L=0,A=1,O=0,M=0,_=!1,D={animation:0},P=t.SKIP_ADJUSTMENT_TUTORIALS,H={x:261,y:38,width:139,height:79},B={x:343,y:0,width:22,height:30},j={x:368,y:0,width:29,height:29},F=[H,B,j];e.init=I,e.show=V,e.hide=$,e.render=tt}),define("mout/string/interpolate",["../lang/toString","../object/get"],function(e,t){function r(r,i,s){r=e(r);var o=function(n,r){return e(t(i,r))};return r.replace(s||n,o)}var n=/\{\{([^\}]+)\}\}/g;return r}),define("steps/messageStep",["exports","config","jquery","stepController","inputController","postController","uiController","mout/string/trim","mout/object/get","mout/lang/isArray","mout/string/interpolate","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c){function D(){P(),H()}function P(){p=n(".add-steps-message-items-wrapper"),d=n(".add-steps-message-name-wrapper"),v=d.find(".add-steps-message-input"),m=n(".add-steps-message-email-wrapper"),g=m.find(".add-steps-message-input"),y=n(".add-steps-message-message-wrapper"),b=y.find(".add-steps-message-message-prefix"),w=y.find(".add-steps-message-input"),C=y[0].scrollpane,k=v.html(),L=g.html(),A=w.html(),x=n(".add-steps-message-terms"),T=n(".add-steps-message-terms-i-accept"),N=n(".add-steps-message-terms-link"),E=n(".add-steps-message-input, .add-steps-message-input, .add-steps-message-input, .add-steps-message-terms-i-accept"),v[0].__focusY=110,v[0].__id="name",v[0].__container=d,v[0].__defaultHTML=k,v[0].__defaultText=u(v.text()),g[0].__focusY=63,g[0].__id="email",g[0].__container=m,g[0].__defaultHTML=L,g[0].__defaultText=u(g.text()),w[0].__focusY=23,w[0].__id="message",w[0].__container=y,w[0].__defaultHTML=A,w[0].__defaultText=u(w.text()),T[0].__focusY=23,T[0].__id="terms",T[0].__container=x,E.each(function(){S[this.__id]=this})}function H(){E.focus(function(){R(this.__id,.5)}),v.add(g).add(w).on("input",F),v.add(g).on("keypress",function(e){return e.which==13?!1:(this.__skipLineBreakParsing=!0,!0)}),i.add(N,"click",B),i.add(T,"click",j),v.blur(z),g.blur(W),w.blur(X)}function B(){R("terms",.5),o.showTerms()}function j(){R("terms",.5),T.toggleClass("selected"),$()?r.enableValidateBtn():r.disableValidateBtn()}function F(){var e=n(this).html(),t=n(this).text();if(e.indexOf("<br>")>-1||e.lastIndexOf("<div>")!==-1)this.innerHTML=t,q(this);t=u(n(this).text()),t.length==0&&this.__id!=="message"&&(n(this).html(this.__defaultHTML),I(this)),this.__skipLineBreakParsing=!1,this===w[0]&&C.onResize()}function I(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function q(e){if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(typeof document.body.createTextRange!="undefined"){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}function R(e,t){var n=S[e],r=n.__container;c.to(p,t,{transform3d:"translate3d(0, "+n.__focusY+"px, 0)"}),e==="name"?z()||(v.text(M),q(v[0])):e==="email"?g.text()===g[0].__defaultText&&(g.text(M),q(g[0])):e==="message"&&(X()||w.text(M));var i=-1;E.removeClass("focus"),E.each(function(e){if(this===n)return i=e,!1}),E.each(function(e){e>i+1?c.to(this.__container,t,{opacity:0,ease:"linear",onComplete:function(){this._appliedTarget.visibility="hidden"}}):(this.__container.css("visibility","visible"),c.to(this.__container,t,{opacity:e==i?1:.75,ease:"linear"})),this.__container.toggleClass("focus",e==i)})}function U(){r.enableBackBtn(),r.disableValidateBtn(),r.showBackBtn(V),r.showValidateBtn(J),h.show(),w.css({textIndent:b.width()+5}),G()}function z(){var e=u(v.text());e=e.replace(M,"");var t=e.length>1&&e!==v[0].__defaultText;return d.toggleClass("completed",t),t||v.html(v[0].__defaultHTML),t}function W(){var e=u(g.text());e=e.replace(M,"");var t=/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/.test(e);return m.toggleClass("completed",t),t||g.html(g[0].__defaultHTML),t}function X(){var e=u(w.text());e=e.replace(M,"");var t=e.length>0&&e!==w[0].__defaultText;return y.toggleClass("completed",t),t||w.html(w[0].__defaultHTML),t}function V(){r.goToStep("adjustment")}function $(){return T.hasClass("selected")}function J(){if(!z()){o.showErrorMsgs(O.name);return}if(!W()){o.showErrorMsgs(O.email);return}if(!X()){o.showErrorMsgs(O.message);return}if(!$()){o.showErrorMsgs(O.terms);return}var e=new FormData;e.append("ln",t.LANG),e.append("name",v.text().replace(/(\u00a0|\u200b)/g,"")),e.append("email",g.text().replace(/(\u00a0|\u200b)/g,"")),e.append("message",w.text().replace(/(\u00a0|\u200b)/g,"")),e.append("imgOffsetX",r.data.imgOffsetX),e.append("imgOffsetY",r.data.imgOffsetY),e.append("fileId",r.data.fileId),o.lock("post-submit"),n.ajax({url:"api/post",type:"POST",dataType:"json",success:K,data:e,error:Q,cache:!1,contentType:!1,processData:!1})}function K(e){e.success?(s.parseSubmittedPost(e.data),r.data.id=e.data.id,o.unlock("post-submit"),r.goToStep("congrats")):Q(e)}function Q(e){o.unlock("post-submit");var t,n,r,i;if(e&&e.errorMsg){n=e.errorMsg,f(n)||(n=[n]);for(r=0,i=n.length;r<i;r++)t=n[r],t==="badWord"?t=l(O[t],{interpolation:e.data.badWords.join(", ")}):t=O[t]||O.unexpected,n[r]=t}o.showErrorMsgs(n)}function G(){v.html(k),g.html(L),w.html(A),d.removeClass("completed"),m.removeClass("completed"),y.removeClass("completed"),T.removeClass("selected"),R("name",0),z()}function Y(){h.hide()}e.id="message",e.animationIndex=3,e.indicatorIndex=1;var h=n(".add-steps-message"),p,d,v,m,g,y,b,w,E,S={},x,T,N,C,k,L,A,O=t.ERROR_MESSAGES,M=n("<p>&#8203;</p>").text(),_=t.transform3DStyle;e.init=D,e.show=U,e.hide=Y}),define("steps/congratsStep",["exports","config","jquery","scene3d/stepCircle","scene3d/postSubmitCircle","soundController","scene3dController","stepController","inputController","utils/socialUtils","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l){function m(){g(),y()}function g(){h=n(".add-steps-congrats-share")}function y(){a.add(h,"click",w)}function b(){d&&(clearTimeout(p),S())}function w(e){var r=n(this),i=r.data("type");f.socialShare(i,"/memory/"+(parseInt(u.data.id,10)+t.POST_ID_OFFSET),i==="twitter"?TWITTER_POST_DESCRIPTION:POST_DESCRIPTION)}function E(){d=!1,c.css("display","table"),s.playAdd(),u.disableBackBtn(),u.disableValidateBtn(),u.hideBackBtn(),u.hideValidateBtn(),l.to(i.uniforms.animation,8,{value:5,ease:"linear"}),o.resetCamera({lockControl:!0,hasControl:!1,duration:5,lookAt:{delay:1.5},camera:{delay:1.5}}),l.to(c,0,{opacity:1,delay:4,ease:"linear",onStart:function(){d=!0},onComplete:function(){p=setTimeout(S,8500)}})}function S(){l.to(c,1,{opacity:0,onComplete:function(){c.hide(),u.hide()}})}e.id="congrats",e.animationIndex=4,e.animationDuration=2,e.indicatorIndex=2;var c=n(".add-steps-congrats"),h,p,d=!1,v=t.transform3DStyle;e.init=m,e.show=E,e.hide=S,e.onBGClick=b}),define("stepController",["exports","config","jquery","signals","uiController","inputController","tutorialController","trackingController","scene3d/stepCircle","scene3d/postSubmitCircle","scene3dController","steps/addOptionsStep","steps/uploadMethodsStep","steps/adjustmentStep","steps/messageStep","steps/congratsStep","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function L(){O(),M(),V()}function A(e){for(var t=0,n=k.length;t<n;t++)if(e===k[t])return t;return-1}function O(){var e;for(var t=0,n=k.length;t<n;t++)e=k[t],C[e.id]=e,e.init()}function M(){S[0].circleBtn.onClicked.add(D),T[0].circleBtn.onClicked.add(P),s.add(y,"click",_)}function _(e){e.target===this&&w&&(w.onBGClick?w.onBGClick():j())}function D(){x()}function P(){N()}function H(e){var t=C[e];u.trackPage({trackPage:"memory-post-"+(A(t)+1)}),t!==w&&(w&&w.hide(),E.removeClass("selected").eq(t.indicatorIndex).addClass("selected"),m.to(a.uniforms.animationRatio,t.animationDuration===g?1:t.animationDuration,{value:t.animationIndex,ease:"easeOutSine"}),t.show(),w=t)}function B(e){var n=200;l.disableControl(),l.resetCamera({lockControl:!0,hasControl:!1,duration:3,cameraOffsetY:n,lookAtOffsetY:n+t.SCENE_CAMERA_VERTICAL_BASE_DISTANCE-110}),e||(e="add-options"),y.show(),m.to(a.uniforms.opacity,.5,{value:1}),m.fromTo(y,.5,{opacity:0},{opacity:1,ease:"linear"}),H(e)}function j(){l.resetCamera({lockControl:!0,hasControl:!0,duration:2}),I(),z(),w&&w.hide(),E.removeClass("selected"),w=null,m.to(a.uniforms.opacity,.5,{value:0}),m.to(f.uniforms.fade,.5,{value:0}),m.to(y,.5,{opacity:0,ease:"linear",onComplete:function(){y.hide(),m.to(a.uniforms.animationRatio,0,{value:0})}}),o.show(),i.showNav()}function F(e){x=e,S.show(),m.to(S,.5,{opacity:1,transform3d:"translate3d(0,0,0)"})}function I(){m.to(S,.5,{opacity:0,transform3d:"translate3d(-40px,0,0)",onComplete:function(){S.hide()}})}function q(){S[0].circleBtn.enable()}function R(){S[0].circleBtn.disable()}function U(e){N=e,T.show(),m.to(T,.5,{opacity:1,transform3d:"translate3d(0,0,0)"})}function z(){m.to(T,.5,{opacity:1,transform3d:"translate3d(40px,0,0)",onComplete:function(){T.hide()}})}function W(){T[0].circleBtn.enable()}function X(){T[0].circleBtn.disable()}function V(e){}var g,y=e.container=n(".add-steps"),b=n(".add-steps-indicators, .add-steps-add-options-look, .add-steps-upload-methods, .add-steps-upload-methods-album-container, .add-steps-adjustment, .add-steps-indicators, .add-steps-add-steps-congrats, .add-steps-back-btn"),w,E=n(".add-steps-indicator"),S=n(".add-steps-back-btn"),x,T=n(".add-steps-validate-btn"),N;e.data={};var C={},k=[c,h,p,d,v];e.init=L,e.goToStep=H,e.show=B,e.hide=j,e.showBackBtn=F,e.hideBackBtn=I,e.enableBackBtn=q,e.disableBackBtn=R,e.showValidateBtn=U,e.hideValidateBtn=z,e.enableValidateBtn=W,e.disableValidateBtn=X,e.updateFading=V}),define("mout/lang/isPlainObject",[],function(){function e(e){return!!e&&typeof e=="object"&&e.constructor===Object}return e}),define("mout/object/deepMixIn",["./forOwn","../lang/isPlainObject"],function(e,t){function n(t,n){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o&&e(o,r,t);return t}function r(e,r){var i=this[r];t(e)&&t(i)?n(i,e):this[r]=e}return n}),define("amd/postprocessing/EffectComposer",["THREE"],function(e){e.EffectComposer=function(t,n){this.renderer=t;if(n===undefined){var r=window.innerWidth||1,i=window.innerHeight||1,s={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1};n=new e.WebGLRenderTarget(r,i,s)}this.renderTarget1=n,this.renderTarget2=n.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],e.CopyShader===undefined&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new e.ShaderPass(e.CopyShader)},e.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(t){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var n=!1,r,i,s=this.passes.length;for(i=0;i<s;i++){r=this.passes[i];if(!r.enabled)continue;r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n);if(r.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof e.MaskPass?n=!0:r instanceof e.ClearMaskPass&&(n=!1)}},reset:function(e){e===undefined&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var n=this.renderTarget1.clone();n.width=e,n.height=t,this.reset(n)}},e.EffectComposer.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),e.EffectComposer.quad=new e.Mesh(new e.PlaneGeometry(2,2),null),e.EffectComposer.scene=new e.Scene,e.EffectComposer.scene.add(e.EffectComposer.quad)}),define("amd/postprocessing/SavePass",["THREE"],function(e){e.SavePass=function(t){e.CopyShader===undefined&&console.error("THREE.SavePass relies on THREE.CopyShader");var n=e.CopyShader;this.textureID="tDiffuse",this.uniforms=e.UniformsUtils.clone(n.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.renderTarget=t,this.renderTarget===undefined&&(this.renderTargetParameters={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1},this.renderTarget=new e.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters)),this.enabled=!0,this.needsSwap=!1,this.clear=!1,this.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneGeometry(2,2),null),this.scene.add(this.quad)},e.SavePass.prototype={render:function(e,t,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n),this.quad.material=this.material,e.render(this.scene,this.camera,this.renderTarget,this.clear)}}}),define("amd/postprocessing/MaskPass",["THREE"],function(e){e.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},e.MaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.colorMask(!1,!1,!1,!1),i.depthMask(!1);var s,o;this.inverse?(s=0,o=1):(s=1,o=0),i.enable(i.STENCIL_TEST),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),i.stencilFunc(i.ALWAYS,s,4294967295),i.clearStencil(o),e.render(this.scene,this.camera,n,this.clear),e.render(this.scene,this.camera,t,this.clear),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),i.stencilFunc(i.EQUAL,1,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},e.ClearMaskPass=function(){this.enabled=!0},e.ClearMaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.disable(i.STENCIL_TEST)}}}),define("amd/postprocessing/RenderPass",["THREE"],function(e){e.RenderPass=function(t,n,r,i,s){this.scene=t,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s!==undefined?s:1,this.oldClearColor=new e.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},e.RenderPass.prototype={render:function(e,t,n,r){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,n,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}}),define("amd/postprocessing/ShaderPass",["THREE"],function(e){e.ShaderPass=function(t,n){this.textureID=n!==undefined?n:"tDiffuse",this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},e.ShaderPass.prototype={render:function(t,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),e.EffectComposer.quad.material=this.material,this.renderToScreen?t.render(e.EffectComposer.scene,e.EffectComposer.camera):t.render(e.EffectComposer.scene,e.EffectComposer.camera,n,this.clear)}}}),define("amd/shaders/CopyShader",["THREE"],function(e){e.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}}),define("amd/shaders/BlendShader",["THREE"],function(e){e.BlendShader={uniforms:{tDiffuse:{type:"t",value:null},tDiffuse2:{type:"t",value:null},v:{type:"f",value:1/512},h:{type:"f",value:1/512},r:{type:"f",value:.35},blendRatio:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tDiffuse2;","uniform float v;","uniform float h;","uniform float r;","uniform float blendRatio;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","float hh = h * abs( r - vUv.y );","vec4 base = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 center = texture2D( tDiffuse2, vec2( vUv.x, vUv.y ) );","sum += texture2D( tDiffuse2, vec2( vUv.x - 2.0 * hh, vUv.y - 2.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse2, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse2, vec2( vUv.x + 2.0 * hh, vUv.y - 2.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse2, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.1531;","sum += center * 0.1633;","sum += texture2D( tDiffuse2, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse2, vec2( vUv.x - 2.0 * hh, vUv.y + 2.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse2, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse2, vec2( vUv.x + 2.0 * hh, vUv.y + 2.0 * vv ) ) * 0.051;","gl_FragColor = mix(base * (1. + blendRatio * 3.), mix(max(center, sum), center / (vec4(1.0) - sum), .9), blendRatio * .3);","}"].join("\n")}}),define("amd/shaders/HorizontalTiltShiftShader",["THREE"],function(e){e.HorizontalTiltShiftShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512},r:{type:"f",value:.35},blendRatio:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","uniform float blendRatio;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","vec4 center = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += center * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}}),define("amd/shaders/RGBShiftShader",["THREE"],function(e){e.RGBShiftShader={uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:0},angle:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")}}),define("amd/shaders/VerticalTiltShiftShader",["THREE"],function(e){e.VerticalTiltShiftShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512},r:{type:"f",value:.35},blendRatio:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","uniform float blendRatio;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","vec4 center = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += center * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}}),define("text!shaders/custom/vertex.glsl",[],function(){return"varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"}),define("text!shaders/custom/fragment.glsl",[],function(){return"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform float alpha;\nuniform float gradientOffset;\nuniform float gradientOpacity;\nuniform float vRadius;\nuniform float vSoftness;\nuniform float vAlpha;\nuniform float zoom;\nuniform float opacity;\n\n\nconst float PI = 3.14159265358979323846264;\n\n\nvarying vec2 vUv;\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvoid main() {\n    vec4 color = texture2D(tDiffuse, vUv);\n\n    color.rgb = mix(color.rgb, vec3(.043, .043, .043), 1.0 - opacity);\n\n    float r = rand(gl_FragCoord.xy + rand(gl_FragCoord.yx + time));\n    color.rgb = mix(color.rgb, vec3(r, r, r), alpha);\n\n    // radial gradient\n    // float distanceToGradientCenter = clamp(length((vUv - vec2(.5, .5 + zoom + .5)) * 2.0), 0., 1.);\n    // color.rgb = mix(color.rgb, mix(color.rgb, vec3(.909, .945,.95), .1), 1. - smoothstep(0., 1., distanceToGradientCenter));\n\n    // linear gradient\n    float linearGradientRatio = clamp((1. - vUv.y * (.85 + sin((vUv.x * 1.0 * PI + gradientOffset )) * .05) + pow(zoom, 1.3)) * 2., 0., 1.);\n    color.rgb = mix(color.rgb, mix(color.rgb, vec3(.909, .945,.95), gradientOpacity), 1. - smoothstep(0., 1., linearGradientRatio));\n\n    vec2 posToCenter = (vUv - vec2(.5, .5)) * 2.0;\n    float len = length(posToCenter);\n    float vignette = smoothstep(vRadius, vRadius-vSoftness, len);\n    color.rgb = mix(color.rgb, color.rgb * vignette, vAlpha);\n    gl_FragColor = color;\n}\n"}),define("amd/shaders/CustomShader",["THREE","text!shaders/custom/vertex.glsl","text!shaders/custom/fragment.glsl"],function(e,t,n){t=e._evalReplace(t,{THREE:e}),n=e._evalReplace(n,{THREE:e}),e.CustomShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},alpha:{type:"f",value:.011},gradientOffset:{type:"f",value:0},gradientOpacity:{type:"f",value:.1},vRadius:{type:"f",value:1},vSoftness:{type:"f",value:1},zoom:{type:"f",value:0},opacity:{type:"f",value:1},vAlpha:{type:"f",value:.36}},vertexShader:t,fragmentShader:n}}),define("scene3dController",["exports","config","jquery","scene3d/map","scene3d/stepCircle","scene3d/postSubmitCircle","scene3d/PostParticle","scene3d/ParticleField","scene3d/searchPostParticles","scene3d/navPostParticles","scene3d/fakeParticles","stepController","uiController","inputController","tutorialController","mout/object/deepMixIn","mout/math/norm","mout/math/lerp","mout/math/clamp","THREE","stageReference","EKTweener","amd/postprocessing/EffectComposer","amd/postprocessing/SavePass","amd/postprocessing/MaskPass","amd/postprocessing/RenderPass","amd/postprocessing/ShaderPass","amd/shaders/CopyShader","amd/shaders/BlendShader","amd/shaders/HorizontalTiltShiftShader","amd/shaders/RGBShiftShader","amd/shaders/VerticalTiltShiftShader","amd/shaders/CustomShader"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){function Lt(){if(t.IS_DEV&&!0){var n=new dat.GUI,r={play:function(){var t=e.cameraVector.clone().normalize();t.y=0,l.uniforms.posOffset.value.x=e.lookAtTargetPosition.x,l.uniforms.posOffset.value.z=e.lookAtTargetPosition.z,l.uniforms.cameraVector.value.copy(t.multiplyScalar(N)),E.killTweensOf(l),E.to(l,0,{time:0,fade:0}),E.to(l,15,{time:1,ease:"easeOutSine"}),E.to(l,.5,{fade:1,ease:"linear"})}},i=n.addFolder("fakeParticles");i.add(l,"fade",0,1).name("fade"),i.add(l,"time",0,1).name("time"),i.add(l.uniforms.skip,"value",1,1e3).name("skip"),i.add(l.uniforms.amount,"value",1,6e4).name("amount"),i.add(l.uniforms.heightPower,"value",.5,1.8).name("heightPower"),i.add(r,"play").name("play"),i.open()}}function At(){P=n(".base-3d-container"),H=P[0].style,it=new b.PerspectiveCamera(100,1,1,3e3),at=new b.Projector,ft=new b.Raycaster,ot=new b.Scene,r.init(),ot.add(r.particles),i.init(),ot.add(i.particles),s.init(),ot.add(s.mesh),st=new b.Scene,st.fog=new b.FogExp2(460551,6e-4);for(var o=0,c=A*A;o<c;o++)lt[o]=new u(t.amount,_+o%A*O,_+Math.floor(o/A)*O),st.add(lt[o].particles);st.add(R),l.init(st),a.init(st),f.init(st),ut=new b.WebGLRenderer({antialias:!0,targetHorizontalRotation:!0,sortObjects:!1}),ut.setClearColor(460551,1),ut.autoClear=!1,ht=new b.EffectComposer(ut);var h=new b.RenderPass(st,it);mt=e.rgbShift=new b.ShaderPass(b.RGBShiftShader),yt=new b.SavePass,pt=e.hblur=new b.ShaderPass(b.HorizontalTiltShiftShader),dt=e.vblur=new b.ShaderPass(b.VerticalTiltShiftShader),vt=e.blurBlend=new b.ShaderPass(b.BlendShader),vt.uniforms.tDiffuse2.value=yt.renderTarget,gt=e.customShader=new b.ShaderPass(b.CustomShader),gt.noiseSpeed=0,ht.addPass(h),ht.addPass(yt),ht.addPass(mt),ht.addPass(pt),ht.addPass(dt),ht.addPass(vt),ht.addPass(gt),gt.renderToScreen=!0,mt.uniforms.amount.value=4e-4;var d=e.cameraPosOffset;d.tX=0,d.tY=0,d.tZ=0,d.a=0,P.append(ut.domElement),Ht(),p.add(P,"down",Mt),p.onMove.add(_t),p.onUp.add(Dt),p.add(P,"wheel",Pt),D.addEventListener("keydown",Ot),D.addEventListener("keyup",Ot),w.onResize.add(Ht),w.onRender.add(Ft),E.to(gt.uniforms.alpha,3,{value:t.DEFAULT_NOISE_RATIO,ease:"linear"}),Jt(),Lt()}function Ot(t){var n=t.type.indexOf("down")>-1;if(!e.hasControl&&n)return;var r=t.keyCode;switch(r){case 68:X=n;break;case 83:V=n;break;case 65:$=n;break;case 87:J=n}}function Mt(e){K=!0}function _t(t){wt=t.x/B*2-1,Et=-t.y/j*2+1;if(!e.hasControl||!K)return;tt+=t.deltaX*.002*(1-e.zoom*.25),nt-=t.deltaY*(1-e.zoom*.75)*.7}function Dt(t){K=!1,e.hasControl&&t.isDoubleClick&&(tt-=wt*F*.001*(1-e.zoom*.25),e.targetZoom=y(e.targetZoom+.2,0,1)),e.canInteractiveWithPost&&(t.isDoubleClick||t.isClick&&bt&&(bt.onOut(),bt.onClick(),bt=null))}function Pt(t){if(!e.hasControl)return;t>0&&(tt-=wt*F*2e-4*(1-e.zoom*.25)*(1-e.targetZoom)),e.targetZoom=y(e.targetZoom+t*.05,0,1)}function Ht(){B=D.innerWidth,j=D.innerHeight,F=B/2,I=j/2;var e=screen.width,t=screen.height;it.aspect=B/j,l.uniforms.fov.value=90+60*y(B/3e3,0,1),it.setViewOffset(e,t,e-B>>1,t-j>>1,B,j),ut.setSize(B,j),ht.setSize(B,j),yt.renderTarget=ht.renderTarget1.clone(),vt.uniforms.tDiffuse2.value=yt.renderTarget}function Bt(){return Math.atan2(Z.z-G.z,Z.x-G.x)+Math.PI/2}function jt(e,t){return Math.sqrt(e*e+t*t)}function Ft(){var t=+(new Date),n=t-kt,o=e.movementEase,u=e.zoom+=(e.targetZoom-e.zoom)*e.zoomSpeed;h.scaleMapBtn(1+u),e.cameraFov=it.fov=g(u,T,x),it.updateProjectionMatrix();var c=0,p=0,d=0,v=(1-u)*(N-5)+5;e.hasControl!==q&&(tt=0,nt=0);if(e.hasControl){var m=Bt();c=tt*.1,tt-=c,Ct+=Math.abs(tt*5),G.x=Z.x-Math.sin(m)*v,G.y=C+Math.pow(u,.15)*k-Math.pow(u,40)*L,G.z=Z.z+Math.cos(m)*v,m-=Math.PI,m-=c,Z.x=G.x-Math.sin(m)*v,Z.y=(1-u)*C,Z.z=G.z+Math.cos(m)*v}Y.x+=(Z.x-Y.x)*o,Y.y+=(Z.y-Y.y)*o,Y.z+=(Z.z-Y.z)*o,Q.x+=(G.x-Q.x)*o,Q.y+=(G.y-Q.y)*o,Q.z+=(G.z-Q.z)*o;var y=e.cameraPosOffset,w=y.a,E=Math.pow(Math.sin(w*Math.PI),3);y.x=E*y.tX,y.y=E*y.tY,y.z=E*y.tZ,Q.add(y),it.position.copy(Q),R.position.copy(Y);if(e.hasControl){R.position.y=Q.y,it.lookAt(R.position),p=nt*.1,nt-=p,d=rt*.1,rt-=d,it.translateZ(p),it.position.y+=Math.abs(p)*.3,it.translateX(d),Ct+=Math.abs(p);var S={x:it.position.x-Q.x,y:0,z:it.position.z-Q.z};G.add(S),Z.add(S),Q.add(S),Y.add(S),R.position.copy(Y)}R.lookAt(it.position),ct+=e.cameraSwingSpeed;var _=e.cameraSwingRadius;it.translateX(Math.sin(ct)*_*(1-u)),it.translateY(Math.sin(ct*2)*_/2),it.lookAt(R.position),e.lookAtHorizontalAngle=Bt(),gt.uniforms.gradientOffset.value=e.lookAtHorizontalAngle;var D=Y.x,P=Y.z,I=Q.x,X=Q.z;e.cameraVector.copy(Q),e.cameraVector.sub(Y),W=2*Math.tan(it.fov/360*Math.PI)/screen.height,z.position.copy(it.position),z.rotation.copy(it.rotation),e.fixedScalePointLength=1/W,z.translateZ(-e.fixedScalePointLength);var V;for(var $=0,J=A*A;$<J;$++)V=lt[$],V.particles.position.x=-Math.floor((-D+V.offsetX+M/2+O/2)/M)*M,V.particles.position.z=-Math.floor((-P+V.offsetZ+M/2+O/2)/M)*M,V.uniforms.posFieldOffset.value.x=V.offsetX+V.particles.position.x,V.uniforms.posFieldOffset.value.z=V.offsetZ+V.particles.position.z,V.move(D,P),V.uniforms.time.value+=.2,V.uniforms.zoom.value=u,V.uniforms.cameraVector.value.copy(e.cameraVector);l.update();var et=a.update(),st=f.update();if(e.canInteractiveWithPost){var mt=et.concat(st);bt&&mt.unshift(bt);var yt=new b.Vector3(wt,Et,1);at.unprojectVector(yt,it),ft.set(it.position,yt.sub(it.position).normalize());var Lt;for($=0,J=mt.length;$<J;$++){Lt=ft.intersectObject(mt[$])[0];if(Lt)break}if(!Lt&&bt||bt&&Lt&&Lt.object!=bt)bt.onOut(),bt=null;Lt&&bt!=Lt.object&&(bt=Lt.object,bt.onOver())}bt?H.cursor="pointer":e.hasControl?(H.cursor=K?"grabbing":"grab",H.cursor=K?"-webkit-grabbing":"-webkit-grab"):H.cursor="auto",gt.uniforms.zoom.value=Math.pow(u,1.5),gt.uniforms.time.value+=gt.noiseSpeed;var At=e.blurriness;pt.uniforms.h.value=At/(.75*B),dt.uniforms.v.value=At/(.75*j),vt.uniforms.h.value=At/(.75*B),vt.uniforms.v.value=At/(.75*j),pt.uniforms.r.value=dt.uniforms.r.value=vt.uniforms.r.value=.5,pt.uniforms.blendRatio.value=dt.uniforms.blendRatio.value=vt.uniforms.blendRatio.value=e.blurBlendRatio*(1-u),ht.render(.1),r.particles.position.copy(z.position),r.particles.rotation.copy(z.rotation),r.particles.translateX(-F+r.offsetLeft),r.particles.translateY(r.offsetTop);var Ot=D-I,Mt=P-X,_t=Tt-St,Dt=Nt-xt,Pt=Math.atan2(Mt,Ot)-Math.atan2(Dt,_t);Pt>Math.PI?Pt-=Math.PI*2:Pt<-Math.PI&&(Pt+=Math.PI*2),U.rotateZ(-Pt);var Ht=Q.x-St,Ft=Q.z-xt,It=jt(Ht,Ft),qt=(Ht*Ot+Ft*Mt)/(It*jt(Ot,Mt))>0;U.rotateX(It*(qt?-1:1)*.002),r.uniforms.rotation.value.copy(U._quaternion),r.uniforms.zoom.value=u,i.uniforms.opacity.value>0&&(i.particles.position.copy(z.position),i.particles.rotation.copy(z.rotation),i.particles.translateX(i.offsetLeft),i.particles.translateY(i.offsetTop),i.updateStepTimes()),s.uniforms.animation.value<=1?(s.mesh.position.copy(z.position),s.mesh.rotation.copy(z.rotation),s.mesh.translateX(s.offsetLeft),s.mesh.translateY(s.offsetTop),s.update()):s.update(),it.near=1e-5,it.updateProjectionMatrix(),ut.render(ot,it),it.near=1,it.updateProjectionMatrix(),q=e.hasControl,St=Q.x,xt=Q.z,Tt=Y.x,Nt=Y.z,Q.sub(y),it.position.sub(y)}function It(){r.uniforms.visible.value=1}function qt(){r.uniforms.visible.value=0}function Rt(e){a.show(e)}function Ut(){a.hide()}function zt(){var e=t.settings.fading/100;for(var n=0,r=A*A;n<r;n++)E.to(lt[n].uniforms.fading,5,{value:e,ease:"linear"})}function Wt(t){var n,r=t.duration===S?1:t.duration;e.hasControl=t.lockControl===S?!1:!t.lockControl,e.canInteractiveWithPost=e.hasControl;var i=t.lookAt||t.camera||t.controller;i.onComplete=function(){e.hasControl=t.hasControl===S?!0:t.hasControl,e.canInteractiveWithPost=t.canInteractiveWithPost===S?e.hasControl:t.canInteractiveWithPost,t.cb&&t.cb()},t.controller&&(t.controller.ease=t.controller.ease||"linear",t.controller.duration!==S?(n=t.controller.duration,delete t.controller.duration):n=r,E.to(e,n,t.controller)),t.camera&&(t.camera.ease=t.camera.ease||"easeInOutSine",t.camera.duration!==S?(n=t.camera.duration,delete t.camera.duration):n=r,E.to(G,n,t.camera),E.to(e.cameraPosOffset,n,{a:t.cameraOffsetAnimation===S?0:t.cameraOffsetAnimation,ease:"linear"})),t.lookAt&&(t.lookAt.ease=t.lookAt.ease||"easeOutSine",t.lookAt.duration!==S?(n=t.lookAt.duration,delete t.lookAt.duration):n=r,E.to(Z,n,t.lookAt))}function Xt(t){var n=e.lookAtTargetPosition,r=e.lookAtHorizontalAngle,i=t.cameraOffsetY||0,s=t.lookAtOffsetY||0;e.moveTo(v({hasControl:!0,lockControl:!0,controller:{blurBlendRatio:1,zoom:0,targetZoom:0,cameraSwingRadius:.6},camera:{x:n.x-Math.sin(r)*N,y:C+i,z:n.z+Math.cos(r)*N},lookAt:{x:Y.x,y:C+s,z:Y.z}},t))}function Vt(t){e.hasControl=!0,e.canInteractiveWithPost=t===S?!0:t,E.killTweensOf(e),E.killTweensOf(G),E.killTweensOf(Z),d.show()}function $t(t){E.killTweensOf(e),E.killTweensOf(G),E.killTweensOf(Z),e.hasControl=!1,e.canInteractiveWithPost=t===S?!1:t,d.hide()}function Jt(e){var n=(e===S?t.settings.fading:e)/100;gt.uniforms.opacity.value=n,r.uniforms.fading.value=n}var S,x=t.SCENE_3D_FOV_MIN,T=t.SCENE_3D_FOV_MAX,N=t.SCENE_CAMERA_HORIZONTAL_DISTANCE,C=t.SCENE_CAMERA_VERTICAL_BASE_DISTANCE,k=t.SCENE_CAMERA_VERTICAL_UP_DISTANCE,L=t.SCENE_CAMERA_VERTICAL_DOWN_DISTANCE,A=t.PARTICLE_FIELD_GRID_SEG,O=t.PARTICLE_FIELD_GRID_SIZE,M=O*A,_=-M/2,D=window,P,H,B,j,F,I;e.hasControl=!1,e.canInteractiveWithPost=!1,e.isActive=!0;var q=!1,R=new b.Object3D,U=new b.Object3D,z=e.fixedScalePoint=new b.Object3D;e.fixedScalePointLength=0;var W=1,X=!1,V=!1,$=!1,J=!1,K;e.movementEase=.1;var Q=e.cameraPosition=new b.Vector3(0,C,N),G=e.cameraTargetPosition=new b.Vector3(0,C,N),Y=e.lookAtPosition=new b.Vector3(0,0,0),Z=e.lookAtTargetPosition=new b.Vector3(0,0,0),et=e.cameraVector=new b.Vector3(0,0,0);e.lookAtHorizontalAngle=0,e.zoomSpeed=.1,e.zoom=0,e.targetZoom=0,e.cameraFov=0,e.cameraSwingSpeed=.015,e.cameraSwingRadius=.6,e.cameraPosOffset=new b.Vector3;var tt=0,nt=0,rt=0,it,st,ot,ut,at,ft,lt=[],ct=0,ht,pt=e.hblur=null,dt=e.vblur=null,vt=e.blurBlend=null,mt=e.rgbShift=null,gt=e.customShader=null,yt;e.blurriness=1.4,e.blurBlendRatio=1;var bt=null,wt=0,Et=0,St=Q.x,xt=Q.z,Tt=Y.x,Nt=Y.z,Ct=0,kt=0;return e.init=At,e.render=Ft,e.showMap=It,e.hideMap=qt,e.showSearchedPosts=Rt,e.hideSearchedPosts=Ut,e.showParticles=zt,e.moveTo=Wt,e.resetCamera=Xt,e.enableControl=Vt,e.disableControl=$t,e.updateFading=Jt,e}),define("ui/nav",["exports","config","jquery","scene3dController","inputController","tutorialController","uiController","stepController","preloaderController","EKTweener"],function(e,t,n,r,i,s,o,u,a,f){function k(){d=n(".nav-search-wrapper"),c=l.find(".circle-btn-icon-wrapper"),a.add(l)}function L(){A(),O()}function A(){v=n(".nav-search-btn"),h=n(".nav-map-wrapper"),p=n(".nav-map-btn"),m=v[0].circleBtn,g=n(".nav-search-item"),y=n(".nav-search-item-text"),b=n(".nav-search-item-close-btn"),w=n(".nav-search-item-line"),E=n(".nav-add-wrapper"),S=n(".nav-add-btn"),x=S[0].circleBtn}function O(){i.add(p,"click",_),i.add(b,"click",M),m.onClicked.add(D),x.onClicked.add(P)}function M(){o.hidePost2d(),q(),r.hideSearchedPosts();var e=r.lookAtTargetPosition,t=r.cameraTargetPosition;r.resetCamera({hasControl:!0,lockControl:!0,duration:2,controller:{blurBlendRatio:1,zoom:0,targetZoom:0,cameraSwingRadius:.6}})}function _(e){if(r.hasControl){var t=p.offset(),n=(e.x-t.left)/46-1,i=(e.y-t.top)/46-1,s=r.lookAtTargetPosition,o=r.cameraTargetPosition,u=Math.atan2(i,n)-Math.PI/2+r.lookAtHorizontalAngle,a=Math.sqrt(n*n+i*i)*1e3,f=-Math.sin(u)*a,l=Math.cos(u)*a;r.moveTo({hasControl:!0,lockControl:!1,controller:{targetZoom:0},camera:{x:o.x+f,y:C,z:o.z+l},lookAt:{x:o.x-Math.sin(u)*N+f,y:C,z:o.z+Math.cos(u)*N+l}})}}function D(){s.completeAll(),o.hidePost2d(),o.showSearch(),q(),r.hideSearchedPosts();var e=r.lookAtTargetPosition,t=r.lookAtHorizontalAngle;r.resetCamera({hasControl:!1,lockControl:!0,duration:2,canInteractiveWithPost:!0})}function P(){s.completeAll(),o.hidePost2d(),o.hideSearch(),u.show("upload-methods"),o.hideNav(),q(),r.hideSearchedPosts()}function H(){r.showMap(),l.show()}function B(e){T=e,p&&(p[0].style[t.transform3DStyle]="scale3d("+e+","+e+",1)")}function j(){r.hideMap(),l.hide()}function F(e){}function I(e){d.addClass("has-item"),g.show(),y.text(e),f.fromTo(g,.2,{opacity:0},{opacity:1,ease:"linear"}),f.to(w,0,{width:0}),f.to(w,.2,{delay:.15,width:g.width()})}function q(){d.removeClass("has-item"),f.to(g,.2,{opacity:0,ease:"linear",onComplete:function(){g.hide()}})}var l=n(".nav"),c,h,p,d,v,m,g,y,b,w,E,S,x,T=1,N=t.SCENE_CAMERA_HORIZONTAL_DISTANCE,C=t.SCENE_CAMERA_VERTICAL_BASE_DISTANCE;e.preInit=k,e.init=L,e.show=H,e.hide=j,e.scaleMapBtn=B,e.updateFading=F,e.showSearchItem=I,e.hideSearchItem=q}),define("ui/search",["exports","config","jquery","uiController","inputController","scene3dController","postController","preloaderController","mout/string/trim","mout/string/interpolate","EKTweener"],function(e,t,n,r,i,s,o,u,a,f,l){function C(){u.add(h)}function k(){L(),A()}function L(){p=n(".search-center-wrapper"),v=n(".search-input-wrapper"),d=n(".search-input-dummy"),m=n(".search-input"),g=n(".search-input-placeholder"),y=n(".search-line"),x=n(".search-hint"),E=n(".search-btn"),b=n(".search-not-found"),w=b.html()}function A(){m.on("input",U),m.on("keypress",U),m.on("focus",R),m.on("blur",F),i.add(h,"click",M),i.add(v,"click",_),i.add(x,"click",X),i.add(E,"click",O),o.onPostSearchBegan.add(D),o.onPostsSearched.add(P),o.onPostsSearchErrored.add(H)}function O(){U({which:13})}function M(e){e.target===this&&(h.hasClass("not-found")?v():(r.hideSearch(),s.enableControl()))}function _(e){h.hasClass("not-found")&&(r.hideNavSearchItem(),h.removeClass("not-found"),m.text(T),m.focus(),q(m[0]))}function D(){r.hideNavSearchItem()}function P(e){e.all.length>0&&r.hideSearch(),e.parsedTagName!==""&&(e.all.length>0&&s.showSearchedPosts(e.all),r.showNavSearchItem(e.tagName),b.html(f(w,{interpolation:e.tagName})),h.toggleClass("not-found",!e.all.length))}function H(e){}function B(){h.removeClass("not-found"),g.css("visibility","visible"),m.text(""),x.css("display","none"),o.parsedTagName="",S=null,h.show(),l.fromTo(h,.5,{opacity:0},{opacity:1,ease:"linear"}),l.to(p,0,{transform3d:"translateZ(0)"}),l.fromTo(y,.5,{transform3d:"scale3d(0, 1, 1)"},{transform3d:"scale3d(1, 1, 1)"}),l.to(v,0,{opacity:0}),l.to(v,.5,{delay:.5,opacity:1}),m.focus()}function j(e){e=e===c?.5:e,l.to(h,e,{opacity:0,ease:"linear"}),l.to(p,e,{transform3d:"scale3d(.85, .85, 1)",onComplete:function(){h.hide()}})}function F(){U({which:1});var e=m.text(),t=a(e,["-"]);t!==e&&m.text(t),g.css("visibility",t.length>0&&t!==" "?"hidden":"visible")}function I(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function q(e){if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(typeof document.body.createTextRange!="undefined"){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}function R(){var e=m.text();if(e==""||e==" ")m.text(T),q(m[0])}function U(e){if(h.hasClass("not-found")){_();return}var r=m.html(),i=m.text();if(r.indexOf("<br>")>-1){m.html(i.replace("<br>","")),q(m[0]);return}var s,u=i.replace(" ","-").replace(/[-!$%^&*()_+|~=`{}\[\]:";'<>?,.\/]/g,"-");u=u.replace(T,"-"),u=u.replace(/\s+/g,"-"),u=u.replace("--","-");var f=N;d.css("fontSize",f).text(i);var l;for(;;){l=d.width()+22;if(!(l>530))break;d.css("fontSize",f-=1)}m[0].style.fontSize=f+"px",m[0].style[t.transform3DStyle]="translate3d(0,"+(N-f>>1)+"px,0)";var c=a(u.toLowerCase(),["-"]);e.which===13&&(s="api/",c.length>0&&(s+="/"+c),o.searchPosts(c),u=a(u,["-"])),S!==c&&e.which!==13&&(c.length>=3?setTimeout(function(){S===c&&(s="api/auto-complete-tags/"+c,n.ajax({url:s,type:"get",data:{ln:t.LANG},success:W,error:z,cache:!1}))},100):x.css("display","none")),S=c,i!==u&&(m.text(u),q(m[0])),u==""&&(m.text(T),q(m[0])),u.length>1&&u.substr(0,1)==="-"&&(m.text(u.substr(1)),q(m[0])),g.css("visibility",u.length>0&&u!=="-"?"hidden":"visible")}function z(e){r.showErrorMsgs(e.errorMsg)}function W(e){if(S.length===c||S.length<3){x.css("display","none");return}if(e.success){var t=S.toLowerCase();if(e.data.tagFragment===t){var n,r,i=e.data.list,s=S.length;x.each(function(e){r=i[e],r&&(this._tag=r,this.innerHTML=S+r.substr(s)),this.style.display=r?"inline":"none"})}}else z(e)}function X(){var e=n(this);S="",m.text(e.text()),U({which:13})}var c,h=e.container=n(".search"),p,d,v,m,g,y,b,w,E,S,x,T=n("<p>&#8203;</p>").text(),N=100;e.preInit=C,e.init=k,e.show=B,e.hide=j}),define("ui/credit",["exports","config","jquery","inputController","uiController","trackingController","preloaderController","stageReference","EKTweener"],function(e,t,n,r,i,s,o,u,a){function p(){o.add(f)}function d(){v(),m()}function v(){l=n(".credit-wrapper"),c=n(".credit-close-btn")[0].circleBtn}function m(){c.onClicked.add(y),r.add(f,"click",g)}function g(e){e.target===this&&y()}function y(){w()}function b(){if(h)return;h=!0,s.trackPage({trackPage:"footer-credits"}),f.show(),a.fromTo(l,.5,{transform3d:"translate3d(332px,0,0)"},{transform3d:"translate3d(0,0,0)"}),f.find(".bss-inner > *").each(function(e){a.to(this,0,{transform3d:"translate3d(0,30px,0)",opacity:0}),a.to(this,.5,{opacity:1,ease:"linear",delay:.1*e}),a.to(this,.5,{transform3d:"translateZ(0,0,0)",delay:.1*e})})}function w(){if(!h)return;h=!1,a.to(l,.5,{transform3d:"translate3d(332px,0,0)",onComplete:function(){f.hide()}})}var f=e.container=n(".credit"),l,c,h=!1;e.preInit=p,e.init=d,e.show=b,e.hide=w}),define("ui/errorBlocker",["exports","config","jquery","scene3dController","inputController","preloaderController","mout/lang/isArray","EKTweener"],function(e,t,n,r,i,s,o,u){function g(){s.add(a)}function y(){b(),w()}function b(){c=n(".error-blocker-messages-container"),h=n(".error-blocker-message").remove()}function w(){i.add(a,"click",E)}function E(){T()}function S(e){x(e&&e.errorMsg?e.errorMsg:m)}function x(e,n){if(v){d.push([e,n]);return}v=!0,p=n,o(e)||(e=[e]);var i,s;for(var f=0,l=e.length;f<l;f++)i=h.clone(),s=e[f],s?t.ERROR_MESSAGES[s]&&(s=t.ERROR_MESSAGES[s]):s=m,i.html(s),c.append(i);u.to(r.customShader.uniforms.alpha,1,{value:.2}),a.show()}function T(){p&&p(),p=null,v=!1,a.hide(),u.to(r.customShader.uniforms.alpha,1,{value:t.DEFAULT_NOISE_RATIO}),c.find("> *").remove();if(d.length>0){var e=d.shift();x.apply(this,e)}}var a=e.container=n(".error-blocker"),f,l,c,h,p,d=[],v=!1,m=t.ERROR_MESSAGES.unexpected;e.preInit=g,e.init=y,e.errorHandler=S,e.show=x,e.hide=T}),define("uiController",["exports","config","jquery","ui/com/CircleBtn","ui/preloader","ui/header","ui/footer","ui/terms","ui/nav","ui/search","ui/credit","ui/errorBlocker","ui/post2d","scene3dController","stageReference"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function y(){m=$(".mouse-blocker");var e=t.appContainer.find(".circle-btn");e.each(function(){new r({target:$(this)})}),i.init(),s.preInit(),o.preInit(),u.preInit(),a.preInit(),f.preInit(),c.preInit(),h.preInit(),l.preInit(),R()}function b(){s.init(),o.init(),u.init(),a.init(),f.init(),c.init(),h.init(),l.init(),d.onResize.add(q),q(),w()}function w(){s.show(),o.show()}function E(){u.show()}function S(){u.hide()}function x(){a.show(),s.showBg(),o.showBg()}function T(){a.hide(),s.hideBg(),o.hideBg()}function N(e){a.showSearchItem(e)}function C(){a.hideSearchItem()}function k(e){a.scaleMapBtn(e)}function L(){p.disableControl(),f.show()}function A(){f.hide()}function O(e){p.disableControl(),h.preShow(e)}function M(e){h.show(e)}function _(){h.hide()}function D(){l.show()}function P(){l.hide()}function H(t){return t||(t=+(new Date)+Math.random()),g=t,e.isLocked=!0,m.show(),t}function B(t){t===g&&(e.isLocked=!1,g=v,m.hide())}function j(e,t){F(e.errorMsg,t)}function F(e,t){c.show(e,t)}function I(){c.hide()}function q(){var e=d.windowHeight,t;e<700?t=100:t=140+100*(e-700)/630,s.changeHeight(t),o.changeHeight(t)}function R(e){var n=(e===v?t.settings.fading:e)/100;s.updateFading(n),o.updateFading(n),a.updateFading(n),h.updateFading(n)}var v,m,g;e.isLocked=!1,e.preInit=y,e.init=b,e.showTerms=E,e.hideTerms=S,e.showHeaderFooter=w,e.preShowPost2d=O,e.showPost2d=M,e.hidePost2d=_,e.showNav=x,e.hideNav=T,e.showNavSearchItem=N,e.hideNavSearchItem=C,e.scaleMapBtn=k,e.showSearch=L,e.hideSearch=A,e.lock=H,e.unlock=B,e.showError=j,e.showErrorMsgs=F,e.hideError=I,e.errorHandler=c.errorHandler,e.updateFading=R,e.showCredit=D,e.hideCredit=P}),define("main",["config","jquery","uiController","postController","stepController","soundController","inputController","preloaderController","tutorialController","scene3dController","widgets/SimpleScrollPane","stageReference"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(){e.USES_STATS&&(p=new Stats,p.setMode(0),p.domElement.style.position="absolute",p.domElement.style.left="0px",p.domElement.style.top="0px",h.append(p.domElement),c.onRender.add(g,this,99999),c.onRender.add(y,this,-99999)),c.init(),c.startRender(),u.add(e.colorMapPath);var n;t(".scroll-wrapper").each(function(){n=t(this),this.scrollPane=new l(n,n.find(".scroll-move-container"),n.find(".scroll-indicator")),this.scrollPane.init(),o.add(n.find(".scroll-indicator-wrapper"),"down",function(e){e.target===e.currentTarget&&this.parentNode.scrollPane.moveToRatio(-(e.y-t(e.target).offset().top)/t(e.target).height())})}),u.onReadyComplete.add(v),u.preStart()}function v(){e.colorMap=u.getLoadedItemByURL(e.colorMapPath).content,s.init(),a.init(),f.init(),setTimeout(function(){n.preInit(),h.addClass("show"),u.add(e.uiAssetPath),n._appInitFunc=m,u.start()},1e3)}function m(){e.uiAsset=u.getLoadedItemByURL(e.uiAssetPath).content,n.init(),r.init(),i.init(),f.showParticles(),r.DEFAULT_POST?(n.preShowPost2d(r.DEFAULT_POST),n.showPost2d(r.DEFAULT_POST),i.hide(),f.disableControl()):i.show()}function g(){p.begin()}function y(){p.end()}var h=e.appContainer,p=e.appContainer;d()}),require(["main"]),setTimeout=_setTimeoutBackup})();